<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protected Page</title>
</head>
<body>
    <script>
        document.write(decodeURIComponent(escape(window.atob("PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KCjxoZWFkPgogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgogICAgPHRpdGxlPlBUIExhbmRzY2FwZSAtIFByb2R1Y3QgVmlldzwvdGl0bGU+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2ZvbnQtYXdlc29tZS82LjQuMC9jc3MvYWxsLm1pbi5jc3MiPgogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLnRhaWx3aW5kY3NzLmNvbSI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9jaGFydC5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvaHRtbDJjYW52YXMvMS40LjEvaHRtbDJjYW52YXMubWluLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9qc3BkZi8yLjUuMS9qc3BkZi51bWQubWluLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL21hcmtlZC9tYXJrZWQubWluLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJQVF9MYW5kc2NhcGVfdGlwcy5qcyI+PC9zY3JpcHQ+CgogICAgPCEtLSBWNS4yNTogKDEpIEluaXRpYWwgYWxsLWNoZWNrZWQgc3RhdGUgKDIpIEZpcnN0LWZpbHRlciBhdXRvLXVuY2hlY2sgKDMpIERpc2FibGVkIFNtYXJ0IFN5bmMgZXhwYW5zaW9uICg0KSBEaXNhYmxlZCBCaWRpcmVjdGlvbmFsIEF1dG8tQ2hlY2sgKDUpIEZpeGVkIFNvZnQgU3RhcnQgYWN0aXZlIHN0YXRlIGJ1ZyAtLT4KICAgIDxzdHlsZT4KICAgICAgICA6cm9vdCB7CiAgICAgICAgICAgIC0tcGxhdGZvcm0tY29sLXdpZHRoOiA5MHB4OwogICAgICAgICAgICAtLWNhcmQtd2lkdGg6IDg2cHg7CiAgICAgICAgICAgIC0tY2VsbC13aWR0aDogY2FsYyh2YXIoLS1jYXJkLXdpZHRoKSArIDEycHgpOwogICAgICAgICAgICAvKiBVbmlmaWVkIGNlbGwgd2lkdGggZm9yIGJvdGggSGVhZGVyIGFuZCBHcmlkICovCiAgICAgICAgICAgIC0tY2FyZC1oZWlnaHQ6IDE5MnB4OwogICAgICAgICAgICAtLXpvb20tbGV2ZWw6IDE7CiAgICAgICAgICAgIC0tcHJpY2UtaGVhZGVyLWhlaWdodDogMzJweDsKICAgICAgICB9CgogICAgICAgICogewogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgIH0KCiAgICAgICAgYm9keSB7CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnSW50ZXInLCAnTm90byBTYW5zIFRDJywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGhlaWdodDogMTAwdmg7CiAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICB9CgogICAgICAgIC50b3AtZml4ZWQgewogICAgICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMnB4IDEwcHggcmdiYSgwLCAwLCAwLCAwLjEpOwogICAgICAgICAgICB6LWluZGV4OiAxMDA7CiAgICAgICAgfQoKICAgICAgICA6cm9vdCB7CiAgICAgICAgICAgIC0tem9vbS1sZXZlbDogMTsKICAgICAgICAgICAgLS1mcy1tb2RlbDogMC43cmVtOwogICAgICAgICAgICAtLWZzLWJyYW5kOiAwLjdyZW07CiAgICAgICAgICAgIC0tZnMtc3BlYzogMC43cmVtOwogICAgICAgICAgICAtLWZzLWZlYXR1cmU6IDAuN3JlbTsKICAgICAgICAgICAgLS1mcy1hY2Nlc3M6IDAuN3JlbTsKICAgICAgICAgICAgLS1mcy1wcmljZTogMC43cmVtOwogICAgICAgICAgICAtLWgtbG9nbzogMzhweDsKICAgICAgICB9CgogICAgICAgIC8qIExvYWRpbmcgQW5pbWF0aW9uICovCiAgICAgICAgQGtleWZyYW1lcyBsb2FkaW5nU3BpbiB7CiAgICAgICAgICAgIDAlIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDBkZWcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAxMDAlIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIEBrZXlmcmFtZXMgbG9hZGluZ1B1bHNlIHsKCiAgICAgICAgICAgIDAlLAogICAgICAgICAgICAxMDAlIHsKICAgICAgICAgICAgICAgIG9wYWNpdHk6IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIDUwJSB7CiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC5sb2FkaW5nLXNwaW5uZXIgewogICAgICAgICAgICBhbmltYXRpb246IGxvYWRpbmdTcGluIDEuNXMgbGluZWFyIGluZmluaXRlOwogICAgICAgIH0KCiAgICAgICAgLmxvYWRpbmctdGV4dCB7CiAgICAgICAgICAgIGFuaW1hdGlvbjogbG9hZGluZ1B1bHNlIDEuNXMgZWFzZS1pbi1vdXQgaW5maW5pdGU7CiAgICAgICAgfQoKICAgICAgICAuaGVhZGVyLXNlY3Rpb24gewogICAgICAgICAgICBwYWRkaW5nOiAwLjVyZW0gMXJlbTsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlNWU3ZWI7CiAgICAgICAgfQoKICAgICAgICAvKiDoppblnJbliIfmj5sgKi8KICAgICAgICAudmlldy10YWJzIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZ2FwOiA0cHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDAuNHJlbSAxcmVtOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjhmYWZjOwogICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2U1ZTdlYjsKICAgICAgICB9CgogICAgICAgIC52aWV3LXRhYiB7CiAgICAgICAgICAgIHBhZGRpbmc6IDZweCAxNnB4OwogICAgICAgICAgICBmb250LXNpemU6IDAuOHJlbTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2QxZDVkYjsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4yczsKICAgICAgICB9CgogICAgICAgIC52aWV3LXRhYjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmM2Y0ZjY7CiAgICAgICAgfQoKICAgICAgICAudmlldy10YWIuYWN0aXZlIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjNjY3ZWVhIDAlLCAjNzY0YmEyIDEwMCUpOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICAgICAgfQoKICAgICAgICAvKiDnr6npgbjliJcgKi8KICAgICAgICAuZmlsdGVyLWJhciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmZWZjZTg7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjZmRlMDQ3OwogICAgICAgICAgICBwYWRkaW5nOiAwLjRyZW0gMXJlbTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICAgICAgICBnYXA6IDAuNHJlbTsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICB9CgogICAgICAgIC8qIOWDueagvOevhOWcjea7keahvyAqLwogICAgICAgIC5wcmljZS1yYW5nZS1maWx0ZXIgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBnYXA6IDhweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIHBhZGRpbmc6IDRweCA4cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2QxZDVkYjsKICAgICAgICB9CgogICAgICAgIC8qIC0tLSBDaGF0IFVJIC0tLSAqLwogICAgICAgICNjaGF0RmFiIHsKICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICAgICAgICBib3R0b206IDIwcHg7CiAgICAgICAgICAgIHJpZ2h0OiAyMHB4OwogICAgICAgICAgICB3aWR0aDogNjBweDsKICAgICAgICAgICAgaGVpZ2h0OiA2MHB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICM2MzY2ZjEsICM4YjVjZjYpOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDE1cHggcmdiYSgwLCAwLCAwLCAwLjIpOwogICAgICAgICAgICB6LWluZGV4OiA5MDAwOwogICAgICAgICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4ycywgYm94LXNoYWRvdyAwLjJzOwogICAgICAgIH0KCiAgICAgICAgI2NoYXRGYWI6aG92ZXIgewogICAgICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSkgdHJhbnNsYXRlWSgtMnB4KTsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCA2cHggMjBweCByZ2JhKDAsIDAsIDAsIDAuMyk7CiAgICAgICAgfQoKICAgICAgICAjY2hhdFBhbmVsIHsKICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICAgICAgICBib3R0b206IDkwcHg7CiAgICAgICAgICAgIHJpZ2h0OiAyMHB4OwogICAgICAgICAgICB3aWR0aDogNDAwcHg7CiAgICAgICAgICAgIGhlaWdodDogNjAwcHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDVweCAyNXB4IHJnYmEoMCwgMCwgMCwgMC4xNSk7CiAgICAgICAgICAgIHotaW5kZXg6IDkwMDA7CiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNlNWU3ZWI7CiAgICAgICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4ycywgdHJhbnNmb3JtIDAuMnMsIHdpZHRoIDAuM3MsIGhlaWdodCAwLjNzLCB0b3AgMC4zcywgbGVmdCAwLjNzOwogICAgICAgIH0KCiAgICAgICAgI2NoYXRQYW5lbC5mdWxsc2NyZWVuIHsKICAgICAgICAgICAgd2lkdGg6IDkwdncgIWltcG9ydGFudDsKICAgICAgICAgICAgaGVpZ2h0OiA5MHZoICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIHRvcDogNXZoOwogICAgICAgICAgICBsZWZ0OiA1dnc7CiAgICAgICAgICAgIGJvdHRvbTogYXV0bzsKICAgICAgICAgICAgcmlnaHQ6IGF1dG87CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICB9CgogICAgICAgICNjaGF0UGFuZWwuZnVsbHNjcmVlbiAuY2hhdC1tc2cgewogICAgICAgICAgICBtYXgtd2lkdGg6IDk1JTsKICAgICAgICAgICAgLyogV2lkZXIgYnViYmxlcyBpbiBmdWxsc2NyZWVuICovCiAgICAgICAgfQoKICAgICAgICAuYXBpLWtleS1jb250YWluZXIgewogICAgICAgICAgICBwYWRkaW5nOiA4cHggMTJweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmZmJlYjsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNmY2QzNGQ7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44cmVtOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBnYXA6IDZweDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICB9CgogICAgICAgIC5hcGkta2V5LWlucHV0IHsKICAgICAgICAgICAgZmxleDogMTsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDhweDsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2QxZDVkYjsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgICAgICAgICBmb250LXNpemU6IDAuNzVyZW07CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7CiAgICAgICAgfQoKICAgICAgICAjY2hhdFBhbmVsLnZpc2libGUgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbmltYXRpb246IHNsaWRlVXAgMC4zcyBlYXNlLW91dDsKICAgICAgICB9CgogICAgICAgIEBrZXlmcmFtZXMgc2xpZGVVcCB7CiAgICAgICAgICAgIGZyb20gewogICAgICAgICAgICAgICAgb3BhY2l0eTogMDsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgyMHB4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdG8gewogICAgICAgICAgICAgICAgb3BhY2l0eTogMTsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLmNoYXQtaGVhZGVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzYzNjZmMSwgIzhiNWNmNik7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgcGFkZGluZzogMTJweCAxNnB4OwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgfQoKICAgICAgICAuY2hhdC1tZXNzYWdlcyB7CiAgICAgICAgICAgIGZsZXg6IDE7CiAgICAgICAgICAgIHBhZGRpbmc6IDE2cHg7CiAgICAgICAgICAgIG92ZXJmbG93LXk6IGF1dG87CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmOWZhZmI7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgIGdhcDogMTJweDsKICAgICAgICB9CgogICAgICAgIC5jaGF0LW1zZyB7CiAgICAgICAgICAgIG1heC13aWR0aDogODUlOwogICAgICAgICAgICBwYWRkaW5nOiA4cHggMTJweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMTJweDsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjlyZW07CiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjQ7CiAgICAgICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsKICAgICAgICB9CgogICAgICAgIC5jaGF0LW1zZy51c2VyIHsKICAgICAgICAgICAgYWxpZ24tc2VsZjogZmxleC1lbmQ7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICM2MzY2ZjE7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDJweDsKICAgICAgICB9CgogICAgICAgIC5jaGF0LW1zZy5tb2RlbCB7CiAgICAgICAgICAgIGFsaWduLXNlbGY6IGZsZXgtc3RhcnQ7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZTVlN2ViOwogICAgICAgICAgICBjb2xvcjogIzM3NDE1MTsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMnB4OwogICAgICAgIH0KCiAgICAgICAgLmNoYXQtbXNnLnN5c3RlbSB7CiAgICAgICAgICAgIGFsaWduLXNlbGY6IGNlbnRlcjsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2YzZjRmNjsKICAgICAgICAgICAgY29sb3I6ICM2YjcyODA7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC43NXJlbTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgICAgICAgICBwYWRkaW5nOiA0cHggOHB4OwogICAgICAgIH0KCiAgICAgICAgLmNoYXQtY29udHJvbHMgewogICAgICAgICAgICBwYWRkaW5nOiA4cHggMTJweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZTVlN2ViOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBnYXA6IDhweDsKICAgICAgICB9CgogICAgICAgIC5jaGF0LWFjdGlvbi1idG4gewogICAgICAgICAgICBmb250LXNpemU6IDAuNzVyZW07CiAgICAgICAgICAgIHBhZGRpbmc6IDRweCA4cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2YzZjRmNjsKICAgICAgICAgICAgY29sb3I6ICM0YjU1NjM7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnM7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNlNWU3ZWI7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGdhcDogNHB4OwogICAgICAgIH0KCiAgICAgICAgLmNoYXQtYWN0aW9uLWJ0bjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNlNWU3ZWI7CiAgICAgICAgfQoKICAgICAgICAuY2hhdC1hY3Rpb24tYnRuLmFjdGl2ZSB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNkYmVhZmU7CiAgICAgICAgICAgIGNvbG9yOiAjMjU2M2ViOwogICAgICAgICAgICBib3JkZXItY29sb3I6ICNiZmRiZmU7CiAgICAgICAgfQoKICAgICAgICAuY2hhdC1pbnB1dC1hcmVhIHsKICAgICAgICAgICAgcGFkZGluZzogMTJweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZTVlN2ViOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBnYXA6IDhweDsKICAgICAgICB9CgogICAgICAgICNjaGF0SW5wdXQgewogICAgICAgICAgICBmbGV4OiAxOwogICAgICAgICAgICBwYWRkaW5nOiA4cHggMTJweDsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2QxZDVkYjsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMjBweDsKICAgICAgICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjlyZW07CiAgICAgICAgfQoKICAgICAgICAjY2hhdElucHV0OmZvY3VzIHsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiAjNjM2NmYxOwogICAgICAgIH0KCiAgICAgICAgI3NlbmRDaGF0QnRuIHsKICAgICAgICAgICAgd2lkdGg6IDM2cHg7CiAgICAgICAgICAgIGhlaWdodDogMzZweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjNjM2NmYxOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQgMC4yczsKICAgICAgICB9CgogICAgICAgICNzZW5kQ2hhdEJ0bjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICM0ZjQ2ZTU7CiAgICAgICAgfQoKICAgICAgICAucHJpY2UtaW5wdXRzIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgZ2FwOiA0cHg7CiAgICAgICAgfQoKICAgICAgICAucHJpY2UtaW5wdXQgewogICAgICAgICAgICB3aWR0aDogNjBweDsKICAgICAgICAgICAgcGFkZGluZzogMnB4IDRweDsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjdyZW07CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNlNWU3ZWI7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgIH0KCiAgICAgICAgLnByaWNlLWlucHV0OmZvY3VzIHsKICAgICAgICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiAjM2I4MmY2OwogICAgICAgIH0KCiAgICAgICAgLnByaWNlLXNsaWRlci1jb250YWluZXIgewogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgICAgIHdpZHRoOiAxMDBweDsKICAgICAgICAgICAgaGVpZ2h0OiAyMHB4OwogICAgICAgIH0KCiAgICAgICAgLnByaWNlLXNsaWRlciB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGhlaWdodDogNHB4OwogICAgICAgICAgICB0b3A6IDhweDsKICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgICAgICAgIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsKICAgICAgICAgICAgYXBwZWFyYW5jZTogbm9uZTsKICAgICAgICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICAgICAgfQoKICAgICAgICAucHJpY2Utc2xpZGVyOjotd2Via2l0LXNsaWRlci10aHVtYiB7CiAgICAgICAgICAgIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsKICAgICAgICAgICAgYXBwZWFyYW5jZTogbm9uZTsKICAgICAgICAgICAgd2lkdGg6IDE0cHg7CiAgICAgICAgICAgIGhlaWdodDogMTRweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogIzRiNTU2MzsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgICAgIHotaW5kZXg6IDI7CiAgICAgICAgfQoKICAgICAgICAucHJpY2Utc2xpZGVyOjotbW96LXJhbmdlLXRodW1iIHsKICAgICAgICAgICAgd2lkdGg6IDE0cHg7CiAgICAgICAgICAgIGhlaWdodDogMTRweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogIzRiNTU2MzsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgfQoKICAgICAgICAucHJpY2Utc2xpZGVyLXRyYWNrIHsKICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICB0b3A6IDhweDsKICAgICAgICAgICAgbGVmdDogMDsKICAgICAgICAgICAgcmlnaHQ6IDA7CiAgICAgICAgICAgIGhlaWdodDogNHB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZTVlN2ViOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAycHg7CiAgICAgICAgfQoKICAgICAgICAucHJpY2Utc2xpZGVyLXRyYWNrOjpiZWZvcmUgewogICAgICAgICAgICBjb250ZW50OiAnJzsKICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICM0YjU1NjM7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDJweDsKICAgICAgICB9CgogICAgICAgIC5maWx0ZXItZ3JvdXAgewogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgfQoKICAgICAgICAuZmlsdGVyLWJ0biB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGdhcDogM3B4OwogICAgICAgICAgICBwYWRkaW5nOiAzcHggOHB4OwogICAgICAgICAgICBmb250LXNpemU6IDAuNjVyZW07CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZDFkNWRiOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICB9CgogICAgICAgIC5maWx0ZXItYnRuOmhvdmVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2YzZjRmNjsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiAjOWNhM2FmOwogICAgICAgIH0KCiAgICAgICAgLyogLS0tIENoYXQgVUkgLS0tICovCiAgICAgICAgI2NoYXRGYWIgewogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICAgICAgICAgIGJvdHRvbTogMjBweDsKICAgICAgICAgICAgcmlnaHQ6IDIwcHg7CiAgICAgICAgICAgIHdpZHRoOiA1NnB4OwogICAgICAgICAgICBoZWlnaHQ6IDU2cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzYzNjZmMSwgIzhiNWNmNik7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDE1cHggcmdiYSg5OSwgMTAyLCAyNDEsIDAuNCk7CiAgICAgICAgICAgIHotaW5kZXg6IDkwMDA7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4yczsKICAgICAgICB9CgogICAgICAgICNjaGF0RmFiOmhvdmVyIHsKICAgICAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwogICAgICAgIH0KCiAgICAgICAgI2NoYXRQYW5lbCB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgICAgICAgYm90dG9tOiA5MHB4OwogICAgICAgICAgICByaWdodDogMjBweDsKICAgICAgICAgICAgd2lkdGg6IDM4MHB4OwogICAgICAgICAgICBoZWlnaHQ6IDUwMHB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMTJweDsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCA4cHggMzBweCByZ2JhKDAsIDAsIDAsIDAuMTUpOwogICAgICAgICAgICB6LWluZGV4OiA5MDAwOwogICAgICAgICAgICBkaXNwbGF5OiBub25lOwogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZTVlN2ViOwogICAgICAgIH0KCiAgICAgICAgI2NoYXRQYW5lbC52aXNpYmxlIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICB9CgogICAgICAgICNjaGF0UGFuZWwuY2hhdC1mdWxsc2NyZWVuIHsKICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICAgICAgICB0b3A6IDIwMHB4OwogICAgICAgICAgICBsZWZ0OiAwOwogICAgICAgICAgICByaWdodDogMDsKICAgICAgICAgICAgYm90dG9tOiAwOwogICAgICAgICAgICB3aWR0aDogMTAwdnc7CiAgICAgICAgICAgIGhlaWdodDogY2FsYygxMDB2aCAtIDIwMHB4KTsKICAgICAgICAgICAgbWF4LXdpZHRoOiBub25lOwogICAgICAgICAgICBtYXgtaGVpZ2h0OiBub25lOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAwOwogICAgICAgICAgICB6LWluZGV4OiA5OTk5OwogICAgICAgICAgICBib3gtc2hhZG93OiBub25lOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgIH0KCiAgICAgICAgLmNoYXQtaGVhZGVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzYzNjZmMSwgIzhiNWNmNik7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgcGFkZGluZzogMTJweDsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgIH0KCiAgICAgICAgLmNoYXQtbWVzc2FnZXMgewogICAgICAgICAgICBmbGV4OiAxOwogICAgICAgICAgICBwYWRkaW5nOiAxNnB4OwogICAgICAgICAgICBvdmVyZmxvdy15OiBhdXRvOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjlmYWZiOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgICAgICBnYXA6IDEycHg7CiAgICAgICAgfQoKICAgICAgICAuY2hhdC1tc2cgewogICAgICAgICAgICBtYXgtd2lkdGg6IDkwJTsKICAgICAgICAgICAgcGFkZGluZzogMTBweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMTJweDsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjg3NXJlbTsKICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuNTsKICAgICAgICAgICAgd29yZC13cmFwOiBicmVhay13b3JkOwogICAgICAgIH0KCiAgICAgICAgLmNoYXQtbXNnLnVzZXIgewogICAgICAgICAgICBhbGlnbi1zZWxmOiBmbGV4LWVuZDsKICAgICAgICAgICAgYmFja2dyb3VuZDogIzYzNjZmMTsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgIH0KCiAgICAgICAgLmNoYXQtbXNnLm1vZGVsIHsKICAgICAgICAgICAgYWxpZ24tc2VsZjogZmxleC1zdGFydDsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNlNWU3ZWI7CiAgICAgICAgICAgIGNvbG9yOiAjMzc0MTUxOwogICAgICAgIH0KCiAgICAgICAgLmNoYXQtbXNnLnN5c3RlbSB7CiAgICAgICAgICAgIGFsaWduLXNlbGY6IGNlbnRlcjsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2YzZjRmNjsKICAgICAgICAgICAgY29sb3I6ICM2YjcyODA7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC43NXJlbTsKICAgICAgICB9CgogICAgICAgIC5jaGF0LWlucHV0LWFyZWEgewogICAgICAgICAgICBwYWRkaW5nOiAxMnB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlNWU3ZWI7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGdhcDogOHB4OwogICAgICAgIH0KCiAgICAgICAgI2NoYXRJbnB1dCB7CiAgICAgICAgICAgIGZsZXg6IDE7CiAgICAgICAgICAgIHBhZGRpbmc6IDhweCAxNHB4OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZDFkNWRiOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAyMHB4OwogICAgICAgICAgICBvdXRsaW5lOiBub25lOwogICAgICAgIH0KCiAgICAgICAgLmFwaS1rZXktYmFyIHsKICAgICAgICAgICAgcGFkZGluZzogOHB4IDEycHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmZmZiZWI7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZmNkMzRkOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBnYXA6IDhweDsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjc1cmVtOwogICAgICAgIH0KCiAgICAgICAgLmFwaS1rZXktYmFyIGlucHV0IHsKICAgICAgICAgICAgZmxleDogMTsKICAgICAgICAgICAgcGFkZGluZzogNHB4OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZDFkNWRiOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7CiAgICAgICAgfQoKICAgICAgICAuZmlsdGVyLWJ0bi5hY3RpdmUgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZGJlYWZlOwogICAgICAgICAgICBib3JkZXItY29sb3I6ICMzYjgyZjY7CiAgICAgICAgfQoKICAgICAgICAuZmlsdGVyLWRyb3Bkb3duIHsKICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICB0b3A6IDEwMCU7CiAgICAgICAgICAgIGxlZnQ6IDA7CiAgICAgICAgICAgIG1pbi13aWR0aDogMTQwcHg7CiAgICAgICAgICAgIG1heC1oZWlnaHQ6IDI4MHB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2U1ZTdlYjsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDRweCAxMnB4IHJnYmEoMCwgMCwgMCwgMC4xNSk7CiAgICAgICAgICAgIHotaW5kZXg6IDIwMDsKICAgICAgICAgICAgZGlzcGxheTogbm9uZTsKICAgICAgICB9CgogICAgICAgIC5maWx0ZXItZHJvcGRvd24uc2hvdyB7CiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgIH0KCiAgICAgICAgLmZpbHRlci1zZWFyY2ggewogICAgICAgICAgICBwYWRkaW5nOiA0cHg7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZTVlN2ViOwogICAgICAgIH0KCiAgICAgICAgLmZpbHRlci1zZWFyY2gtaW5wdXQgewogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDZweDsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjdyZW07CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkMWQ1ZGI7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDsKICAgICAgICB9CgogICAgICAgIC5maWx0ZXItc2VhcmNoLWlucHV0OmZvY3VzIHsKICAgICAgICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiAjM2I4MmY2OwogICAgICAgIH0KCiAgICAgICAgLmZpbHRlci1vcHRpb25zLWxpc3QgewogICAgICAgICAgICBtYXgtaGVpZ2h0OiAxNTBweDsKICAgICAgICAgICAgb3ZlcmZsb3cteTogYXV0bzsKICAgICAgICB9CgogICAgICAgIC5maWx0ZXItZHJvcGRvd24taGVhZGVyIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZ2FwOiAzcHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDRweDsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlNWU3ZWI7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmOGZhZmM7CiAgICAgICAgfQoKICAgICAgICAuZmlsdGVyLWRyb3Bkb3duLWhlYWRlciBidXR0b24gewogICAgICAgICAgICBmbGV4OiAxOwogICAgICAgICAgICBwYWRkaW5nOiAycHggNHB4OwogICAgICAgICAgICBmb250LXNpemU6IDAuNnJlbTsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAycHg7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICB9CgogICAgICAgIC5maWx0ZXItb3B0aW9uIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgcGFkZGluZzogM3B4IDZweDsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjY1cmVtOwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgfQoKICAgICAgICAuZmlsdGVyLW9wdGlvbjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmM2Y0ZjY7CiAgICAgICAgfQoKICAgICAgICAuZmlsdGVyLW9wdGlvbiBpbnB1dCB7CiAgICAgICAgICAgIG1hcmdpbi1yaWdodDogNXB4OwogICAgICAgIH0KCiAgICAgICAgLyog5o6n5Yi25YiXICovCiAgICAgICAgLmNvbnRyb2xzLWJhciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmOGZhZmM7CiAgICAgICAgICAgIHBhZGRpbmc6IDAuM3JlbSAxcmVtOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBnYXA6IDFyZW07CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZTVlN2ViOwogICAgICAgICAgICBmb250LXNpemU6IDAuN3JlbTsKICAgICAgICB9CgogICAgICAgIC56b29tLWNvbnRyb2xzIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgZ2FwOiA0cHg7CiAgICAgICAgfQoKICAgICAgICAuem9vbS1idG4gewogICAgICAgICAgICB3aWR0aDogMjRweDsKICAgICAgICAgICAgaGVpZ2h0OiAyNHB4OwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkMWQ1ZGI7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICBmb250LXNpemU6IDAuN3JlbTsKICAgICAgICB9CgogICAgICAgIC56b29tLWJ0bjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNlNWU3ZWI7CiAgICAgICAgfQoKICAgICAgICAvKiA9PT09PT09PT09IOagvOWtkOimluWcliA9PT09PT09PT09ICovCiAgICAgICAgLmdyaWQtd3JhcHBlciB7CiAgICAgICAgICAgIGZsZXg6IDE7CiAgICAgICAgICAgIC8qIGRpc3BsYXk6IGZsZXg7IFJFTU9WRUQgKi8KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgICAgICB6LWluZGV4OiAxOwogICAgICAgICAgICAvKiBMaW1pdCBzdGFja2luZyBjb250ZXh0IHNvIGRldGFpbC1wYW5lbCBjYW4gYXBwZWFyIGFib3ZlICovCiAgICAgICAgfQoKICAgICAgICAucGxhdGZvcm0tY29sdW1uIHsKICAgICAgICAgICAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwogICAgICAgICAgICAvKiBIaWRkZW4gaW4gZmF2b3Igb2Ygc3RpY2t5IGNvbHVtbnMgKi8KICAgICAgICB9CgogICAgICAgIC5wbGF0Zm9ybS1oZWFkZXIgewogICAgICAgICAgICBoZWlnaHQ6IHZhcigtLXByaWNlLWhlYWRlci1oZWlnaHQpOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgLyogZm9udC13ZWlnaHQ6IGJvbGQ7IGZvbnQtc2l6ZTogMC43cmVtOyBSZW1vdmVkIHRvIGFsbG93IHRvZ2dsZSBzdHlsaW5nICovCiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBib3JkZXItYm90dG9tOiAycHggc29saWQgI2U1ZTdlYjsKICAgICAgICAgICAgZmxleC1zaHJpbms6IDA7CiAgICAgICAgICAgIHBhZGRpbmc6IDAgNHB4OwogICAgICAgIH0KCiAgICAgICAgLyogVG9nZ2xlIEJ1dHRvbiBTdHlsZSAqLwogICAgICAgIC50b2dnbGUtY29udGFpbmVyIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IHJvdzsKICAgICAgICAgICAgLyogSG9yaXpvbnRhbCBhbGlnbm1lbnQgKi8KICAgICAgICAgICAgZ2FwOiA0cHg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIC8qIEVuc3VyZSBmdWxsIHdpZHRoIHVzYWdlICovCiAgICAgICAgICAgIHBhZGRpbmc6IDAgNHB4OwogICAgICAgICAgICAvKiBJbnRlcm5hbCBwYWRkaW5nICovCiAgICAgICAgfQoKICAgICAgICAvKiBHcmlkIFRvZ2dsZSBCdXR0b24gU3R5bGUgKFNwZWNpZmljIGNsYXNzIHRvIGVuc3VyZSBzdHlsaW5nKSAqLwogICAgICAgIC5ncmlkLXRvZ2dsZS1idG4gewogICAgICAgICAgICBmbGV4OiAxOwogICAgICAgICAgICAvKiBTaGFyZSB3aWR0aCBlcXVhbGx5ICovCiAgICAgICAgICAgIHdpZHRoOiBhdXRvOwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgcGFkZGluZzogNnB4IDBweCAhaW1wb3J0YW50OwogICAgICAgICAgICAvKiBUYWxsZXIgdG91Y2ggdGFyZ2V0ICovCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44cmVtICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIC8qIExhcmdlciBpY29uICovCiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnSW50ZXInLCBzeXN0ZW0tdWksIC1hcHBsZS1zeXN0ZW0sIHNhbnMtc2VyaWYgIWltcG9ydGFudDsKICAgICAgICAgICAgLyogRm9yY2Ugc2Fucy1zZXJpZiAqLwogICAgICAgICAgICBmb250LXdlaWdodDogNjAwICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkMWQ1ZGIgIWltcG9ydGFudDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGNvbG9yOiAjNGI1NTYzICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgZGlzcGxheTogZmxleCAhaW1wb3J0YW50OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGdhcDogMHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIC8qIE5vIHRleHQsIG5vIGdhcCBuZWVkZWQgKi8KICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnM7CiAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiBub25lICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIC8qIFByZXZlbnQgdXBwZXJjYXNlIHRyYW5zZm9ybWF0aW9uIGlmIGFueSAqLwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDFweCAycHggcmdiYSgwLCAwLCAwLCAwLjA1KTsKICAgICAgICAgICAgbWluLWhlaWdodDogMjhweDsKICAgICAgICAgICAgLyogRW5zdXJlIGNsaWNrYWJpbGl0eSAqLwogICAgICAgIH0KCiAgICAgICAgLmdyaWQtdG9nZ2xlLWJ0bjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmM2Y0ZjYgIWltcG9ydGFudDsKICAgICAgICB9CgogICAgICAgIC5ncmlkLXRvZ2dsZS1idG4uYWN0aXZlIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjNjY3ZWVhIDAlLCAjNzY0YmEyIDEwMCUpICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZSAhaW1wb3J0YW50OwogICAgICAgICAgICBib3JkZXItY29sb3I6IHRyYW5zcGFyZW50ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDEwMiwgMTI2LCAyMzQsIDAuMykgIWltcG9ydGFudDsKICAgICAgICB9CgogICAgICAgIC8qIE1vZGUgQnV0dG9uIFN0eWxlIChQdXJwbGUgR3JhZGllbnQpIC0gTWF0Y2hlcyBWaWV3IFRhYnMgKi8KICAgICAgICAubW9kZS1idG4gewogICAgICAgICAgICBwYWRkaW5nOiAycHggNnB4OwogICAgICAgICAgICBmb250LXNpemU6IDAuNjVyZW07CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkMWQ1ZGI7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgZ2FwOiA0cHg7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzOwogICAgICAgIH0KCiAgICAgICAgLm1vZGUtYnRuOmhvdmVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2YzZjRmNjsKICAgICAgICB9CgogICAgICAgIC5tb2RlLWJ0bi5hY3RpdmUgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICM2NjdlZWEgMCUsICM3NjRiYTIgMTAwJSk7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgICAgICB9CgogICAgICAgIC8qIE5FVyBTVElDS1kgQ0xBU1NFUyAqLwogICAgICAgIC5zdGlja3ktY29ybmVyLWhlYWRlciB7CiAgICAgICAgICAgIHdpZHRoOiBjYWxjKHZhcigtLXBsYXRmb3JtLWNvbC13aWR0aCkgKiB2YXIoLS16b29tLWxldmVsKSk7CiAgICAgICAgICAgIG1pbi13aWR0aDogY2FsYyh2YXIoLS1wbGF0Zm9ybS1jb2wtd2lkdGgpICogdmFyKC0tem9vbS1sZXZlbCkpOwogICAgICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgICAgICAgcG9zaXRpb246IHN0aWNreTsKICAgICAgICAgICAgbGVmdDogMDsKICAgICAgICAgICAgei1pbmRleDogMzA7CiAgICAgICAgICAgIC8qIEhpZ2hlciB0aGFuIGNvbnRlbnQgKi8KICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlci1yaWdodDogMXB4IHNvbGlkICNlNWU3ZWI7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsKICAgICAgICAgICAgLyogQWxpZ24gY29udGVudCB0byBsZWZ0ICovCiAgICAgICAgfQoKICAgICAgICAuc3RpY2t5LWxlZnQtY29sIHsKICAgICAgICAgICAgcG9zaXRpb246IHN0aWNreTsKICAgICAgICAgICAgbGVmdDogMDsKICAgICAgICAgICAgei1pbmRleDogMjA7CiAgICAgICAgICAgIHdpZHRoOiBjYWxjKHZhcigtLXBsYXRmb3JtLWNvbC13aWR0aCkgKiB2YXIoLS16b29tLWxldmVsKSk7CiAgICAgICAgICAgIG1pbi13aWR0aDogY2FsYyh2YXIoLS1wbGF0Zm9ybS1jb2wtd2lkdGgpICogdmFyKC0tem9vbS1sZXZlbCkpOwogICAgICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGJvcmRlci1yaWdodDogMXB4IHNvbGlkICNlNWU3ZWI7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZTVlN2ViOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTsKICAgICAgICB9CgogICAgICAgIC5zdGlja3ktcGxhdGZvcm0tY2VsbCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBjb2xvcjogIzFlM2E4YTsKICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWQgI2U1ZTdlYjsKICAgICAgICAgICAgLyogSGVpZ2h0IGlzIGF1dG8gZGV0ZXJtaW5lZCBieSByb3cgKi8KICAgICAgICB9CgogICAgICAgIC8qIExvZ28gV3JhcHBlciBTdHlsZSBmb3IgR2l0SHViLWhvc3RlZCBsb2dvcyAqLwogICAgICAgIC5sb2dvLXdyYXBwZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgICAgICAgICBwYWRkaW5nOiA0cHg7CiAgICAgICAgICAgIG1heC13aWR0aDogODAlOwogICAgICAgICAgICBtYXgtaGVpZ2h0OiA4MCU7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgIH0KCiAgICAgICAgLnN0aWNreS1oZWFkZXItcm93IHsKICAgICAgICAgICAgcG9zaXRpb246IHN0aWNreTsKICAgICAgICAgICAgdG9wOiAwOwogICAgICAgICAgICB6LWluZGV4OiAyNTsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMXB4IDJweCByZ2JhKDAsIDAsIDAsIDAuMSk7CiAgICAgICAgICAgIGhlaWdodDogNTVweDsKICAgICAgICAgICAgLyogSW5jcmVhc2VkIGhlaWdodCBmb3IgYm91bmRhcnkgbGFiZWxzICovCiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBmbGV4LWVuZDsKICAgICAgICAgICAgLyogQWxpZ24gYmFzaWMgcHJpY2UgdGlja3MgdG8gYm90dG9tICovCiAgICAgICAgfQoKICAgICAgICAuYm91bmRhcnktbGFiZWwgewogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgIHRvcDogLTIwcHg7CiAgICAgICAgICAgIGxlZnQ6IDA7CiAgICAgICAgICAgIC8qIFBvc2l0aW9uIGFib3ZlIHRoZSByZWQgbGluZSAobGVmdCBlZGdlIG9mIGNlbGwpICovCiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDgwMDsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjFyZW07CiAgICAgICAgICAgIGNvbG9yOiBibGFjazsKICAgICAgICAgICAgei1pbmRleDogNTsKICAgICAgICAgICAgcGFkZGluZzogMCAycHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC44KTsKICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgICAgfQoKICAgICAgICAucHJpY2UtaGVhZGVyLWNlbGwgewogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgICAgIHdpZHRoOiBjYWxjKHZhcigtLWNlbGwtd2lkdGgpICogdmFyKC0tem9vbS1sZXZlbCkpOwogICAgICAgICAgICBtaW4td2lkdGg6IGNhbGModmFyKC0tY2VsbC13aWR0aCkgKiB2YXIoLS16b29tLWxldmVsKSk7CiAgICAgICAgICAgIGhlaWdodDogdmFyKC0tcHJpY2UtaGVhZGVyLWhlaWdodCk7CiAgICAgICAgICAgIGZsZXgtc2hyaW5rOiAwOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogZmxleC1lbmQ7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgICAgICBwYWRkaW5nOiAycHg7CiAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiA0cHg7CiAgICAgICAgICAgIGJvcmRlci1yaWdodDogMXB4IHNvbGlkIHRyYW5zcGFyZW50OwogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICAgICAgY29sb3I6ICMxZTNhOGE7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC43cmVtOwogICAgICAgIH0KCiAgICAgICAgLnN0aWNreS1jb3JuZXItaGVhZGVyIHsKICAgICAgICAgICAgcG9zaXRpb246IHN0aWNreTsKICAgICAgICAgICAgbGVmdDogMDsKICAgICAgICAgICAgdG9wOiAwOwogICAgICAgICAgICB6LWluZGV4OiAzMCAhaW1wb3J0YW50OwogICAgICAgICAgICB3aWR0aDogY2FsYyh2YXIoLS1wbGF0Zm9ybS1jb2wtd2lkdGgpICogdmFyKC0tem9vbS1sZXZlbCkpOwogICAgICAgICAgICBtaW4td2lkdGg6IGNhbGModmFyKC0tcGxhdGZvcm0tY29sLXdpZHRoKSAqIHZhcigtLXpvb20tbGV2ZWwpKTsKICAgICAgICAgICAgZmxleC1zaHJpbms6IDA7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBib3JkZXItYm90dG9tOiAycHggc29saWQgI2U1ZTdlYjsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgLyogRW5zdXJlIHRvZ2dsZSBjb250YWluZXIgaXMgY2VudGVyZWQgKi8KICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgfQoKICAgICAgICAucGxhdGZvcm0tbGlzdCB7CiAgICAgICAgICAgIGZsZXg6IDE7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgfQoKICAgICAgICAucGxhdGZvcm0tY2VsbCB7CiAgICAgICAgICAgIGhlaWdodDogY2FsYyh2YXIoLS1jYXJkLWhlaWdodCkgKiB2YXIoLS16b29tLWxldmVsKSk7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBwYWRkaW5nOiAwLjNyZW07CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMSk7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgZm9udC1zaXplOiBjYWxjKDAuNjVyZW0gKiB2YXIoLS16b29tLWxldmVsKSk7CiAgICAgICAgfQoKICAgICAgICAucGxhdGZvcm0tbG9nbyB7CiAgICAgICAgICAgIG1heC13aWR0aDogY2FsYyg5MXB4ICogdmFyKC0tem9vbS1sZXZlbCkpOwogICAgICAgICAgICBtYXgtaGVpZ2h0OiBjYWxjKDUycHggKiB2YXIoLS16b29tLWxldmVsKSk7CiAgICAgICAgICAgIG9iamVjdC1maXQ6IGNvbnRhaW47CiAgICAgICAgfQoKICAgICAgICAuZ3JpZC1tYWluIHsKICAgICAgICAgICAgZmxleDogMTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICB9CgogICAgICAgIC8qIOWbuuWumuWDueagvOaomemgrSAqLwogICAgICAgIC5wcmljZS1oZWFkZXItY29udGFpbmVyIHsKICAgICAgICAgICAgZmxleC1zaHJpbms6IDA7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgI2ZiYmYyNCAwJSwgI2Y1OWUwYiAxMDAlKTsKICAgICAgICB9CgogICAgICAgIC5wcmljZS1oZWFkZXItcm93IHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICB9CgogICAgICAgIC8qIERVUExJQ0FURSBSRU1PVkVEIC0gdXNpbmcgZGVmaW5pdGlvbiBhdCBsaW5lIDQzMCAqLwoKICAgICAgICAvKiBSdWxlciBUaWNrcyAqLwogICAgICAgIC50aWNrLW1ham9yOjpiZWZvcmUgewogICAgICAgICAgICBjb250ZW50OiAnJzsKICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgICAgICB0b3A6IDA7CiAgICAgICAgICAgIGxlZnQ6IDUwJTsKICAgICAgICAgICAgLyogQ2VudGVyIHRoZSB0aWNrID8/IE9yIGxlZnQgZWRnZT8gIlN0cmFpZ2h0IHJ1bGVyIiB1c3VhbGx5IGhhcyB0aWNrcyBhdCBlZGdlLiBCdXQgb3VyIGNlbGxzIGFyZSBjZW50ZXJlZCB2YWx1ZXMuICovCiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsKICAgICAgICAgICAgd2lkdGg6IDJweDsKICAgICAgICAgICAgaGVpZ2h0OiAxMnB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMWUzYThhOwogICAgICAgIH0KCiAgICAgICAgLnRpY2stbWlub3I6OmJlZm9yZSB7CiAgICAgICAgICAgIGNvbnRlbnQ6ICcnOwogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgIHRvcDogMDsKICAgICAgICAgICAgbGVmdDogNTAlOwogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7CiAgICAgICAgICAgIHdpZHRoOiAxcHg7CiAgICAgICAgICAgIGhlaWdodDogNnB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDMwLCA1OCwgMTM4LCAwLjUpOwogICAgICAgIH0KCiAgICAgICAgLyogUmVkIEJvcmRlciBIZWxwZXIgKi8KICAgICAgICAuYm9yZGVyLWxlZnQtcmVkLWN1c3RvbSB7CiAgICAgICAgICAgIGJvcmRlci1sZWZ0OiAxLjVweCBzb2xpZCByZWQgIWltcG9ydGFudDsKICAgICAgICB9CgogICAgICAgIC8qIEluIGhlYWRlciByb3csIHJlbW92aW5nIHJlZCBsaW5lIGFzIHBlciB1c2VyIHJlcXVlc3QgaWYgbm90IGFsaWduZWQgKi8KICAgICAgICAuc3RpY2t5LWhlYWRlci1yb3cgLmJvcmRlci1sZWZ0LXJlZC1jdXN0b20gewogICAgICAgICAgICBib3JkZXItbGVmdDogbm9uZSAhaW1wb3J0YW50OwogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgfQoKICAgICAgICAvKiBSZW1vdmVkIDo6YmVmb3JlIHBzZXVkby1lbGVtZW50IHRoYXQgZHJldyB0aGUgbWlzYWxpZ25lZCBsaW5lICovCgogICAgICAgIC5ncmlkLXNjcm9sbC1hcmVhIHsKICAgICAgICAgICAgZmxleDogMTsKICAgICAgICAgICAgb3ZlcmZsb3c6IGF1dG87CiAgICAgICAgfQoKICAgICAgICAuZ3JpZC1jb250ZW50IHsKICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgfQoKICAgICAgICAuZGF0YS1yb3cgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICAvKiBBbGxvdyByb3cgdG8gc2hyaW5rL2dyb3cgYmFzZWQgb24gY29udGVudCAqLwogICAgICAgICAgICBoZWlnaHQ6IGF1dG87CiAgICAgICAgfQoKICAgICAgICAuZGF0YS1yb3c6bnRoLWNoaWxkKGV2ZW4pIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjUpOwogICAgICAgIH0KCiAgICAgICAgLmRhdGEtcm93Om50aC1jaGlsZChvZGQpIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjg1KTsKICAgICAgICB9CgogICAgICAgIC5ncmlkLWNlbGwgewogICAgICAgICAgICB3aWR0aDogY2FsYyh2YXIoLS1jZWxsLXdpZHRoKSAqIHZhcigtLXpvb20tbGV2ZWwpKTsKICAgICAgICAgICAgbWluLXdpZHRoOiBjYWxjKHZhcigtLWNlbGwtd2lkdGgpICogdmFyKC0tem9vbS1sZXZlbCkpOwogICAgICAgICAgICBoZWlnaHQ6IGF1dG87CiAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDA7CiAgICAgICAgICAgIHBhZGRpbmc6IDJweDsKICAgICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWQgI2U1ZTdlYjsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlNWU3ZWI7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgIH0KCiAgICAgICAgLyogSGlkZSBzY3JvbGxiYXIgZm9yIGNsZWFuZXIgbG9vayBidXQgYWxsb3cgc2Nyb2xsICovCiAgICAgICAgLmdyaWQtY2VsbDo6LXdlYmtpdC1zY3JvbGxiYXIgewogICAgICAgICAgICBoZWlnaHQ6IDRweDsKICAgICAgICB9CgogICAgICAgIC5ncmlkLWNlbGw6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2NiZDVlMTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMnB4OwogICAgICAgIH0KCiAgICAgICAgLnByb2R1Y3QtY2FyZCB7CiAgICAgICAgICAgIGZsZXgtc2hyaW5rOiAwOwogICAgICAgICAgICAvKiBQcmV2ZW50IHNocmlua2luZyAqLwogICAgICAgIH0KCiAgICAgICAgLmhpZGUtc3BlY3MgLmNhcmQtc3BlY3MgewogICAgICAgICAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CiAgICAgICAgfQoKICAgICAgICAuaGlkZS1mZWF0dXJlcyAuY2FyZC10b3RhbCB7CiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKICAgICAgICB9CgogICAgICAgIC5oaWRlLWFjY2Vzc29yaWVzIC5jYXJkLWFjY2Vzc29yaWVzIHsKICAgICAgICAgICAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwogICAgICAgIH0KCiAgICAgICAgLnByb2R1Y3QtY2FyZCB7CiAgICAgICAgICAgIHdpZHRoOiB2YXIoLS1jYXJkLXdpZHRoKTsKICAgICAgICAgICAgLyogQWxsb3cgaGVpZ2h0IHRvIGFkYXB0ICovCiAgICAgICAgICAgIGhlaWdodDogYXV0bzsKICAgICAgICAgICAgbWluLWhlaWdodDogMTAwJTsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAxcHggNHB4IHJnYmEoMCwgMCwgMCwgMC4wOCk7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuMTVzLCBib3gtc2hhZG93IDAuMTVzOwogICAgICAgICAgICB6b29tOiB2YXIoLS16b29tLWxldmVsKTsKICAgICAgICAgICAgdHJhbnNmb3JtLW9yaWdpbjogdG9wIGxlZnQ7CiAgICAgICAgfQoKICAgICAgICAucHJvZHVjdC1jYXJkOmhvdmVyIHsKICAgICAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjA1KSB0cmFuc2xhdGVZKC0xcHgpOwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDNweCAxMHB4IHJnYmEoMCwgMCwgMCwgMC4xNSk7CiAgICAgICAgICAgIHotaW5kZXg6IDEwOwogICAgICAgIH0KCiAgICAgICAgLmNhcmQtaW1hZ2UgewogICAgICAgICAgICBoZWlnaHQ6IDQ1cHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICB9CgogICAgICAgIC5jYXJkLWltYWdlIGltZyB7CiAgICAgICAgICAgIG1heC13aWR0aDogMTAwJTsKICAgICAgICAgICAgbWF4LWhlaWdodDogMTAwJTsKICAgICAgICAgICAgb2JqZWN0LWZpdDogY29udGFpbjsKICAgICAgICB9CgogICAgICAgIC5jYXJkLWJvZHkgewogICAgICAgICAgICBmbGV4OiAxOwogICAgICAgICAgICBwYWRkaW5nOiAzcHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC41NXJlbTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICAgICAgZ2FwOiAxcHg7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgfQoKICAgICAgICAuY2FyZC1icmFuZCB7CiAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDE0cHg7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjhmYWZjOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAycHg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZnMtYnJhbmQpOwogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgIH0KCiAgICAgICAgLyogU2hvdy9IaWRlIExvZ2ljIGZvciBCcmFuZCBMb2dvICovCiAgICAgICAgLmJyYW5kLWltZyB7CiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7CiAgICAgICAgICAgIG1heC13aWR0aDogMTAwJTsKICAgICAgICAgICAgbWF4LWhlaWdodDogMTAwJTsKICAgICAgICAgICAgb2JqZWN0LWZpdDogY29udGFpbjsKICAgICAgICB9CgogICAgICAgIC5icmFuZC10ZXh0IHsKICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgICAgfQoKICAgICAgICAuc2hvdy1sb2dvcyAuYnJhbmQtaW1nIHsKICAgICAgICAgICAgZGlzcGxheTogYmxvY2sgIWltcG9ydGFudDsKICAgICAgICB9CgogICAgICAgIC5zaG93LWxvZ29zIC5icmFuZC10ZXh0IHsKICAgICAgICAgICAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwogICAgICAgIH0KCiAgICAgICAgLnNob3ctbG9nb3MgLmNhcmQtYnJhbmQgewogICAgICAgICAgICBoZWlnaHQ6IHZhcigtLWgtbG9nbyk7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBmb250LXNpemU6IHZhcigtLWZzLWJyYW5kKTsKICAgICAgICB9CgogICAgICAgIC5jYXJkLW1vZGVsIHsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgICAgIGNvbG9yOiAjMWUzYThhOwogICAgICAgICAgICBmb250LXNpemU6IHZhcigtLWZzLW1vZGVsKTsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICAvKiBSZW1vdmUgZml4ZWQgaGVpZ2h0IHRvIGFsbG93IGZvbnQgc2NhbGluZyAqLwogICAgICAgICAgICAvKiBoZWlnaHQ6IDI0cHg7ICovCiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjE7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICAgICAgICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOwogICAgICAgICAgICAvKiBkaXNwbGF5OiAtd2Via2l0LWJveDsgUmVtb3ZlZCBtdWx0aS1saW5lIGNsYW1wICovCiAgICAgICAgICAgIC8qIC13ZWJraXQtbGluZS1jbGFtcDogMjsgKi8KICAgICAgICAgICAgLyogbGluZS1jbGFtcDogMjsgKi8KICAgICAgICAgICAgLyogLXdlYmtpdC1ib3gtb3JpZW50OiB2ZXJ0aWNhbDsgKi8KICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMnB4OwogICAgICAgIH0KCiAgICAgICAgLmNhcmQtc3BlY3MgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjFmNWY5OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZTJlOGYwOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAycHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDFweCAycHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZnMtc3BlYyk7CiAgICAgICAgICAgIGNvbG9yOiAjNjQ3NDhiOwogICAgICAgICAgICBsaW5lLWhlaWdodDogMS4xNTsKICAgICAgICAgICAgb3ZlcmZsb3c6IHZpc2libGU7CiAgICAgICAgICAgIC8qIENoYW5nZWQgZnJvbSBoaWRkZW4gdG8gdmlzaWJsZSAqLwogICAgICAgICAgICBmb250LWZhbWlseTogbW9ub3NwYWNlOwogICAgICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgICAgICAgbWluLWhlaWdodDogbWluLWNvbnRlbnQ7CiAgICAgICAgICAgIC8qIEVuc3VyZSBpdCB0YWtlcyBuZWVkZWQgc3BhY2UgKi8KICAgICAgICB9CgogICAgICAgIC5jYXJkLXNwZWMgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICAgICAgfQoKICAgICAgICAuY2FyZC10b3RhbCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmZmZiZWI7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNmZGU2OGE7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDJweDsKICAgICAgICAgICAgcGFkZGluZzogMXB4IDJweDsKICAgICAgICAgICAgZm9udC1zaXplOiB2YXIoLS1mcy1mZWF0dXJlKTsKICAgICAgICAgICAgY29sb3I6ICM5MjQwMGU7CiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjE1OwogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgICAgICBmb250LWZhbWlseTogbW9ub3NwYWNlOwogICAgICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgICB9CgogICAgICAgIC5jYXJkLXRvdGFsLWxpbmUgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICAgICAgfQoKICAgICAgICAuY2FyZC1hY2Nlc3NvcmllcyB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmMGZkZjQ7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICM4NmVmYWM7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDJweDsKICAgICAgICAgICAgcGFkZGluZzogMXB4IDJweDsKICAgICAgICAgICAgZm9udC1zaXplOiB2YXIoLS1mcy1hY2Nlc3MpOwogICAgICAgICAgICBjb2xvcjogIzE2NjUzNDsKICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuMTU7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIGZsZXgtc2hyaW5rOiAwOwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogICAgICAgICAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKICAgICAgICB9CgogICAgICAgIC5jYXJkLXByaWNlIHsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICBmb250LXNpemU6IHZhcigtLWZzLXByaWNlKTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgICAgIGNvbG9yOiAjMWUzYThhOwogICAgICAgICAgICBwYWRkaW5nOiAycHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmOGZhZmM7CiAgICAgICAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZTVlN2ViOwogICAgICAgIH0KCiAgICAgICAgLmVtcHR5LWNlbGwgewogICAgICAgICAgICBjb2xvcjogI2U1ZTdlYjsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjhyZW07CiAgICAgICAgfQoKICAgICAgICAvKiA9PT09PT09PT09IOaVo+m7nuWcluimluWcliA9PT09PT09PT09ICovCiAgICAgICAgLnNjYXR0ZXItd3JhcHBlciB7CiAgICAgICAgICAgIGZsZXg6IDE7CiAgICAgICAgICAgIHBhZGRpbmc6IDFyZW07CiAgICAgICAgICAgIG92ZXJmbG93OiBhdXRvOwogICAgICAgICAgICBkaXNwbGF5OiBub25lOwogICAgICAgIH0KCiAgICAgICAgLnNjYXR0ZXItY29udGFpbmVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgcGFkZGluZzogMXJlbTsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAycHggOHB4IHJnYmEoMCwgMCwgMCwgMC4xKTsKICAgICAgICAgICAgbWluLWhlaWdodDogMTAwJTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICB9CgogICAgICAgIC5zY2F0dGVyLWNoYXJ0LXdyYXBwZXIgewogICAgICAgICAgICBmbGV4OiAwIDAgYXV0bzsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgICAgICBtaW4taGVpZ2h0OiAwOwogICAgICAgIH0KCiAgICAgICAgLnNjYXR0ZXItY2hhcnQtd3JhcHBlciBjYW52YXMgewogICAgICAgICAgICB3aWR0aDogMTAwJSAhaW1wb3J0YW50OwogICAgICAgICAgICBoZWlnaHQ6IDEwMCUgIWltcG9ydGFudDsKICAgICAgICB9CgogICAgICAgIC5zY2F0dGVyLWNvbnRyb2xzIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZ2FwOiAxcmVtOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxcmVtOwogICAgICAgICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICAgICAgfQoKICAgICAgICAuc2NhdHRlci1jb250cm9scyBsYWJlbCB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44cmVtOwogICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgICAgICBjb2xvcjogIzQ3NTU2OTsKICAgICAgICB9CgogICAgICAgIC5zY2F0dGVyLWNvbnRyb2xzIHNlbGVjdCB7CiAgICAgICAgICAgIHBhZGRpbmc6IDRweCA4cHg7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkMWQ1ZGI7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjhyZW07CiAgICAgICAgfQoKICAgICAgICAvKiDnlKLlk4HoqbPmg4XpnaLmnb8gKi8KICAgICAgICAuZGV0YWlsLXBhbmVsIHsKICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICAgICAgICByaWdodDogLTM2MHB4OwogICAgICAgICAgICB0b3A6IDA7CiAgICAgICAgICAgIHdpZHRoOiAzNjBweDsKICAgICAgICAgICAgaGVpZ2h0OiAxMDB2aDsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IC00cHggMCAyMHB4IHJnYmEoMCwgMCwgMCwgMC4xKTsKICAgICAgICAgICAgei1pbmRleDogNTAwOwogICAgICAgICAgICB0cmFuc2l0aW9uOiByaWdodCAwLjNzIGVhc2U7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgfQoKICAgICAgICAuZGV0YWlsLXBhbmVsLm9wZW4gewogICAgICAgICAgICByaWdodDogMDsKICAgICAgICB9CgogICAgICAgIC5kZXRhaWwtaGVhZGVyIHsKICAgICAgICAgICAgcG9zaXRpb246IHN0aWNreTsKICAgICAgICAgICAgdG9wOiAwOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICM2NjdlZWEgMCUsICM3NjRiYTIgMTAwJSk7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgcGFkZGluZzogMXJlbTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICB6LWluZGV4OiAxMDsKICAgICAgICAgICAgZmxleC1zaHJpbms6IDA7CiAgICAgICAgfQoKICAgICAgICAuZGV0YWlsLWNsb3NlIHsKICAgICAgICAgICAgd2lkdGg6IDMycHg7CiAgICAgICAgICAgIGhlaWdodDogMzJweDsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yKTsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgIH0KCiAgICAgICAgLmRldGFpbC1jbG9zZTpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKTsKICAgICAgICB9CgogICAgICAgIC5kZXRhaWwtYm9keSB7CiAgICAgICAgICAgIGZsZXg6IDE7CiAgICAgICAgICAgIG92ZXJmbG93LXk6IGF1dG87CiAgICAgICAgICAgIHBhZGRpbmc6IDFyZW07CiAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiA0MHB4OwogICAgICAgICAgICAvKiBQcmV2ZW50IGN1dC1vZmYgKi8KICAgICAgICB9CgogICAgICAgIC5kZXRhaWwtaW1hZ2UgewogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgbWF4LWhlaWdodDogMjAwcHg7CiAgICAgICAgICAgIG9iamVjdC1maXQ6IGNvbnRhaW47CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmM2Y0ZjY7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMXJlbTsKICAgICAgICB9CgogICAgICAgIC5kZXRhaWwtcm93IHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgcGFkZGluZzogMC41cmVtIDA7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZjFmNWY5OwogICAgICAgICAgICBmb250LXNpemU6IDAuODVyZW07CiAgICAgICAgfQoKICAgICAgICAuZGV0YWlsLWxhYmVsIHsKICAgICAgICAgICAgd2lkdGg6IDEwMHB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgICAgICBjb2xvcjogIzY0NzQ4YjsKICAgICAgICAgICAgZmxleC1zaHJpbms6IDA7CiAgICAgICAgfQoKICAgICAgICAuZGV0YWlsLXZhbHVlIHsKICAgICAgICAgICAgZmxleDogMTsKICAgICAgICAgICAgY29sb3I6ICMxZTI5M2I7CiAgICAgICAgICAgIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsKICAgICAgICB9CgogICAgICAgIC5sb2FkZXIgewogICAgICAgICAgICB3aWR0aDogMzZweDsKICAgICAgICAgICAgaGVpZ2h0OiAzNnB4OwogICAgICAgICAgICBib3JkZXI6IDNweCBzb2xpZCAjNjY3ZWVhOwogICAgICAgICAgICBib3JkZXItYm90dG9tLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICAgICBhbmltYXRpb246IHNwaW4gMXMgbGluZWFyIGluZmluaXRlOwogICAgICAgIH0KCiAgICAgICAgQGtleWZyYW1lcyBzcGluIHsKICAgICAgICAgICAgdG8gewogICAgICAgICAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMzYwZGVnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLm92ZXJsYXkgewogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICAgICAgICAgIGluc2V0OiAwOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMyk7CiAgICAgICAgICAgIHotaW5kZXg6IDE0MDsKICAgICAgICAgICAgZGlzcGxheTogbm9uZTsKICAgICAgICB9CgogICAgICAgIC5vdmVybGF5LnNob3cgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICB9CgogICAgICAgIC8qIFNldHRpbmdzIE1vZGFsICovCiAgICAgICAgLm1vZGFsIHsKICAgICAgICAgICAgZGlzcGxheTogbm9uZTsKICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICAgICAgICB6LWluZGV4OiAyMDA7CiAgICAgICAgICAgIGxlZnQ6IDA7CiAgICAgICAgICAgIHRvcDogMDsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICAgICAgb3ZlcmZsb3c6IGF1dG87CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC40KTsKICAgICAgICB9CgogICAgICAgIC5tb2RhbC1jb250ZW50IHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZlZmVmZTsKICAgICAgICAgICAgbWFyZ2luOiAxNSUgYXV0bzsKICAgICAgICAgICAgcGFkZGluZzogMjBweDsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgIzg4ODsKICAgICAgICAgICAgd2lkdGg6IDMwMHB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDZweCByZ2JhKDAsIDAsIDAsIDAuMSk7CiAgICAgICAgfQoKICAgICAgICAubW9kYWwtaGVhZGVyIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxcmVtOwogICAgICAgIH0KCiAgICAgICAgLmNsb3NlLW1vZGFsIHsKICAgICAgICAgICAgY29sb3I6ICNhYWE7CiAgICAgICAgICAgIGZsb2F0OiByaWdodDsKICAgICAgICAgICAgZm9udC1zaXplOiAyOHB4OwogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgIH0KCiAgICAgICAgLnNldHRpbmctaXRlbSB7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDFyZW07CiAgICAgICAgfQoKICAgICAgICAuc2V0dGluZy1pdGVtIGxhYmVsIHsKICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDAuNXJlbTsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjlyZW07CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgfQoKICAgICAgICAuc2V0dGluZy1pdGVtIGlucHV0W3R5cGU9cmFuZ2VdIHsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgfQoKICAgICAgICAvKiBOZXcgVmlldyBNb2RlIC8gRGF0YSBNb2RlIFN0eWxlcyAqLwogICAgICAgIC5tb2RlLWdyb3VwIHsKICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmMWY1Zjk7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDk5OTlweDsKICAgICAgICAgICAgcGFkZGluZzogNHB4OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZTJlOGYwOwogICAgICAgIH0KCiAgICAgICAgLm1vZGUtZ3JvdXAtbGFiZWwgewogICAgICAgICAgICBmb250LXNpemU6IDAuNzVyZW07CiAgICAgICAgICAgIC8qIHRleHQteHMgKi8KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgICAgICAgY29sb3I6ICM2NDc0OGI7CiAgICAgICAgICAgIC8qIHNsYXRlLTUwMCAqLwogICAgICAgICAgICBtYXJnaW4tbGVmdDogMTJweDsKICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiA4cHg7CiAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAwLjA1ZW07CiAgICAgICAgfQoKICAgICAgICAubW9kZS1idG4gewogICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIHBhZGRpbmc6IDZweCAxNnB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA5OTk5cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44NzVyZW07CiAgICAgICAgICAgIC8qIHRleHQtc20gKi8KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICAgICAgY29sb3I6ICM2NDc0OGI7CiAgICAgICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnM7CiAgICAgICAgICAgIGdhcDogNnB4OwogICAgICAgIH0KCiAgICAgICAgLm1vZGUtYnRuIGkgewogICAgICAgICAgICBmb250LXNpemU6IDFyZW07CiAgICAgICAgfQoKICAgICAgICAubW9kZS1idG46aG92ZXIgewogICAgICAgICAgICBjb2xvcjogIzMzNDE1NTsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjUpOwogICAgICAgIH0KCiAgICAgICAgLyogRGlzcGxheSBNb2RlIEFjdGl2ZSAoUHVycGxlIC0gVW5pZmllZCkgKi8KICAgICAgICAubW9kZS1ncm91cDpub3QoLmRhdGEtbW9kZSkgLm1vZGUtYnRuLmFjdGl2ZSB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICM5MzMzZWE7CiAgICAgICAgICAgIC8qIHB1cnBsZS02MDAgKi8KICAgICAgICAgICAgY29sb3I6ICNmZmZmZmY7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMXB4IDJweCByZ2JhKDAsIDAsIDAsIDAuMSk7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgfQoKICAgICAgICAvKiBEYXRhIE1vZGUgQWN0aXZlIChQdXJwbGUpICovCiAgICAgICAgLmRhdGEtbW9kZSAubW9kZS1idG4uYWN0aXZlIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzkzMzNlYTsKICAgICAgICAgICAgLyogcHVycGxlLTYwMCAqLwogICAgICAgICAgICBjb2xvcjogI2ZmZmZmZjsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAxcHggMnB4IHJnYmEoMCwgMCwgMCwgMC4xKTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cgo8Ym9keT4KICAgIDxkaXYgY2xhc3M9InRvcC1maXhlZCI+CiAgICAgICAgPCEtLSDlj6/mipjnlornmoQgaGVhZGVyIOWNgOWfnyAtLT4KICAgICAgICA8ZGl2IGlkPSJoZWFkZXJDb2xsYXBzaWJsZSIgY2xhc3M9InRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTMwMCBvdmVyZmxvdy1oaWRkZW4iPgogICAgICAgICAgICA8aGVhZGVyIGNsYXNzPSJoZWFkZXItc2VjdGlvbiI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4iPgogICAgICAgICAgICAgICAgICAgIDxoMSBjbGFzcz0idGV4dC1iYXNlIGZvbnQtYm9sZCB0ZXh0LWluZGlnby05MDAiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSJpbmxpbmUtYmxvY2sgbXItMSB3LTUgaC01IHRleHQtaW5kaWdvLTYwMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0LjMxIDhsNS43NCA5Ljk0IiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTkuNjkgOGgxMS40OCIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik03LjM4IDEybDUuNzQtOS45NCIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik05LjY5IDE2TDMuOTUgNi4wNiIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNC4zMSAxNkgyLjgzIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2LjYyIDEybC01Ljc0IDkuOTQiIC8+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPlBUIExhbmRzY2FwZQogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ibG9hZFN0YXR1cyIgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCBtbC0yIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9oMT4KICAgICAgICAgICAgICAgICAgICA8IS0tIENvbnRyb2xzIC0gUmlnaHQgYWxpZ25lZCAtLT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gR1Mg5qmf56iu5pW055CGIFNoZWV0IC0tPgogICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJnc1NoZWV0U2VsZWN0IiBjbGFzcz0icHktMSBweC0yIGJvcmRlciBib3JkZXItZ3JheS0zMDAgcm91bmRlZCB0ZXh0LXhzIHctMjQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iTVRTIExpc3QiPk1UUyBMaXN0PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgICAgICA8IS0tIEdTIFBUIERBVEEgLS0+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9ImZpbGVTZWxlY3QiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0icHktMSBweC0yIHRleHQteHMgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkIGJnLXZpb2xldC01MCB0ZXh0LXZpb2xldC03MDAgZm9udC1ib2xkIGZvY3VzOm91dGxpbmUtbm9uZSBmb2N1czpyaW5nLTIgZm9jdXM6cmluZy12aW9sZXQtNTAwIHctMjgiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iIiBkaXNhYmxlZCBzZWxlY3RlZD5EYXRhLi4uPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgICAgICA8IS0tIFVuaWZpZWQgUmVmcmVzaCArIExvYWQgLS0+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImZldGNoU2hlZXRzQnRuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9InB4LTIgcHktMSBiZy1ibHVlLTEwMCB0ZXh0LWJsdWUtNjAwIHJvdW5kZWQgdGV4dC14cyBob3ZlcjpiZy1ibHVlLTIwMCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPSJSZWZyZXNoIEdTIFNoZWV0cyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXN5bmMtYWx0Ij48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJsb2FkRGF0YUJ0biIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPSJweS0xIHB4LTMgYmctZ3JhZGllbnQtdG8tciBmcm9tLXZpb2xldC02MDAgdG8tcHVycGxlLTYwMCB0ZXh0LXdoaXRlIHJvdW5kZWQgdGV4dC14cyBmb250LW1lZGl1bSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXBsYXkgbXItMSI+PC9pPkxvYWQKICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9oZWFkZXI+CgogICAgICAgICAgICA8IS0tIOimluWcluWIh+aPmyAtLT4KICAgICAgICAgICAgPGRpdiBjbGFzcz0idmlldy10YWJzIiBpZD0idmlld1RhYnMiIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+CiAgICAgICAgICAgICAgICA8IS0tIERpc3BsYXkgTW9kZSBHcm91cCAtLT4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGUtZ3JvdXAiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJtb2RlLWdyb3VwLWxhYmVsIj5EaXNwbGF5Ojwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJtb2RlLWJ0biBhY3RpdmUiIGRhdGEtdmlldz0iZ3JpZCI+PGkgY2xhc3M9ImZhcyBmYS10aCI+PC9pPkxhbmRzY2FwZTwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im1vZGUtYnRuIiBkYXRhLXZpZXc9InNjYXR0ZXIiPjxpIGNsYXNzPSJmYXMgZmEtY2hhcnQtbGluZSI+PC9pPlNjYXR0ZXI8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJtb2RlLWJ0biIgZGF0YS12aWV3PSJwaXZvdCI+PGkgY2xhc3M9ImZhcyBmYS10YWJsZS1jZWxscyI+PC9pPk1hdHJpeDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPCEtLSBEYXRhIE1vZGUgR3JvdXAgLS0+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtb2RlLWdyb3VwIGRhdGEtbW9kZSIgc3R5bGU9Im1hcmdpbi1sZWZ0OiAxcmVtOyI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im1vZGUtZ3JvdXAtbGFiZWwiPkRhdGE6PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im1vZGUtYnRuIGFjdGl2ZSIgZGF0YS1tb2RlPSJhbGwiPjxpIGNsYXNzPSJmYXMgZmEtbGF5ZXItZ3JvdXAiPjwvaT5BbGw8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJtb2RlLWJ0biIgZGF0YS1tb2RlPSJ1bmlxdWUiPjxpIGNsYXNzPSJmYXMgZmEtZmluZ2VycHJpbnQiPjwvaT5Pbmx5T25lPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibW9kZS1idG4iIGRhdGEtbW9kZT0ibG93ZXN0UHJpY2UiPjxpIGNsYXNzPSJmYXMgZmEtdGFnIj48L2k+TG93ZXN0PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibW9kZS1idG4iIGRhdGEtbW9kZT0icmFuZ2UiPjxpIGNsYXNzPSJmYXMgZmEtYXJyb3dzLWFsdC12Ij48L2k+UmFuZ2U8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im1vZGUtYnRuIiBvbmNsaWNrPSJvcGVuVGlwc01vZGFsKCkiIHRpdGxlPSJWaWV3IEFsbCBGZWF0dXJlIFRpcHMiCiAgICAgICAgICAgICAgICAgICAgc3R5bGU9Im1hcmdpbi1sZWZ0OiAxMnB4OyBiYWNrZ3JvdW5kOiAjZmZmYmViOyBjb2xvcjogI2I0NTMwOTsiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtbGlnaHRidWxiIHRleHQteWVsbG93LTUwMCI+PC9pPiBUaXBzCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDwhLS0g56+p6YG45YiXIC0tPgogICAgICAgIDxkaXYgY2xhc3M9ImZpbHRlci1iYXIiIGlkPSJmaWx0ZXJCYXIiIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+CiAgICAgICAgICAgIDxidXR0b24gaWQ9ImZpbHRlclRvZ2dsZSIgY2xhc3M9InRleHQtYW1iZXItNzAwIGhvdmVyOnRleHQtYW1iZXItOTAwIHRyYW5zaXRpb24tdHJhbnNmb3JtIgogICAgICAgICAgICAgICAgdGl0bGU9IlRvZ2dsZSBIZWFkZXIiPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGV2cm9uLXVwIj48L2k+CiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC14cyBmb250LWJvbGQgdGV4dC1hbWJlci03MDAiPjxpIGNsYXNzPSJmYXMgZmEtZmlsdGVyIG1yLTEiPjwvaT5GaWx0ZXJzOjwvc3Bhbj4KCiAgICAgICAgICAgIDwhLS0gUHJpY2UgRmlsdGVyIChJbnB1dHMgT25seSkgLS0+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InByaWNlLXJhbmdlLWZpbHRlciIgaWQ9InByaWNlUmFuZ2VGaWx0ZXIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJpY2UtaW5wdXRzIj4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0icHJpY2VNaW4iIGNsYXNzPSJwcmljZS1pbnB1dCIgcGxhY2Vob2xkZXI9Ik1pbiIgdmFsdWU9IjAiCiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJ3aWR0aDogNzBweDsiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LWdyYXktNDAwIj4tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJwcmljZU1heCIgY2xhc3M9InByaWNlLWlucHV0IiBwbGFjZWhvbGRlcj0iTWF4IiB2YWx1ZT0iMTAwMCIKICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9IndpZHRoOiA3MHB4OyI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCI+4oKsPC9zcGFuPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBpZD0iZmlsdGVyQ29udHJvbHMiIGNsYXNzPSJmbGV4IGZsZXgtd3JhcCBnYXAtMSI+PC9kaXY+CiAgICAgICAgICAgIDxidXR0b24gaWQ9ImNsZWFyRmlsdGVyc0J0biIgY2xhc3M9ImZpbHRlci1idG4gYmctcmVkLTUwIHRleHQtcmVkLTYwMCBib3JkZXItcmVkLTIwMCBtbC1hdXRvIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMiPjwvaT4gQ2xlYXIKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDwhLS0g5o6n5Yi25YiXIC0tPgogICAgICAgIDxkaXYgY2xhc3M9ImNvbnRyb2xzLWJhciIgaWQ9ImNvbnRyb2xzQmFyIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPgogICAgICAgICAgICA8c3Bhbj48aSBjbGFzcz0iZmFzIGZhLWJveCBtci0xIj48L2k+UHJvZHVjdHM6IDxzdHJvbmcgaWQ9InByb2R1Y3RDb3VudCI+MDwvc3Ryb25nPjwvc3Bhbj4KICAgICAgICAgICAgPHNwYW4+PGkgY2xhc3M9ImZhcyBmYS1zdG9yZSBtci0xIj48L2k+UGxhdGZvcm1zOiA8c3Ryb25nIGlkPSJwbGF0Zm9ybUNvdW50Ij4wPC9zdHJvbmc+PC9zcGFuPgoKICAgICAgICAgICAgPCEtLSBDYXJkIFZpc2liaWxpdHkgVG9nZ2xlcyAtLT4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTMgbWwtNCBweC0yIGJvcmRlci1sIGJvcmRlci1ncmF5LTMwMCI+CiAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0xIGN1cnNvci1wb2ludGVyIHRleHQteHMgc2VsZWN0LW5vbmUiIHRpdGxlPSJTaG93L0hpZGUgU3BlY3MiPgogICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InRvZ2dsZVNwZWNzIiBjaGVja2VkCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPSJyb3VuZGVkIHRleHQtYmx1ZS02MDAgZm9jdXM6cmluZy1ibHVlLTUwMCBoLTMgdy0zIj4KICAgICAgICAgICAgICAgICAgICA8c3Bhbj5TcGVjPC9zcGFuPgogICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEgY3Vyc29yLXBvaW50ZXIgdGV4dC14cyBzZWxlY3Qtbm9uZSIgdGl0bGU9IlNob3cvSGlkZSBGZWF0dXJlcyI+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0idG9nZ2xlRmVhdHVyZXMiIGNoZWNrZWQKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9InJvdW5kZWQgdGV4dC1ibHVlLTYwMCBmb2N1czpyaW5nLWJsdWUtNTAwIGgtMyB3LTMiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuPkZlYXR1cmVzPC9zcGFuPgogICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEgY3Vyc29yLXBvaW50ZXIgdGV4dC14cyBzZWxlY3Qtbm9uZSIgdGl0bGU9IlNob3cvSGlkZSBBY2Nlc3NvcmllcyI+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0idG9nZ2xlQWNjZXNzb3JpZXMiIGNoZWNrZWQKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9InJvdW5kZWQgdGV4dC1ibHVlLTYwMCBmb2N1czpyaW5nLWJsdWUtNTAwIGgtMyB3LTMiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuPkFjY2Vzcy48L3NwYW4+CiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSBjdXJzb3ItcG9pbnRlciB0ZXh0LXhzIHNlbGVjdC1ub25lIiB0aXRsZT0iU2hvdyBCcmFuZCBMb2dvIj4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJ0b2dnbGVMb2dvcyIgY2xhc3M9InJvdW5kZWQgdGV4dC1ibHVlLTYwMCBmb2N1czpyaW5nLWJsdWUtNTAwIGgtMyB3LTMiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuPkxvZ288L3NwYW4+CiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgPCEtLSBDdXN0b20gU29ydCBCdXR0b24gLS0+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJvcGVuU29ydE1vZGFsQnRuIiBvbmNsaWNrPSJvcGVuU29ydE1vZGFsKCkiCiAgICAgICAgICAgICAgICAgICAgY2xhc3M9Im1sLTIgcHgtMiBweS0xIHRleHQteHMgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkIGJnLXdoaXRlIGhvdmVyOmJnLWdyYXktMTAwIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xIgogICAgICAgICAgICAgICAgICAgIHRpdGxlPSLoh6roqIIgUGxhdGZvcm0gLyBCcmFuZCDmjpLluo8iPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc29ydC1hbW91bnQtZG93biB0ZXh0LWdyYXktNTAwIj48L2k+IOaOkuW6jwogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPCEtLSBQREYg5Yyv5Ye65o6n5Yi2IC0tPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBtbC00IHB4LTMgcHktMSBiZy1ncmVlbi01MCByb3VuZGVkIGJvcmRlciBib3JkZXItZ3JlZW4tMjAwIj4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JlZW4tNzAwIj48aSBjbGFzcz0iZmFzIGZhLWZpbGUtcGRmIG1yLTEiPjwvaT5QREY6PC9zcGFuPgogICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0icGRmTW9kZSIgY2xhc3M9InRleHQteHMgYm9yZGVyIHJvdW5kZWQgcHgtMSBweS0wLjUiIG9uY2hhbmdlPSJ0b2dnbGVQZGZJbnB1dHMoKSI+CiAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ic2luZ2xlIj5TaW5nbGUgUGFnZTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9InNwbGl0Ij5TcGxpdCAoQTQpPC9vcHRpb24+CiAgICAgICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9InNwbGl0Q29udHJvbHMiIGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSBoaWRkZW4iPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JlZW4tNzAwIj5Sb3dzL1BnOjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0icGxhdGZvcm1zUGVyUGFnZSIgdmFsdWU9IjMiIG1pbj0iMSIgbWF4PSIxMCIKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9InctMTAgcHgtMSB0ZXh0LWNlbnRlciB0ZXh0LXhzIGJvcmRlciByb3VuZGVkIj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iZXhwb3J0UGRmQnRuIiBjbGFzcz0icHgtMiBweS0xIGJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIHRleHQteHMgcm91bmRlZCBob3ZlcjpiZy1ncmVlbi03MDAiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZG93bmxvYWQgbXItMSI+PC9pPkV4cG9ydAogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPCEtLSBBSSBDb250ZXh0IENvcHkgLS0+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIG1sLTIgcHgtMyBweS0xIGJnLWluZGlnby01MCByb3VuZGVkIGJvcmRlciBib3JkZXItaW5kaWdvLTIwMCI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJkb3dubG9hZENzdkJ0biIgb25jbGljaz0iZG93bmxvYWRDc3ZDb250ZXh0KCkiCiAgICAgICAgICAgICAgICAgICAgY2xhc3M9InB4LTIgcHktMSBiZy1ncmVlbi02MDAgdGV4dC13aGl0ZSB0ZXh0LXhzIHJvdW5kZWQgaG92ZXI6YmctZ3JlZW4tNzAwIHRyYW5zaXRpb24tY29sb3JzIgogICAgICAgICAgICAgICAgICAgIHRpdGxlPSJEb3dubG9hZCBmaWx0ZXJlZCBkYXRhIGFzIENTViI+CiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1maWxlLWNzdiBtci0xIj48L2k+RG93bmxvYWQgQ1NWCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KCiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPCEtLSBWaWV3IENvbnRyb2xzIEFyZWEgKER5bmFtaWMpIC0tPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2aWV3LWNvbnRyb2xzLWFyZWEgbWwtYXV0byBmbGV4IGl0ZW1zLWNlbnRlciIgaWQ9InZpZXdDb250cm9sc0FyZWEiPgoKICAgICAgICAgICAgICAgIDwhLS0gR3JpZCBDb250cm9scyAtLT4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImdyaWRUb3BDb250cm9scyIgY2xhc3M9InZpZXctY29udHJvbC1ncm91cCBmbGV4IGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtZ3JheS01MDAgbXItMiI+Wm9vbTo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iem9vbS1idG4iIGlkPSJ6b29tT3V0Ij48aSBjbGFzcz0iZmFzIGZhLW1pbnVzIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9Inpvb21MZXZlbCIgY2xhc3M9InRleHQteHMgdy0xMCB0ZXh0LWNlbnRlciI+MTAwJTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJ6b29tLWJ0biIgaWQ9Inpvb21JbiI+PGkgY2xhc3M9ImZhcyBmYS1wbHVzIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iem9vbS1idG4iIGlkPSJ6b29tUmVzZXQiPjxpIGNsYXNzPSJmYXMgZmEtdW5kbyI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Inpvb20tYnRuIG1sLTIiIGlkPSJncmlkU2V0dGluZ3NCdG4iIHRpdGxlPSJWaWV3IFNldHRpbmdzIj48aQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9ImZhcyBmYS1jb2ciPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgIDwhLS0gU2NhdHRlciBDb250cm9scyAtLT4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9InNjYXR0ZXJUb3BDb250cm9scyIgY2xhc3M9InZpZXctY29udHJvbC1ncm91cCBmbGV4IGl0ZW1zLWNlbnRlciBoaWRkZW4iPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS02MDAgbXItMiI+Wm9vbTo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iem9vbS1idG4iIGlkPSJzY2F0dGVyWm9vbU91dCI+PGkgY2xhc3M9ImZhcyBmYS1taW51cyI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJzY2F0dGVyWm9vbUxldmVsIiBjbGFzcz0idGV4dC14cyB3LTEyIHRleHQtY2VudGVyIHRleHQtZ3JheS02MDAiPjEwMCU8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iem9vbS1idG4iIGlkPSJzY2F0dGVyWm9vbUluIj48aSBjbGFzcz0iZmFzIGZhLXBsdXMiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJ6b29tLWJ0biIgaWQ9InNjYXR0ZXJab29tUmVzZXQiPjxpIGNsYXNzPSJmYXMgZmEtdW5kbyI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImJ0blNjcmVlbnNob3QiIGNsYXNzPSJ6b29tLWJ0biBiZy1pbmRpZ28tMTAwIHRleHQtaW5kaWdvLTcwMCBtbC0yIiB0aXRsZT0iU2NyZWVuc2hvdCI+PGkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPSJmYXMgZmEtY2FtZXJhIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ib3BlblNldHRpbmdzQnRuIiBjbGFzcz0iem9vbS1idG4gYmctZ3JheS0yMDAgdGV4dC1ncmF5LTYwMCBtbC0yIgogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT0iQ2hhcnQgU2V0dGluZ3MiPjxpIGNsYXNzPSJmYXMgZmEtY29nIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8IS0tIE1hdHJpeCBDb250cm9scyAtLT4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9Im1hdHJpeFRvcENvbnRyb2xzIiBjbGFzcz0idmlldy1jb250cm9sLWdyb3VwIGZsZXggaXRlbXMtY2VudGVyIGhpZGRlbiI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTYwMCBtci0yIj5ab29tOjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJ6b29tLWJ0biIgaWQ9Im1hdHJpeFpvb21PdXQiPjxpIGNsYXNzPSJmYXMgZmEtbWludXMiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ibWF0cml4Wm9vbUxldmVsIiBjbGFzcz0idGV4dC14cyB3LTEyIHRleHQtY2VudGVyIHRleHQtZ3JheS02MDAiPjEwMCU8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iem9vbS1idG4iIGlkPSJtYXRyaXhab29tSW4iPjxpIGNsYXNzPSJmYXMgZmEtcGx1cyI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Inpvb20tYnRuIiBpZD0ibWF0cml4Wm9vbVJlc2V0Ij48aSBjbGFzcz0iZmFzIGZhLXVuZG8iPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJ6b29tLWJ0biBtbC0yIiBpZD0ibWF0cml4Q29weUJ0biIgdGl0bGU9IkNvcHkgVGFibGUiPjxpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0iZmFzIGZhLWNvcHkiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKCiAgICA8IS0tIExvYWRpbmcgT3ZlcmxheSAtLT4KICAgIDxkaXYgaWQ9ImxvYWRpbmdPdmVybGF5IgogICAgICAgIGNsYXNzPSJmaXhlZCBpbnNldC0wIGJnLXdoaXRlLzk1IGJhY2tkcm9wLWJsdXItc20gei01MCBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciIKICAgICAgICBzdHlsZT0iZGlzcGxheTogbm9uZTsiPgogICAgICAgIDxzdmcgY2xhc3M9ImxvYWRpbmctc3Bpbm5lciB3LTE2IGgtMTYgdGV4dC1pbmRpZ28tNjAwIG1iLTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIKICAgICAgICAgICAgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPgogICAgICAgICAgICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgLz4KICAgICAgICAgICAgPHBhdGggZD0iTTE0LjMxIDhsNS43NCA5Ljk0IiAvPgogICAgICAgICAgICA8cGF0aCBkPSJNOS42OSA4aDExLjQ4IiAvPgogICAgICAgICAgICA8cGF0aCBkPSJNNy4zOCAxMmw1Ljc0LTkuOTQiIC8+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik05LjY5IDE2TDMuOTUgNi4wNiIgLz4KICAgICAgICAgICAgPHBhdGggZD0iTTE0LjMxIDE2SDIuODMiIC8+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNi42MiAxMmwtNS43NCA5Ljk0IiAvPgogICAgICAgIDwvc3ZnPgogICAgICAgIDxwIGlkPSJsb2FkaW5nTWVzc2FnZSIgY2xhc3M9ImxvYWRpbmctdGV4dCB0ZXh0LWxnIGZvbnQtc2VtaWJvbGQgdGV4dC1pbmRpZ28tNzAwIHRyYWNraW5nLXdpZGVyIj5QVCBMQU5EU0NBUEUKICAgICAgICA8L3A+CiAgICAgICAgPHAgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTQwMCBtdC0xIj5Mb2FkaW5nIERhdGEuLi48L3A+CiAgICAgICAgPCEtLSBQcm9ncmVzcyBCYXIgLS0+CiAgICAgICAgPGRpdiBjbGFzcz0idy02NCBoLTIgYmctZ3JheS0yMDAgcm91bmRlZC1mdWxsIG92ZXJmbG93LWhpZGRlbiBtdC00Ij4KICAgICAgICAgICAgPGRpdiBpZD0ibG9hZGluZ1Byb2dyZXNzQmFyIiBjbGFzcz0iaC1mdWxsIGJnLWluZGlnby02MDAgcm91bmRlZC1mdWxsIHRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTMwMCIKICAgICAgICAgICAgICAgIHN0eWxlPSJ3aWR0aDogMCUiPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxwIGlkPSJsb2FkaW5nUGVyY2VudCIgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTUwMCBtdC0yIj4wJTwvcD4KICAgICAgICA8IS0tIFRpcHMgLS0+CiAgICAgICAgPHAgaWQ9ImxvYWRpbmdUaXAiIGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS00MDAgbXQtNCBtYXgtdy1tZCB0ZXh0LWNlbnRlciBweC00Ij48L3A+CiAgICA8L2Rpdj4KCiAgICA8IS0tIFBhc3N3b3JkIElucHV0IE92ZXJsYXkgLS0+CiAgICA8ZGl2IGlkPSJwYXNzd29yZE92ZXJsYXkiCiAgICAgICAgY2xhc3M9ImZpeGVkIGluc2V0LTAgYmctZ3JhZGllbnQtdG8tYnIgZnJvbS1pbmRpZ28tMTAwIHRvLXB1cnBsZS0xMDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgei1bMTAwMDBdIgogICAgICAgIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+CiAgICAgICAgPGRpdiBjbGFzcz0iYmctd2hpdGUgcm91bmRlZC0yeGwgc2hhZG93LTJ4bCBwLTggdy05NiBhbmltYXRlLWZhZGUtaW4iPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBtYi02Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctMTYgaC0xNiBiZy1pbmRpZ28tMTAwIHJvdW5kZWQtZnVsbCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBteC1hdXRvIG1iLTQiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtbG9jayB0ZXh0LTJ4bCB0ZXh0LWluZGlnby02MDAiPjwvaT4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC1ncmF5LTgwMCI+UFQgTGFuZHNjYXBlPC9oMj4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS01MDAgbXQtMSI+RW50ZXIgQWNjZXNzIEtleSB0byBDb250aW51ZTwvcD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktNCI+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgaWQ9InBhc3N3b3JkSW5wdXQiIHBsYWNlaG9sZGVyPSJBY2Nlc3MgS2V5IgogICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0idy1mdWxsIHB4LTQgcHktMyBib3JkZXItMiBib3JkZXItZ3JheS0yMDAgcm91bmRlZC14bCB0ZXh0LWNlbnRlciB0ZXh0LWxnIGZvbnQtbW9ubyBmb2N1czpib3JkZXItaW5kaWdvLTUwMCBmb2N1czpvdXRsaW5lLW5vbmUgdHJhbnNpdGlvbi1jb2xvcnMiCiAgICAgICAgICAgICAgICAgICAgICAgIG9ua2V5ZG93bj0iaWYoZXZlbnQua2V5PT09J0VudGVyJykgc3VibWl0UGFzc3dvcmQoKSI+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LXNtIHRleHQtZ3JheS00MDAiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtbGlnaHRidWxiIHRleHQteWVsbG93LTUwMCBtci0xIj48L2k+CiAgICAgICAgICAgICAgICAgICAgSGludDogPHNwYW4gY2xhc3M9ImZvbnQtbW9ubyBiZy1ncmF5LTEwMCBweC0yIHB5LTAuNSByb3VuZGVkIj41NTdYWFhYWDA8L3NwYW4+CiAgICAgICAgICAgICAgICA8L3A+CiAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9InN1Ym1pdFBhc3N3b3JkKCkiCiAgICAgICAgICAgICAgICAgICAgY2xhc3M9InctZnVsbCBweS0zIGJnLWluZGlnby02MDAgaG92ZXI6YmctaW5kaWdvLTcwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCByb3VuZGVkLXhsIHRyYW5zaXRpb24tY29sb3JzIHNoYWRvdy1sZyI+CiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS11bmxvY2sgbXItMiI+PC9pPkFjY2VzcwogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8cCBpZD0icGFzc3dvcmRFcnJvciIgY2xhc3M9InRleHQtY2VudGVyIHRleHQtcmVkLTUwMCB0ZXh0LXNtIGhpZGRlbiI+CiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi1jaXJjbGUgbXItMSI+PC9pPiBJbmNvcnJlY3QgS2V5CiAgICAgICAgICAgICAgICA8L3A+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPCEtLSDmoLzlrZDoppblnJYgLS0+CiAgICA8ZGl2IGNsYXNzPSJncmlkLXdyYXBwZXIiIGlkPSJncmlkV3JhcHBlciIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJwbGF0Zm9ybS1jb2x1bW4iIGlkPSJwbGF0Zm9ybUNvbHVtbiI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InBsYXRmb3JtLWhlYWRlciI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b2dnbGUtY29udGFpbmVyIj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJncmlkLXRvZ2dsZS1idG4gYWN0aXZlIG5vdHJhbnNsYXRlIiBkYXRhLW1vZGU9InBsYXRmb3JtIj48aQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9ImZhcyBmYS1zdG9yZSI+PC9pPlBsYXRmb3JtPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZ3JpZC10b2dnbGUtYnRuIG5vdHJhbnNsYXRlIiBkYXRhLW1vZGU9ImJyYW5kIj48aQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9ImZhcyBmYS10YWciPjwvaT5CcmFuZDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwbGF0Zm9ybS1saXN0IiBpZD0icGxhdGZvcm1MaXN0Ij48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJncmlkLW1haW4iPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcmljZS1oZWFkZXItY29udGFpbmVyIiBpZD0icHJpY2VIZWFkZXJDb250YWluZXIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJpY2UtaGVhZGVyLXJvdyIgaWQ9InByaWNlSGVhZGVyUm93Ij48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdyaWQtc2Nyb2xsLWFyZWEiIGlkPSJncmlkU2Nyb2xsQXJlYSI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJncmlkLWNvbnRlbnQiIGlkPSJncmlkQ29udGVudCI+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPCEtLSDmlaPpu57lnJboppblnJYgLS0+CiAgICA8ZGl2IGNsYXNzPSJzY2F0dGVyLXdyYXBwZXIiIGlkPSJzY2F0dGVyV3JhcHBlciI+CiAgICAgICAgPGRpdiBjbGFzcz0ic2NhdHRlci1jb250YWluZXIiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzY2F0dGVyLWNvbnRyb2xzIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTYwMCBtci0yIj5ZLUF4aXM6IDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0ic2NhdHRlcllBeGlzIiBjbGFzcz0idGV4dC1zbSBib3JkZXIgcm91bmRlZCBwLTEiPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJCcmFuZCI+QnJhbmQ8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iUGxhdGZvcm0iPlBsYXRmb3JtPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlR5cGUiPlR5cGU8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgbWwtNCI+CiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS02MDAgbXItMiI+Q29sb3I6IDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0ic2NhdHRlckNvbG9yQnkiIGNsYXNzPSJ0ZXh0LXNtIGJvcmRlciByb3VuZGVkIHAtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkJyYW5kIj5CcmFuZDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJQbGF0Zm9ybSI+UGxhdGZvcm08L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iVHlwZSI+VHlwZTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJNb2RlbCAjIj5Nb2RlbDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJQb3dlciBTdXBwbHkiPlBvd2VyIFN1cHBseTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBtbC00Ij4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTYwMCBtci0yIj5TaXplOiA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9InNjYXR0ZXJTaXplQnkiIGNsYXNzPSJ0ZXh0LXNtIGJvcmRlciByb3VuZGVkIHAtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9Im5vbmUiPk5vbmU8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQ29tbWVudHMiPkNvbW1lbnRzPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlNjb3JlIj5TY29yZTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJNb2RlbENvdW50Ij5Nb2RlbCBDb3VudDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJtYWluVGlja0ludGVydmFsIiBjbGFzcz0ibXItNCBib3JkZXIgcm91bmRlZCBwLTEgdGV4dC1zbSBiZy13aGl0ZSIKICAgICAgICAgICAgICAgICAgICBzdHlsZT0iYm9yZGVyLWNvbG9yOiNjY2MiPgogICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjI1Ij4yNTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjUwIiBzZWxlY3RlZD41MDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjEwMCI+MTAwPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iMjAwIj4yMDA8L29wdGlvbj4KICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPCEtLSBDaGFydCB3cmFwcGVyIE5PVyBJTlNJREUgc2NhdHRlci1jb250YWluZXIgZm9yIGZsZXggbGF5b3V0IC0tPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzY2F0dGVyLWNoYXJ0LXdyYXBwZXIiIGlkPSJzY2F0dGVyQ2hhcnRXcmFwcGVyIj4KICAgICAgICAgICAgICAgIDxjYW52YXMgaWQ9InNjYXR0ZXJDaGFydCI+PC9jYW52YXM+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPCEtLSBQaXZvdCBBbmFseXNpcyBXcmFwcGVyIC0tPgogICAgPGRpdiBpZD0icGl2b3RXcmFwcGVyIiBjbGFzcz0icC00IGJnLWdyYXktNTAgbS0yIHJvdW5kZWQgc2hhZG93IiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPgogICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktNiI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLXdoaXRlIHAtMyByb3VuZGVkLWxnIHNoYWRvdy1tZCBtYi00Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC00IGZsZXgtd3JhcCI+CiAgICAgICAgICAgICAgICAgICAgPCEtLSBSb3cgU2V0dGluZ3MgLS0+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwaXZvdFJvd1NlbGVjdCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPSJ0ZXh0LXNtIGZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTcwMCB3aGl0ZXNwYWNlLW5vd3JhcCI+Um93OjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9InBpdm90Um93U2VsZWN0IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9InB5LTEuNSBweC0zIGJvcmRlciBib3JkZXItZ3JheS0zMDAgYmctd2hpdGUgcm91bmRlZC1tZCBzaGFkb3ctc20gZm9jdXM6b3V0bGluZS1ub25lIGZvY3VzOnJpbmctaW5kaWdvLTUwMCBmb2N1czpib3JkZXItaW5kaWdvLTUwMCB0ZXh0LXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IiI+U2VsZWN0IGZpZWxkLi4uPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICA8IS0tIFN3YXAgQnV0dG9uIC0tPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9Im1hdHJpeFN3YXBCdG4iIGNsYXNzPSJwLTIgdGV4dC1ncmF5LTUwMCBob3Zlcjp0ZXh0LWluZGlnby02MDAgdHJhbnNpdGlvbi1jb2xvcnMiCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPSJTd2FwIFJvdy9Db2x1bW4iPgogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2hhbmdlLWFsdCI+PC9pPgogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgoKICAgICAgICAgICAgICAgICAgICA8IS0tIENvbHVtbiBTZXR0aW5ncyAtLT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InBpdm90Q29sU2VsZWN0IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9InRleHQtc20gZm9udC1zZW1pYm9sZCB0ZXh0LWdyYXktNzAwIHdoaXRlc3BhY2Utbm93cmFwIj5Db2x1bW46PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0icGl2b3RDb2xTZWxlY3QiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0icHktMS41IHB4LTMgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCBiZy13aGl0ZSByb3VuZGVkLW1kIHNoYWRvdy1zbSBmb2N1czpvdXRsaW5lLW5vbmUgZm9jdXM6cmluZy1pbmRpZ28tNTAwIGZvY3VzOmJvcmRlci1pbmRpZ28tNTAwIHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iIj5TZWxlY3QgZmllbGQuLi48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDwhLS0gU2VwYXJhdG9yIC0tPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJvcmRlci1sIGJvcmRlci1ncmF5LTMwMCBoLTYgbXgtMiI+PC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDwhLS0gQ29tcGFyZSBNb2RlIC0tPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibWF0cml4Q29tcGFyZU1vZGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0idGV4dC1zbSBmb250LXNlbWlib2xkIHRleHQtZ3JheS03MDAgd2hpdGVzcGFjZS1ub3dyYXAiPkNvbXBhcmU6PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0ibWF0cml4Q29tcGFyZU1vZGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0icHktMS41IHB4LTMgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCBiZy13aGl0ZSByb3VuZGVkLW1kIHNoYWRvdy1zbSBmb2N1czpvdXRsaW5lLW5vbmUgZm9jdXM6cmluZy1pbmRpZ28tNTAwIGZvY3VzOmJvcmRlci1pbmRpZ28tNTAwIHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0icm93Ij5Sb3c8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImNvbHVtbiI+Q29sdW1uPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJnbG9iYWwiPkdsb2JhbDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPCEtLSBDb21wYXJlIERhdGEgLS0+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJtYXRyaXhDb21wYXJlRGF0YSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPSJ0ZXh0LXNtIGZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTcwMCB3aGl0ZXNwYWNlLW5vd3JhcCI+RGF0YTo8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJtYXRyaXhDb21wYXJlRGF0YSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPSJweS0xLjUgcHgtMyBib3JkZXIgYm9yZGVyLWdyYXktMzAwIGJnLXdoaXRlIHJvdW5kZWQtbWQgc2hhZG93LXNtIGZvY3VzOm91dGxpbmUtbm9uZSBmb2N1czpyaW5nLWluZGlnby01MDAgZm9jdXM6Ym9yZGVyLWluZGlnby01MDAgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJjb3VudCI+Q291bnQ8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImNvbW1lbnRzIj5Db21tZW50czwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ic2NvcmUiPlNjb3JlPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJtb2RlbENvdW50Ij5Nb2RlbCBDb3VudDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iY29tcGV0aXRpb24iPkNvbXBldGl0aW9uIEluZGV4PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8IS0tIFBpdm90IFRhYmxlIERpc3BsYXkgQXJlYSAoSU5TSURFIHBpdm90V3JhcHBlcikgLS0+CiAgICAgICAgPGRpdiBjbGFzcz0iYmctd2hpdGUgcC00IHJvdW5kZWQtbGcgc2hhZG93LWxnIiBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7Ij4KICAgICAgICAgICAgPGRpdiBpZD0icGl2b3RUYWJsZUNvbnRhaW5lciIgY2xhc3M9InRleHQtc20iPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtZ3JheS01MDAiPlNlbGVjdCBSb3cgYW5kIENvbHVtbiBmaWVsZHMgdG8gZ2VuZXJhdGUgbWF0cml4IHRhYmxlPC9wPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9Im92ZXJsYXkiIGlkPSJvdmVybGF5Ij48L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJkZXRhaWwtcGFuZWwiIGlkPSJkZXRhaWxQYW5lbCI+CiAgICAgICAgPGRpdiBjbGFzcz0iZGV0YWlsLWhlYWRlciI+CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LWJvbGQiPlByb2R1Y3QgSW5mbzwvc3Bhbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZGV0YWlsLWNsb3NlIiBpZD0iZGV0YWlsQ2xvc2UiPjxpIGNsYXNzPSJmYXMgZmEtdGltZXMiPjwvaT48L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJkZXRhaWwtYm9keSIgaWQ9ImRldGFpbEJvZHkiPjwvZGl2PgogICAgPC9kaXY+CgogICAgPCEtLSBDaGFydCBTZXR0aW5ncyBNb2RhbCBtb3ZlZCB0byBib3R0b20gLS0+CgogICAgPHNjcmlwdD4KICAgICAgICAvLyBQVCDmqZ/lnovmlbTnkIYgR29vZ2xlIFNoZWV0cyAo55Si5ZOB6KaP5qC8KQogICAgICAgIGNvbnN0IEdTX1VSTCA9ICdodHRwczovL3NjcmlwdC5nb29nbGUuY29tL21hY3Jvcy9zL0FLZnljYnd5U1ppNmhWZHQ0WUJ4YkVTRjlwUDh1eklVWVZrVVFKY0RHYXBlSDFQY3ZEaTFxR1Q4R3RRaFR2VTgtcVR5TW9QcUdBL2V4ZWMnOwoKICAgICAgICAvLyBQVCBEQVRBIOW5s+WPsCBHb29nbGUgU2hlZXRzICjlg7nmoLzos4fmlpkpIC0g5Y+W5LujIEdpdEh1YiBDU1YKICAgICAgICBjb25zdCBHU19EQVRBX1VSTCA9ICdodHRwczovL3NjcmlwdC5nb29nbGUuY29tL21hY3Jvcy9zL0FLZnljYnhheUh2dnBXZ2dNRjh5RXRZSnhoWWpvQ2U4a1I2NVN4SVF3UWtIYmM3UzJYQ1JzLVZ4T1hXekdFZ0tDbEc1NnZRZkxBL2V4ZWMnOwoKICAgICAgICAvLyBHUyBBUEkgUGFzc3dvcmQgKGdldCBmcm9tIGxvY2FsU3RvcmFnZSwgc2hvdyBvdmVybGF5IGlmIG5vdCBzZXQpCiAgICAgICAgY29uc3QgR1NfUEFTU1dPUkRfSElOVCA9ICI1NTdYWFhYWDAiOwogICAgICAgIGxldCBnc0FwaUtleUNhY2hlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ0dTX0FQSV9LRVknKSB8fCAnJzsKCiAgICAgICAgZnVuY3Rpb24gZ2V0R1NBcGlLZXkoKSB7CiAgICAgICAgICAgIHJldHVybiBnc0FwaUtleUNhY2hlOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2hvd1Bhc3N3b3JkT3ZlcmxheSgpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkT3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nT3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZElucHV0JykuZm9jdXMoKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHN1Ym1pdFBhc3N3b3JkKCkgewogICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZElucHV0Jyk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IGlucHV0LnZhbHVlLnRyaW0oKTsKICAgICAgICAgICAgY29uc3QgZXJyb3JFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZEVycm9yJyk7CgogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgICBnc0FwaUtleUNhY2hlID0ga2V5OwogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ0dTX0FQSV9LRVknLCBrZXkpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3N3b3JkT3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBlcnJvckVsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZXJyb3JFbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoJ2JvcmRlci1yZWQtNTAwJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIENoZWNrIHBhc3N3b3JkIG9uIHBhZ2UgbG9hZAogICAgICAgIGZ1bmN0aW9uIGNoZWNrUGFzc3dvcmRBbmRJbml0KCkgewogICAgICAgICAgICBjb25zdCBzYXZlZEtleSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdHU19BUElfS0VZJyk7CiAgICAgICAgICAgIGlmIChzYXZlZEtleSkgewogICAgICAgICAgICAgICAgZ3NBcGlLZXlDYWNoZSA9IHNhdmVkS2V5OwogICAgICAgICAgICAgICAgaW5pdEFwcCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2hvd1Bhc3N3b3JkT3ZlcmxheSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBpbml0QXBwKCkgewogICAgICAgICAgICBzaG93TG9hZGluZyh0cnVlKTsKCiAgICAgICAgICAgIC8vIDEuIFBvcHVsYXRlIGJvdGggYm90aCBHUyBzaGVldCBkcm9wZG93bnMgRklSU1QgKHNvIEdT5qmf56iu5pW055CGIGlzIGF2YWlsYWJsZSkKICAgICAgICAgICAgUHJvbWlzZS5hbGwoWwogICAgICAgICAgICAgICAgcG9wdWxhdGVTaGVldERyb3Bkb3duKCksICAvLyBHUyDmqZ/nqK7mlbTnkIYgKE1UUyBMaXN0IC8gVEJTIExpc3QpCiAgICAgICAgICAgICAgICBmZXRjaEZpbGVMaXN0KCkgICAgICAgICAgIC8vIEdTIFBUIERBVEEgKERhdGFfTVRTIC8gRGF0YV9UQlMpCiAgICAgICAgICAgIF0pLnRoZW4oKFtfLCBpbml0aWFsVXJsXSkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFpbml0aWFsVXJsKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdObyBDU1YgZmlsZXMgZm91bmQnKTsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdGF0dXMoJ05vIGRhdGEgZm91bmQnKTsKICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGluZyhmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIE5vdyBsb2FkIGRhdGEgLSBHUyBzaGVldHMgYXJlIGFscmVhZHkgcG9wdWxhdGVkCiAgICAgICAgICAgICAgICAgICAgbG9hZEFsbERhdGEoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0luaXQgRXJyb3I6JywgZXJyKTsKICAgICAgICAgICAgICAgIGFsZXJ0KCdGYWlsZWQgdG8gbG9hZCBkYXRhIHNvdXJjZSBsaXN0LiBQbGVhc2UgY2hlY2sgeW91ciBuZXR3b3JrLicpOwogICAgICAgICAgICAgICAgc2hvd0xvYWRpbmcoZmFsc2UpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIEdpdEh1YiBDb25maWd1cmF0aW9uICjlgpnnlKgpCiAgICAgICAgY29uc3QgUkVQT19PV05FUiA9ICc2YXNlLTFpbjMnOwogICAgICAgIGNvbnN0IFJFUE9fTkFNRSA9ICdTdG9yYWdlJzsKICAgICAgICBjb25zdCBSRVBPX1BBVEggPSAnc2hhcmUv57ay6aCBX1BU6LOH5paZ5bqrL1BUIERhdGEg5bmz5Y+wJzsKCiAgICAgICAgY29uc3QgRklMVEVSX0ZJRUxEUyA9IFsKICAgICAgICAgICAgLy8gR2VuZXJhbCBmaWx0ZXJzCiAgICAgICAgICAgIHsga2V5OiAnUGxhdGZvcm0gVHlwZScsIGxhYmVsOiAnUGxhdGZvcm0gVHlwZScgfSwKICAgICAgICAgICAgeyBrZXk6ICdQbGF0Zm9ybScsIGxhYmVsOiAnUGxhdGZvcm0nIH0sCiAgICAgICAgICAgIHsga2V5OiAnQnJhbmQnLCBsYWJlbDogJ0JyYW5kJyB9LAogICAgICAgICAgICB7IGtleTogJ1ByaWNlIFJhbmdlJywgbGFiZWw6ICdQcmljZSBSYW5nZScgfSwKICAgICAgICAgICAgeyBrZXk6ICdCbGFkZSBSYW5nZScsIGxhYmVsOiAnQmxhZGUgUmFuZ2UnIH0sCiAgICAgICAgICAgIHsga2V5OiAnQWNjZXNzb3JpZXMnLCBsYWJlbDogJ0FjY2Vzc29yaWVzJyB9LAogICAgICAgICAgICB7IGtleTogJ1R5cGUnLCBsYWJlbDogJ1R5cGUnIH0sCiAgICAgICAgICAgIHsga2V5OiAnTW9kZWwgIycsIGxhYmVsOiAnTW9kZWwgIycsIGhhc1NlYXJjaDogdHJ1ZSB9LAogICAgICAgICAgICB7IGtleTogJ1Bvd2VyIFN1cHBseScsIGxhYmVsOiAnUG93ZXIgU3VwcGx5JyB9LAogICAgICAgICAgICAvLyBWYXJpYXRpb24gZmlsdGVycwogICAgICAgICAgICB7IGtleTogJ1NvZnQgU3RhcnQnLCBsYWJlbDogJ1NvZnQgU3RhcnQnIH0sCiAgICAgICAgICAgIHsga2V5OiAnTGFzZXInLCBsYWJlbDogJ0xhc2VyJyB9LAogICAgICAgICAgICB7IGtleTogJ0JldmVsJywgbGFiZWw6ICdCZXZlbCcgfSwKICAgICAgICAgICAgeyBrZXk6ICdTbGlkZScsIGxhYmVsOiAnU2xpZGUnIH0KICAgICAgICBdOwoKICAgICAgICBjb25zdCBDT0xPUl9QQUxFVFRFID0gWycjNjM2NmYxJywgJyNlYzQ4OTknLCAnIzEwYjk4MScsICcjZjU5ZTBiJywgJyM4YjVjZjYnLCAnIzA2YjZkNCcsICcjZWY0NDQ0JywgJyM4NGNjMTYnLCAnIzE0YjhhNicsICcjZjk3MzE2JywgJyNhODU1ZjcnLCAnIzIyZDNkOCddOwoKICAgICAgICBsZXQgY3N2RGF0YSA9IFtdLCBnc0RhdGEgPSBbXSwgbWVyZ2VkRGF0YSA9IFtdLCBmaWx0ZXJlZERhdGEgPSBbXTsKICAgICAgICBsZXQgZGF0ZUNvbHVtbnMgPSBbXTsKICAgICAgICBsZXQgZmlsdGVyU2VsZWN0aW9ucyA9IHt9OwogICAgICAgIGxldCBmaWx0ZXJEZXBlbmRlbmNpZXMgPSB7fTsgLy8gTWFwPEZpZWxkLCBNYXA8VmFsdWUsIE1hcDxUYXJnZXRGaWVsZCwgVGFyZ2V0VmFsdWU+Pj4KICAgICAgICBsZXQgcHJpY2VSYW5nZSA9IHsgbWluOiAwLCBtYXg6IDEwMDAgfTsKICAgICAgICBsZXQgem9vbUxldmVsID0gMTsKICAgICAgICBsZXQgc2NhdHRlclpvb21MZXZlbCA9IDE7CiAgICAgICAgbGV0IGN1cnJlbnRWaWV3ID0gJ2dyaWQnOwogICAgICAgIGxldCBkYXRhTW9kZSA9ICdhbGwnOyAvLyAnYWxsJyA9IOWFqOmDqOapn+WeiywgJ3VuaXF1ZScgPSDllK/kuIDmqZ/lnosKICAgICAgICBsZXQgc2NhdHRlckNoYXJ0ID0gbnVsbDsKICAgICAgICBsZXQgZ3JpZFJvd01vZGUgPSAncGxhdGZvcm0nOyAvLyAncGxhdGZvcm0nIG9yICdicmFuZCcKICAgICAgICBsZXQgY2hhcnRTZXR0aW5ncyA9IHsKICAgICAgICAgICAgcm93SGVpZ2h0OiAzMCwKICAgICAgICAgICAgbWluSGVpZ2h0OiAxMDAsCiAgICAgICAgICAgIHBvaW50UmFkaXVzOiA2LAogICAgICAgICAgICB0aWNrSW50ZXJ2YWw6IDUwLAogICAgICAgICAgICBsYWJlbEZvbnRTaXplOiAxMgogICAgICAgIH07CiAgICAgICAgbGV0IGFjdGl2ZUNvbmZpZyA9IG51bGw7CiAgICAgICAgbGV0IG1hdHJpeFpvb21MZXZlbCA9IDEuMDsKICAgICAgICBsZXQgaGFzVXNlckZpbHRlcmVkID0gZmFsc2U7IC8vIFY1LjI1OiBUcmFjayBpZiB1c2VyIGhhcyBtYWRlIGZpcnN0IGZpbHRlciBhY3Rpb24KCiAgICAgICAgLy8gTG9hZGluZyBUaXBzIEFycmF5ICjpmqjmqZ/poa/npLopCiAgICAgICAgLy8gU2hvdy9IaWRlIExvYWRpbmcgT3ZlcmxheSAoVXNlcyBleGlzdGluZyBIVE1MIGVsZW1lbnQpCiAgICAgICAgLy8gTG9hZCBUSVBTIGZyb20gZXh0ZXJuYWwgY29uZmlnIGlmIGF2YWlsYWJsZQogICAgICAgIGxldCByYXdUaXBzID0gd2luZG93LlRJUFNfQ09ORklHIHx8IFtdOwoKICAgICAgICAvLyBGYWxsYmFjayBpZiBleHRlcm5hbCBmaWxlIG1pc3NpbmcgKHRob3VnaCB3ZSBqdXN0IGNyZWF0ZWQgaXQpCiAgICAgICAgaWYgKCFyYXdUaXBzLmxlbmd0aCkgewogICAgICAgICAgICByYXdUaXBzID0gWwogICAgICAgICAgICAgICAgeyBjYXRlZ29yeTogIlN5c3RlbSIsIGNvbG9yOiAiYmctZ3JheS01MDAiLCB0ZXh0OiAiVGlwcyBmaWxlIG5vdCBsb2FkZWQuIiB9CiAgICAgICAgICAgIF07CiAgICAgICAgfQoKICAgICAgICBjb25zdCBMT0FESU5HX1RJUFMgPSByYXdUaXBzLm1hcCh0ID0+CiAgICAgICAgICAgIGA8c3BhbiBjbGFzcz0iJHt0LmNvbG9yfSB0ZXh0LXdoaXRlIHB4LTIgcHktMC41IHJvdW5kZWQgdGV4dC14cyBmb250LWJvbGQgbXItMiI+JHt0LmNhdGVnb3J5fTwvc3Bhbj4ke3QudGV4dH1gCiAgICAgICAgKTsKCiAgICAgICAgLy8gU2hvdy9IaWRlIExvYWRpbmcgT3ZlcmxheSAoVXNlcyBleGlzdGluZyBIVE1MIGVsZW1lbnQpCiAgICAgICAgbGV0IGxhc3RUaXBJbmRleCA9IC0xOwoKICAgICAgICBmdW5jdGlvbiBzaG93TG9hZGluZyhzaG93LCBwcm9ncmVzcyA9IDApIHsKICAgICAgICAgICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nT3ZlcmxheScpOwogICAgICAgICAgICBpZiAoIW92ZXJsYXkpIHJldHVybjsKCiAgICAgICAgICAgIGlmIChzaG93KSB7CiAgICAgICAgICAgICAgICByZXNldFByb2dyZXNzKCk7IC8vIFJlc2V0IHRvIDAlIGZpcnN0CiAgICAgICAgICAgICAgICBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgICAgICB1cGRhdGVMb2FkaW5nUHJvZ3Jlc3MocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgICAgIC8vIFNob3cgcmFuZG9tIHRpcCAoQXZvaWQgUmVwZWF0aW5nIHByZXZpb3VzIG9uZSkKICAgICAgICAgICAgICAgIGNvbnN0IHRpcEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdUaXAnKTsKICAgICAgICAgICAgICAgIGlmICh0aXBFbCAmJiBMT0FESU5HX1RJUFMgJiYgTE9BRElOR19USVBTLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBsZXQgbmV3SW5kZXg7CiAgICAgICAgICAgICAgICAgICAgbGV0IGF0dGVtcHRzID0gMDsKICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0luZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogTE9BRElOR19USVBTLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dGVtcHRzKys7CiAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAobmV3SW5kZXggPT09IGxhc3RUaXBJbmRleCAmJiBMT0FESU5HX1RJUFMubGVuZ3RoID4gMSAmJiBhdHRlbXB0cyA8IDUpOwoKICAgICAgICAgICAgICAgICAgICBsYXN0VGlwSW5kZXggPSBuZXdJbmRleDsKICAgICAgICAgICAgICAgICAgICB0aXBFbC5pbm5lckhUTUwgPSBMT0FESU5HX1RJUFNbbmV3SW5kZXhdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgb3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBUaXBzIE1vZGFsIExvZ2ljCiAgICAgICAgZnVuY3Rpb24gb3BlblRpcHNNb2RhbCgpIHsKICAgICAgICAgICAgbGV0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpcHNNb2RhbCcpOwoKICAgICAgICAgICAgLy8gLS0tIDEuIFByZXBhcmUgRGF0YSAmIFN0YXRlIC0tLQogICAgICAgICAgICBjb25zdCB0aXBzQ29uZmlnID0gd2luZG93LlRJUFNfQ09ORklHIHx8IFtdOwogICAgICAgICAgICBjb25zdCBjYXRlZ29yaWVzID0ge307CiAgICAgICAgICAgIGNvbnN0IGNhdE9yZGVyID0gW107CiAgICAgICAgICAgIHRpcHNDb25maWcuZm9yRWFjaCh0aXAgPT4gewogICAgICAgICAgICAgICAgaWYgKCFjYXRlZ29yaWVzW3RpcC5jYXRlZ29yeV0pIHsKICAgICAgICAgICAgICAgICAgICBjYXRlZ29yaWVzW3RpcC5jYXRlZ29yeV0gPSB7IGNvbG9yOiB0aXAuY29sb3IsIGl0ZW1zOiBbXSB9OwogICAgICAgICAgICAgICAgICAgIGNhdE9yZGVyLnB1c2godGlwLmNhdGVnb3J5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGVnb3JpZXNbdGlwLmNhdGVnb3J5XS5pdGVtcy5wdXNoKHRpcCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBzdGF0ZSAoY2xvc3VyZSBmb3IgdGhpcyBtb2RhbCBzZXNzaW9uKQogICAgICAgICAgICBpZiAoIXdpbmRvdy50aXBzU3RhdGUpIHdpbmRvdy50aXBzU3RhdGUgPSB7IGFjdGl2ZTogY2F0T3JkZXJbMF0gfHwgJycgfTsKICAgICAgICAgICAgaWYgKCF3aW5kb3cudGlwc1N0YXRlLmFjdGl2ZSAmJiBjYXRPcmRlci5sZW5ndGggPiAwKSB3aW5kb3cudGlwc1N0YXRlLmFjdGl2ZSA9IGNhdE9yZGVyWzBdOwoKICAgICAgICAgICAgY29uc3QgY2F0ZWdvcnlJY29ucyA9IHsKICAgICAgICAgICAgICAgICfos4fmlpnoroDlj5YnOiAnZmEtZGF0YWJhc2UnLAogICAgICAgICAgICAgICAgJ+evqemBuCc6ICdmYS1maWx0ZXInLAogICAgICAgICAgICAgICAgJ+mAmueUqOmhr+ekuic6ICdmYS1kZXNrdG9wJywKICAgICAgICAgICAgICAgICflnLDlnJbpoa/npLonOiAnZmEtbWFwJywKICAgICAgICAgICAgICAgICfmlaPkvYjlnJbpoa/npLonOiAnZmEtY2hhcnQtYXJlYScsCiAgICAgICAgICAgICAgICAn55+p6Zmj6aGv56S6JzogJ2ZhLXRoJywKICAgICAgICAgICAgICAgICfnrZbnlaXop4Dlr58nOiAnZmEtY2hlc3MnLAogICAgICAgICAgICAgICAgJ0FJ5Yqp5omLJzogJ2ZhLXJvYm90JwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gR2xvYmFsIFJlLXJlbmRlciB0cmlnZ2VycyAoYXNzaWduZWQgb25jZSkKICAgICAgICAgICAgd2luZG93LnNlbGVjdFRpcENhdGVnb3J5ID0gKGNhdCkgPT4gewogICAgICAgICAgICAgICAgd2luZG93LnRpcHNTdGF0ZS5hY3RpdmUgPSBjYXQ7CiAgICAgICAgICAgICAgICByZW5kZXJUaXBzQm9keSgpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gLS0tIDIuIENyZWF0ZSBNb2RhbCBET00gKEZpcnN0IFJ1bikgLS0tCiAgICAgICAgICAgIGlmICghbW9kYWwpIHsKICAgICAgICAgICAgICAgIG1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBtb2RhbC5pZCA9ICd0aXBzTW9kYWwnOwogICAgICAgICAgICAgICAgbW9kYWwuY2xhc3NOYW1lID0gJ2ZpeGVkIGluc2V0LTAgei1bOTk5OV0gZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgYmctYmxhY2sgYmctb3BhY2l0eS02MCBiYWNrZHJvcC1ibHVyLXNtIHRyYW5zaXRpb24tb3BhY2l0eSBvcGFjaXR5LTAgcG9pbnRlci1ldmVudHMtbm9uZSc7IC8vIEhpZGRlbiBzdGF0ZQoKICAgICAgICAgICAgICAgIC8vIE1vZGFsIENvbnRlbnQKICAgICAgICAgICAgICAgIG1vZGFsLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy13aGl0ZSByb3VuZGVkLXhsIHNoYWRvdy0yeGwgdy1bOTUlXSBtYXgtdy1bMTAwMHB4XSBoLVs4MHZoXSBmbGV4IGZsZXgtY29sIG92ZXJmbG93LWhpZGRlbiB0cmFuc2Zvcm0gc2NhbGUtOTUgdHJhbnNpdGlvbi1hbGwgZHVyYXRpb24tMzAwIiBpZD0idGlwc01vZGFsQ29udGVudCI+CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICA8IS0tIEhlYWRlciAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctZ3JhZGllbnQtdG8tciBmcm9tLWluZGlnby02MDAgdG8tcHVycGxlLTYwMCBwLTQgZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIHRleHQtd2hpdGUgc2hyaW5rLTAgc2hhZG93LW1kIHotMTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1saWdodGJ1bGIgdGV4dC15ZWxsb3ctMzAwIHRleHQtMnhsIj48L2k+IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPlBUIExhbmRzY2FwZSA8c3BhbiBjbGFzcz0ib3BhY2l0eS04MCBmb250LW5vcm1hbCB0ZXh0LXNtIG1sLTEiPuWKn+iDveaMh+WNlzwvc3Bhbj48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2gyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iY2xvc2UtdGlwcyB3LTggaC04IHJvdW5kZWQtZnVsbCBiZy13aGl0ZS8xMCBob3ZlcjpiZy13aGl0ZS8yMCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0cmFuc2l0aW9uLWNvbG9ycyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSBCb2R5IChGbGV4KSAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LTEgb3ZlcmZsb3ctaGlkZGVuIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gU2lkZWJhciAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctNjQgYmctZ3JheS01MCBib3JkZXItciBib3JkZXItZ3JheS0yMDAgb3ZlcmZsb3cteS1hdXRvIHNocmluay0wIGZsZXggZmxleC1jb2wgcHktNCBnYXAtMSIgaWQ9InRpcHNTaWRlYmFyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIFNpZGViYXIgSXRlbXMgLS0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSBDb250ZW50IC0tPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleC0xIGJnLXdoaXRlIHJlbGF0aXZlIG92ZXJmbG93LXktYXV0byBzY3JvbGwtc21vb3RoIiBpZD0idGlwc01haW5TY3JvbGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtOCBtYXgtdy00eGwgbXgtYXV0byIgaWQ9InRpcHNDb250ZW50Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSBDb250ZW50IEl0ZW1zIC0tPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobW9kYWwpOwoKICAgICAgICAgICAgICAgIC8vIENTUyBJbmplY3Rpb24gKEp1c3QgZm9yIHRoaXMgbW9kYWwncyBzcGVjaWZpYyB0d2Vha3MpCiAgICAgICAgICAgICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICAgICAgICAgICAgICBzdHlsZS5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAjdGlwc01vZGFsLm9wZW4geyBvcGFjaXR5OiAxOyBwb2ludGVyLWV2ZW50czogYXV0bzsgfQogICAgICAgICAgICAgICAgICAgI3RpcHNNb2RhbC5vcGVuICN0aXBzTW9kYWxDb250ZW50IHsgdHJhbnNmb3JtOiBzY2FsZSgxMDAlKTsgfQogICAgICAgICAgICAgICAgICAgLnRpcC1uYXYtYnRuIHsgdGV4dC1hbGlnbjogbGVmdDsgcGFkZGluZzogMTJweCAyMHB4OyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDEycHg7IGNvbG9yOiAjNGI1NTYzOyB0cmFuc2l0aW9uOiBhbGwgMC4yczsgYm9yZGVyLWxlZnQ6IDRweCBzb2xpZCB0cmFuc3BhcmVudDsgfQogICAgICAgICAgICAgICAgICAgLnRpcC1uYXYtYnRuOmhvdmVyIHsgYmFja2dyb3VuZDogI2U1ZTdlYjsgY29sb3I6ICMxZjI5Mzc7IH0KICAgICAgICAgICAgICAgICAgIC50aXAtbmF2LWJ0bi5hY3RpdmUgeyBiYWNrZ3JvdW5kOiAjZWVmMmZmOyBjb2xvcjogIzRmNDZlNTsgYm9yZGVyLWxlZnQtY29sb3I6ICM2MzY2ZjE7IGZvbnQtd2VpZ2h0OiA2MDA7IH0KICAgICAgICAgICAgICAgICAgIC50aXAtbmF2LWJ0biBpIHsgd2lkdGg6IDIwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsgfQogICAgICAgICAgICAgICAgICAgLnRpcC1jYXJkIHsgYW5pbWF0aW9uOiBzbGlkZUluUmlnaHQgMC4zcyBlYXNlLW91dCBmb3J3YXJkczsgb3BhY2l0eTogMDsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDEwcHgpOyB9CiAgICAgICAgICAgICAgICAgICBAa2V5ZnJhbWVzIHNsaWRlSW5SaWdodCB7IHRvIHsgb3BhY2l0eTogMTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDApOyB9IH0KICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTsKCiAgICAgICAgICAgICAgICAvLyBFdmVudHMKICAgICAgICAgICAgICAgIGNvbnN0IGNsb3NlQnRuID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNsb3NlLXRpcHMnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNsb3NlQWN0aW9uID0gKCkgPT4gewogICAgICAgICAgICAgICAgICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScsIDMwMCk7IC8vIFdhaXQgZm9yIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBjbG9zZUJ0bi5vbmNsaWNrID0gY2xvc2VBY3Rpb247CiAgICAgICAgICAgICAgICBtb2RhbC5vbmNsaWNrID0gKGUpID0+IHsgaWYgKGUudGFyZ2V0ID09PSBtb2RhbCkgY2xvc2VBY3Rpb24oKTsgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tIDMuIFJlbmRlciBMb2dpYyAtLS0KICAgICAgICAgICAgY29uc3QgcmVuZGVyVGlwc0JvZHkgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBzaWRlYmFyID0gbW9kYWwucXVlcnlTZWxlY3RvcignI3RpcHNTaWRlYmFyJyk7CiAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gbW9kYWwucXVlcnlTZWxlY3RvcignI3RpcHNDb250ZW50Jyk7CiAgICAgICAgICAgICAgICBjb25zdCBtYWluU2Nyb2xsID0gbW9kYWwucXVlcnlTZWxlY3RvcignI3RpcHNNYWluU2Nyb2xsJyk7CgogICAgICAgICAgICAgICAgLy8gUmVzZXQgU2Nyb2xsCiAgICAgICAgICAgICAgICBpZiAobWFpblNjcm9sbCkgbWFpblNjcm9sbC5zY3JvbGxUb3AgPSAwOwoKICAgICAgICAgICAgICAgIC8vIFNpZGViYXIKICAgICAgICAgICAgICAgIHNpZGViYXIuaW5uZXJIVE1MID0gY2F0T3JkZXIubWFwKGNhdCA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaWNvbiA9IGNhdGVnb3J5SWNvbnNbY2F0XSB8fCAnZmEtY2lyY2xlJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmUgPSBjYXQgPT09IHdpbmRvdy50aXBzU3RhdGUuYWN0aXZlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0id2luZG93LnNlbGVjdFRpcENhdGVnb3J5KCcke2NhdH0nKSIgY2xhc3M9InRpcC1uYXYtYnRuICR7YWN0aXZlID8gJ2FjdGl2ZScgOiAnJ30iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyAke2ljb259Ij48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2NhdH0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpOwoKICAgICAgICAgICAgICAgIC8vIENvbnRlbnQKICAgICAgICAgICAgICAgIGNvbnN0IGNhdERhdGEgPSBjYXRlZ29yaWVzW3dpbmRvdy50aXBzU3RhdGUuYWN0aXZlXTsKICAgICAgICAgICAgICAgIGlmICghY2F0RGF0YSkgcmV0dXJuOwoKICAgICAgICAgICAgICAgIC8vIEZpbmQgTmV4dCBDYXRlZ29yeQogICAgICAgICAgICAgICAgY29uc3QgY3VycklkeCA9IGNhdE9yZGVyLmluZGV4T2Yod2luZG93LnRpcHNTdGF0ZS5hY3RpdmUpOwogICAgICAgICAgICAgICAgY29uc3QgbmV4dENhdCA9IGNhdE9yZGVyW2N1cnJJZHggKyAxXTsKCiAgICAgICAgICAgICAgICBjb250ZW50LmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYi04IGJvcmRlci1iIGJvcmRlci1ncmF5LTEwMCBwYi00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgdGV4dC1ncmF5LTgwMCI+JHt3aW5kb3cudGlwc1N0YXRlLmFjdGl2ZX08L2gzPgogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1ncmF5LTUwMCBtdC0yIj7lhbEgJHtjYXREYXRhLml0ZW1zLmxlbmd0aH0g5YmH5L2/55So5oqA5benPC9wPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktNiI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7Y2F0RGF0YS5pdGVtcy5tYXAoKHRpcCwgaWR4KSA9PiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0aXAtY2FyZCBmbGV4IGdhcC00IHAtNSByb3VuZGVkLXhsIGJvcmRlciBib3JkZXItZ3JheS0xMDAgYmctd2hpdGUgc2hhZG93LXNtIGhvdmVyOnNoYWRvdy1tZCB0cmFuc2l0aW9uLXNoYWRvdyIgc3R5bGU9ImFuaW1hdGlvbi1kZWxheTogJHtpZHggKiA1MH1tcyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2hyaW5rLTAgdy0xMCBoLTEwIHJvdW5kZWQtZnVsbCAke3RpcC5jb2xvci5yZXBsYWNlKCdiZy0nLCAnYmctb3BhY2l0eS0xMCB0ZXh0LScpLnJlcGxhY2UoJzUwMCcsICc2MDAnKX0gYmctZ3JheS0xMDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1sZyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtbGlnaHRidWxiIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtZ3JheS03MDAgdGV4dC1sZyBsZWFkaW5nLXJlbGF4ZWQiPiR7dGlwLnRleHR9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIGApLmpvaW4oJycpfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAke25leHRDYXQgPyBgCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im10LTEyIGZsZXgganVzdGlmeS1lbmQgcHQtNiBib3JkZXItdCBib3JkZXItZ3JheS0xMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0id2luZG93LnNlbGVjdFRpcENhdGVnb3J5KCcke25leHRDYXR9JykiIGNsYXNzPSJncm91cCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyBweC02IHB5LTMgYmctaW5kaWdvLTUwIHRleHQtaW5kaWdvLTYwMCByb3VuZGVkLWZ1bGwgZm9udC1zZW1pYm9sZCBob3ZlcjpiZy1pbmRpZ28tMTAwIHRyYW5zaXRpb24tY29sb3JzIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDkuIvkuIDlgIvvvJoke25leHRDYXR9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1hcnJvdy1yaWdodCBncm91cC1ob3Zlcjp0cmFuc2xhdGUteC0xIHRyYW5zaXRpb24tdHJhbnNmb3JtIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIGAgOiAnJ30KICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyAtLS0gNC4gU2hvdyBNb2RhbCAtLS0KICAgICAgICAgICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgLy8gU21hbGwgZGVsYXkgdG8gYWxsb3cgZGlzcGxheTpmbGV4IHRvIGFwcGx5IGJlZm9yZSBhZGRpbmcgY2xhc3MgZm9yIHRyYW5zaXRpb24KICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHsKICAgICAgICAgICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTsKICAgICAgICAgICAgICAgIHJlbmRlclRpcHNCb2R5KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gQW5pbWF0ZWQgTG9hZGluZyBQcm9ncmVzcyBCYXIKICAgICAgICBsZXQgY3VycmVudFByb2dyZXNzID0gMDsKICAgICAgICBsZXQgdGFyZ2V0UHJvZ3Jlc3MgPSAwOwogICAgICAgIGxldCBwcm9ncmVzc0FuaW1hdGlvbklkID0gbnVsbDsKCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlTG9hZGluZ1Byb2dyZXNzKHBlcmNlbnQpIHsKICAgICAgICAgICAgdGFyZ2V0UHJvZ3Jlc3MgPSBwZXJjZW50OwogICAgICAgICAgICBpZiAoIXByb2dyZXNzQW5pbWF0aW9uSWQpIHsKICAgICAgICAgICAgICAgIGFuaW1hdGVQcm9ncmVzcygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlUHJvZ3Jlc3MoKSB7CiAgICAgICAgICAgIGNvbnN0IGJhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUHJvZ3Jlc3NCYXInKTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUGVyY2VudCcpOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRQcm9ncmVzcyA8IHRhcmdldFByb2dyZXNzKSB7CiAgICAgICAgICAgICAgICAvLyBTcGVlZDogZmFzdGVyIHdoZW4gZmFyIGZyb20gdGFyZ2V0LCBzbG93ZXIgd2hlbiBjbG9zZQogICAgICAgICAgICAgICAgY29uc3QgZGlmZiA9IHRhcmdldFByb2dyZXNzIC0gY3VycmVudFByb2dyZXNzOwogICAgICAgICAgICAgICAgY29uc3Qgc3RlcCA9IE1hdGgubWF4KDAuNSwgZGlmZiAqIDAuMSk7IC8vIEF0IGxlYXN0IDAuNSUgcGVyIGZyYW1lCiAgICAgICAgICAgICAgICBjdXJyZW50UHJvZ3Jlc3MgPSBNYXRoLm1pbihjdXJyZW50UHJvZ3Jlc3MgKyBzdGVwLCB0YXJnZXRQcm9ncmVzcyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudFByb2dyZXNzID4gdGFyZ2V0UHJvZ3Jlc3MpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRQcm9ncmVzcyA9IHRhcmdldFByb2dyZXNzOyAvLyBTbmFwIGRvd24gaWYgdGFyZ2V0IGRlY3JlYXNlZAogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoYmFyKSBiYXIuc3R5bGUud2lkdGggPSBjdXJyZW50UHJvZ3Jlc3MgKyAnJSc7CiAgICAgICAgICAgIGlmICh0ZXh0KSB0ZXh0LnRleHRDb250ZW50ID0gTWF0aC5yb3VuZChjdXJyZW50UHJvZ3Jlc3MpICsgJyUnOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRQcm9ncmVzcyA8IHRhcmdldFByb2dyZXNzKSB7CiAgICAgICAgICAgICAgICBwcm9ncmVzc0FuaW1hdGlvbklkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGVQcm9ncmVzcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwcm9ncmVzc0FuaW1hdGlvbklkID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUmVzZXQgcHJvZ3Jlc3Mgd2hlbiBzaG93aW5nIGxvYWRpbmcKICAgICAgICBmdW5jdGlvbiByZXNldFByb2dyZXNzKCkgewogICAgICAgICAgICBjdXJyZW50UHJvZ3Jlc3MgPSAwOwogICAgICAgICAgICB0YXJnZXRQcm9ncmVzcyA9IDA7CiAgICAgICAgICAgIGNvbnN0IGJhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUHJvZ3Jlc3NCYXInKTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nUGVyY2VudCcpOwogICAgICAgICAgICBpZiAoYmFyKSBiYXIuc3R5bGUud2lkdGggPSAnMCUnOwogICAgICAgICAgICBpZiAodGV4dCkgdGV4dC50ZXh0Q29udGVudCA9ICcwJSc7CiAgICAgICAgfQoKCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICAgICAgICAgICAgc2V0dXBFdmVudExpc3RlbmVycygpOwogICAgICAgICAgICAvLyBwb3B1bGF0ZVNoZWV0RHJvcGRvd24oKTsgLy8gUmVtb3ZlZDogQ2FsbGVkIGluc2lkZSBpbml0QXBwKCkgdG8gYXZvaWQgZHVwbGljYXRlIGxvZwoKCiAgICAgICAgICAgIC8vIFRvZ2dsZSBCdXR0b24gTG9naWMgKFBsYXRmb3JtL0JyYW5kIGluIExhbmRzY2FwZSB2aWV3KQogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9nZ2xlLWNvbnRhaW5lciAuZ3JpZC10b2dnbGUtYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgICAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2RlID0gZS50YXJnZXQuY2xvc2VzdCgnLmdyaWQtdG9nZ2xlLWJ0bicpPy5kYXRhc2V0Lm1vZGU7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFJvd01vZGUgPSBtb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBVSSB1cGRhdGUKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRvZ2dsZS1jb250YWluZXIgLmdyaWQtdG9nZ2xlLWJ0bicpLmZvckVhY2goYiA9PiBiLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIGIuZGF0YXNldC5tb2RlID09PSBtb2RlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlckdyaWQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWUudGFyZ2V0LmNsb3Nlc3QoJy5maWx0ZXItZ3JvdXAnKSkgewogICAgICAgICAgICAgICAgICAgIGxldCBhbnlDbG9zZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsdGVyLWRyb3Bkb3duJykuZm9yRWFjaChkID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW55Q2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChhbnlDbG9zZWQpIGFwcGx5RmlsdGVycygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY2hlY2tQYXNzd29yZEFuZEluaXQoKTsgLy8gQ2hlY2sgcGFzc3dvcmQgZmlyc3QsIHRoZW4gaW5pdGlhbGl6ZQogICAgICAgIH0pOwoKICAgICAgICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgICAgIEdpdEh1YiBEYXRhIExvYWRpbmcgRnVuY3Rpb25zCiAgICAgICAgICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hGaWxlTGlzdCgpIHsKICAgICAgICAgICAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVTZWxlY3QnKTsKICAgICAgICAgICAgc2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiIGRpc2FibGVkPkxvYWRpbmcgZGF0YS4uLjwvb3B0aW9uPic7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8g5L2/55SoIEdTX0RBVEFfVVJMIOWPluW+l+WIhumggeWIl+ihqAogICAgICAgICAgICAgICAgY29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCAxMDAwMCk7IC8vIDEwcyB0aW1lb3V0CgogICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtHU19EQVRBX1VSTH0/YWN0aW9uPWdldFNoZWV0cyZrZXk9JHtnZXRHU0FwaUtleSgpfWAsIHsKICAgICAgICAgICAgICAgICAgICByZWRpcmVjdDogJ2ZvbGxvdycsCiAgICAgICAgICAgICAgICAgICAgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTsKCiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB0aHJvdyBuZXcgRXJyb3IoJ0dTIEFQSSBFcnJvcicpOwoKICAgICAgICAgICAgICAgIGNvbnN0IHNoZWV0cyA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKCiAgICAgICAgICAgICAgICAvLyDpgY7mv77lh7ogRGF0YV8g6ZaL6aCt55qE5YiG6aCBIChCdWcgIzY6IE9ubHkgc2hvdyBzaGVldHMgd2l0aCAiRGF0YSIgaW4gbmFtZSkKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFTaGVldHMgPSBzaGVldHMuZmlsdGVyKHMgPT4gcy5pbmNsdWRlcygnRGF0YScpKTsKCiAgICAgICAgICAgICAgICBzZWxlY3QuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICBkYXRhU2hlZXRzLmZvckVhY2goc2hlZXROYW1lID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsKICAgICAgICAgICAgICAgICAgICBvcHQudmFsdWUgPSBzaGVldE5hbWU7IC8vIOebtOaOpeS9v+eUqOWIhumggeWQjeeosQogICAgICAgICAgICAgICAgICAgIG9wdC50ZXh0Q29udGVudCA9IHNoZWV0TmFtZTsgLy8g6aGv56S65Y6f5aeL5YiG6aCB5ZCN56ixCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKG9wdCk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZmlyc3Qgc2hlZXQgbmFtZSBpZiBhdmFpbGFibGUKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhU2hlZXRzLmxlbmd0aCA+IDAgPyBkYXRhU2hlZXRzWzBdIDogbnVsbDsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignR1MgRGF0YSBmZXRjaCBmYWlsZWQsIHRyeWluZyBHaXRIdWIgZmFsbGJhY2s6JywgZXJyb3IpOwoKICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIEdpdEh1YgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBnaFJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvJHtSRVBPX09XTkVSfS8ke1JFUE9fTkFNRX0vY29udGVudHMvJHtSRVBPX1BBVEh9YCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGdoUmVzcG9uc2Uub2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZXMgPSBhd2FpdCBnaFJlc3BvbnNlLmpzb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3N2RmlsZXMgPSBmaWxlcy5maWx0ZXIoZiA9PiBmLm5hbWUuZW5kc1dpdGgoJy5jc3YnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdC5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgY3N2RmlsZXMuZm9yRWFjaChmaWxlID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0LnZhbHVlID0gJ2dpdGh1YjonICsgZmlsZS5kb3dubG9hZF91cmw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHQudGV4dENvbnRlbnQgPSBmaWxlLm5hbWUucmVwbGFjZSgnLmNzdicsICcnKSArICcgKEdpdEh1YiknOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKG9wdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3N2RmlsZXMubGVuZ3RoID4gMCA/ICdnaXRodWI6JyArIGNzdkZpbGVzWzBdLmRvd25sb2FkX3VybCA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0dpdEh1YiBmYWxsYmFjayBhbHNvIGZhaWxlZDonLCBlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9IiIgZGlzYWJsZWQ+TG9hZCBGYWlsZWQ8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJlbG9hZERhdGEoc291cmNlKSB7CiAgICAgICAgICAgIHNob3dMb2FkaW5nKHRydWUsIDApOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gUmVzZXQgZmlsdGVyIHNlbGVjdGlvbnMgd2hlbiBzd2l0Y2hpbmcgZGF0YSBzb3VyY2VzCiAgICAgICAgICAgICAgICAvLyBUaGlzIHByZXZlbnRzIG9sZCBmaWx0ZXIgdmFsdWVzIGZyb20gaGlkaW5nIGFsbCBuZXcgZGF0YQogICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoZmlsdGVyU2VsZWN0aW9ucykuZm9yRWFjaChrZXkgPT4gZGVsZXRlIGZpbHRlclNlbGVjdGlvbnNba2V5XSk7CgogICAgICAgICAgICAgICAgbGV0IGRhdGFGcm9tU291cmNlID0gW107CgogICAgICAgICAgICAgICAgdXBkYXRlTG9hZGluZ1Byb2dyZXNzKDEwKTsgLy8g6ZaL5aeLCgogICAgICAgICAgICAgICAgLy8g5Yik5pa36LOH5paZ5L6G5rqQ6aGe5Z6LCiAgICAgICAgICAgICAgICBpZiAoc291cmNlLnN0YXJ0c1dpdGgoJ2dpdGh1YjonKSkgewogICAgICAgICAgICAgICAgICAgIC8vIEdpdEh1YiBDU1Yg6LyJ5YWlICjlgpnnlKgpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3N2VXJsID0gc291cmNlLnJlcGxhY2UoJ2dpdGh1YjonLCAnJyk7CiAgICAgICAgICAgICAgICAgICAgZGF0YUZyb21Tb3VyY2UgPSBhd2FpdCBsb2FkQ1NWKGNzdlVybCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIOS9v+eUqCBHU19EQVRBX1VSTCDovInlhaXliIbpoIHos4fmlpkKICAgICAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgJHtHU19EQVRBX1VSTH0/YWN0aW9uPWdldERhdGEmc2hlZXQ9JHtlbmNvZGVVUklDb21wb25lbnQoc291cmNlKX0ma2V5PSR7Z2V0R1NBcGlLZXkoKX1gLCB7IHJlZGlyZWN0OiAnZm9sbG93JyB9KTsKICAgICAgICAgICAgICAgICAgICBkYXRhRnJvbVNvdXJjZSA9IGF3YWl0IHJlcy5qc29uKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYEdTIERhdGEgbG9hZGVkOiAke2RhdGFGcm9tU291cmNlLmxlbmd0aH0gcm93cyBmcm9tICR7c291cmNlfWApOwoKICAgICAgICAgICAgICAgICAgICAvLyDoqK3lrpogZGF0ZUNvbHVtbnMgKOW+nuizh+aWmeashOS9jeS4reaJvuWHuuaXpeacn+agvOW8j+eahOashOS9jSkKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUZyb21Tb3VyY2UubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRlQ29sdW1ucyA9IE9iamVjdC5rZXlzKGRhdGFGcm9tU291cmNlWzBdKS5maWx0ZXIoaCA9PiAvXlxkezh9JC8udGVzdChoKSkuc29ydCgpLnJldmVyc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0RhdGUgY29sdW1uczonLCBkYXRlQ29sdW1ucyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHVwZGF0ZUxvYWRpbmdQcm9ncmVzcyg3MCk7IC8vIOWDueagvOizh+aWmei8ieWFpeWujOaIkAoKICAgICAgICAgICAgICAgIC8vIOi8ieWFpSBQVCDmqZ/lnovmlbTnkIYg55qE6KaP5qC86LOH5paZCiAgICAgICAgICAgICAgICBjb25zdCBncyA9IGF3YWl0IGZldGNoR1NEYXRhKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnc1NoZWV0U2VsZWN0JykudmFsdWUpLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiR1MgRGF0YSBGYWlsZWQsIGNvbnRpbnVpbmcuLi4iLCBlKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICB1cGRhdGVMb2FkaW5nUHJvZ3Jlc3MoODApOyAvLyDopo/moLzos4fmlpnovInlhaXlrozmiJDvvIzplovlp4vlkIjkvbUKCiAgICAgICAgICAgICAgICBjc3ZEYXRhID0gZGF0YUZyb21Tb3VyY2U7CiAgICAgICAgICAgICAgICBnc0RhdGEgPSBnczsKCiAgICAgICAgICAgICAgICAvLyBtZXJnZURhdGEgd2l0aCBwcm9ncmVzcyBjYWxsYmFjayAoODAlIHRvIDk1JSkKICAgICAgICAgICAgICAgIG1lcmdlZERhdGEgPSBtZXJnZURhdGEoZGF0YUZyb21Tb3VyY2UsIGdzLCAocHJvY2Vzc2VkLCB0b3RhbCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1lcmdlUHJvZ3Jlc3MgPSA4MCArIChwcm9jZXNzZWQgLyB0b3RhbCkgKiAxNTsgLy8gODAlIHRvIDk1JQogICAgICAgICAgICAgICAgICAgIHVwZGF0ZUxvYWRpbmdQcm9ncmVzcyhtZXJnZVByb2dyZXNzKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBNZXJnZWQgZGF0YTogJHttZXJnZWREYXRhLmxlbmd0aH0gcHJvZHVjdHNgKTsKCiAgICAgICAgICAgICAgICB1cGRhdGVMb2FkaW5nUHJvZ3Jlc3MoOTUpOyAvLyDos4fmlpnlkIjkvbXlrozmiJAKCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgZGVwZW5kZW5jaWVzCiAgICAgICAgICAgICAgICBjYWxjdWxhdGVEZXBlbmRlbmNpZXMoKTsKCiAgICAgICAgICAgICAgICAvLyBSZS1pbml0IGZpbHRlcnMgYW5kIHJlbmRlcgogICAgICAgICAgICAgICAgLy8gUmUtaW5pdCBmaWx0ZXJzIGFuZCByZW5kZXIKICAgICAgICAgICAgICAgIHNldHVwRmlsdGVycygpOwogICAgICAgICAgICAgICAgLy8gTG9hZCBmaWx0ZXJzL3N0YXRlIGZyb20gVVJMIChpZiBhbnkpCiAgICAgICAgICAgICAgICBsb2FkU3RhdGVGcm9tVVJMKCk7CiAgICAgICAgICAgICAgICBhcHBseUZpbHRlcnMoKTsgLy8gQXBwbHkgZGVmYXVsdCBvciBsb2FkZWQgc3RhdGUKCiAgICAgICAgICAgICAgICB1cGRhdGVMb2FkaW5nUHJvZ3Jlc3MoOTkpOyAvLyDnr6npgbjlmajlpZfnlKgKCiAgICAgICAgICAgICAgICAvLyBFbnN1cmUgVUkgaXMgdmlzaWJsZQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZXdUYWJzJykuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXJCYXInKS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRyb2xzQmFyJykuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKCiAgICAgICAgICAgICAgICBwb3B1bGF0ZVNjYXR0ZXJPcHRpb25zKCk7CiAgICAgICAgICAgICAgICB1cGRhdGVTdGF0cygpOwoKICAgICAgICAgICAgICAgIC8vIFJlc3RvcmUgdmlldwogICAgICAgICAgICAgICAgc3dpdGNoVmlldyhjdXJyZW50VmlldyB8fCAnZ3JpZCcpOwoKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZWxvYWQgRXJyb3I6JywgZXJyKTsKICAgICAgICAgICAgICAgIGFsZXJ0KCdMb2FkIEZhaWxlZDogJyArIGVyci5tZXNzYWdlKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHVwZGF0ZUxvYWRpbmdQcm9ncmVzcygxMDApOyAvLyBDb21wbGV0ZQogICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDUwMCkpOyAvLyBCcmllZiBwYXVzZSB0byBzaG93IDEwMCUKICAgICAgICAgICAgICAgIHNob3dMb2FkaW5nKGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaW5pdEFwcCgpIHsKICAgICAgICAgICAgc2hvd0xvYWRpbmcodHJ1ZSk7CgogICAgICAgICAgICAvLyAxLiBQb3B1bGF0ZSBib3RoIEdTIHNoZWV0IGRyb3Bkb3ducyBGSVJTVCAoc28gR1PmqZ/nqK7mlbTnkIYgaXMgYXZhaWxhYmxlKQogICAgICAgICAgICBQcm9taXNlLmFsbChbCiAgICAgICAgICAgICAgICBwb3B1bGF0ZVNoZWV0RHJvcGRvd24oKSwgIC8vIEdTIOapn+eoruaVtOeQhiAoTVRTIExpc3QgLyBUQlMgTGlzdCkKICAgICAgICAgICAgICAgIGZldGNoRmlsZUxpc3QoKSAgICAgICAgICAgLy8gR1MgUFQgREFUQSAoRGF0YV9NVFMgLyBEYXRhX1RCUykKICAgICAgICAgICAgXSkudGhlbigoW18sIGluaXRpYWxVcmxdKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWluaXRpYWxVcmwpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ05vIENTViBmaWxlcyBmb3VuZCcpOwogICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXR1cygnTm8gZGF0YSBmb3VuZCcpOwogICAgICAgICAgICAgICAgICAgIHNob3dMb2FkaW5nKGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTm93IGxvYWQgZGF0YSAtIEdTIHNoZWV0cyBhcmUgYWxyZWFkeSBwb3B1bGF0ZWQKICAgICAgICAgICAgICAgICAgICBsb2FkQWxsRGF0YSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW5pdCBFcnJvcjonLCBlcnIpOwogICAgICAgICAgICAgICAgYWxlcnQoJ0ZhaWxlZCB0byBsb2FkIGRhdGEgc291cmNlIGxpc3QuIFBsZWFzZSBjaGVjayB5b3VyIG5ldHdvcmsuJyk7CiAgICAgICAgICAgICAgICBzaG93TG9hZGluZyhmYWxzZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gTW9kaWZpZWQgbG9hZENTViB0byBhY2NlcHQgZnVsbCBVUkwKICAgICAgICBhc3luYyBmdW5jdGlvbiBsb2FkQ1NWKHVybCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwpOwogICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZENzdiA9IHBhcnNlQ1NWKHRleHQpOwogICAgICAgICAgICAgICAgaWYgKHBhcnNlZENzdi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0ZUNvbHVtbnMgPSBPYmplY3Qua2V5cyhwYXJzZWRDc3ZbMF0pLmZpbHRlcihoID0+IC9eXGR7OH0kLy50ZXN0KGgpKS5zb3J0KCkucmV2ZXJzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdXBkYXRlU3RhdHVzKGBDU1Y6ICR7cGFyc2VkQ3N2Lmxlbmd0aH1gKTsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZWRDc3Y7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkNTViBMb2FkIEZhaWxlZCIsIGUpOwogICAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXR1cEV2ZW50TGlzdGVuZXJzKCkgewogICAgICAgICAgICAvLyBHaXRIdWIgZmlsZSBsb2FkaW5nIC0gbG9hZERhdGFCdG4gbm93IHRyaWdnZXJzIEdpdEh1YiBkYXRhIGxvYWRpbmcKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWREYXRhQnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBsb2FkQWxsRGF0YSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZXRjaFNoZWV0c0J0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgcG9wdWxhdGVTaGVldERyb3Bkb3duKCk7CiAgICAgICAgICAgICAgICBmZXRjaEZpbGVMaXN0KCk7IC8vIEFsc28gcmVmcmVzaCBmaWxlIGxpc3QKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBDYXJkIFZpc2liaWxpdHkgVG9nZ2xlcwogICAgICAgICAgICBbJ3RvZ2dsZVNwZWNzJywgJ3RvZ2dsZUZlYXR1cmVzJywgJ3RvZ2dsZUFjY2Vzc29yaWVzJ10uZm9yRWFjaChpZCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKICAgICAgICAgICAgICAgIGlmIChjYikgewogICAgICAgICAgICAgICAgICAgIGNiLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncmlkQ29udGVudCcpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXAgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG9nZ2xlU3BlY3MnOiAnaGlkZS1zcGVjcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG9nZ2xlRmVhdHVyZXMnOiAnaGlkZS1mZWF0dXJlcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG9nZ2xlQWNjZXNzb3JpZXMnOiAnaGlkZS1hY2Nlc3NvcmllcycKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNiLmNoZWNrZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQuY2xhc3NMaXN0LnJlbW92ZShtYXBbaWRdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQuY2xhc3NMaXN0LmFkZChtYXBbaWRdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIExvZ28gVG9nZ2xlIExvZ2ljCiAgICAgICAgICAgIGNvbnN0IGxvZ29Ub2dnbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlTG9nb3MnKTsKICAgICAgICAgICAgaWYgKGxvZ29Ub2dnbGUpIHsKICAgICAgICAgICAgICAgIGxvZ29Ub2dnbGUuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3JpZENvbnRlbnQnKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9nb1RvZ2dsZS5jaGVja2VkKSBjb250ZW50LmNsYXNzTGlzdC5hZGQoJ3Nob3ctbG9nb3MnKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGNvbnRlbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdy1sb2dvcycpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyRmlsdGVyc0J0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xlYXJBbGxGaWx0ZXJzKTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd6b29tSW4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNldFpvb20oem9vbUxldmVsICsgMC4xKSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd6b29tT3V0JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBzZXRab29tKHpvb21MZXZlbCAtIDAuMSkpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnem9vbVJlc2V0JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBzZXRab29tKDEpKTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxDbG9zZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xvc2VEZXRhaWxQYW5lbCk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdmVybGF5JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbG9zZURldGFpbFBhbmVsKTsKCiAgICAgICAgICAgIC8vIOimluWcluWIh+aPmwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW9kZS1idG5bZGF0YS12aWV3XScpLmZvckVhY2godGFiID0+IHsKICAgICAgICAgICAgICAgIHRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHN3aXRjaFZpZXcodGFiLmRhdGFzZXQudmlldykpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIOaVo+m7nuWcluaOp+WItgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhdHRlcllBeGlzJykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlU2NhdHRlckNoYXJ0KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYXR0ZXJDb2xvckJ5JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlU2NhdHRlckNoYXJ0KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYXR0ZXJTaXplQnknKT8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlU2NhdHRlckNoYXJ0KTsKCiAgICAgICAgICAgIC8vIOaVo+m7nuWclue4ruaUvgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhdHRlclpvb21JbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gc2V0U2NhdHRlclpvb20oc2NhdHRlclpvb21MZXZlbCArIDAuMikpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhdHRlclpvb21PdXQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNldFNjYXR0ZXJab29tKHNjYXR0ZXJab29tTGV2ZWwgLSAwLjIpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYXR0ZXJab29tUmVzZXQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNldFNjYXR0ZXJab29tKDEpKTsKCiAgICAgICAgICAgIC8vIE1hdHJpeCBDb3B5IEJ1dHRvbgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF0cml4Q29weUJ0bicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNvcHlNYXRyaXhUYWJsZSk7CgogICAgICAgICAgICAvLyDos4fmlpnmqKHlvI/liIfmj5sKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtbW9kZV0nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBzd2l0Y2hEYXRhTW9kZShidG4uZGF0YXNldC5tb2RlKSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8g56+p6YG45YiX5pS25oqYICjmipjnlorkuIrmlrkgaGVhZGVyIOWNgOWfnykKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlclRvZ2dsZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3Qgd3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFkZXJDb2xsYXBzaWJsZScpOwogICAgICAgICAgICAgICAgY29uc3QgaWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNmaWx0ZXJUb2dnbGUgaScpOwogICAgICAgICAgICAgICAgY29uc3QgaXNDb2xsYXBzZWQgPSB3cmFwcGVyLnN0eWxlLmhlaWdodCA9PT0gJzBweCc7CgogICAgICAgICAgICAgICAgaWYgKGlzQ29sbGFwc2VkKSB7CiAgICAgICAgICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5oZWlnaHQgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhLWNoZXZyb24tZG93bicpOwogICAgICAgICAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnZmEtY2hldnJvbi11cCcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB3cmFwcGVyLnN0eWxlLmhlaWdodCA9ICcwcHgnOwogICAgICAgICAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmEtY2hldnJvbi11cCcpOwogICAgICAgICAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnZmEtY2hldnJvbi1kb3duJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gRmVhdHVyZTogTWF0cml4IFpvb20gQ29udHJvbHMKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hdHJpeFpvb21JbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgc2V0TWF0cml4Wm9vbShtYXRyaXhab29tTGV2ZWwgKyAwLjEpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hdHJpeFpvb21PdXQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNldE1hdHJpeFpvb20obWF0cml4Wm9vbUxldmVsIC0gMC4xKSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXRyaXhab29tUmVzZXQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNldE1hdHJpeFpvb20oMS4wKSk7CgogICAgICAgICAgICAvLyBGZWF0dXJlOiBNYXRyaXggU3dhcAogICAgICAgICAgICBjb25zdCBzd2FwQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hdHJpeFN3YXBCdG4nKTsKICAgICAgICAgICAgaWYgKHN3YXBCdG4pIHsKICAgICAgICAgICAgICAgIHN3YXBCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm93U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bpdm90Um93U2VsZWN0Jyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bpdm90Q29sU2VsZWN0Jyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGVtcCA9IHJvd1NlbGVjdC52YWx1ZTsKICAgICAgICAgICAgICAgICAgICByb3dTZWxlY3QudmFsdWUgPSBjb2xTZWxlY3QudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgY29sU2VsZWN0LnZhbHVlID0gdGVtcDsKICAgICAgICAgICAgICAgICAgICByb3dTZWxlY3QuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2NoYW5nZScpKTsKICAgICAgICAgICAgICAgICAgICBjb2xTZWxlY3QuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2NoYW5nZScpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGZWF0dXJlOiBNYXRyaXggQ29tcGFyZSBNb2RlIGFuZCBEYXRhCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXRyaXhDb21wYXJlTW9kZScpPy5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB1cGRhdGVQaXZvdFRhYmxlKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hdHJpeENvbXBhcmVEYXRhJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHVwZGF0ZVBpdm90VGFibGUpOwoKICAgICAgICAgICAgLy8gU2V0dGluZ3MgTW9kYWwgTG9naWMKICAgICAgICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V0dGluZ3NNb2RhbCcpOwogICAgICAgICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlblNldHRpbmdzQnRuJyk7CiAgICAgICAgICAgIGNvbnN0IHNwYW4gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJjbG9zZS1tb2RhbCIpWzBdOwogICAgICAgICAgICBjb25zdCBhcHBseUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHBseVNldHRpbmdzQnRuJyk7CgogICAgICAgICAgICBpZiAoYnRuKSB7CiAgICAgICAgICAgICAgICBidG4ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBzcGFuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpbmRvdy5vbmNsaWNrID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09IG1vZGFsKSB7CiAgICAgICAgICAgICAgICAgICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIElucHV0cyBzeW5jCiAgICAgICAgICAgIFsncm93SGVpZ2h0JywgJ21pbkhlaWdodCcsICdwb2ludFJhZGl1cyddLmZvckVhY2goa2V5ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NldCcgKyBrZXkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBrZXkuc2xpY2UoMSkpOwogICAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmFsJyArIGtleS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGtleS5zbGljZSgxKSk7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQgJiYgbGFiZWwpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gZS50YXJnZXQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJ0U2V0dGluZ3Nba2V5XSA9IHBhcnNlSW50KGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoYXBwbHlCdG4pIHsKICAgICAgICAgICAgICAgIGFwcGx5QnRuLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlU2NhdHRlckNoYXJ0KCk7CiAgICAgICAgICAgICAgICAgICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOWQjOatpea7vuWLlQogICAgICAgICAgICBjb25zdCBncmlkU2Nyb2xsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dyaWRTY3JvbGxBcmVhJyk7CiAgICAgICAgICAgIGNvbnN0IHBsYXRMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXRmb3JtTGlzdCcpOwogICAgICAgICAgICBjb25zdCBwcmljZUhlYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmljZUhlYWRlckNvbnRhaW5lcicpOwoKICAgICAgICAgICAgaWYgKGdyaWRTY3JvbGwgJiYgcGxhdExpc3QgJiYgcHJpY2VIZWFkZXIpIHsKICAgICAgICAgICAgICAgIGdyaWRTY3JvbGwuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHBsYXRMaXN0LnNjcm9sbFRvcCA9IGdyaWRTY3JvbGwuc2Nyb2xsVG9wOwogICAgICAgICAgICAgICAgICAgIHByaWNlSGVhZGVyLnNjcm9sbExlZnQgPSBncmlkU2Nyb2xsLnNjcm9sbExlZnQ7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g5YO55qC856+E5ZyNIElucHV0IGxvZ2ljCiAgICAgICAgICAgIGNvbnN0IHByaWNlTWluSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpY2VNaW4nKTsKICAgICAgICAgICAgY29uc3QgcHJpY2VNYXhJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmljZU1heCcpOwoKICAgICAgICAgICAgaWYgKHByaWNlTWluSW5wdXQpIHsKICAgICAgICAgICAgICAgIHByaWNlTWluSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHByaWNlUmFuZ2UubWluID0gcGFyc2VJbnQocHJpY2VNaW5JbnB1dC52YWx1ZSkgfHwgMDsKICAgICAgICAgICAgICAgICAgICBhcHBseUZpbHRlcnMoKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocHJpY2VNYXhJbnB1dCkgewogICAgICAgICAgICAgICAgcHJpY2VNYXhJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcHJpY2VSYW5nZS5tYXggPSBwYXJzZUludChwcmljZU1heElucHV0LnZhbHVlKSB8fCAyMDAwOwogICAgICAgICAgICAgICAgICAgIGFwcGx5RmlsdGVycygpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGJ0blNjcmVlbnNob3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuU2NyZWVuc2hvdCcpOwogICAgICAgICAgICBpZiAoYnRuU2NyZWVuc2hvdCkgYnRuU2NyZWVuc2hvdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNhcHR1cmVTY2F0dGVyQ2hhcnQpOwoKICAgICAgICAgICAgLy8gVVJMIFN5bmMgZm9yIE1hdHJpeC9TY2F0dGVyIGNvbnRyb2xzCiAgICAgICAgICAgIFsncGl2b3RSb3dTZWxlY3QnLCAncGl2b3RDb2xTZWxlY3QnLCAnc2NhdHRlcllBeGlzJywgJ3NjYXR0ZXJDb2xvckJ5J10uZm9yRWFjaChpZCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKICAgICAgICAgICAgICAgIGlmIChlbCkgZWwuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlVVJMRnJvbVN0YXRlKTsKICAgICAgICAgICAgfSk7CgogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc3dpdGNoVmlldyh2aWV3KSB7CiAgICAgICAgICAgIGN1cnJlbnRWaWV3ID0gdmlldzsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vZGUtYnRuW2RhdGEtdmlld10nKS5mb3JFYWNoKHQgPT4gdC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZVRhYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5tb2RlLWJ0bltkYXRhLXZpZXc9IiR7dmlld30iXWApOwogICAgICAgICAgICBpZiAoYWN0aXZlVGFiKSBhY3RpdmVUYWIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CgogICAgICAgICAgICBjb25zdCBncmlkV3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncmlkV3JhcHBlcicpOwogICAgICAgICAgICBjb25zdCBzY2F0dGVyV3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2F0dGVyV3JhcHBlcicpOwogICAgICAgICAgICBjb25zdCBwaXZvdFdyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGl2b3RXcmFwcGVyJyk7CgogICAgICAgICAgICAvLyBUb2dnbGUgRGlzcGxheQogICAgICAgICAgICBpZiAoZ3JpZFdyYXBwZXIpIGdyaWRXcmFwcGVyLnN0eWxlLmRpc3BsYXkgPSB2aWV3ID09PSAnZ3JpZCcgPyAnZmxleCcgOiAnbm9uZSc7CiAgICAgICAgICAgIGlmIChzY2F0dGVyV3JhcHBlcikgc2NhdHRlcldyYXBwZXIuc3R5bGUuZGlzcGxheSA9IHZpZXcgPT09ICdzY2F0dGVyJyA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgICAgIGlmIChwaXZvdFdyYXBwZXIpIHBpdm90V3JhcHBlci5zdHlsZS5kaXNwbGF5ID0gdmlldyA9PT0gJ3Bpdm90JyA/ICdibG9jaycgOiAnbm9uZSc7CgogICAgICAgICAgICAvLyBSZXNldCBUb2dnbGUgZm9yIFRvcCBDb250cm9scwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudmlldy1jb250cm9sLWdyb3VwJykuZm9yRWFjaChnID0+IGcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwoKICAgICAgICAgICAgaWYgKHZpZXcgPT09ICdncmlkJykgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dyaWRUb3BDb250cm9scycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZpZXcgPT09ICdzY2F0dGVyJykgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYXR0ZXJUb3BDb250cm9scycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZpZXcgPT09ICdwaXZvdCcpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXRyaXhUb3BDb250cm9scycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTY3JvbGwgT3ZlcmZsb3cKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9IHZpZXcgPT09ICdwaXZvdCcgPyAnYXV0bycgOiAnaGlkZGVuJzsKCiAgICAgICAgICAgIGlmICh2aWV3ID09PSAnc2NhdHRlcicgJiYgZmlsdGVyZWREYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHVwZGF0ZVNjYXR0ZXJDaGFydCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh2aWV3ID09PSAncGl2b3QnKSB7CiAgICAgICAgICAgICAgICBpZiAod2luZG93LnVwZGF0ZVBpdm90VGFibGUpIHdpbmRvdy51cGRhdGVQaXZvdFRhYmxlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlVVJMRnJvbVN0YXRlKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzd2l0Y2hEYXRhTW9kZShtb2RlKSB7CiAgICAgICAgICAgIGRhdGFNb2RlID0gbW9kZTsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtbW9kZV0nKS5mb3JFYWNoKGIgPT4gYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLW1vZGU9IiR7bW9kZX0iXWApLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwoKICAgICAgICAgICAgLy8g5ZSv5LiA5qmf5Z6L5qih5byP5LiL77yM6Zqx6JeP5bmz5Y+w56+p6YG45ZmoIChZIOi7uOS4jemOluWumikKICAgICAgICAgICAgaWYgKG1vZGUgPT09ICd1bmlxdWUnKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsdGVyLWdyb3VwJykuZm9yRWFjaChnID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBidG4gPSBnLnF1ZXJ5U2VsZWN0b3IoJy5maWx0ZXItYnRuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJ0biAmJiBidG4uZGF0YXNldC5maWVsZCA9PT0gJ1BsYXRmb3JtJykgewogICAgICAgICAgICAgICAgICAgICAgICBnLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyDpoa/npLrlubPlj7Dnr6npgbjlmagKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItZ3JvdXAnKS5mb3JFYWNoKGcgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ0biA9IGcucXVlcnlTZWxlY3RvcignLmZpbHRlci1idG4nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYnRuICYmIGJ0bi5kYXRhc2V0LmZpZWxkID09PSAnUGxhdGZvcm0nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGcuc3R5bGUuZGlzcGxheSA9ICcnOyAvLyBSZXNldAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFwcGx5RmlsdGVycygpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0U2NhdHRlclpvb20obGV2ZWwpIHsKICAgICAgICAgICAgc2NhdHRlclpvb21MZXZlbCA9IE1hdGgubWF4KDAuNSwgTWF0aC5taW4oMywgbGV2ZWwpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYXR0ZXJab29tTGV2ZWwnKS50ZXh0Q29udGVudCA9IE1hdGgucm91bmQoc2NhdHRlclpvb21MZXZlbCAqIDEwMCkgKyAnJSc7CgogICAgICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYXR0ZXJDaGFydFdyYXBwZXInKTsKICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5taW5IZWlnaHQgPSAoNDAwICogc2NhdHRlclpvb21MZXZlbCkgKyAncHgnOwogICAgICAgICAgICB3cmFwcGVyLnN0eWxlLndpZHRoID0gKDEwMCAqIHNjYXR0ZXJab29tTGV2ZWwpICsgJyUnOwoKICAgICAgICAgICAgaWYgKHNjYXR0ZXJDaGFydCkgewogICAgICAgICAgICAgICAgc2NhdHRlckNoYXJ0LnJlc2l6ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXRab29tKGxldmVsKSB7CiAgICAgICAgICAgIHpvb21MZXZlbCA9IE1hdGgubWF4KDAuMywgTWF0aC5taW4oMiwgbGV2ZWwpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCctLXpvb20tbGV2ZWwnLCB6b29tTGV2ZWwpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnem9vbUxldmVsJykudGV4dENvbnRlbnQgPSBNYXRoLnJvdW5kKHpvb21MZXZlbCAqIDEwMCkgKyAnJSc7CiAgICAgICAgICAgIHJlbmRlckdyaWQoKTsKICAgICAgICB9CgogICAgICAgIC8vIOa4hemZpCBQb3dlciBTdXBwbHkg5Lit55qEIENvcmRsZXNzCiAgICAgICAgZnVuY3Rpb24gY2xlYW5Qb3dlclN1cHBseSh2YWwpIHsKICAgICAgICAgICAgaWYgKCF2YWwpIHJldHVybiAnLSc7CiAgICAgICAgICAgIHJldHVybiB2YWwucmVwbGFjZSgvQ29yZGxlc3NccyovZ2ksICcnKS50cmltKCkgfHwgdmFsOwogICAgICAgIH0KCiAgICAgICAgLy8g5YO55qC85Y2A5q615YiG6aGeCiAgICAgICAgZnVuY3Rpb24gZ2V0UHJpY2VSYW5nZShwcmljZSkgewogICAgICAgICAgICBpZiAoIXByaWNlIHx8IHByaWNlIDw9IDApIHJldHVybiAn5pyq55+lJzsKICAgICAgICAgICAgY29uc3QgcmFuZ2VzID0gWwogICAgICAgICAgICAgICAgeyBtaW46IDAsIG1heDogMTAwLCBsYWJlbDogJ+KCrDAtMTAwJyB9LAogICAgICAgICAgICAgICAgeyBtaW46IDEwMCwgbWF4OiAyMDAsIGxhYmVsOiAn4oKsMTAwLTIwMCcgfSwKICAgICAgICAgICAgICAgIHsgbWluOiAyMDAsIG1heDogMzAwLCBsYWJlbDogJ+KCrDIwMC0zMDAnIH0sCiAgICAgICAgICAgICAgICB7IG1pbjogMzAwLCBtYXg6IDQwMCwgbGFiZWw6ICfigqwzMDAtNDAwJyB9LAogICAgICAgICAgICAgICAgeyBtaW46IDQwMCwgbWF4OiA1MDAsIGxhYmVsOiAn4oKsNDAwLTUwMCcgfSwKICAgICAgICAgICAgICAgIHsgbWluOiA1MDAsIG1heDogNjAwLCBsYWJlbDogJ+KCrDUwMC02MDAnIH0sCiAgICAgICAgICAgICAgICB7IG1pbjogNjAwLCBtYXg6IDgwMCwgbGFiZWw6ICfigqw2MDAtODAwJyB9LAogICAgICAgICAgICAgICAgeyBtaW46IDgwMCwgbWF4OiAxMDAwLCBsYWJlbDogJ+KCrDgwMC0xMDAwJyB9LAogICAgICAgICAgICAgICAgeyBtaW46IDEwMDAsIG1heDogSW5maW5pdHksIGxhYmVsOiAn4oKsMTAwMCsnIH0KICAgICAgICAgICAgXTsKICAgICAgICAgICAgZm9yIChjb25zdCByIG9mIHJhbmdlcykgewogICAgICAgICAgICAgICAgaWYgKHByaWNlID49IHIubWluICYmIHByaWNlIDwgci5tYXgpIHJldHVybiByLmxhYmVsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAn4oKsMTAwMCsnOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaGFuZGxlQ1NWVXBsb2FkKGUpIHsKICAgICAgICAgICAgY29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdOwogICAgICAgICAgICBpZiAoIWZpbGUpIHJldHVybjsKICAgICAgICAgICAgZGV0ZWN0TW9kZShmaWxlLm5hbWUpOwogICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgICByZWFkZXIub25sb2FkID0gKGV2KSA9PiB7CiAgICAgICAgICAgICAgICBjc3ZEYXRhID0gcGFyc2VDU1YoZXYudGFyZ2V0LnJlc3VsdCk7CiAgICAgICAgICAgICAgICBpZiAoY3N2RGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0ZUNvbHVtbnMgPSBPYmplY3Qua2V5cyhjc3ZEYXRhWzBdKS5maWx0ZXIoaCA9PiAvXlxkezh9JC8udGVzdChoKSkuc29ydCgpLnJldmVyc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXR1cyhgQ1NWOiAke2NzdkRhdGEubGVuZ3RofWApOwogICAgICAgICAgICB9OwogICAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlLCAnVVRGLTgnKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHBhcnNlQ1NWKHRleHQpIHsKICAgICAgICAgICAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KCdcbicpLmZpbHRlcihsID0+IGwudHJpbSgpKTsKICAgICAgICAgICAgaWYgKGxpbmVzLmxlbmd0aCA8IDIpIHJldHVybiBbXTsKICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IHBhcnNlQ1NWTGluZShsaW5lc1swXSk7CiAgICAgICAgICAgIHJldHVybiBsaW5lcy5zbGljZSgxKS5tYXAobGluZSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB2YWxzID0gcGFyc2VDU1ZMaW5lKGxpbmUpOwogICAgICAgICAgICAgICAgaWYgKHZhbHMubGVuZ3RoICE9PSBoZWFkZXJzLmxlbmd0aCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBjb25zdCByb3cgPSB7fTsKICAgICAgICAgICAgICAgIGhlYWRlcnMuZm9yRWFjaCgoaCwgaSkgPT4gcm93W2hdID0gdmFsc1tpXSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcm93OwogICAgICAgICAgICB9KS5maWx0ZXIociA9PiByKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHBhcnNlQ1NWTGluZShsaW5lKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgICAgICAgICBsZXQgY3VycmVudCA9ICcnLCBpblF1b3RlcyA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmUubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBsaW5lW2ldOwogICAgICAgICAgICAgICAgaWYgKGMgPT09ICciJykgewogICAgICAgICAgICAgICAgICAgIGlmIChpblF1b3RlcyAmJiBsaW5lW2kgKyAxXSA9PT0gJyInKSB7IGN1cnJlbnQgKz0gJyInOyBpKys7IH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGluUXVvdGVzID0gIWluUXVvdGVzOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjID09PSAnLCcgJiYgIWluUXVvdGVzKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goY3VycmVudC50cmltKCkpOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSAnJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudCArPSBjOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGN1cnJlbnQudHJpbSgpKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIHBvcHVsYXRlU2hlZXREcm9wZG93bigpIHsKICAgICAgICAgICAgY29uc3Qgc2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzU2hlZXRTZWxlY3QnKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGAke0dTX1VSTH0/YWN0aW9uPWdldFNoZWV0cyZrZXk9JHtnZXRHU0FwaUtleSgpfWAsIHsgcmVkaXJlY3Q6ICdmb2xsb3cnIH0pOwogICAgICAgICAgICAgICAgY29uc3Qgc2hlZXRzID0gYXdhaXQgcmVzLmpzb24oKTsKICAgICAgICAgICAgICAgIC8vIEJ1ZyAjNTogT25seSBzaG93IHNoZWV0cyB3aXRoICJMaXN0IiBpbiBuYW1lIChlLmcuLCAiTVRTIExpc3QiLCAiVEJTIExpc3QiKQogICAgICAgICAgICAgICAgY29uc3QgbGlzdFNoZWV0cyA9IHNoZWV0cy5maWx0ZXIobiA9PiBuLmluY2x1ZGVzKCdMaXN0JykpOwoKICAgICAgICAgICAgICAgIHNlbC5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgICAgIGxpc3RTaGVldHMuZm9yRWFjaCgobiwgaWR4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgICAgICAgICAgICAgICAgb3B0LnZhbHVlID0gbjsKICAgICAgICAgICAgICAgICAgICBvcHQudGV4dENvbnRlbnQgPSBuOwogICAgICAgICAgICAgICAgICAgIC8vIEF1dG8tc2VsZWN0IE1UUyBMaXN0IGlmIGV4aXN0cywgb3RoZXJ3aXNlIGZpcnN0IGl0ZW0KICAgICAgICAgICAgICAgICAgICBpZiAobi5pbmNsdWRlcygnTVRTIExpc3QnKSB8fCAoaWR4ID09PSAwICYmICFsaXN0U2hlZXRzLnNvbWUocyA9PiBzLmluY2x1ZGVzKCdNVFMgTGlzdCcpKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0LnNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2VsLmFwcGVuZENoaWxkKG9wdCk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnR1MgU2hlZXRzIHBvcHVsYXRlZDonLCBsaXN0U2hlZXRzLCAnU2VsZWN0ZWQ6Jywgc2VsLnZhbHVlKTsKICAgICAgICAgICAgICAgIHJldHVybiBsaXN0U2hlZXRzLmxlbmd0aCA+IDAgPyBzZWwudmFsdWUgOiBudWxsOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gcG9wdWxhdGUgR1Mgc2hlZXRzOicsIGUpOwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGZldGNoR1NEYXRhKHNoZWV0KSB7CiAgICAgICAgICAgIGlmICghc2hlZXQpIHJldHVybiBbXTsKICAgICAgICAgICAgdXBkYXRlR1NTdGF0dXMoJ2xvYWRpbmcnLCAnLi4uJyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgJHtHU19VUkx9P2FjdGlvbj1nZXREYXRhJnNoZWV0PSR7ZW5jb2RlVVJJQ29tcG9uZW50KHNoZWV0KX0ma2V5PSR7Z2V0R1NBcGlLZXkoKX1gLCB7IHJlZGlyZWN0OiAnZm9sbG93JyB9KTsKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpOwogICAgICAgICAgICAgICAgdXBkYXRlR1NTdGF0dXMoJ3N1Y2Nlc3MnLCBgJHtkYXRhLmxlbmd0aH1gKTsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICB1cGRhdGVHU1N0YXR1cygnZXJyb3InLCAn5aSx5pWXJyk7CiAgICAgICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUdTU3RhdHVzKHQsIG0pIHsKICAgICAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3NTdGF0dXMnKTsKICAgICAgICAgICAgaWYgKCFlbCkgcmV0dXJuOyAvLyBFbGVtZW50IHdhcyByZW1vdmVkLCBza2lwIHVwZGF0ZQogICAgICAgICAgICBjb25zdCBpY29ucyA9IHsgbG9hZGluZzogJ2ZhLXNwaW4gZmEtY2lyY2xlLW5vdGNoIHRleHQtYmx1ZS01MDAnLCBzdWNjZXNzOiAnZmEtY2hlY2stY2lyY2xlIHRleHQtZ3JlZW4tNTAwJywgZXJyb3I6ICdmYS1leGNsYW1hdGlvbi1jaXJjbGUgdGV4dC1yZWQtNTAwJyB9OwogICAgICAgICAgICBlbC5pbm5lckhUTUwgPSBgPGkgY2xhc3M9ImZhcyAke2ljb25zW3RdfSBtci0xIj48L2k+JHttfWA7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB1cGRhdGVTdGF0dXMobSkgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZFN0YXR1cycpLnRleHRDb250ZW50ID0gbTsgfQoKICAgICAgICBhc3luYyBmdW5jdGlvbiBsb2FkQWxsRGF0YSgpIHsKICAgICAgICAgICAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVTZWxlY3QnKTsKICAgICAgICAgICAgY29uc3QgdXJsID0gc2VsZWN0LnZhbHVlOwogICAgICAgICAgICBpZiAoIXVybCkgewogICAgICAgICAgICAgICAgYWxlcnQoJ+iri+WFiOmBuOaTh+izh+aWmeS+hua6kCcpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFVzZSByZWxvYWREYXRhIGxvZ2ljCiAgICAgICAgICAgIGRldGVjdE1vZGUodXJsKTsKICAgICAgICAgICAgcmVsb2FkRGF0YSh1cmwpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbWVyZ2VEYXRhKGNzdiwgZ3MsIHByb2dyZXNzQ2FsbGJhY2sgPSBudWxsKSB7CiAgICAgICAgICAgIGNvbnN0IGdzTWFwID0ge307CiAgICAgICAgICAgIGdzLmZvckVhY2gociA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBtID0gKHJbJ01vZGVsICMnXSB8fCAnJykudHJpbSgpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBpZiAobSkgZ3NNYXBbbV0gPSByOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgICAgICAgICBjb25zdCB0b3RhbCA9IGNzdi5sZW5ndGg7CiAgICAgICAgICAgIGxldCBwcm9jZXNzZWQgPSAwOwoKICAgICAgICAgICAgZm9yIChjb25zdCByIG9mIGNzdikgewogICAgICAgICAgICAgICAgcHJvY2Vzc2VkKys7CgogICAgICAgICAgICAgICAgLy8gVXBkYXRlIHByb2dyZXNzIGV2ZXJ5IDUwIHJvd3MKICAgICAgICAgICAgICAgIGlmIChwcm9ncmVzc0NhbGxiYWNrICYmIHByb2Nlc3NlZCAlIDUwID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NDYWxsYmFjayhwcm9jZXNzZWQsIHRvdGFsKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoclsnRXhjbHVkZSBVcGRhdGUnXSA9PT0gJ1knKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBTdHJpbmcoclsnTW9kZWwgIyddIHx8ICcnKS50cmltKCk7CiAgICAgICAgICAgICAgICBpZiAoIW0pIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBwcmljZSBpbiBkYXRlQ29sdW1ucyAoTVRTIGZvcm1hdCkKICAgICAgICAgICAgICAgIGxldCBoYXNQcmljZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIGRhdGVDb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IHBhcnNlRmxvYXQocltjXSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc05hTihwKSAmJiBwID4gMCkgeyBoYXNQcmljZSA9IHRydWU7IGJyZWFrOyB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQWxzbyBjaGVjayBmb3IgZGlyZWN0IFByaWNlIGNvbHVtbiAoVEJTIGZvcm1hdCAtIG1heSBiZSBsaWtlICLigqw1OTguMzQiKQogICAgICAgICAgICAgICAgaWYgKCFoYXNQcmljZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpcmVjdFByaWNlID0gclsnUHJpY2UnXTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGlyZWN0UHJpY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbnVtUHJpY2UgPSBwYXJzZUZsb2F0KFN0cmluZyhkaXJlY3RQcmljZSkucmVwbGFjZSgvW+KCrCxdL2csICcnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNOYU4obnVtUHJpY2UpICYmIG51bVByaWNlID4gMCkgaGFzUHJpY2UgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIWhhc1ByaWNlKSBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBjb25zdCBnID0gZ3NNYXBbbS50b0xvd2VyQ2FzZSgpXSB8fCB7fTsKCiAgICAgICAgICAgICAgICAvLyBHZXQgcHJpY2U6IGZpcnN0IGZyb20gZGF0ZUNvbHVtbnMsIGZhbGxiYWNrIHRvIGRpcmVjdCBQcmljZSBjb2x1bW4KICAgICAgICAgICAgICAgIGxldCBwcmljZSA9IG51bGw7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgZGF0ZUNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gcGFyc2VGbG9hdChyW2NdKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKHApICYmIHAgPiAwKSB7IHByaWNlID0gcDsgYnJlYWs7IH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChwcmljZSA9PT0gbnVsbCAmJiByWydQcmljZSddKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpY2UgPSBwYXJzZUZsb2F0KFN0cmluZyhyWydQcmljZSddKS5yZXBsYWNlKC9b4oKsLF0vZywgJycpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBDb2xsZWN0IEhpc3RvcnkgKGZvciBDaGFydCkKICAgICAgICAgICAgICAgIGNvbnN0IGhpc3RvcnkgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiBkYXRlQ29sdW1ucykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBwYXJzZUZsb2F0KHJbY10pOwogICAgICAgICAgICAgICAgICAgIGlmICghaXNOYU4ocCkgJiYgcCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGlzdG9yeS5wdXNoKHsgZGF0ZTogYywgcHJpY2U6IHAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEdldCBQcmljZSBUYWcgKHJvdW5kZWQgcHJpY2UgZm9yIGNhdGVnb3JpemF0aW9uKQogICAgICAgICAgICAgICAgbGV0IHByaWNlVGFnID0gclsnUHJpY2UgVGFnJ107CgogICAgICAgICAgICAgICAgaWYgKHByaWNlVGFnICYmICFpc05hTihwYXJzZUZsb2F0KHByaWNlVGFnKSkpIHsKICAgICAgICAgICAgICAgICAgICBwcmljZVRhZyA9IHBhcnNlRmxvYXQocHJpY2VUYWcpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwcmljZSkgewogICAgICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrOiBjYWxjdWxhdGUgUHJpY2UgVGFnIGZyb20gUHJpY2UgdXNpbmcgcm91bmRpbmcgbG9naWMKICAgICAgICAgICAgICAgICAgICBjb25zdCBiYXNlID0gTWF0aC5mbG9vcihwcmljZSAvIDEwMCkgKiAxMDA7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVtYWluZGVyID0gcHJpY2UgJSAxMDA7CiAgICAgICAgICAgICAgICAgICAgcHJpY2VUYWcgPSBiYXNlICsgKHJlbWFpbmRlciA8PSAyNSA/IDAgOiByZW1haW5kZXIgPD0gNzUgPyA1MCA6IDEwMCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goewogICAgICAgICAgICAgICAgICAgIFBsYXRmb3JtOiByWydQbGF0Zm9ybSddIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICdQbGF0Zm9ybSBUeXBlJzogKHJbJ1BsYXRmb3JtJ10gfHwgJycpLnN0YXJ0c1dpdGgoJ1ItJykgPyAnUmV0YWlsZXInIDogJ0JyYW5kZXInLAogICAgICAgICAgICAgICAgICAgICdNb2RlbCAjJzogbSwKICAgICAgICAgICAgICAgICAgICBQcmljZTogcHJpY2UsCiAgICAgICAgICAgICAgICAgICAgJ1ByaWNlIFRhZyc6IHByaWNlVGFnIHx8IHByaWNlLCAgLy8gVXNlIFByaWNlIFRhZyBmb3IgY2F0ZWdvcml6YXRpb24KICAgICAgICAgICAgICAgICAgICBIaXN0b3J5OiBoaXN0b3J5LCAvLyBBZGRlZCBIaXN0b3J5IGZvciBDaGFydAogICAgICAgICAgICAgICAgICAgICdJbWFnZSc6IHJbJ0ltYWdlIFVSTCddIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICdQcm9kdWN0IFVSTCc6IHJbJ1Byb2R1Y3QgVVJMJ10gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgQWNjZXNzb3JpZXM6IHJbJ0FjY2Vzc29yaWVzJ10gfHwgJy0nLAogICAgICAgICAgICAgICAgICAgICdBY2Nlc3NvcmllcyBTdGF0dXMnOiAoclsnQWNjZXNzb3JpZXMnXSAmJiByWydBY2Nlc3NvcmllcyddICE9PSAnLScpID8gJ1dpdGggQWNjZXNzb3JpZXMnIDogJy0nLAogICAgICAgICAgICAgICAgICAgICdQcmljZSBSYW5nZSc6IGdldFByaWNlUmFuZ2UocHJpY2VUYWcgfHwgcHJpY2UpLCAgLy8gVXNlIFByaWNlIFRhZyBmb3IgcmFuZ2UKICAgICAgICAgICAgICAgICAgICAvLyBNZXJnZSBHUy9DU1YgRGF0YQogICAgICAgICAgICAgICAgICAgICdJbWFnZSBVUkwnOiBnWydJbWFnZSBVUkwnXSB8fCByWydJbWFnZSBVUkwnXSB8fCAnJywKICAgICAgICAgICAgICAgICAgICBCcmFuZDogZ1snQnJhbmQnXSB8fCByWydCcmFuZCddIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIFR5cGU6IGdbJ1R5cGUnXSB8fCByWydUeXBlJ10gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgQmV2ZWw6IGdbJ0JldmVsJ10gfHwgclsnQmV2ZWwnXSB8fCAnJywKICAgICAgICAgICAgICAgICAgICBTbGlkZTogZ1snU2xpZGUnXSB8fCByWydTbGlkZSddIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICdCbGFkZSBEaWFtZXRlcic6IGdbJ0JsYWRlIERpYW1ldGVyJ10gfHwgclsnQmxhZGUgRGlhbWV0ZXInXSB8fCAnJywKICAgICAgICAgICAgICAgICAgICAnQmxhZGUgUmFuZ2UnOiBnWydCbGFkZSBSYW5nZSddIHx8IHJbJ0JsYWRlIFJhbmdlJ10gfHwgZ1snQmxhZGUgRGlhbWV0ZXInXSB8fCByWydCbGFkZSBEaWFtZXRlciddIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICdNb3RvciBUeXBlJzogZ1snTW90b3IgVHlwZSddIHx8IHJbJ01vdG9yIFR5cGUnXSB8fCAnJywKICAgICAgICAgICAgICAgICAgICAnUG93ZXIgU3VwcGx5JzogZ1snUG93ZXIgU3VwcGx5J10gfHwgclsnUG93ZXIgU3VwcGx5J10gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgJ1NvZnQgU3RhcnQnOiBnWydTb2Z0IFN0YXJ0J10gfHwgclsnU29mdCBTdGFydCddIHx8IHJbJ1N0YXJ0IE1vZGUnXSB8fCAnJywKICAgICAgICAgICAgICAgICAgICBMYXNlcjogZ1snTGFzZXInXSB8fCByWydMYXNlciddIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIFRvdGFsOiBnWydUb3RhbCddIHx8IHJbJ1RvdGFsJ10gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgT3RoZXJzOiBnWydPdGhlcnMnXSB8fCByWydPdGhlcnMnXSB8fCAnJywKICAgICAgICAgICAgICAgICAgICBSUE06IGdbJ1JQTSddIHx8IHJbJ1JQTSddIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIFdhdHQ6IGdbJ1dhdHQnXSB8fCByWydXYXR0J10gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgYXR0OiBnWydhdHQnXSB8fCByWydhdHQnXSB8fCAnJywKICAgICAgICAgICAgICAgICAgICAvLyBOZXcgZmllbGRzIGZvciBTY2F0dGVyIFNpemUKICAgICAgICAgICAgICAgICAgICBDb21tZW50czogcGFyc2VGbG9hdChyWydDb21tZW50cyddKSB8fCAwLAogICAgICAgICAgICAgICAgICAgIFNjb3JlOiBwYXJzZUZsb2F0KHJbJ1Njb3JlJ10pIHx8IDAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGaW5hbCBwcm9ncmVzcyB1cGRhdGUKICAgICAgICAgICAgaWYgKHByb2dyZXNzQ2FsbGJhY2spIHByb2dyZXNzQ2FsbGJhY2sodG90YWwsIHRvdGFsKTsKCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXR1cEZpbHRlcnMoKSB7CiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgUGl2b3QgQ29udHJvbHMgd2hlbmV2ZXIgZmlsdGVycy9kYXRhIGFyZSBzZXR1cAogICAgICAgICAgICBpZiAodHlwZW9mIGluaXRQaXZvdENvbnRyb2xzID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICBpbml0UGl2b3RDb250cm9scygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyQ29udHJvbHMnKTsKICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnOwoKICAgICAgICAgICAgLy8gQWx3YXlzIHVzZSBGSUxURVJfRklFTERTIGZvciBjb25zaXN0ZW50IGZpbHRlciBvcmRlcgogICAgICAgICAgICBsZXQgZmllbGRzID0gWy4uLkZJTFRFUl9GSUVMRFNdOwoKICAgICAgICAgICAgLy8gRW5zdXJlIFBsYXRmb3JtIFR5cGUgaXMgYWx3YXlzIHByZXNlbnQgKFVzZXIgUmVxdWlyZW1lbnQpCiAgICAgICAgICAgIGlmICghZmllbGRzLnNvbWUoZiA9PiBmLmtleSA9PT0gJ1BsYXRmb3JtIFR5cGUnKSkgewogICAgICAgICAgICAgICAgZmllbGRzLnNwbGljZSgxLCAwLCB7IGtleTogJ1BsYXRmb3JtIFR5cGUnLCBsYWJlbDogJ1BsYXRmb3JtIFR5cGUnIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWZpZWxkcy5zb21lKGYgPT4gZi5rZXkgPT09ICdBY2Nlc3NvcmllcycpKSB7CiAgICAgICAgICAgICAgICBmaWVsZHMucHVzaCh7IGtleTogJ0FjY2Vzc29yaWVzJywgbGFiZWw6ICdBY2Nlc3NvcmllcycgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEJ1aWxkIEJyYW5kLXRvLVBsYXRmb3JtIE1hcCBmb3IgQXV0by1TZWxlY3QgTG9naWMKICAgICAgICAgICAgd2luZG93LmJyYW5kVG9QbGF0Zm9ybXMgPSB7fTsKICAgICAgICAgICAgd2luZG93Lmxhc3RBdXRvUGxhdGZvcm1TZXQgPSBuZXcgU2V0KCk7IC8vIFRyYWNrIGF1dG8tc2VsZWN0ZWQgc3RhdGUKCiAgICAgICAgICAgIG1lcmdlZERhdGEuZm9yRWFjaChkID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBkLkJyYW5kOwogICAgICAgICAgICAgICAgY29uc3QgcCA9IGQuUGxhdGZvcm07CiAgICAgICAgICAgICAgICBpZiAoYiAmJiBwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF3aW5kb3cuYnJhbmRUb1BsYXRmb3Jtc1tiXSkgd2luZG93LmJyYW5kVG9QbGF0Zm9ybXNbYl0gPSBuZXcgU2V0KCk7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmJyYW5kVG9QbGF0Zm9ybXNbYl0uYWRkKHApOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sYXN0QXV0b1BsYXRmb3JtU2V0LmFkZChwKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gUmV2ZXJzZSBNYXA6IFBsYXRmb3JtIC0+IEJyYW5kcyBmb3IgQXV0by1FeHBhbnNpb24KICAgICAgICAgICAgICAgICAgICBpZiAoIXdpbmRvdy5wbGF0Zm9ybVRvQnJhbmRzKSB3aW5kb3cucGxhdGZvcm1Ub0JyYW5kcyA9IHt9OwogICAgICAgICAgICAgICAgICAgIGlmICghd2luZG93LnBsYXRmb3JtVG9CcmFuZHNbcF0pIHdpbmRvdy5wbGF0Zm9ybVRvQnJhbmRzW3BdID0gbmV3IFNldCgpOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wbGF0Zm9ybVRvQnJhbmRzW3BdLmFkZChiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBmaWVsZHMuZm9yRWFjaChmID0+IHsKICAgICAgICAgICAgICAgIC8vIERldGVybWluZSBlZmZlY3RpdmUga2V5ICh1c2UgZmFsbGJhY2sgaWYgcHJpbWFyeSBoYXMgbm8gdmFsdWVzKQogICAgICAgICAgICAgICAgbGV0IGVmZmVjdGl2ZUtleSA9IGYua2V5OwogICAgICAgICAgICAgICAgbGV0IG5vbkVtcHR5VmFsdWVzID0gWy4uLm5ldyBTZXQobWVyZ2VkRGF0YS5tYXAoZCA9PiBkW2Yua2V5XSkuZmlsdGVyKHYgPT4gdikpXTsKCiAgICAgICAgICAgICAgICAvLyBUcnkgZmFsbGJhY2tfa2V5IGlmIHByaW1hcnkga2V5IGhhcyBubyB2YWx1ZXMKICAgICAgICAgICAgICAgIGlmIChub25FbXB0eVZhbHVlcy5sZW5ndGggPT09IDAgJiYgZi5mYWxsYmFja19rZXkpIHsKICAgICAgICAgICAgICAgICAgICBub25FbXB0eVZhbHVlcyA9IFsuLi5uZXcgU2V0KG1lcmdlZERhdGEubWFwKGQgPT4gZFtmLmZhbGxiYWNrX2tleV0pLmZpbHRlcih2ID0+IHYpKV07CiAgICAgICAgICAgICAgICAgICAgaWYgKG5vbkVtcHR5VmFsdWVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWZmZWN0aXZlS2V5ID0gZi5mYWxsYmFja19rZXk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBGaWx0ZXIgJHtmLmtleX06IHVzaW5nIGZhbGxiYWNrX2tleSAiJHtmLmZhbGxiYWNrX2tleX0iYCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFNvcnQgUHJpY2UgUmFuZ2UgbnVtZXJpY2FsbHkKICAgICAgICAgICAgICAgIGlmIChmLmtleSA9PT0gJ1ByaWNlIFJhbmdlJykgewogICAgICAgICAgICAgICAgICAgIG5vbkVtcHR5VmFsdWVzLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbnVtQSA9IHBhcnNlSW50KChhLm1hdGNoKC9cZCsvKSB8fCBbJzAnXSlbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1CID0gcGFyc2VJbnQoKGIubWF0Y2goL1xkKy8pIHx8IFsnMCddKVswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudW1BIC0gbnVtQjsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbm9uRW1wdHlWYWx1ZXMuc29ydCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBlbXB0eSB2YWx1ZXMKICAgICAgICAgICAgICAgIGNvbnN0IGhhc0VtcHR5ID0gbWVyZ2VkRGF0YS5zb21lKGQgPT4gIWRbZWZmZWN0aXZlS2V5XSk7CgogICAgICAgICAgICAgICAgaWYgKCFub25FbXB0eVZhbHVlcy5sZW5ndGggJiYgIWhhc0VtcHR5KSByZXR1cm47CgogICAgICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgQWNjZXNzb3JpZXM6IHBhcnNlIGtleXdvcmRzIGZyb20gYWNjZXNzb3J5IHN0cmluZ3MKICAgICAgICAgICAgICAgIGxldCBhbGxPcHRpb25zOwogICAgICAgICAgICAgICAgaWYgKGYua2V5ID09PSAnQWNjZXNzb3JpZXMnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgQUNDRVNTT1JZX0tFWVdPUkRTID0gWydCbGFkZScsICdCYXR0ZXJ5JywgJ0NoYXJnZXInLCAnU3RhbmQnLCAnQnVuZGxlJ107CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm91bmRLZXl3b3JkcyA9IG5ldyBTZXQoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNOb25lID0gbm9uRW1wdHlWYWx1ZXMuaW5jbHVkZXMoJy0nKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gU2NhbiBhbGwgZGF0YSBmb3Iga2V5d29yZHMKICAgICAgICAgICAgICAgICAgICBtZXJnZWREYXRhLmZvckVhY2goZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjYyA9IGRbJ0FjY2Vzc29yaWVzJ10gfHwgJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIEFDQ0VTU09SWV9LRVlXT1JEUy5mb3JFYWNoKGt3ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY2MudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhrdy50b0xvd2VyQ2FzZSgpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kS2V5d29yZHMuYWRkKGt3KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGFsbE9wdGlvbnMgPSBbXTsKICAgICAgICAgICAgICAgICAgICBpZiAoaGFzTm9uZSkgYWxsT3B0aW9ucy5wdXNoKCctJyk7CiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGZvdW5kIGtleXdvcmRzIGluIGRlZmluZWQgb3JkZXIKICAgICAgICAgICAgICAgICAgICBBQ0NFU1NPUllfS0VZV09SRFMuZm9yRWFjaChrdyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZEtleXdvcmRzLmhhcyhrdykpIGFsbE9wdGlvbnMucHVzaChrdyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc0VtcHR5KSBhbGxPcHRpb25zLnVuc2hpZnQoJyhFbXB0eSknKTsKCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FjY2Vzc29yaWVzIGtleXdvcmRzIGZvdW5kOicsIFsuLi5mb3VuZEtleXdvcmRzXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIEJ1aWxkIG9wdGlvbnMgbGlzdDogZW1wdHkgZmlyc3QsIHRoZW4gb3RoZXJzCiAgICAgICAgICAgICAgICAgICAgYWxsT3B0aW9ucyA9IGhhc0VtcHR5ID8gWycoRW1wdHkpJywgLi4ubm9uRW1wdHlWYWx1ZXNdIDogbm9uRW1wdHlWYWx1ZXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaWx0ZXJTZWxlY3Rpb25zW2Yua2V5XSA9IG5ldyBTZXQoYWxsT3B0aW9ucyk7CiAgICAgICAgICAgICAgICAvLyBTdG9yZSBlZmZlY3RpdmUga2V5IG1hcHBpbmcgZm9yIGZpbHRlciBhcHBsaWNhdGlvbgogICAgICAgICAgICAgICAgZmlsdGVyU2VsZWN0aW9uc1tmLmtleSArICdfZWZmZWN0aXZlS2V5J10gPSBlZmZlY3RpdmVLZXk7CgogICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGRlcGVuZGVuY2llcyBhZ2FpbiBpZiBuZWVkZWQgKG9yIG1vdmUgdG8gcmVsb2FkRGF0YSkKICAgICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZURlcGVuZGVuY2llcygpOwoKICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBncm91cC5jbGFzc05hbWUgPSAnZmlsdGVyLWdyb3VwJzsKCiAgICAgICAgICAgICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgICAgICAgICAgIGJ0bi5jbGFzc05hbWUgPSAnZmlsdGVyLWJ0bic7CiAgICAgICAgICAgICAgICAvLyBPbmx5IHNob3cgY291bnQgZm9yIFBsYXRmb3JtIGFuZCBCcmFuZAogICAgICAgICAgICAgICAgaWYgKGYua2V5ID09PSAnUGxhdGZvcm0nIHx8IGYua2V5ID09PSAnQnJhbmQnKSB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmlubmVySFRNTCA9IGAke2YubGFiZWx9IDxzcGFuIGNsYXNzPSJ0ZXh0LWdyYXktNDAwIj4oJHthbGxPcHRpb25zLmxlbmd0aH0pPC9zcGFuPiA8aSBjbGFzcz0iZmFzIGZhLWNoZXZyb24tZG93biIgc3R5bGU9ImZvbnQtc2l6ZTowLjVyZW0iPjwvaT5gOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBidG4uaW5uZXJIVE1MID0gYCR7Zi5sYWJlbH0gPGkgY2xhc3M9ImZhcyBmYS1jaGV2cm9uLWRvd24iIHN0eWxlPSJmb250LXNpemU6MC41cmVtIj48L2k+YDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJ0bi5kYXRhc2V0LmZpZWxkID0gZi5rZXk7CiAgICAgICAgICAgICAgICBpZiAoZi5rZXkgPT09ICdQbGF0Zm9ybScpIGJ0bi5pZCA9ICdidG4tcGxhdGZvcm0tZmlsdGVyJzsgLy8gRGVidWdnaW5nIEFuY2hvcgoKICAgICAgICAgICAgICAgIGNvbnN0IGRyb3Bkb3duID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBkcm9wZG93bi5jbGFzc05hbWUgPSAnZmlsdGVyLWRyb3Bkb3duJzsKCiAgICAgICAgICAgICAgICAvLyDmkJzlsIvmoYbvvIjlpoLmnpzllZ/nlKjvvIkKICAgICAgICAgICAgICAgIGNvbnN0IHNlYXJjaEh0bWwgPSBmLmhhc1NlYXJjaCA/IGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmaWx0ZXItc2VhcmNoIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmaWx0ZXItc2VhcmNoLWlucHV0IiBwbGFjZWhvbGRlcj0i5pCc5bCLJHtmLmxhYmVsfS4uLiI+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICBgIDogJyc7CgogICAgICAgICAgICAgICAgZHJvcGRvd24uaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgICR7c2VhcmNoSHRtbH0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmaWx0ZXItZHJvcGRvd24taGVhZGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTcwMCIgZGF0YS1hY3Rpb249ImFsbCI+5YWo6YG4PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJnLWdyYXktMTAwIHRleHQtZ3JheS03MDAiIGRhdGEtYWN0aW9uPSJub25lIj7muIXpmaQ8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmaWx0ZXItb3B0aW9ucy1saXN0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgJHthbGxPcHRpb25zLm1hcCh2ID0+IGA8bGFiZWwgY2xhc3M9ImZpbHRlci1vcHRpb24iPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgdmFsdWU9IiR7dn0iIGNoZWNrZWQ+JHt2fTwvbGFiZWw+YCkuam9pbignJyl9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICBgOwoKICAgICAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpc09wZW4gPSBkcm9wZG93bi5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3cnKTsKCiAgICAgICAgICAgICAgICAgICAgbGV0IGFueUNsb3NlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItZHJvcGRvd24nKS5mb3JFYWNoKGQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3cnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbnlDbG9zZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIC8vIElmIHdlIGNsb3NlZCBhbnl0aGluZyAoaW5jbHVkaW5nIHRoZSBjdXJyZW50IG9uZSBpZiBpdCB3YXMgb3BlbiksIGFwcGx5IGZpbHRlcnMKICAgICAgICAgICAgICAgICAgICBpZiAoYW55Q2xvc2VkKSBhcHBseUZpbHRlcnMoKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc09wZW4pIGRyb3Bkb3duLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWFjdGlvbl0nKS5mb3JFYWNoKGIgPT4gewogICAgICAgICAgICAgICAgICAgIGIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1NlbGVjdEFsbCA9IGIuZGF0YXNldC5hY3Rpb24gPT09ICdhbGwnOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGNoZWNrYm94IHN0YXRlcwogICAgICAgICAgICAgICAgICAgICAgICBkcm9wZG93bi5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCcpLmZvckVhY2goY2IgPT4gY2IuY2hlY2tlZCA9IGlzU2VsZWN0QWxsKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFY1LjIxOiBGdWxsIHNlbGVjdGlvbiA9IG5vIHJlc3RyaWN0aW9uID0gZW1wdHkgU2V0CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBhcnRpYWwgc2VsZWN0aW9uID0gaGFzIHJlc3RyaWN0aW9uID0gU2V0IHdpdGggc2VsZWN0ZWQgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgZW5zdXJlcyBzbWFydCBzeW5jIG9ubHkgdHJpZ2dlcnMgZm9yIGZpbHRlcnMgd2l0aCBhY3R1YWwgcmVzdHJpY3Rpb25zCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsID0gZHJvcGRvd24ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXScpLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hlY2tlZCA9IFsuLi5kcm9wZG93bi5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFt0eXBlPSJjaGVja2JveCJdOmNoZWNrZWQnKV0ubWFwKGNiID0+IGNiLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBjaGVja2VkLmxlbmd0aDsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFsd2F5cyBzdG9yZSB0aGUgYWN0dWFsIGNoZWNrZWQgdmFsdWVzIChuZWVkZWQgZm9yIGFwcGx5RmlsdGVycykKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyU2VsZWN0aW9uc1tmLmtleV0gPSBuZXcgU2V0KGNoZWNrZWQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGJ1dHRvbiBhY3RpdmUgc3RhdGUgYW5kIHRleHQgaW1tZWRpYXRlbHkKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYnRuID0gZHJvcGRvd24ucHJldmlvdXNFbGVtZW50U2libGluZzsKICAgICAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIHNlbGVjdGVkIDwgdG90YWwgJiYgc2VsZWN0ZWQgPiAwKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBidXR0b24gdGV4dCBmb3IgUGxhdGZvcm0vQnJhbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYua2V5ID09PSAnUGxhdGZvcm0nIHx8IGYua2V5ID09PSAnQnJhbmQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidG4uaW5uZXJIVE1MID0gYCR7Zi5sYWJlbH0gPHNwYW4gY2xhc3M9InRleHQtZ3JheS00MDAiPigke3NlbGVjdGVkfS8ke3RvdGFsfSk8L3NwYW4+IDxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1kb3duIiBzdHlsZT0iZm9udC1zaXplOjAuNXJlbSI+PC9pPmA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEltbWVkaWF0ZWx5IHVwZGF0ZSBjYXNjYWRlIHZpc2liaWxpdHkgKGJsYWNrL2dyYXkpIHNvIHVzZXIgc2VlcyB2YWxpZCBvcHRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUZpbHRlck9wdGlvbnNWaXNpYmlsaXR5KCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBkcm9wZG93bi5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFt0eXBlPSJjaGVja2JveCJdJykuZm9yRWFjaChjYiA9PiB7CiAgICAgICAgICAgICAgICAgICAgY2IuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHVwZGF0ZUZpbHRlckZyb21Ecm9wZG93bihmLmtleSwgZHJvcGRvd24sIGUudGFyZ2V0KSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyDmkJzlsIvlip/og70KICAgICAgICAgICAgICAgIGNvbnN0IHNlYXJjaElucHV0ID0gZHJvcGRvd24ucXVlcnlTZWxlY3RvcignLmZpbHRlci1zZWFyY2gtaW5wdXQnKTsKICAgICAgICAgICAgICAgIGlmIChzZWFyY2hJbnB1dCkgewogICAgICAgICAgICAgICAgICAgIHNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcXVlcnkgPSBlLnRhcmdldC52YWx1ZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBkcm9wZG93bi5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsdGVyLW9wdGlvbicpLmZvckVhY2gobGFiZWwgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGxhYmVsLnRleHRDb250ZW50LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC5zdHlsZS5kaXNwbGF5ID0gdGV4dC5pbmNsdWRlcyhxdWVyeSkgPyAnJyA6ICdub25lJzsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZ3JvdXAuYXBwZW5kQ2hpbGQoYnRuKTsKICAgICAgICAgICAgICAgIGdyb3VwLmFwcGVuZENoaWxkKGRyb3Bkb3duKTsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChncm91cCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgbGV0IGlzU3luY2luZyA9IGZhbHNlOyAvLyBQcmV2ZW50IHJlY3Vyc2lvbiBsb29wCgogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUZpbHRlckZyb21Ecm9wZG93bihmaWVsZCwgZHJvcGRvd24sIHRyaWdnZXJFbGVtZW50KSB7CiAgICAgICAgICAgIGlmIChpc1N5bmNpbmcpIHJldHVybjsgLy8gQmxvY2sgcmVjdXJzaXZlIGNhbGxzCgogICAgICAgICAgICBjb25zdCB0b3RhbCA9IGRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W3R5cGU9ImNoZWNrYm94Il0nKS5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IGNoZWNrZWQgPSBbLi4uZHJvcGRvd24ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXTpjaGVja2VkJyldLm1hcChjYiA9PiBjYi52YWx1ZSk7CiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gY2hlY2tlZC5sZW5ndGg7CgogICAgICAgICAgICAvLyBBbHdheXMgc3RvcmUgdGhlIGFjdHVhbCBjaGVja2VkIHZhbHVlcyAobmVlZGVkIGZvciBhcHBseUZpbHRlcnMpCiAgICAgICAgICAgIGZpbHRlclNlbGVjdGlvbnNbZmllbGRdID0gbmV3IFNldChjaGVja2VkKTsKCiAgICAgICAgICAgIC8vIFtWNS4yNV0gRmlyc3QgRmlsdGVyIEF1dG8tVW5jaGVjayBMb2dpYwogICAgICAgICAgICAvLyBXaGVuIHVzZXIgbWFrZXMgRklSU1QgZmlsdGVyIGFjdGlvbiAocGFydGlhbCBzZWxlY3Rpb24pLCBhdXRvLXVuY2hlY2sgb3RoZXIgYWxsLXNlbGVjdGVkIGZpbHRlcnMKICAgICAgICAgICAgLy8gVGhpcyBhbGxvd3MgaW1tZWRpYXRlIGJsYWNrL2dyYXkgZGlzdGluY3Rpb24gdmlzaWJpbGl0eQogICAgICAgICAgICBpZiAoIWhhc1VzZXJGaWx0ZXJlZCAmJiBzZWxlY3RlZCA8IHRvdGFsICYmIHNlbGVjdGVkID4gMCkgewogICAgICAgICAgICAgICAgaGFzVXNlckZpbHRlcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbVjUuMjVdIEZpcnN0IGZpbHRlciBkZXRlY3RlZCBvbicsIGZpZWxkLCAnLSBhdXRvLXVuY2hlY2tpbmcgb3RoZXIgYWxsLXNlbGVjdGVkIGZpbHRlcnMnKTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsdGVyLWdyb3VwJykuZm9yRWFjaChncm91cCA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJCdG4gPSBncm91cC5xdWVyeVNlbGVjdG9yKCcuZmlsdGVyLWJ0bicpOwogICAgICAgICAgICAgICAgICAgIGlmICghb3RoZXJCdG4pIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlckZpZWxkID0gb3RoZXJCdG4uZGF0YXNldC5maWVsZDsKICAgICAgICAgICAgICAgICAgICBpZiAoIW90aGVyRmllbGQgfHwgb3RoZXJGaWVsZCA9PT0gZmllbGQpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJEcm9wZG93biA9IGdyb3VwLnF1ZXJ5U2VsZWN0b3IoJy5maWx0ZXItZHJvcGRvd24nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIW90aGVyRHJvcGRvd24pIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJUb3RhbCA9IG90aGVyRHJvcGRvd24ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXScpLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlckNoZWNrZWQgPSBvdGhlckRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W3R5cGU9ImNoZWNrYm94Il06Y2hlY2tlZCcpLmxlbmd0aDsKCiAgICAgICAgICAgICAgICAgICAgLy8gT25seSB1bmNoZWNrIGlmIGN1cnJlbnRseSBhbGwtc2VsZWN0ZWQKICAgICAgICAgICAgICAgICAgICBpZiAob3RoZXJDaGVja2VkID09PSBvdGhlclRvdGFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyRHJvcGRvd24ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXScpLmZvckVhY2goY2IgPT4gY2IuY2hlY2tlZCA9IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyU2VsZWN0aW9uc1tvdGhlckZpZWxkXSA9IG5ldyBTZXQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBidXR0b24gVUkKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBGSUxURVJfRklFTERTLmZpbmQoZiA9PiBmLmtleSA9PT0gb3RoZXJGaWVsZCk/LmxhYmVsIHx8IG90aGVyRmllbGQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvdGhlckZpZWxkID09PSAnUGxhdGZvcm0nIHx8IG90aGVyRmllbGQgPT09ICdCcmFuZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyQnRuLmlubmVySFRNTCA9IGAke2xhYmVsfSA8c3BhbiBjbGFzcz0idGV4dC1ncmF5LTQwMCI+KDAvJHtvdGhlclRvdGFsfSk8L3NwYW4+IDxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1kb3duIiBzdHlsZT0iZm9udC1zaXplOjAuNXJlbSI+PC9pPmA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgb3RoZXJCdG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFtWNS4yMF0gR0VORVJJQyBTbWFydCBTeW5jIExvZ2ljCiAgICAgICAgICAgIC8vIEdyYXkgPSBvcHRpb24gbm90IGluIGN1cnJlbnQgZmlsdGVyZWREYXRhIChpbnZhbGlkIGdpdmVuIGN1cnJlbnQgZmlsdGVyIHN0YXRlKQogICAgICAgICAgICAvLyBCbGFjayA9IG9wdGlvbiBpbiBjdXJyZW50IGZpbHRlcmVkRGF0YSAodmFsaWQpCiAgICAgICAgICAgIC8vIFdoZW4gc2VsZWN0aW5nIEdSQVk6IGV4cGFuZCBBTEwgb3RoZXIgZmlsdGVycyB0aGF0IGhhdmUgZXhwbGljaXQgc2VsZWN0aW9ucwoKICAgICAgICAgICAgbGV0IGlzR3JheU9wdGlvblNlbGVjdGVkID0gZmFsc2U7CiAgICAgICAgICAgIGxldCBzZWxlY3RlZFZhbHVlID0gbnVsbDsKCiAgICAgICAgICAgIGlmICh0cmlnZ2VyRWxlbWVudCAmJiB0cmlnZ2VyRWxlbWVudC5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlID0gdHJpZ2dlckVsZW1lbnQudmFsdWU7CgogICAgICAgICAgICAgICAgLy8gVjUuMjM6IEdyYXkgZGV0ZWN0aW9uIG11c3QgbWF0Y2ggY2FzY2FkZSB2aXNpYmlsaXR5IGxvZ2ljCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgdmFsaWQgdmFsdWVzIGJ5IGZpbHRlcmluZyBtZXJnZWREYXRhIEVYQ0xVRElORyB0aGlzIGZpZWxkJ3MgZmlsdGVyCiAgICAgICAgICAgICAgICAvLyBUaGlzIG1hdGNoZXMgd2hhdCB1cGRhdGVGaWx0ZXJPcHRpb25zVmlzaWJpbGl0eSBzaG93cyBhcyBibGFjay9ncmF5CgogICAgICAgICAgICAgICAgLy8gUHJlLWNhbGN1bGF0ZSBCcmFuZC9QbGF0Zm9ybSBzdGF0ZQogICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlQnJhbmRzID0gbmV3IFNldCgpOwogICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlUGxhdGZvcm1zID0gbmV3IFNldCgpOwogICAgICAgICAgICAgICAgbWVyZ2VkRGF0YS5mb3JFYWNoKHIgPT4gewogICAgICAgICAgICAgICAgICAgIHVuaXF1ZUJyYW5kcy5hZGQoci5CcmFuZCB8fCAnKEVtcHR5KScpOwogICAgICAgICAgICAgICAgICAgIHVuaXF1ZVBsYXRmb3Jtcy5hZGQoci5QbGF0Zm9ybSB8fCAnKEVtcHR5KScpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjb25zdCB0b3RhbEJyYW5kcyA9IHVuaXF1ZUJyYW5kcy5zaXplOwogICAgICAgICAgICAgICAgY29uc3QgdG90YWxQbGF0Zm9ybXMgPSB1bmlxdWVQbGF0Zm9ybXMuc2l6ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGJyYW5kU2V0ID0gZmlsdGVyU2VsZWN0aW9uc1snQnJhbmQnXTsKICAgICAgICAgICAgICAgIGNvbnN0IHBsYXRmb3JtU2V0ID0gZmlsdGVyU2VsZWN0aW9uc1snUGxhdGZvcm0nXTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzQnJhbmRBY3RpdmUgPSBicmFuZFNldCAmJiBicmFuZFNldC5zaXplIDwgdG90YWxCcmFuZHM7CgogICAgICAgICAgICAgICAgLy8gSGVscGVyOiBDaGVjayBpZiByb3cgcGFzc2VzIGFsbCBmaWx0ZXJzIEVYQ0VQVCB0aGUgY3VycmVudCBmaWVsZAogICAgICAgICAgICAgICAgY29uc3Qgcm93UGFzc2VzT3RoZXJGaWx0ZXJzID0gKHJvdykgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICghcm93LlBsYXRmb3JtIHx8ICFyb3cuUHJpY2UpIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgLy8gUHJpY2UgcmFuZ2UgZmlsdGVyCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJpY2UgPSBwYXJzZUZsb2F0KHJvdy5QcmljZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByaWNlIDwgcHJpY2VSYW5nZS5taW4gfHwgcHJpY2UgPiBwcmljZVJhbmdlLm1heCkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgICAgICAgICAvLyBHZW5lcmljIEZpbHRlcnMgKHNraXAgY3VycmVudCBmaWVsZCkKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXNzT3RoZXJzID0gT2JqZWN0LmVudHJpZXMoZmlsdGVyU2VsZWN0aW9ucykuZXZlcnkoKFtrZXksIHZhbHVlc10pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gZmllbGQpIHJldHVybiB0cnVlOyAvLyBTa2lwIGN1cnJlbnQgZmllbGQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ0JyYW5kJyB8fCBrZXkgPT09ICdQbGF0Zm9ybScpIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5LmVuZHNXaXRoKCdfZWZmZWN0aXZlS2V5JykpIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISh2YWx1ZXMgaW5zdGFuY2VvZiBTZXQpIHx8IHZhbHVlcy5zaXplID09PSAwKSByZXR1cm4gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVmZmVjdGl2ZUtleSA9IGZpbHRlclNlbGVjdGlvbnNba2V5ICsgJ19lZmZlY3RpdmVLZXknXSB8fCBrZXk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1WYWx1ZSA9IHJvd1tlZmZlY3RpdmVLZXldOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWl0ZW1WYWx1ZSAmJiB2YWx1ZXMuaGFzKCcoRW1wdHkpJykpIHJldHVybiB0cnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgQWNjZXNzb3JpZXMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ0FjY2Vzc29yaWVzJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWNjZXNzb3JpZXNWYWx1ZSA9IGl0ZW1WYWx1ZSB8fCAnLSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWNjZXNzb3JpZXNWYWx1ZSA9PT0gJy0nKSByZXR1cm4gdmFsdWVzLmhhcygnLScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgQUxMX0tFWVdPUkRTID0gWydCbGFkZScsICdCYXR0ZXJ5JywgJ0NoYXJnZXInLCAnU3RhbmQnLCAnQnVuZGxlJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGt3IG9mIEFMTF9LRVlXT1JEUykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY2Nlc3Nvcmllc1ZhbHVlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoa3cudG9Mb3dlckNhc2UoKSkgJiYgIXZhbHVlcy5oYXMoa3cpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVzLmhhcyhpdGVtVmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIXBhc3NPdGhlcnMpIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgLy8gQnJhbmQvUGxhdGZvcm0gU1RSSUNULCBza2lwIGlmIGl0J3MgdGhlIGN1cnJlbnQgZmllbGQKICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQgIT09ICdQbGF0Zm9ybScgJiYgcGxhdGZvcm1TZXQgJiYgIXBsYXRmb3JtU2V0Lmhhcyhyb3cuUGxhdGZvcm0pKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkICE9PSAnQnJhbmQnICYmIGJyYW5kU2V0ICYmIGlzQnJhbmRBY3RpdmUgJiYgIWJyYW5kU2V0Lmhhcyhyb3cuQnJhbmQpKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgdmFsaWQgdmFsdWVzIGZvciBUSElTIGZpZWxkIChleGNsdWRpbmcgaXRzIG93biBmaWx0ZXIpCiAgICAgICAgICAgICAgICBjb25zdCB2YWxpZFZhbHVlcyA9IG5ldyBTZXQoKTsKICAgICAgICAgICAgICAgIG1lcmdlZERhdGEuZm9yRWFjaChyb3cgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyb3dQYXNzZXNPdGhlckZpbHRlcnMocm93KSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWwgPSByb3dbZmllbGRdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsKSB2YWxpZFZhbHVlcy5hZGQodmFsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoIXZhbGlkVmFsdWVzLmhhcyhzZWxlY3RlZFZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlzR3JheU9wdGlvblNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW1N5bmMgVjUuMjNdIEdyYXkgb3B0aW9uIHNlbGVjdGVkOicsIGZpZWxkLCAnPScsIHNlbGVjdGVkVmFsdWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW1N5bmMgVjUuMjNdIEJsYWNrIG9wdGlvbiBzZWxlY3RlZDonLCBmaWVsZCwgJz0nLCBzZWxlY3RlZFZhbHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gR0VORVJJQyBFWFBBTlNJT046IElmIGdyYXkgb3B0aW9uIHNlbGVjdGVkLCBleHBhbmQgYWxsIG90aGVyIGFjdGl2ZSBmaWx0ZXJzCiAgICAgICAgICAgIC8vIFtWNS4yNV0gRElTQUJMRUQgLSBUaGlzIGNvbmZsaWN0cyB3aXRoIHRoZSBkZXNpcmVkIGJlaGF2aW9yIHdoZXJlIHVzZXIgb25seSBzZWxlY3RzIHdoYXQgdGhleSB3YW50CiAgICAgICAgICAgIC8vIFRoZSBleHBhbnNpb24gd2FzIGF1dG8tY2hlY2tpbmcgcmVsYXRlZCBvcHRpb25zIGluIG90aGVyIGZpbHRlcnMsIHdoaWNoIGlzIGNvbmZ1c2luZwogICAgICAgICAgICAvKgogICAgICAgICAgICBpZiAoaXNHcmF5T3B0aW9uU2VsZWN0ZWQgJiYgc2VsZWN0ZWRWYWx1ZSkgewogICAgICAgICAgICAgICAgaXNTeW5jaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbU3luYyBWNS4yMF0gRXhwYW5kaW5nIG90aGVyIGZpbHRlcnMgdG8gYWNjb21tb2RhdGUgZ3JheSBvcHRpb24uLi4nKTsKCiAgICAgICAgICAgICAgICAvLyBGaW5kIGFsbCBvdGhlciBmaWx0ZXJzIHRoYXQgaGF2ZSBQQVJUSUFMIHNlbGVjdGlvbnMgKG5vdCAiYWxsIHNlbGVjdGVkIikKICAgICAgICAgICAgICAgIC8vIFRoZXNlIGFyZSBmaWx0ZXJzIHdoZXJlIHVzZXIgaGFzIG1hZGUgZXhwbGljaXQgcmVzdHJpY3RpdmUgY2hvaWNlcwogICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlRmlsdGVycyA9IFtdOwogICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpbHRlci1ncm91cCcpLmZvckVhY2goZ3JvdXAgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ0biA9IGdyb3VwLnF1ZXJ5U2VsZWN0b3IoJy5maWx0ZXItYnRuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFidG4pIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlckZpZWxkID0gYnRuLmRhdGFzZXQuZmllbGQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFvdGhlckZpZWxkIHx8IG90aGVyRmllbGQgPT09IGZpZWxkKSByZXR1cm47CgogICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoaXMgZmlsdGVyIGhhcyBQQVJUSUFMIHNlbGVjdGlvbnMgKHJlc3RyaWN0aXZlKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyRHJvcGRvd24gPSBncm91cC5xdWVyeVNlbGVjdG9yKCcuZmlsdGVyLWRyb3Bkb3duJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFvdGhlckRyb3Bkb3duKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJUb3RhbCA9IG90aGVyRHJvcGRvd24ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXScpLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlclZhbHVlcyA9IGZpbHRlclNlbGVjdGlvbnNbb3RoZXJGaWVsZF07CiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBjb25zaWRlciBhcyAiYWN0aXZlIiBpZiBpdCdzIGEgcGFydGlhbCBzZWxlY3Rpb24gKG5vdCBhbGwgc2VsZWN0ZWQpCiAgICAgICAgICAgICAgICAgICAgaWYgKG90aGVyVmFsdWVzICYmIG90aGVyVmFsdWVzLnNpemUgPiAwICYmIG90aGVyVmFsdWVzLnNpemUgPCBvdGhlclRvdGFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZUZpbHRlcnMucHVzaCh7IGZpZWxkOiBvdGhlckZpZWxkLCBidG4sIGRyb3Bkb3duOiBvdGhlckRyb3Bkb3duIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIEZvciBlYWNoIGFjdGl2ZSBmaWx0ZXIsIGZpbmQgd2hhdCB2YWx1ZXMgd291bGQgbWFrZSB0aGlzIGdyYXkgb3B0aW9uIHZhbGlkCiAgICAgICAgICAgICAgICBhY3RpdmVGaWx0ZXJzLmZvckVhY2goKHsgZmllbGQ6IG90aGVyRmllbGQsIGJ0biwgZHJvcGRvd24gfSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICghZHJvcGRvd24pIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgLy8gRmluZCBpbiBtZXJnZWREYXRhOiB3aGF0IG90aGVyRmllbGQgdmFsdWVzIGV4aXN0IGZvciByb3dzIHdoZXJlIGZpZWxkID09PSBzZWxlY3RlZFZhbHVlCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmVlZGVkVmFsdWVzID0gbmV3IFNldCgpOwogICAgICAgICAgICAgICAgICAgIG1lcmdlZERhdGEuZm9yRWFjaChyb3cgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93W2ZpZWxkXSA9PT0gc2VsZWN0ZWRWYWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJWYWwgPSByb3dbb3RoZXJGaWVsZF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3RoZXJWYWwpIG5lZWRlZFZhbHVlcy5hZGQob3RoZXJWYWwpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbU3luYyBWNS4yMF0gRXhwYW5kaW5nJywgb3RoZXJGaWVsZCwgJ3dpdGg6JywgWy4uLm5lZWRlZFZhbHVlc10pOwoKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdGhlc2UgdmFsdWVzIHRvIHRoZSBvdGhlciBmaWx0ZXIncyBjaGVja2JveGVzCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5wdXRzID0gZHJvcGRvd24ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXScpOwogICAgICAgICAgICAgICAgICAgIGlucHV0cy5mb3JFYWNoKGNiID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5lZWRlZFZhbHVlcy5oYXMoY2IudmFsdWUpICYmICFjYi5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5jaGVja2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgZmlsdGVyU2VsZWN0aW9ucwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0NoZWNrZWQgPSBbLi4uZHJvcGRvd24ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXTpjaGVja2VkJyldLm1hcChjYiA9PiBjYi52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgZmlsdGVyU2VsZWN0aW9uc1tvdGhlckZpZWxkXSA9IG5ldyBTZXQobmV3Q2hlY2tlZCk7CgogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBidXR0b24gdGV4dCBpZiBQbGF0Zm9ybSBvciBCcmFuZAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsID0gaW5wdXRzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IG5ld0NoZWNrZWQubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsVGV4dCA9IEZJTFRFUl9GSUVMRFMuZmluZChmID0+IGYua2V5ID09PSBvdGhlckZpZWxkKT8ubGFiZWwgfHwgb3RoZXJGaWVsZDsKICAgICAgICAgICAgICAgICAgICBpZiAob3RoZXJGaWVsZCA9PT0gJ1BsYXRmb3JtJyB8fCBvdGhlckZpZWxkID09PSAnQnJhbmQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ0bi5pbm5lckhUTUwgPSBgJHtsYWJlbFRleHR9IDxzcGFuIGNsYXNzPSJ0ZXh0LWdyYXktNDAwIj4oJHtzZWxlY3RlZH0vJHt0b3RhbH0pPC9zcGFuPiA8aSBjbGFzcz0iZmFzIGZhLWNoZXZyb24tZG93biIgc3R5bGU9ImZvbnQtc2l6ZTowLjVyZW0iPjwvaT5gOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlzU3luY2luZyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgICovCiAgICAgICAgICAgIC8vIFY1LjIyOiBhcHBseUZpbHRlcnMgaXMgREVGRVJSRUQgdG8gZHJvcGRvd24gY2xvc2UKICAgICAgICAgICAgLy8gRG8gTk9UIGNhbGwgYXBwbHlGaWx0ZXJzIGhlcmUgLSBpdCBjYXVzZXMgY2FzY2FkZSB0byB1cGRhdGUgcHJlbWF0dXJlbHkKCiAgICAgICAgICAgIC8vIEV4aXN0aW5nIExvZ2ljOiAxLXRvLTEgRGVwZW5kZW5jaWVzIChQcmVzZXJ2ZSBpZiBuZWVkZWQsIGJ1dCBhYm92ZSBtaWdodCBjb3ZlciBpdCkKICAgICAgICAgICAgLy8gLi4uIChSZW1vdmluZyBvbGQgQnJhbmQgYXV0by1zZWxlY3QgYmxvY2sgbGluZXMgMzEwMS0zMTYwIGFzIGl0IGNvbmZsaWN0cykgLi4uCgoKICAgICAgICAgICAgLy8gTkVXOiBHZW5lcmljIEJpZGlyZWN0aW9uYWwgQXV0by1DaGVjayAoQ2hpbGQgLT4gUGFyZW50KSAoUHJlc2VydmUgZm9yIG90aGVycykKICAgICAgICAgICAgLy8gRXhhbXBsZTogU2VsZWN0ICJCb3NjaCIgKFBsYXRmb3JtKSAtPiBBdXRvLWNoZWNrICJCcmFuZGVyIiAoUGxhdGZvcm0gVHlwZSkKICAgICAgICAgICAgLy8gW1Y1LjI1XSBESVNBQkxFRCAtIFRoaXMgYXV0by1jaGVja3Mgb3B0aW9ucyBiYXNlZCBvbiAxLXRvLTEgZGVwZW5kZW5jaWVzCiAgICAgICAgICAgIC8vIHdoaWNoIGlzIGNvbmZ1c2luZyAoZS5nLiwgc2VsZWN0aW5nIEJvc2NoIGF1dG8tY2hlY2tzIFNvZnQgU3RhcnQgaWYgYWxsIEJvc2NoIHByb2R1Y3RzIGhhdmUgaXQpCiAgICAgICAgICAgIC8qCiAgICAgICAgICAgIGlmIChmaWx0ZXJEZXBlbmRlbmNpZXNbZmllbGRdKSB7CiAgICAgICAgICAgICAgICAvLyAuLi4ga2VlcCBleGlzdGluZyBsb2dpYyAuLi4KICAgICAgICAgICAgICAgIGNvbnN0IGRlcGVuZGVuY2llcyA9IGZpbHRlckRlcGVuZGVuY2llc1tmaWVsZF07CgogICAgICAgICAgICAgICAgLy8gSWRlbnRpZnkgdGFyZ2V0IGZpZWxkcyB0aGF0IG5lZWQgdXBkYXRlcwogICAgICAgICAgICAgICAgY29uc3QgZmllbGRzVG9VcGRhdGUgPSBuZXcgTWFwKCk7IC8vIEZpZWxkIC0+IFNldDxSZXF1aXJlZFZhbHVlcz4KCiAgICAgICAgICAgICAgICBjaGVja2VkLmZvckVhY2godmFsID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGVwZW5kZW5jaWVzW3ZhbF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMoZGVwZW5kZW5jaWVzW3ZhbF0pLmZvckVhY2goKFt0YXJnZXRGaWVsZCwgdGFyZ2V0VmFsdWVdKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZpZWxkc1RvVXBkYXRlLmhhcyh0YXJnZXRGaWVsZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHNUb1VwZGF0ZS5zZXQodGFyZ2V0RmllbGQsIG5ldyBTZXQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHNUb1VwZGF0ZS5nZXQodGFyZ2V0RmllbGQpLmFkZCh0YXJnZXRWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIEFwcGx5IHVwZGF0ZXMKICAgICAgICAgICAgICAgIGZpZWxkc1RvVXBkYXRlLmZvckVhY2goKHJlcXVpcmVkVmFsdWVzLCB0YXJnZXRGaWVsZCkgPT4gewogICAgICAgICAgICAgICAgICAgIC8vIEF2b2lkIHJlY3Vyc2lvbiBpZiBhbHJlYWR5IHByb2Nlc3NpbmcgQnJhbmQvUGxhdGZvcm0gYWJvdmUKICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0RmllbGQgPT09ICdCcmFuZCcgfHwgdGFyZ2V0RmllbGQgPT09ICdQbGF0Zm9ybScpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLmZpbHRlci1idG5bZGF0YS1maWVsZD0iJHt0YXJnZXRGaWVsZH0iXWApOwogICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRCdG4gJiYgcmVxdWlyZWRWYWx1ZXMuc2l6ZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0RHJvcGRvd24gPSB0YXJnZXRCdG4ubmV4dEVsZW1lbnRTaWJsaW5nOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2hhbmdlZCA9IGZhbHNlOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RHJvcGRvd24ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXScpLmZvckVhY2goY2IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVpcmVkVmFsdWVzLmhhcyhjYi52YWx1ZSkgJiYgIWNiLmNoZWNrZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5jaGVja2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hhbmdlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0Q2hlY2tlZCA9IFsuLi50YXJnZXREcm9wZG93bi5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFt0eXBlPSJjaGVja2JveCJdOmNoZWNrZWQnKV0ubWFwKGNiID0+IGNiLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclNlbGVjdGlvbnNbdGFyZ2V0RmllbGRdID0gbmV3IFNldCh0YXJnZXRDaGVja2VkKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgQnV0dG9uIFVJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbCA9IHRhcmdldERyb3Bkb3duLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W3R5cGU9ImNoZWNrYm94Il0nKS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IHRhcmdldENoZWNrZWQubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0QnRuLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIHNlbGVjdGVkIDwgdG90YWwgJiYgc2VsZWN0ZWQgPiAwKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IEZJTFRFUl9GSUVMRFMuZmluZChmID0+IGYua2V5ID09PSB0YXJnZXRGaWVsZCk/LmxhYmVsIHx8IHRhcmdldEZpZWxkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2ltcGxpZnkgYnV0dG9uIHVwZGF0ZSAoR2VuZXJpYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldEJ0bi5pbm5lckhUTUwgPSBgJHtsYWJlbH0gPGkgY2xhc3M9ImZhcyBmYS1jaGV2cm9uLWRvd24iIHN0eWxlPSJmb250LXNpemU6MC41cmVtIj48L2k+YDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgICovCgogICAgICAgICAgICBjb25zdCBidG4gPSBkcm9wZG93bi5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOwogICAgICAgICAgICAvLyB0b3RhbCBhbmQgc2VsZWN0ZWQgYWxyZWFkeSBkZWNsYXJlZCBhdCBmdW5jdGlvbiBzdGFydCAoVjUuMjEpCgogICAgICAgICAgICBidG4uY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJywgc2VsZWN0ZWQgPCB0b3RhbCAmJiBzZWxlY3RlZCA+IDApOwogICAgICAgICAgICBjb25zdCBsYWJlbCA9IEZJTFRFUl9GSUVMRFMuZmluZChmID0+IGYua2V5ID09PSBmaWVsZCk/LmxhYmVsIHx8IGZpZWxkOwogICAgICAgICAgICAvLyBPbmx5IHNob3cgY291bnQgZm9yIFBsYXRmb3JtIGFuZCBCcmFuZAogICAgICAgICAgICBpZiAoZmllbGQgPT09ICdQbGF0Zm9ybScgfHwgZmllbGQgPT09ICdCcmFuZCcpIHsKICAgICAgICAgICAgICAgIGJ0bi5pbm5lckhUTUwgPSBgJHtsYWJlbH0gPHNwYW4gY2xhc3M9InRleHQtZ3JheS00MDAiPigke3NlbGVjdGVkfS8ke3RvdGFsfSk8L3NwYW4+IDxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1kb3duIiBzdHlsZT0iZm9udC1zaXplOjAuNXJlbSI+PC9pPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBidG4uaW5uZXJIVE1MID0gYCR7bGFiZWx9IDxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1kb3duIiBzdHlsZT0iZm9udC1zaXplOjAuNXJlbSI+PC9pPmA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGFwcGx5RmlsdGVycygpOyAvLyBERUZFUlJFRDogZXhlY3V0ZSBvbmx5IHdoZW4gZHJvcGRvd24gY2xvc2VzCgogICAgICAgICAgICAvLyBSZW9yZGVyOiBjaGVja2VkIGZpcnN0IChBLVopLCB0aGVuIHVuY2hlY2tlZCAoQS1aKQogICAgICAgICAgICByZW9yZGVyRmlsdGVyT3B0aW9ucyhkcm9wZG93bik7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZW9yZGVyRmlsdGVyT3B0aW9ucyhkcm9wZG93bikgewogICAgICAgICAgICBjb25zdCBvcHRpb25zTGlzdCA9IGRyb3Bkb3duLnF1ZXJ5U2VsZWN0b3IoJy5maWx0ZXItb3B0aW9ucy1saXN0Jyk7CiAgICAgICAgICAgIGlmICghb3B0aW9uc0xpc3QpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigncmVvcmRlckZpbHRlck9wdGlvbnM6IG9wdGlvbnNMaXN0IG5vdCBmb3VuZCcpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBsYWJlbHMgPSBBcnJheS5mcm9tKG9wdGlvbnNMaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItb3B0aW9uJykpOwoKICAgICAgICAgICAgLy8gU29ydCBieTogMSkgQ2hlY2tlZCBmaXJzdCwgMikgQmxhY2sgdGV4dCAodmFsaWQpIGJlZm9yZSBHcmF5IHRleHQgKGludmFsaWQpLCAzKSBBLVoKICAgICAgICAgICAgbGFiZWxzLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGFDaGVja2VkID0gYS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpLmNoZWNrZWQ7CiAgICAgICAgICAgICAgICBjb25zdCBiQ2hlY2tlZCA9IGIucXVlcnlTZWxlY3RvcignaW5wdXQnKS5jaGVja2VkOwoKICAgICAgICAgICAgICAgIC8vIDEuIENoZWNrZWQgZmlyc3QKICAgICAgICAgICAgICAgIGlmIChhQ2hlY2tlZCAhPT0gYkNoZWNrZWQpIHJldHVybiBhQ2hlY2tlZCA/IC0xIDogMTsKCiAgICAgICAgICAgICAgICAvLyAyLiBWYWxpZCAoZGF0YS12YWxpZD0idHJ1ZSIpIGJlZm9yZSBJbnZhbGlkIChkYXRhLXZhbGlkPSJmYWxzZSIpCiAgICAgICAgICAgICAgICAvLyBWNS4yNDogVXNlIGRhdGEtdmFsaWQgYXR0cmlidXRlIHNldCBieSB1cGRhdGVGaWx0ZXJPcHRpb25zVmlzaWJpbGl0eQogICAgICAgICAgICAgICAgY29uc3QgYUlzVmFsaWQgPSBhLmRhdGFzZXQudmFsaWQgPT09ICd0cnVlJzsKICAgICAgICAgICAgICAgIGNvbnN0IGJJc1ZhbGlkID0gYi5kYXRhc2V0LnZhbGlkID09PSAndHJ1ZSc7CgogICAgICAgICAgICAgICAgaWYgKGFJc1ZhbGlkICE9PSBiSXNWYWxpZCkgcmV0dXJuIGFJc1ZhbGlkID8gLTEgOiAxOwoKICAgICAgICAgICAgICAgIC8vIDMuIFRoZW4gQS1aCiAgICAgICAgICAgICAgICByZXR1cm4gYS50ZXh0Q29udGVudC5sb2NhbGVDb21wYXJlKGIudGV4dENvbnRlbnQpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIENsZWFyIGFuZCByZS1hcHBlbmQgaW4gc29ydGVkIG9yZGVyCiAgICAgICAgICAgIG9wdGlvbnNMaXN0LmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBsYWJlbHMuZm9yRWFjaChsYWJlbCA9PiBvcHRpb25zTGlzdC5hcHBlbmRDaGlsZChsYWJlbCkpOwogICAgICAgIH0KICAgICAgICAvLyBIZWxwZXIgdG8gdXBkYXRlIHZpc3VhbCBzbGlkZXIgdHJhY2sKICAgICAgICBmdW5jdGlvbiB1cGRhdGVQcmljZVRyYWNrKCkgewogICAgICAgICAgICBjb25zdCBzTWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByaWNlU2xpZGVyTWluJyk7CiAgICAgICAgICAgIGNvbnN0IHNNYXggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpY2VTbGlkZXJNYXgnKTsKICAgICAgICAgICAgY29uc3QgdHJhY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpY2VTbGlkZXJUcmFjaycpOwogICAgICAgICAgICBpZiAoIXNNaW4gfHwgIXNNYXggfHwgIXRyYWNrKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBtaW4gPSBwYXJzZUludChzTWluLnZhbHVlKTsKICAgICAgICAgICAgY29uc3QgbWF4ID0gcGFyc2VJbnQoc01heC52YWx1ZSk7CiAgICAgICAgICAgIGNvbnN0IHJhbmdlTWluID0gMDsKICAgICAgICAgICAgY29uc3QgcmFuZ2VNYXggPSAyMDAwOwoKICAgICAgICAgICAgY29uc3QgcDEgPSAoKG1pbiAtIHJhbmdlTWluKSAvIChyYW5nZU1heCAtIHJhbmdlTWluKSkgKiAxMDA7CiAgICAgICAgICAgIGNvbnN0IHAyID0gKChtYXggLSByYW5nZU1pbikgLyAocmFuZ2VNYXggLSByYW5nZU1pbikpICogMTAwOwoKICAgICAgICAgICAgLy8gU3RhbmRhcmQgR3JheS0zMDAgaW5hY3RpdmUsIEdyYXktNjAwIGFjdGl2ZSAobWF0Y2hpbmcgY2xlYXJBbGxGaWx0ZXJzIHN0eWxlKQogICAgICAgICAgICB0cmFjay5zdHlsZS5iYWNrZ3JvdW5kID0gYGxpbmVhci1ncmFkaWVudCh0byByaWdodCwgI2QxZDVkYiAke3AxfSUsICM0YjU1NjMgJHtwMX0lLCAjNGI1NTYzICR7cDJ9JSwgI2QxZDVkYiAke3AyfSUpYDsKICAgICAgICB9CgogICAgICAgIC8vIFVSTCBTdGF0ZSBTeW5jaHJvbml6YXRpb24KICAgICAgICBmdW5jdGlvbiB1cGRhdGVVUkxGcm9tU3RhdGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTsKCiAgICAgICAgICAgIC8vIENvbmZpZyAvIEFjdGl2ZSBNb2RlCiAgICAgICAgICAgIGlmIChhY3RpdmVDb25maWcgJiYgYWN0aXZlQ29uZmlnLmlkKSBwYXJhbXMuc2V0KCdjb25maWcnLCBhY3RpdmVDb25maWcuaWQpOwoKICAgICAgICAgICAgLy8gVmlldyBNb2RlCiAgICAgICAgICAgIGlmIChjdXJyZW50VmlldyAmJiBjdXJyZW50VmlldyAhPT0gJ2dyaWQnKSBwYXJhbXMuc2V0KCd2aWV3JywgY3VycmVudFZpZXcpOwoKICAgICAgICAgICAgLy8gRGF0YSBNb2RlCiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YU1vZGUgIT09ICd1bmRlZmluZWQnICYmIGRhdGFNb2RlICE9PSAnYWxsJykgcGFyYW1zLnNldCgnZGF0YU1vZGUnLCBkYXRhTW9kZSk7CgogICAgICAgICAgICAvLyBNYXRyaXggUXVlcnkgUGFyYW1zCiAgICAgICAgICAgIGNvbnN0IHBSb3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGl2b3RSb3dTZWxlY3QnKTsKICAgICAgICAgICAgY29uc3QgcENvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwaXZvdENvbFNlbGVjdCcpOwogICAgICAgICAgICBpZiAocFJvdyAmJiBwUm93LnZhbHVlKSBwYXJhbXMuc2V0KCdtUm93JywgcFJvdy52YWx1ZSk7CiAgICAgICAgICAgIGlmIChwQ29sICYmIHBDb2wudmFsdWUpIHBhcmFtcy5zZXQoJ21Db2wnLCBwQ29sLnZhbHVlKTsKCiAgICAgICAgICAgIC8vIFNjYXR0ZXIgUXVlcnkgUGFyYW1zCiAgICAgICAgICAgIGNvbnN0IHNZID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYXR0ZXJZQXhpcycpOwogICAgICAgICAgICBjb25zdCBzQyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2F0dGVyQ29sb3JCeScpOwogICAgICAgICAgICBpZiAoc1kgJiYgc1kudmFsdWUgIT09ICdQcmljZScpIHBhcmFtcy5zZXQoJ3NZJywgc1kudmFsdWUpOwogICAgICAgICAgICBpZiAoc0MgJiYgc0MudmFsdWUgIT09ICdCcmFuZCcpIHBhcmFtcy5zZXQoJ3NDJywgc0MudmFsdWUpOwoKICAgICAgICAgICAgLy8gUHJpY2UgUmFuZ2UgKG9ubHkgaWYgY2hhbmdlZCBmcm9tIGRlZmF1bHQpCiAgICAgICAgICAgIC8vIERlZmF1bHQgMC0yMDAwLiBJZiBkaWZmZXJlbnQsIHNldCBpdC4KICAgICAgICAgICAgaWYgKHByaWNlUmFuZ2UubWluID4gMCB8fCBwcmljZVJhbmdlLm1heCA8IDIwMDApIHsKICAgICAgICAgICAgICAgIHBhcmFtcy5zZXQoJ3ByaWNlJywgYCR7cHJpY2VSYW5nZS5taW59LSR7cHJpY2VSYW5nZS5tYXh9YCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEZpbHRlcnMKICAgICAgICAgICAgLy8gQ2FwdHVyZSBvbmx5IGlmIE5PVCBhbGwgc2VsZWN0ZWQuCiAgICAgICAgICAgIC8vIEJ1dCBzZXR1cEZpbHRlcnMgaW5pdGlhbGl6ZXMgdG8gQUxMLiBhY3RpdmUgc3RhdGUgdHJhY2sgd2hhdCBpcyBzZWxlY3RlZC4KICAgICAgICAgICAgLy8gSWYgY2hlY2tpbmcgbG9naWMgaXMgIklmIHNpemUgPCBmdWxsIG9wdGlvbnMiLCB0aGVuIGl0J3MgZmlsdGVyZWQuCiAgICAgICAgICAgIC8vIEJ1dCBnZXR0aW5nICJmdWxsIG9wdGlvbnMiIHNpemUgaXMgaGFyZCBoZXJlLgogICAgICAgICAgICAvLyBTaW1wbGVyOiBKdXN0IHNhdmUgd2hhdCBpcyBzZWxlY3RlZCBpZiBpdCdzIG5vdCBlbXB0eT8KICAgICAgICAgICAgLy8gQWN0dWFsbHksIHVzdWFsbHkgVVJMIGZpbHRlcnMgcmVwcmVzZW50ICJXaGF0IGlzIHNlbGVjdGVkIi4KICAgICAgICAgICAgLy8gSWYgSSBzZWxlY3QgIkJvc2NoIiwgVVJMIGhhcyAiQm9zY2giLgogICAgICAgICAgICAvLyBJZiBJIHNlbGVjdCBBbGwsIFVSTCBoYXMgYWxsPyBPciBub3RoaW5nPwogICAgICAgICAgICAvLyAiTm90aGluZyIgdXN1YWxseSBpbXBsaWVzICJEZWZhdWx0IiAoQWxsKS4KICAgICAgICAgICAgLy8gQnV0IGhlcmUsIGZpbHRlclNlbGVjdGlvbnMgY29udGFpbnMgRXZlcnl0aGluZyBieSBkZWZhdWx0LgogICAgICAgICAgICAvLyBJZiBJIG9taXQgaXQgZnJvbSBVUkwsIGBsb2FkU3RhdGVGcm9tVVJMYCB3aWxsIGFzc3VtaW5nICJEZWZhdWx0IiAoQWxsKS4KICAgICAgICAgICAgLy8gU28gd2UgbmVlZCB0byBkZXRlY3QgIklzIGl0IGZ1bGw/Ii4KCiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItZHJvcGRvd24nKS5mb3JFYWNoKGRkID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gZGQucHJldmlvdXNFbGVtZW50U2libGluZz8uZGF0YXNldD8uZmllbGQ7CiAgICAgICAgICAgICAgICBpZiAoZmllbGQgJiYgZmlsdGVyU2VsZWN0aW9uc1tmaWVsZF0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbE9wdGlvbnMgPSBkZC5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFt0eXBlPSJjaGVja2JveCJdJykubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gZmlsdGVyU2VsZWN0aW9uc1tmaWVsZF0uc2l6ZTsKICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IHdyaXRlIHRvIFVSTCBpZiBOT1QgYWxsIGFyZSBzZWxlY3RlZCAoaS5lLiB1c2VyIGZpbHRlcmVkIHNvbWV0aGluZykKICAgICAgICAgICAgICAgICAgICAvLyBFeGNlcHRpb246IElmIDAgc2VsZWN0ZWQ/IChzaG91bGQgbm90IGhhcHBlbiB1c3VhbGx5LCBsb2dpYyBmb3JjZXMgYXQgbGVhc3QgMSBvciAwIGlzIGVtcHR5KQogICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZCA8IHRvdGFsT3B0aW9ucyAmJiBzZWxlY3RlZCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRW5jb2RlIHZhbHVlcwogICAgICAgICAgICAgICAgICAgICAgICAvLyBVc2UgYSBzZXBhcmF0b3IgdGhhdCBpcyB1cmwgc2FmZSBvciBlbmNvZGUuIENvbW1hIGlzIGZpbmUgZm9yIHJlYWRhYmlsaXR5IGlmIHZhbHVlcyBkb24ndCBoYXZlIGNvbW1hcy4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gU29tZSB0b29sIG5hbWVzIG1pZ2h0IGhhdmUgY29tbWFzPyBCZXR0ZXIgdG8gYmUgc2FmZS4gCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJ1dCBIb3JuYmFjaCB1c2VzIHBsYWluIGNvbW1hLiBJIHdpbGwgdXNlIGNvbW1hIGJ1dCBtYXAgdmFsdWVzLgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWxTdHIgPSBBcnJheS5mcm9tKGZpbHRlclNlbGVjdGlvbnNbZmllbGRdKS5tYXAodiA9PiBlbmNvZGVVUklDb21wb25lbnQodikpLmpvaW4oJywnKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnNldChgZi4ke2ZpZWxkfWAsIHZhbFN0cik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNvbnN0IG5ld1VybCA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArICc/JyArIHBhcmFtcy50b1N0cmluZygpOwogICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sICcnLCBuZXdVcmwpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbG9hZFN0YXRlRnJvbVVSTCgpIHsKICAgICAgICAgICAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTsKCiAgICAgICAgICAgIC8vIDEuIENvbmZpZyAoQWxyZWFkeSBoYW5kbGVkIGJ5IGRldGVjdE1vZGU/IE5vLCBkZXRlY3RNb2RlIHVzZXMgZmlsZW5hbWUgdXN1YWxseSkKICAgICAgICAgICAgLy8gSWYgd2Ugd2FudCB0byBzdXBwb3J0ID9jb25maWc9VEJTLCB3ZSBtaWdodCBuZWVkIGxvZ2ljLgogICAgICAgICAgICAvLyBCdXQgbGV0J3MgYXNzdW1lIGN1cnJlbnQgcGFnZSBtb2RlIGZvciBub3cgb3IgdXNlciBuYXZpZ2F0ZXMgdmlhIGZpbGUuCgogICAgICAgICAgICAvLyBWaWV3IE1vZGUKICAgICAgICAgICAgY29uc3QgdmlldyA9IHBhcmFtcy5nZXQoJ3ZpZXcnKTsKCiAgICAgICAgICAgIC8vIE1hdHJpeCBTdGF0ZQogICAgICAgICAgICBjb25zdCBtUm93ID0gcGFyYW1zLmdldCgnbVJvdycpOwogICAgICAgICAgICBjb25zdCBtQ29sID0gcGFyYW1zLmdldCgnbUNvbCcpOwogICAgICAgICAgICBpZiAobVJvdykgeyBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwaXZvdFJvd1NlbGVjdCcpOyBpZiAoZWwpIGVsLnZhbHVlID0gbVJvdzsgfQogICAgICAgICAgICBpZiAobUNvbCkgeyBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwaXZvdENvbFNlbGVjdCcpOyBpZiAoZWwpIGVsLnZhbHVlID0gbUNvbDsgfQoKICAgICAgICAgICAgLy8gU2NhdHRlciBTdGF0ZQogICAgICAgICAgICBjb25zdCBzWSA9IHBhcmFtcy5nZXQoJ3NZJyk7CiAgICAgICAgICAgIGNvbnN0IHNDID0gcGFyYW1zLmdldCgnc0MnKTsKICAgICAgICAgICAgaWYgKHNZKSB7IGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYXR0ZXJZQXhpcycpOyBpZiAoZWwpIGVsLnZhbHVlID0gc1k7IH0KICAgICAgICAgICAgaWYgKHNDKSB7IGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYXR0ZXJDb2xvckJ5Jyk7IGlmIChlbCkgZWwudmFsdWUgPSBzQzsgfQoKICAgICAgICAgICAgaWYgKHZpZXcgJiYgWydncmlkJywgJ3NjYXR0ZXInLCAncGl2b3QnXS5pbmNsdWRlcyh2aWV3KSkgewogICAgICAgICAgICAgICAgc3dpdGNoVmlldyh2aWV3KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gRGF0YSBNb2RlCiAgICAgICAgICAgIGNvbnN0IG1vZGUgPSBwYXJhbXMuZ2V0KCdkYXRhTW9kZScpOwogICAgICAgICAgICBpZiAobW9kZSkgewogICAgICAgICAgICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLm1vZGUtYnRuW2RhdGEtbW9kZT0iJHttb2RlfSJdYCk7CiAgICAgICAgICAgICAgICBpZiAoYnRuKSBidG4uY2xpY2soKTsKICAgICAgICAgICAgICAgIC8vIE5vdGU6IGJ0bi5jbGljaygpIHRyaWdnZXJzIGV2ZW50IC0+IHNldHMgZGF0YU1vZGUgLT4gY2FsbHMgYXBwbHlGaWx0ZXJzPwogICAgICAgICAgICAgICAgLy8gRGVwZW5kaW5nIG9uIGV2ZW50IGxpc3RlbmVyLCBpdCBtaWdodCBqdXN0IHRvZ2dsZSBjbGFzcyBhbmQgc2V0IHZhci4KICAgICAgICAgICAgICAgIC8vIExldCdzIGFzc3VtZSB3ZSBzZXQgdmFyaWFibGUgbWFudWFsbHkgaWYgY2xpY2sgZG9lc24ndCB3b3JrIHN5bmMuCiAgICAgICAgICAgICAgICAvLyBBY3R1YWxseSwgbGlzdGVuZXJzIGF0IDE1OTkgc2V0IGRhdGFNb2RlIGFuZCBjYWxsIGFwcGx5RmlsdGVycy4KICAgICAgICAgICAgICAgIC8vIFdlIHdhbnQgdG8gYXZvaWQgZG91YmxlIGFwcGx5LiAKICAgICAgICAgICAgICAgIC8vIFNldCB2YXJpYWJsZSBkaXJlY3RseToKICAgICAgICAgICAgICAgIGRhdGFNb2RlID0gbW9kZTsKICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBVSSBhY3RpdmUgc3RhdGUKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kYXRhLW1vZGUgLm1vZGUtYnRuJykuZm9yRWFjaChiID0+IHsKICAgICAgICAgICAgICAgICAgICBiLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIGIuZGF0YXNldC5tb2RlID09PSBtb2RlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBQcmljZQogICAgICAgICAgICBjb25zdCBwcmljZSA9IHBhcmFtcy5nZXQoJ3ByaWNlJyk7CiAgICAgICAgICAgIGlmIChwcmljZSkgewogICAgICAgICAgICAgICAgY29uc3QgW21pbiwgbWF4XSA9IHByaWNlLnNwbGl0KCctJykubWFwKE51bWJlcik7CiAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKG1pbikgJiYgIWlzTmFOKG1heCkpIHsKICAgICAgICAgICAgICAgICAgICBwcmljZVJhbmdlLm1pbiA9IG1pbjsKICAgICAgICAgICAgICAgICAgICBwcmljZVJhbmdlLm1heCA9IG1heDsKICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgVUkKICAgICAgICAgICAgICAgICAgICBjb25zdCBzTWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByaWNlU2xpZGVyTWluJyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc01heCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmljZVNsaWRlck1heCcpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlNaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpY2VNaW4nKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpTWF4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByaWNlTWF4Jyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNNaW4pIHNNaW4udmFsdWUgPSBtaW47CiAgICAgICAgICAgICAgICAgICAgaWYgKHNNYXgpIHNNYXgudmFsdWUgPSBtYXg7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlNaW4pIGlNaW4udmFsdWUgPSBtaW47CiAgICAgICAgICAgICAgICAgICAgaWYgKGlNYXgpIGlNYXgudmFsdWUgPSBtYXg7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlUHJpY2VUcmFjaygpOyAvLyBIZWxwZXIgaWYgZXhpc3RzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDQuIEZpbHRlcnMKICAgICAgICAgICAgLy8gSXRlcmF0ZSBrbm93biBmaWVsZHMKICAgICAgICAgICAgbGV0IGhhc0ZpbHRlclBhcmFtcyA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsdGVyLWRyb3Bkb3duJykuZm9yRWFjaChkZCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IGRkLnByZXZpb3VzRWxlbWVudFNpYmxpbmc/LmRhdGFzZXQ/LmZpZWxkOwogICAgICAgICAgICAgICAgY29uc3QgcGFyYW1WYWwgPSBwYXJhbXMuZ2V0KGBmLiR7ZmllbGR9YCk7CiAgICAgICAgICAgICAgICBpZiAoZmllbGQgJiYgcGFyYW1WYWwpIHsKICAgICAgICAgICAgICAgICAgICBoYXNGaWx0ZXJQYXJhbXMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IG5ldyBTZXQocGFyYW1WYWwuc3BsaXQoJywnKS5tYXAoZGVjb2RlVVJJQ29tcG9uZW50KSk7CiAgICAgICAgICAgICAgICAgICAgZmlsdGVyU2VsZWN0aW9uc1tmaWVsZF0gPSB2YWx1ZXM7CgogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBVSSBDaGVja2JveGVzCiAgICAgICAgICAgICAgICAgICAgZGQucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXScpLmZvckVhY2goY2IgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjYi5jaGVja2VkID0gdmFsdWVzLmhhcyhjYi52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBCdXR0b24gQ291bnQgVUkKICAgICAgICAgICAgICAgICAgICB1cGRhdGVGaWx0ZXJGcm9tRHJvcGRvd24oZmllbGQsIGRkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhcHBseUZpbHRlcnMoKSB7CiAgICAgICAgICAgIC8vIFByZS1jYWxjdWxhdGUgZm9yIFVuaW9uIExvZ2ljIChCcmFuZC9QbGF0Zm9ybSkKICAgICAgICAgICAgY29uc3QgdW5pcXVlQnJhbmRzID0gbmV3IFNldCgpOwogICAgICAgICAgICBjb25zdCB1bmlxdWVQbGF0Zm9ybXMgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgIG1lcmdlZERhdGEuZm9yRWFjaChyID0+IHsKICAgICAgICAgICAgICAgIHVuaXF1ZUJyYW5kcy5hZGQoci5CcmFuZCB8fCAnKEVtcHR5KScpOwogICAgICAgICAgICAgICAgdW5pcXVlUGxhdGZvcm1zLmFkZChyLlBsYXRmb3JtIHx8ICcoRW1wdHkpJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCB0b3RhbEJyYW5kcyA9IHVuaXF1ZUJyYW5kcy5zaXplOwogICAgICAgICAgICBjb25zdCB0b3RhbFBsYXRmb3JtcyA9IHVuaXF1ZVBsYXRmb3Jtcy5zaXplOwoKICAgICAgICAgICAgY29uc3QgYnJhbmRTZXQgPSBmaWx0ZXJTZWxlY3Rpb25zWydCcmFuZCddOwogICAgICAgICAgICBjb25zdCBwbGF0Zm9ybVNldCA9IGZpbHRlclNlbGVjdGlvbnNbJ1BsYXRmb3JtJ107CiAgICAgICAgICAgIGNvbnN0IGlzQnJhbmRBY3RpdmUgPSBicmFuZFNldCAmJiBicmFuZFNldC5zaXplIDwgdG90YWxCcmFuZHM7CiAgICAgICAgICAgIGNvbnN0IGlzUGxhdGZvcm1BY3RpdmUgPSBwbGF0Zm9ybVNldCAmJiBwbGF0Zm9ybVNldC5zaXplIDwgdG90YWxQbGF0Zm9ybXM7CgogICAgICAgICAgICAvLyBBcHBseSBiYXNlIGZpbHRlcnMKICAgICAgICAgICAgbGV0IGJhc2VGaWx0ZXJlZCA9IG1lcmdlZERhdGEuZmlsdGVyKHJvdyA9PiB7CiAgICAgICAgICAgICAgICAvLyBFeGNsdWRlIHJvd3Mgd2l0aG91dCBwcmljZSBvciBwbGF0Zm9ybQogICAgICAgICAgICAgICAgaWYgKCFyb3cuUGxhdGZvcm0gfHwgIXJvdy5QcmljZSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgICAgIC8vIFByaWNlIHJhbmdlIGZpbHRlcgogICAgICAgICAgICAgICAgY29uc3QgcHJpY2UgPSBwYXJzZUZsb2F0KHJvdy5QcmljZSk7CiAgICAgICAgICAgICAgICBpZiAocHJpY2UgPCBwcmljZVJhbmdlLm1pbiB8fCBwcmljZSA+IHByaWNlUmFuZ2UubWF4KSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAgICAgLy8gMi4gR2VuZXJpYyBGaWx0ZXJzIChBTkQgTG9naWMpCiAgICAgICAgICAgICAgICBjb25zdCBwYXNzT3RoZXJzID0gT2JqZWN0LmVudHJpZXMoZmlsdGVyU2VsZWN0aW9ucykuZXZlcnkoKFtrZXksIHZhbHVlc10pID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIEJyYW5kIGFuZCBQbGF0Zm9ybSAoaGFuZGxlZCBzZXBhcmF0ZWx5IHZpYSBVbmlvbikKICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnQnJhbmQnIHx8IGtleSA9PT0gJ1BsYXRmb3JtJykgcmV0dXJuIHRydWU7CgogICAgICAgICAgICAgICAgICAgIC8vIFNraXAgZWZmZWN0aXZlS2V5IG1hcHBpbmdzIGFuZCBub24tc2V0IHZhbHVlcwogICAgICAgICAgICAgICAgICAgIGlmIChrZXkuZW5kc1dpdGgoJ19lZmZlY3RpdmVLZXknKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEodmFsdWVzIGluc3RhbmNlb2YgU2V0KSB8fCB2YWx1ZXMuc2l6ZSA9PT0gMCkgcmV0dXJuIHRydWU7CgogICAgICAgICAgICAgICAgICAgIC8vIFVzZSBlZmZlY3RpdmUga2V5IGlmIGF2YWlsYWJsZQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVmZmVjdGl2ZUtleSA9IGZpbHRlclNlbGVjdGlvbnNba2V5ICsgJ19lZmZlY3RpdmVLZXknXSB8fCBrZXk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbVZhbHVlID0gcm93W2VmZmVjdGl2ZUtleV07CgogICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBlbXB0eSB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICBpZiAoIWl0ZW1WYWx1ZSAmJiB2YWx1ZXMuaGFzKCcoRW1wdHkpJykpIHJldHVybiB0cnVlOwoKICAgICAgICAgICAgICAgICAgICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciBBY2Nlc3NvcmllcyBmaWx0ZXIgLSBrZXl3b3JkIGV4Y2x1c2lvbiBsb2dpYwogICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdBY2Nlc3NvcmllcycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWNjZXNzb3JpZXNWYWx1ZSA9IGl0ZW1WYWx1ZSB8fCAnLSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY2Nlc3Nvcmllc1ZhbHVlID09PSAnLScpIHJldHVybiB2YWx1ZXMuaGFzKCctJyk7CgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBBTExfS0VZV09SRFMgPSBbJ0JsYWRlJywgJ0JhdHRlcnknLCAnQ2hhcmdlcicsICdTdGFuZCcsICdCdW5kbGUnXTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBrdyBvZiBBTExfS0VZV09SRFMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2R1Y3RIYXNLZXl3b3JkID0gYWNjZXNzb3JpZXNWYWx1ZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGt3LnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5d29yZElzQ2hlY2tlZCA9IHZhbHVlcy5oYXMoa3cpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2R1Y3RIYXNLZXl3b3JkICYmICFrZXl3b3JkSXNDaGVja2VkKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZXMuaGFzKGl0ZW1WYWx1ZSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoIXBhc3NPdGhlcnMpIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICAvLyAzLiBCcmFuZCAvIFBsYXRmb3JtIFNUUklDVCBMb2dpYyAodjUuMjUgLSBFbXB0eSBTZXQgPSBObyBGaWx0ZXIpCiAgICAgICAgICAgICAgICAvLyBCb3RoIEJyYW5kIGFuZCBQbGF0Zm9ybSBhcmUgU1RSSUNUIGZpbHRlcnMgbm93CiAgICAgICAgICAgICAgICAvLyBSdWxlOiBFbXB0eSBTZXQgKHNpemUgPT09IDApIG1lYW5zICdubyBmaWx0ZXInIChzaG93IGFsbCkKICAgICAgICAgICAgICAgIC8vIFJ1bGUgMTogUGxhdGZvcm0gRmlsdGVyIGlzIFNUUklDVCAob25seSB3aGVuIGhhcyBzZWxlY3Rpb25zKS4KICAgICAgICAgICAgICAgIGlmIChwbGF0Zm9ybVNldCAmJiBwbGF0Zm9ybVNldC5zaXplID4gMCAmJiAhcGxhdGZvcm1TZXQuaGFzKHJvdy5QbGF0Zm9ybSkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICAvLyBSdWxlIDI6IEJyYW5kIEZpbHRlciBpcyBTVFJJQ1QgKG9ubHkgd2hlbiBoYXMgc2VsZWN0aW9ucykuCiAgICAgICAgICAgICAgICBpZiAoYnJhbmRTZXQgJiYgYnJhbmRTZXQuc2l6ZSA+IDAgJiYgIWJyYW5kU2V0Lmhhcyhyb3cuQnJhbmQpKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0pOwoKCiAgICAgICAgICAgIC8vIERhdGEgbW9kZSBmaWx0ZXJpbmcKICAgICAgICAgICAgaWYgKGRhdGFNb2RlID09PSAndW5pcXVlJykgewogICAgICAgICAgICAgICAgLy8gVW5pcXVlOiBLZWVwIG9ubHkgdW5pcXVlIG1vZGVscyBhY3Jvc3MgYWxsIHBsYXRmb3JtcyAobG93ZXN0IHByaWNlIHBlciBtb2RlbCkKICAgICAgICAgICAgICAgIGNvbnN0IG1vZGVsTWFwID0gbmV3IE1hcCgpOwogICAgICAgICAgICAgICAgYmFzZUZpbHRlcmVkLmZvckVhY2gocm93ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2RlbCA9IHJvd1snTW9kZWwgIyddOwogICAgICAgICAgICAgICAgICAgIGlmICghbW9kZWwpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZyA9IG1vZGVsTWFwLmdldChtb2RlbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFleGlzdGluZyB8fCByb3cuUHJpY2UgPCBleGlzdGluZy5QcmljZSkgewogICAgICAgICAgICAgICAgICAgICAgICBtb2RlbE1hcC5zZXQobW9kZWwsIHJvdyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBmaWx0ZXJlZERhdGEgPSBbLi4ubW9kZWxNYXAudmFsdWVzKCldOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGFNb2RlID09PSAnbG93ZXN0UHJpY2UnKSB7CiAgICAgICAgICAgICAgICAvLyBMb3dlc3Q6IEtlZXAgb25seSBsb3dlc3QgcHJpY2UgcGVyIG1vZGVsK3BsYXRmb3JtIGNvbWJvCiAgICAgICAgICAgICAgICBjb25zdCBjb21ib01hcCA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICAgIGJhc2VGaWx0ZXJlZC5mb3JFYWNoKHJvdyA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9kZWwgPSByb3dbJ01vZGVsICMnXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF0Zm9ybSA9IHJvd1snUGxhdGZvcm0nXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIW1vZGVsIHx8ICFwbGF0Zm9ybSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IGAke21vZGVsfXx8fCR7cGxhdGZvcm19YDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZyA9IGNvbWJvTWFwLmdldChrZXkpOwogICAgICAgICAgICAgICAgICAgIGlmICghZXhpc3RpbmcgfHwgcGFyc2VGbG9hdChyb3cuUHJpY2UpIDwgcGFyc2VGbG9hdChleGlzdGluZy5QcmljZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29tYm9NYXAuc2V0KGtleSwgcm93KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGZpbHRlcmVkRGF0YSA9IFsuLi5jb21ib01hcC52YWx1ZXMoKV07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YU1vZGUgPT09ICdyYW5nZScpIHsKICAgICAgICAgICAgICAgIC8vIFJhbmdlOiBHbG9iYWwgbG93ZXN0ICsgaGlnaGVzdCBwZXIgTU9ERUwgKGFjcm9zcyBBTEwgcGxhdGZvcm1zKQogICAgICAgICAgICAgICAgY29uc3QgbG93ZXN0TWFwID0gbmV3IE1hcCgpOwogICAgICAgICAgICAgICAgY29uc3QgaGlnaGVzdE1hcCA9IG5ldyBNYXAoKTsKCiAgICAgICAgICAgICAgICBiYXNlRmlsdGVyZWQuZm9yRWFjaChyb3cgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vZGVsID0gcm93WydNb2RlbCAjJ107CiAgICAgICAgICAgICAgICAgICAgaWYgKCFtb2RlbCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByaWNlID0gcGFyc2VGbG9hdChyb3cuUHJpY2UpOwoKICAgICAgICAgICAgICAgICAgICAvLyBUcmFjayBnbG9iYWwgbG93ZXN0IGZvciB0aGlzIG1vZGVsCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdMb3cgPSBsb3dlc3RNYXAuZ2V0KG1vZGVsKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWV4aXN0aW5nTG93IHx8IHByaWNlIDwgcGFyc2VGbG9hdChleGlzdGluZ0xvdy5QcmljZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXN0TWFwLnNldChtb2RlbCwgcm93KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFRyYWNrIGdsb2JhbCBoaWdoZXN0IGZvciB0aGlzIG1vZGVsCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdIaWdoID0gaGlnaGVzdE1hcC5nZXQobW9kZWwpOwogICAgICAgICAgICAgICAgICAgIGlmICghZXhpc3RpbmdIaWdoIHx8IHByaWNlID4gcGFyc2VGbG9hdChleGlzdGluZ0hpZ2guUHJpY2UpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hlc3RNYXAuc2V0KG1vZGVsLCByb3cpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIENvbWJpbmUgbG93ZXN0IGFuZCBoaWdoZXN0IChhdm9pZCBkdXBsaWNhdGVzIGlmIHNhbWUgcHJpY2UpCiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRNYXAgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICBsb3dlc3RNYXAuZm9yRWFjaCgocm93LCBtb2RlbCkgPT4gcmVzdWx0TWFwLnNldChtb2RlbCArICdfbG93Jywgcm93KSk7CiAgICAgICAgICAgICAgICBoaWdoZXN0TWFwLmZvckVhY2goKHJvdywgbW9kZWwpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsb3dSb3cgPSBsb3dlc3RNYXAuZ2V0KG1vZGVsKTsKICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IGFkZCBoaWdoZXN0IGlmIGRpZmZlcmVudCBmcm9tIGxvd2VzdAogICAgICAgICAgICAgICAgICAgIGlmICghbG93Um93IHx8IHBhcnNlRmxvYXQocm93LlByaWNlKSAhPT0gcGFyc2VGbG9hdChsb3dSb3cuUHJpY2UpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdE1hcC5zZXQobW9kZWwgKyAnX2hpZ2gnLCByb3cpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGZpbHRlcmVkRGF0YSA9IFsuLi5yZXN1bHRNYXAudmFsdWVzKCldOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZmlsdGVyZWREYXRhID0gYmFzZUZpbHRlcmVkOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZW5kZXJHcmlkKCk7CiAgICAgICAgICAgIHVwZGF0ZVN0YXRzKCk7CgogICAgICAgICAgICAvLyDmqqLmn6UgRE9NIOWPr+imi+aAp+S+huaxuuWumuaYr+WQpuabtOaWsOaVo+m7nuWclu+8jOavlOiuiuaVuOabtOWPr+mdoAogICAgICAgICAgICBjb25zdCBzY2F0dGVyV3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2F0dGVyV3JhcHBlcicpOwogICAgICAgICAgICBpZiAoc2NhdHRlcldyYXBwZXIgJiYgc2NhdHRlcldyYXBwZXIuc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAgICB1cGRhdGVTY2F0dGVyQ2hhcnQoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVXBkYXRlIHBpdm90IHRhYmxlIGlmIHZpc2libGUKICAgICAgICAgICAgY29uc3QgcGl2b3RXcmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bpdm90V3JhcHBlcicpOwogICAgICAgICAgICBpZiAocGl2b3RXcmFwcGVyICYmIHBpdm90V3JhcHBlci5zdHlsZS5kaXNwbGF5ICE9PSAnbm9uZScpIHsKICAgICAgICAgICAgICAgIHVwZGF0ZVBpdm90VGFibGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2FzY2FkaW5nIGZpbHRlcnM6IHVwZGF0ZSBvdGhlciBmaWx0ZXIgb3B0aW9ucyBiYXNlZCBvbiBmaWx0ZXJlZCBkYXRhCiAgICAgICAgICAgIHVwZGF0ZUZpbHRlck9wdGlvbnNWaXNpYmlsaXR5KCk7CgogICAgICAgICAgICAvLyBTeW5jIGN1cnJlbnQgc3RhdGUgdG8gVVJMCiAgICAgICAgICAgIHVwZGF0ZVVSTEZyb21TdGF0ZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FzY2FkaW5nIEZpbHRlciBMb2dpYzogSGlkZSBvcHRpb25zIHRoYXQgaGF2ZSBubyBtYXRjaGluZyBkYXRhCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlRmlsdGVyT3B0aW9uc1Zpc2liaWxpdHkoKSB7CiAgICAgICAgICAgIC8vIFY1LjIzOiBDYWxjdWxhdGUgdmFsaWQgdmFsdWVzIFBFUiBGSUVMRCwgZXhjbHVkaW5nIHRoZSBmaWVsZCdzIG93biBmaWx0ZXIKICAgICAgICAgICAgLy8gVGhpcyBzaG93cyAid2hhdCB2YWx1ZXMgd291bGQgcHJvZHVjZSByZXN1bHRzIGlmIHNlbGVjdGVkIiAoT1IgbG9naWMgd2l0aGluIGRyb3Bkb3duKQoKICAgICAgICAgICAgLy8gUHJlLWNhbGN1bGF0ZSBzaGFyZWQgZmlsdGVyIHN0YXRlCiAgICAgICAgICAgIGNvbnN0IHVuaXF1ZUJyYW5kcyA9IG5ldyBTZXQoKTsKICAgICAgICAgICAgY29uc3QgdW5pcXVlUGxhdGZvcm1zID0gbmV3IFNldCgpOwogICAgICAgICAgICBtZXJnZWREYXRhLmZvckVhY2gociA9PiB7CiAgICAgICAgICAgICAgICB1bmlxdWVCcmFuZHMuYWRkKHIuQnJhbmQgfHwgJyhFbXB0eSknKTsKICAgICAgICAgICAgICAgIHVuaXF1ZVBsYXRmb3Jtcy5hZGQoci5QbGF0Zm9ybSB8fCAnKEVtcHR5KScpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgdG90YWxCcmFuZHMgPSB1bmlxdWVCcmFuZHMuc2l6ZTsKICAgICAgICAgICAgY29uc3QgdG90YWxQbGF0Zm9ybXMgPSB1bmlxdWVQbGF0Zm9ybXMuc2l6ZTsKCiAgICAgICAgICAgIGNvbnN0IGJyYW5kU2V0ID0gZmlsdGVyU2VsZWN0aW9uc1snQnJhbmQnXTsKICAgICAgICAgICAgY29uc3QgcGxhdGZvcm1TZXQgPSBmaWx0ZXJTZWxlY3Rpb25zWydQbGF0Zm9ybSddOwogICAgICAgICAgICBjb25zdCBpc0JyYW5kQWN0aXZlID0gYnJhbmRTZXQgJiYgYnJhbmRTZXQuc2l6ZSA8IHRvdGFsQnJhbmRzOwogICAgICAgICAgICBjb25zdCBpc1BsYXRmb3JtQWN0aXZlID0gcGxhdGZvcm1TZXQgJiYgcGxhdGZvcm1TZXQuc2l6ZSA8IHRvdGFsUGxhdGZvcm1zOwoKICAgICAgICAgICAgLy8gSGVscGVyOiBDaGVjayBpZiByb3cgcGFzc2VzIGEgZmlsdGVyIChleGNsdWRpbmcgYSBzcGVjaWZpYyBmaWVsZCkKICAgICAgICAgICAgY29uc3Qgcm93UGFzc2VzRmlsdGVyID0gKHJvdywgZXhjbHVkZUZpZWxkKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIXJvdy5QbGF0Zm9ybSB8fCAhcm93LlByaWNlKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAgICAgLy8gUHJpY2UgcmFuZ2UgZmlsdGVyCiAgICAgICAgICAgICAgICBjb25zdCBwcmljZSA9IHBhcnNlRmxvYXQocm93LlByaWNlKTsKICAgICAgICAgICAgICAgIGlmIChwcmljZSA8IHByaWNlUmFuZ2UubWluIHx8IHByaWNlID4gcHJpY2VSYW5nZS5tYXgpIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICAvLyBHZW5lcmljIEZpbHRlcnMgKEFORCBsb2dpYywgYnV0IHNraXAgZXhjbHVkZUZpZWxkKQogICAgICAgICAgICAgICAgY29uc3QgcGFzc090aGVycyA9IE9iamVjdC5lbnRyaWVzKGZpbHRlclNlbGVjdGlvbnMpLmV2ZXJ5KChba2V5LCB2YWx1ZXNdKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gZXhjbHVkZUZpZWxkKSByZXR1cm4gdHJ1ZTsgLy8gU2tpcCB0aGUgZXhjbHVkZWQgZmllbGQKICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnQnJhbmQnIHx8IGtleSA9PT0gJ1BsYXRmb3JtJykgcmV0dXJuIHRydWU7IC8vIEhhbmRsZWQgc2VwYXJhdGVseQogICAgICAgICAgICAgICAgICAgIGlmIChrZXkuZW5kc1dpdGgoJ19lZmZlY3RpdmVLZXknKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEodmFsdWVzIGluc3RhbmNlb2YgU2V0KSB8fCB2YWx1ZXMuc2l6ZSA9PT0gMCkgcmV0dXJuIHRydWU7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVmZmVjdGl2ZUtleSA9IGZpbHRlclNlbGVjdGlvbnNba2V5ICsgJ19lZmZlY3RpdmVLZXknXSB8fCBrZXk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbVZhbHVlID0gcm93W2VmZmVjdGl2ZUtleV07CgogICAgICAgICAgICAgICAgICAgIGlmICghaXRlbVZhbHVlICYmIHZhbHVlcy5oYXMoJyhFbXB0eSknKSkgcmV0dXJuIHRydWU7CgogICAgICAgICAgICAgICAgICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIEFjY2Vzc29yaWVzCiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ0FjY2Vzc29yaWVzJykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY2Nlc3Nvcmllc1ZhbHVlID0gaXRlbVZhbHVlIHx8ICctJzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjY2Vzc29yaWVzVmFsdWUgPT09ICctJykgcmV0dXJuIHZhbHVlcy5oYXMoJy0nKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgQUxMX0tFWVdPUkRTID0gWydCbGFkZScsICdCYXR0ZXJ5JywgJ0NoYXJnZXInLCAnU3RhbmQnLCAnQnVuZGxlJ107CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga3cgb2YgQUxMX0tFWVdPUkRTKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9kdWN0SGFzS2V5d29yZCA9IGFjY2Vzc29yaWVzVmFsdWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhrdy50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleXdvcmRJc0NoZWNrZWQgPSB2YWx1ZXMuaGFzKGt3KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9kdWN0SGFzS2V5d29yZCAmJiAha2V5d29yZElzQ2hlY2tlZCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVzLmhhcyhpdGVtVmFsdWUpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKCFwYXNzT3RoZXJzKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAgICAgLy8gQnJhbmQvUGxhdGZvcm0gU1RSSUNULCBidXQgc2tpcCBpZiBpdCdzIHRoZSBleGNsdWRlZCBmaWVsZAogICAgICAgICAgICAgICAgaWYgKGV4Y2x1ZGVGaWVsZCAhPT0gJ1BsYXRmb3JtJyAmJiBwbGF0Zm9ybVNldCAmJiAhcGxhdGZvcm1TZXQuaGFzKHJvdy5QbGF0Zm9ybSkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGlmIChleGNsdWRlRmllbGQgIT09ICdCcmFuZCcgJiYgYnJhbmRTZXQgJiYgaXNCcmFuZEFjdGl2ZSAmJiAhYnJhbmRTZXQuaGFzKHJvdy5CcmFuZCkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB2YWxpZCB2YWx1ZXMgZm9yIGVhY2ggZmlsdGVyIGZpZWxkCiAgICAgICAgICAgIGNvbnN0IHZhbGlkVmFsdWVzTWFwID0ge307CiAgICAgICAgICAgIGNvbnN0IGZpbHRlckZpZWxkcyA9IEZJTFRFUl9GSUVMRFM7CgogICAgICAgICAgICBmaWx0ZXJGaWVsZHMuZm9yRWFjaChmID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGVmZmVjdGl2ZUtleSA9IGZpbHRlclNlbGVjdGlvbnNbZi5rZXkgKyAnX2VmZmVjdGl2ZUtleSddIHx8IGYua2V5OwogICAgICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gbmV3IFNldCgpOwoKICAgICAgICAgICAgICAgIC8vIEZpbHRlciBtZXJnZWREYXRhIGV4Y2x1ZGluZyB0aGlzIGZpZWxkJ3MgZmlsdGVyCiAgICAgICAgICAgICAgICBtZXJnZWREYXRhLmZvckVhY2gocm93ID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAocm93UGFzc2VzRmlsdGVyKHJvdywgZi5rZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IHJvd1tlZmZlY3RpdmVLZXldOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMuYWRkKHZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMuYWRkKCcoRW1wdHkpJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICB2YWxpZFZhbHVlc01hcFtmLmtleV0gPSB2YWx1ZXM7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gVXBkYXRlIGVhY2ggZmlsdGVyIGRyb3Bkb3duJ3Mgb3B0aW9uIHZpc2liaWxpdHkKICAgICAgICAgICAgbGV0IGFueUZpbHRlckNoYW5nZWQgPSBmYWxzZTsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpbHRlci1ncm91cCcpLmZvckVhY2goZ3JvdXAgPT4gewogICAgICAgICAgICAgICAgY29uc3QgYnRuID0gZ3JvdXAucXVlcnlTZWxlY3RvcignLmZpbHRlci1idG4nKTsKICAgICAgICAgICAgICAgIGlmICghYnRuKSByZXR1cm47CgogICAgICAgICAgICAgICAgY29uc3QgZmllbGQgPSBidG4uZGF0YXNldC5maWVsZDsKICAgICAgICAgICAgICAgIGlmICghZmllbGQgfHwgIXZhbGlkVmFsdWVzTWFwW2ZpZWxkXSkgcmV0dXJuOwoKICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkVmFsdWVzID0gdmFsaWRWYWx1ZXNNYXBbZmllbGRdOwogICAgICAgICAgICAgICAgY29uc3QgZHJvcGRvd24gPSBncm91cC5xdWVyeVNlbGVjdG9yKCcuZmlsdGVyLWRyb3Bkb3duJyk7CiAgICAgICAgICAgICAgICBpZiAoIWRyb3Bkb3duKSByZXR1cm47CgogICAgICAgICAgICAgICAgbGV0IHZpc2libGVDb3VudCA9IDA7CiAgICAgICAgICAgICAgICBsZXQgY2hlY2tlZENvdW50ID0gMDsKCiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgb3B0aW9uIHZpc2liaWxpdHkgdXNpbmcgRE9NIGRpZmYgKGp1c3QgdG9nZ2xlIGRpc3BsYXksIGRvbid0IHJlYnVpbGQpCiAgICAgICAgICAgICAgICBkcm9wZG93bi5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsdGVyLW9wdGlvbicpLmZvckVhY2gobGFiZWwgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoZWNrYm94ID0gbGFiZWwucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT0iY2hlY2tib3giXScpOwogICAgICAgICAgICAgICAgICAgIGlmICghY2hlY2tib3gpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjaGVja2JveC52YWx1ZTsKICAgICAgICAgICAgICAgICAgICBsZXQgaXNWYWxpZDsKCiAgICAgICAgICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgQWNjZXNzb3JpZXMga2V5d29yZC1iYXNlZCBvcHRpb25zCiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkID09PSAnQWNjZXNzb3JpZXMnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJy0nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdmFsaWRWYWx1ZXMuaGFzKCctJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICcoRW1wdHkpJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IHZhbGlkVmFsdWVzLmhhcygnKEVtcHR5KScpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGtleXdvcmRzIChCbGFkZSwgQmF0dGVyeSwgZXRjLiksIGNoZWNrIGlmIGFueSB2YWx1ZSBjb250YWlucyB0aGUga2V5d29yZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNWYWxpZCA9IFsuLi52YWxpZFZhbHVlc10uc29tZSh2ID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdiAmJiB2ICE9PSAnLScgJiYgdiAhPT0gJyhFbXB0eSknICYmIHYudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh2YWx1ZS50b0xvd2VyQ2FzZSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB2YWxpZFZhbHVlcy5oYXModmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyBhbGwgb3B0aW9ucywganVzdCB2aXN1YWxseSBpbmRpY2F0ZSBpbnZhbGlkIG9uZXMKICAgICAgICAgICAgICAgICAgICBsYWJlbC5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZUNvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrYm94LmNoZWNrZWQpIGNoZWNrZWRDb3VudCsrOwoKICAgICAgICAgICAgICAgICAgICAvLyBTdG9yZSB2YWxpZGl0eSBpbiBkYXRhIGF0dHJpYnV0ZSBmb3Igc29ydGluZyAoVjUuMjQpCiAgICAgICAgICAgICAgICAgICAgbGFiZWwuZGF0YXNldC52YWxpZCA9IGlzVmFsaWQgPyAndHJ1ZScgOiAnZmFsc2UnOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVmFsaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgY2hlY2tlZCwga2VlcCBmdWxsIG9wYWNpdHkgKHVzZXIgZXhwbGljaXQgc2VsZWN0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB1bmNoZWNrZWQsIGdyYXkgb3V0IHRvIHNob3cgaXQncyBub3QgYXZhaWxhYmxlIGluIGN1cnJlbnQgZmlsdGVyZWQgY29udGV4dAogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC5zdHlsZS5vcGFjaXR5ID0gY2hlY2tib3guY2hlY2tlZCA/ICcxJyA6ICcwLjUnOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFZhbGlkIG9wdGlvbiAtIGZ1bGwgb3BhY2l0eQogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC5zdHlsZS5vcGFjaXR5ID0gJzEnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBidXR0b24gdGV4dCB0byBzaG93IHZpc2libGUvY2hlY2tlZCBjb3VudHMgKG9ubHkgZm9yIFBsYXRmb3JtIGFuZCBCcmFuZCkKICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsVGV4dCA9IEZJTFRFUl9GSUVMRFMuZmluZChmID0+IGYua2V5ID09PSBmaWVsZCk/LmxhYmVsIHx8IGZpZWxkOwogICAgICAgICAgICAgICAgaWYgKGZpZWxkID09PSAnUGxhdGZvcm0nIHx8IGZpZWxkID09PSAnQnJhbmQnKSB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmlubmVySFRNTCA9IGAke2xhYmVsVGV4dH0gPHNwYW4gY2xhc3M9InRleHQtZ3JheS00MDAiPigke2NoZWNrZWRDb3VudH0vJHt2aXNpYmxlQ291bnR9KTwvc3Bhbj4gPGkgY2xhc3M9ImZhcyBmYS1jaGV2cm9uLWRvd24iIHN0eWxlPSJmb250LXNpemU6MC41cmVtIj48L2k+YDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmlubmVySFRNTCA9IGAke2xhYmVsVGV4dH0gPGkgY2xhc3M9ImZhcyBmYS1jaGV2cm9uLWRvd24iIHN0eWxlPSJmb250LXNpemU6MC41cmVtIj48L2k+YDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBWNS4yNDogUmVvcmRlciBvcHRpb25zIGFmdGVyIG9wYWNpdHkgaXMgc2V0IChjaGVja2VkIGZpcnN0LCBibGFjayBiZWZvcmUgZ3JheSwgdGhlbiBBLVopCiAgICAgICAgICAgICAgICByZW9yZGVyRmlsdGVyT3B0aW9ucyhkcm9wZG93bik7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gSWYgd2UgYXV0by11bmNoZWNrZWQgYW55IGludmFsaWQgb3B0aW9ucywgd2UgTVVTVCByZS1hcHBseSBmaWx0ZXJzIHRvIHVwZGF0ZSB0aGUgZ3JpZAogICAgICAgICAgICBpZiAoYW55RmlsdGVyQ2hhbmdlZCkgewogICAgICAgICAgICAgICAgLy8gVXNlIHNldFRpbWVvdXQgdG8gYXZvaWQgZGVlcCByZWN1cnNpb24gbG9vcCBvbiBzYW1lIHN0YWNrLCB0aG91Z2ggZGlyZWN0IGNhbGwgaXMgYWxzbyBzYWZlIGhlcmUKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoYXBwbHlGaWx0ZXJzLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCgoKICAgICAgICAvLyBDYWxjdWxhdGUgMS10by0xIGRlcGVuZGVuY2llcyBiZXR3ZWVuIGZpbHRlciBmaWVsZHMKICAgICAgICBmdW5jdGlvbiBjYWxjdWxhdGVEZXBlbmRlbmNpZXMoKSB7CiAgICAgICAgICAgIGZpbHRlckRlcGVuZGVuY2llcyA9IHt9OwoKICAgICAgICAgICAgLy8gQWx3YXlzIHVzZSBGSUxURVJfRklFTERTIGZvciBjb25zaXN0ZW5jeSB3aXRoIHNldHVwRmlsdGVycwogICAgICAgICAgICBsZXQgZmllbGRzID0gWy4uLkZJTFRFUl9GSUVMRFNdOwoKICAgICAgICAgICAgLy8gRW5zdXJlIFBsYXRmb3JtIFR5cGUgaXMgYWx3YXlzIHByZXNlbnQKICAgICAgICAgICAgaWYgKCFmaWVsZHMuc29tZShmID0+IGYua2V5ID09PSAnUGxhdGZvcm0gVHlwZScpKSB7CiAgICAgICAgICAgICAgICBmaWVsZHMuc3BsaWNlKDEsIDAsIHsga2V5OiAnUGxhdGZvcm0gVHlwZScsIGxhYmVsOiAnUGxhdGZvcm0gVHlwZScgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEVuc3VyZSBBY2Nlc3NvcmllcyBpcyBhbHdheXMgcHJlc2VudAogICAgICAgICAgICBpZiAoIWZpZWxkcy5zb21lKGYgPT4gZi5rZXkgPT09ICdBY2Nlc3NvcmllcycpKSB7CiAgICAgICAgICAgICAgICBmaWVsZHMucHVzaCh7IGtleTogJ0FjY2Vzc29yaWVzJywgbGFiZWw6ICdBY2Nlc3NvcmllcycgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFRlbXBvcmFyeSBtYXAgdG8gc3RvcmUgdW5pcXVlIHRhcmdldCB2YWx1ZXM6IEZpZWxkIC0+IFZhbHVlIC0+IFRhcmdldEZpZWxkIC0+IFNldDxUYXJnZXRWYWx1ZT4KICAgICAgICAgICAgY29uc3QgdGVtcE1hcCA9IHt9OwoKICAgICAgICAgICAgbWVyZ2VkRGF0YS5mb3JFYWNoKHJvdyA9PiB7CiAgICAgICAgICAgICAgICBmaWVsZHMuZm9yRWFjaChmMSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsMSA9IHJvd1tmMS5rZXldOyAvLyBVc2UgcmF3IGtleSBvciBlZmZlY3RpdmUga2V5PyBVc2luZyByYXcga2V5IGltcGxpZXMgMToxIGluIGRhdGEKICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbDEpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCF0ZW1wTWFwW2YxLmtleV0pIHRlbXBNYXBbZjEua2V5XSA9IHt9OwogICAgICAgICAgICAgICAgICAgIGlmICghdGVtcE1hcFtmMS5rZXldW3ZhbDFdKSB0ZW1wTWFwW2YxLmtleV1bdmFsMV0gPSB7fTsKCiAgICAgICAgICAgICAgICAgICAgZmllbGRzLmZvckVhY2goZjIgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZjEua2V5ID09PSBmMi5rZXkpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsMiA9IHJvd1tmMi5rZXldOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0ZW1wTWFwW2YxLmtleV1bdmFsMV1bZjIua2V5XSkgdGVtcE1hcFtmMS5rZXldW3ZhbDFdW2YyLmtleV0gPSBuZXcgU2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wTWFwW2YxLmtleV1bdmFsMV1bZjIua2V5XS5hZGQodmFsMik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIENvbnZlcnQgdG8gc3RyaWN0IDEtdG8tMSBkZXBlbmRlbmNpZXMKICAgICAgICAgICAgT2JqZWN0LmtleXModGVtcE1hcCkuZm9yRWFjaChmMSA9PiB7CiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyh0ZW1wTWFwW2YxXSkuZm9yRWFjaCh2YWwxID0+IHsKICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyh0ZW1wTWFwW2YxXVt2YWwxXSkuZm9yRWFjaChmMiA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFZhbHVlcyA9IHRlbXBNYXBbZjFdW3ZhbDFdW2YyXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldFZhbHVlcy5zaXplID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbHRlckRlcGVuZGVuY2llc1tmMV0pIGZpbHRlckRlcGVuZGVuY2llc1tmMV0gPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZmlsdGVyRGVwZW5kZW5jaWVzW2YxXVt2YWwxXSkgZmlsdGVyRGVwZW5kZW5jaWVzW2YxXVt2YWwxXSA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyRGVwZW5kZW5jaWVzW2YxXVt2YWwxXVtmMl0gPSBbLi4udGFyZ2V0VmFsdWVzXVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zb2xlLmxvZygnRmlsdGVyIERlcGVuZGVuY2llczonLCBmaWx0ZXJEZXBlbmRlbmNpZXMpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2xlYXJBbGxGaWx0ZXJzKCkgewogICAgICAgICAgICBoYXNVc2VyRmlsdGVyZWQgPSBmYWxzZTsgLy8gVjUuMjU6IFJlc2V0IGZpcnN0LWZpbHRlciBmbGFnCiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItZHJvcGRvd24nKS5mb3JFYWNoKGRkID0+IHsKICAgICAgICAgICAgICAgIGRkLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0JykuZm9yRWFjaChjYiA9PiBjYi5jaGVja2VkID0gdHJ1ZSk7CiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IGRkLnByZXZpb3VzRWxlbWVudFNpYmxpbmc/LmRhdGFzZXQ/LmZpZWxkOwogICAgICAgICAgICAgICAgaWYgKGZpZWxkKSB1cGRhdGVGaWx0ZXJGcm9tRHJvcGRvd24oZmllbGQsIGRkKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyDph43oqK3lg7nmoLznr4TlnI0KICAgICAgICAgICAgcHJpY2VSYW5nZSA9IHsgbWluOiAwLCBtYXg6IDIwMDAgfTsKICAgICAgICAgICAgY29uc3QgcHJpY2VTbGlkZXJNaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpY2VTbGlkZXJNaW4nKTsKICAgICAgICAgICAgY29uc3QgcHJpY2VTbGlkZXJNYXggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpY2VTbGlkZXJNYXgnKTsKICAgICAgICAgICAgY29uc3QgcHJpY2VNaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpY2VNaW4nKTsKICAgICAgICAgICAgY29uc3QgcHJpY2VNYXggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpY2VNYXgnKTsKICAgICAgICAgICAgY29uc3QgcHJpY2VTbGlkZXJUcmFjayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmljZVNsaWRlclRyYWNrJyk7CgogICAgICAgICAgICBpZiAocHJpY2VTbGlkZXJNaW4pIHByaWNlU2xpZGVyTWluLnZhbHVlID0gMDsKICAgICAgICAgICAgaWYgKHByaWNlU2xpZGVyTWF4KSBwcmljZVNsaWRlck1heC52YWx1ZSA9IDIwMDA7CiAgICAgICAgICAgIGlmIChwcmljZU1pbikgcHJpY2VNaW4udmFsdWUgPSAnJzsKICAgICAgICAgICAgaWYgKHByaWNlTWF4KSBwcmljZU1heC52YWx1ZSA9ICcnOwogICAgICAgICAgICBpZiAocHJpY2VTbGlkZXJUcmFjaykgewogICAgICAgICAgICAgICAgcHJpY2VTbGlkZXJUcmFjay5zdHlsZS5iYWNrZ3JvdW5kID0gJ2xpbmVhci1ncmFkaWVudCh0byByaWdodCwgIzRiNTU2MyAwJSwgIzRiNTU2MyAxMDAlKSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXBwbHlGaWx0ZXJzKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZW5kZXJHcmlkKCkgewogICAgICAgICAgICAvLyBEZXRlcm1pbmUgZ3JvdXBpbmcga2V5cyBiYXNlZCBvbiBtb2RlCiAgICAgICAgICAgIGNvbnN0IGdldEdyb3VwS2V5ID0gKGQpID0+IGdyaWRSb3dNb2RlID09PSAncGxhdGZvcm0nID8gZC5QbGF0Zm9ybSA6IChkLkJyYW5kIHx8ICcoVW5rbm93biknKTsKCiAgICAgICAgICAgIC8vIOaJvuWHuuaJgOacieWIhue1hCAoUGxhdGZvcm0gb3IgQnJhbmQpCiAgICAgICAgICAgIGNvbnN0IGZpZWxkS2V5ID0gZ3JpZFJvd01vZGUgPT09ICdwbGF0Zm9ybScgPyAnUGxhdGZvcm0nIDogJ0JyYW5kJzsKICAgICAgICAgICAgbGV0IGdyb3VwcyA9IFsuLi5uZXcgU2V0KGZpbHRlcmVkRGF0YS5tYXAoZ2V0R3JvdXBLZXkpKV0uZmlsdGVyKGcgPT4gZyk7CiAgICAgICAgICAgIC8vIEFwcGx5IGN1c3RvbSBzb3J0IG9yZGVyIGlmIGF2YWlsYWJsZSwgZWxzZSBBLVoKICAgICAgICAgICAgZ3JvdXBzID0gdHlwZW9mIGdldEN1c3RvbVNvcnRlZFZhbHVlcyA9PT0gJ2Z1bmN0aW9uJwogICAgICAgICAgICAgICAgPyBnZXRDdXN0b21Tb3J0ZWRWYWx1ZXMoZ3JvdXBzLCBmaWVsZEtleSkKICAgICAgICAgICAgICAgIDogZ3JvdXBzLnNvcnQoKTsKCiAgICAgICAgICAgIC8vIDEuIENhbGN1bGF0ZSBDb2x1bW5zIChQcmljZSBUYWcgKyBJbmRleCkKICAgICAgICAgICAgLy8gVXNlIFByaWNlIFRhZyBmb3IgZ3JvdXBpbmcgKFVzZXIgcmVxdWlyZW1lbnQ6ICLopoHmipNwcmljZSB0YWciKQogICAgICAgICAgICBjb25zdCB1bmlxdWVUYWdzID0gWy4uLm5ldyBTZXQoZmlsdGVyZWREYXRhLm1hcChkID0+IHBhcnNlRmxvYXQoZFsnUHJpY2UgVGFnJ10pIHx8IDApKV0uZmlsdGVyKHAgPT4gcCA+IDApLnNvcnQoKGEsIGIpID0+IGEgLSBiKTsKCiAgICAgICAgICAgIC8vIEZvciBlYWNoIFByaWNlIFRhZywgZmluZCB0aGUgbWF4IG51bWJlciBvZiBpdGVtcyBhY3Jvc3MgYWxsIGdyb3VwcyAocGxhdGZvcm1zKQogICAgICAgICAgICBjb25zdCBleHBhbmRlZENvbHVtbnMgPSBbXTsKICAgICAgICAgICAgdW5pcXVlVGFncy5mb3JFYWNoKHRhZyA9PiB7CiAgICAgICAgICAgICAgICBsZXQgbWF4RGVwdGggPSAxOwogICAgICAgICAgICAgICAgZ3JvdXBzLmZvckVhY2goZyA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ291bnQgaXRlbXMgZm9yIHRoaXMgcGxhdGZvcm0gdGhhdCBmYWxsIHVuZGVyIHRoaXMgUHJpY2UgVGFnCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbXNJbkdyb3VwID0gZmlsdGVyZWREYXRhLmZpbHRlcihkID0+IGdldEdyb3VwS2V5KGQpID09PSBnICYmIChwYXJzZUZsb2F0KGRbJ1ByaWNlIFRhZyddKSB8fCAwKSA9PT0gdGFnKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNJbkdyb3VwLmxlbmd0aCA+IG1heERlcHRoKSBtYXhEZXB0aCA9IGl0ZW1zSW5Hcm91cC5sZW5ndGg7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF4RGVwdGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGV4cGFuZGVkQ29sdW1ucy5wdXNoKHsgcHJpY2U6IHRhZywgaW5kZXg6IGkgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY29uc3QgbWF0cml4ID0ge307CiAgICAgICAgICAgIGdyb3Vwcy5mb3JFYWNoKGcgPT4gbWF0cml4W2ddID0ge30pOwoKICAgICAgICAgICAgLy8gUG9wdWxhdGUgTWF0cml4CiAgICAgICAgICAgIGdyb3Vwcy5mb3JFYWNoKGcgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBJdGVtcyA9IGZpbHRlcmVkRGF0YS5maWx0ZXIoZCA9PiBnZXRHcm91cEtleShkKSA9PT0gZyk7CiAgICAgICAgICAgICAgICAvLyBHcm91cCBpdGVtcyBieSBQcmljZSBUYWcgZm9yIHRoaXMgcGxhdGZvcm0KICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zQnlUYWcgPSB7fTsKICAgICAgICAgICAgICAgIGdyb3VwSXRlbXMuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWcgPSBwYXJzZUZsb2F0KGl0ZW1bJ1ByaWNlIFRhZyddKSB8fCAwOwogICAgICAgICAgICAgICAgICAgIGlmIChpdGVtWydNb2RlbCAjJ10gJiYgaXRlbVsnTW9kZWwgIyddLmluY2x1ZGVzKCdITTEwMExYVScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZW5kZXJHcmlkIEhNMTAwTFhVOicsIGl0ZW0uQnJhbmQsIGl0ZW1bJ01vZGVsICMnXSwgJ1Jhd1RhZzonLCBpdGVtWydQcmljZSBUYWcnXSwgJ1BhcnNlZFRhZzonLCB0YWcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIWl0ZW1zQnlUYWdbdGFnXSkgaXRlbXNCeVRhZ1t0YWddID0gW107CiAgICAgICAgICAgICAgICAgICAgaXRlbXNCeVRhZ1t0YWddLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyBBc3NpZ24gdG8gbWF0cml4IHNsb3RzCiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhpdGVtc0J5VGFnKS5mb3JFYWNoKHRhZ0tleSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFnID0gcGFyc2VGbG9hdCh0YWdLZXkpOwogICAgICAgICAgICAgICAgICAgIGxldCBpdGVtcyA9IGl0ZW1zQnlUYWdbdGFnXTsKCiAgICAgICAgICAgICAgICAgICAgLy8gU29ydCBpdGVtczogQnJhbmQgLT4gTW9kZWwgKFVzZXIgcmVxdWlyZW1lbnQpCiAgICAgICAgICAgICAgICAgICAgLy8gU29ydCBpdGVtczogQnJhbmQgLT4gUHJpY2UgLT4gTW9kZWwgKFVzZXIgcmVxdWlyZW1lbnQpCiAgICAgICAgICAgICAgICAgICAgaXRlbXMuc29ydCgoYSwgYikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAvLyAxLiBCcmFuZAogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiQSA9IChhLkJyYW5kIHx8ICcnKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiQiA9IChiLkJyYW5kIHx8ICcnKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYkEgPCBiQikgcmV0dXJuIC0xOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYkEgPiBiQikgcmV0dXJuIDE7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyAyLiBPcmlnaW5hbCBQcmljZSAoTnVtZXJpYykKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcEEgPSBwYXJzZUZsb2F0KGEuUHJpY2UpIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBCID0gcGFyc2VGbG9hdChiLlByaWNlKSB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocEEgIT09IHBCKSByZXR1cm4gcEEgLSBwQjsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIDMuIE1vZGVsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1BID0gKGFbJ01vZGVsICMnXSB8fCBhLk1vZGVsIHx8ICcnKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtQiA9IChiWydNb2RlbCAjJ10gfHwgYi5Nb2RlbCB8fCAnJykudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1BLmxvY2FsZUNvbXBhcmUobUIpOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAvLyBEaXN0cmlidXRlIHRvIGNvbHVtbnMKICAgICAgICAgICAgICAgICAgICBpdGVtcy5mb3JFYWNoKChpdGVtLCBpZHgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gS2V5IGZvcm1hdDogInRhZy1pbmRleCIgdG8gbWF0Y2ggY29sdW1uIGtleQogICAgICAgICAgICAgICAgICAgICAgICBtYXRyaXhbZ11bYCR7dGFnfS0ke2lkeH1gXSA9IGl0ZW07CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBIaWRlIG9sZCBleHRlcm5hbCBjb250YWluZXJzCiAgICAgICAgICAgIGNvbnN0IHBsYXRMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXRmb3JtTGlzdCcpOwogICAgICAgICAgICBpZiAocGxhdExpc3QpIHBsYXRMaXN0LmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBjb25zdCBwaENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmljZUhlYWRlckNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAocGhDb250YWluZXIpIHBoQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgICAgICAvLyDmoLzlrZDlhaflrrkKICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncmlkQ29udGVudCcpOwogICAgICAgICAgICBjb250ZW50LmlubmVySFRNTCA9ICcnOwoKICAgICAgICAgICAgLy8gLS0tIDEuIFN0aWNreSBIZWFkZXIgUm93IChDb3JuZXIgKyBQcmljZXMpIC0tLQogICAgICAgICAgICBjb25zdCBoZWFkZXJSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgaGVhZGVyUm93LmNsYXNzTmFtZSA9ICdzdGlja3ktaGVhZGVyLXJvdyc7CgogICAgICAgICAgICAvLyAxLjEgVG9wLUxlZnQgU3RpY2t5IENvcm5lciAoVG9nZ2xlKQogICAgICAgICAgICBjb25zdCBjb3JuZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgY29ybmVyLmNsYXNzTmFtZSA9ICdzdGlja3ktY29ybmVyLWhlYWRlcic7CiAgICAgICAgICAgIGNvcm5lci5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b2dnbGUtY29udGFpbmVyIj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJncmlkLXRvZ2dsZS1idG4gJHtncmlkUm93TW9kZSA9PT0gJ3BsYXRmb3JtJyA/ICdhY3RpdmUnIDogJyd9IG5vdHJhbnNsYXRlIiBvbmNsaWNrPSJncmlkUm93TW9kZT0ncGxhdGZvcm0nOyByZW5kZXJHcmlkKCkiIHRpdGxlPSJQbGF0Zm9ybSI+PGkgY2xhc3M9ImZhcyBmYS1zdG9yZSI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImdyaWQtdG9nZ2xlLWJ0biAke2dyaWRSb3dNb2RlID09PSAnYnJhbmQnID8gJ2FjdGl2ZScgOiAnJ30gbm90cmFuc2xhdGUiIG9uY2xpY2s9ImdyaWRSb3dNb2RlPSdicmFuZCc7IHJlbmRlckdyaWQoKSIgdGl0bGU9IkJyYW5kIj48aSBjbGFzcz0iZmFzIGZhLXRhZyI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgaGVhZGVyUm93LmFwcGVuZENoaWxkKGNvcm5lcik7CgogICAgICAgICAgICAvLyAxLjIgUHJpY2UgSGVhZGVycwogICAgICAgICAgICBsZXQgbGFzdFByaWNlRmxvb3IxMDAgPSAtMTsKICAgICAgICAgICAgZXhwYW5kZWRDb2x1bW5zLmZvckVhY2goKGNvbCwgaWR4KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBwcmljZSA9IGNvbC5wcmljZTsKICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIGNlbGwuY2xhc3NOYW1lID0gJ3ByaWNlLWhlYWRlci1jZWxsJzsKCiAgICAgICAgICAgICAgICAvLyBSZWQgR3JpZCBMaW5lcyBMb2dpYwogICAgICAgICAgICAgICAgLy8gUnVsZTogRXZlcnkgNTAsIGFuZCB0aGlubmVyIGxpbmUKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGbG9vciA9IE1hdGguZmxvb3IocHJpY2UgLyA1MCk7CgogICAgICAgICAgICAgICAgLy8gQm91bmRhcnkgY2hlY2s6IERpZmZlcmVudCBmbG9vciBBTkQgaXQncyB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiB0aGlzIHByaWNlL2luZGV4CiAgICAgICAgICAgICAgICBjb25zdCBpc0JvdW5kYXJ5ID0gKGlkeCA+IDAgJiYgTWF0aC5mbG9vcihleHBhbmRlZENvbHVtbnNbaWR4IC0gMV0ucHJpY2UgLyA1MCkgPCBjdXJyZW50Rmxvb3IpOwogICAgICAgICAgICAgICAgY29uc3QgaXNFeGFjdDUwID0gKHByaWNlICUgNTAgPT09IDAgJiYgY29sLmluZGV4ID09PSAwKTsKCiAgICAgICAgICAgICAgICBpZiAoaXNCb3VuZGFyeSB8fCBpc0V4YWN0NTApIHsKICAgICAgICAgICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ2JvcmRlci1sZWZ0LXJlZC1jdXN0b20nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEZsb29yID4gMCAmJiBjb2wuaW5kZXggPT09IDApIHsgLy8gTGFiZWwgb25seSBvbiBmaXJzdCBjb2wKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGJsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgICAgICAgICAgICAgICAgICBsYmwuY2xhc3NOYW1lID0gJ2JvdW5kYXJ5LWxhYmVsJzsKICAgICAgICAgICAgICAgICAgICAgICAgbGJsLnRleHRDb250ZW50ID0gKGN1cnJlbnRGbG9vciAqIDUwKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXNlciBSZXF1ZXN0OiBNYWtlIGZvbnQgc2FtZSBzaXplIGFzIG90aGVycyAocmVtb3ZlIHNwZWNpYWwgc2l6aW5nKQogICAgICAgICAgICAgICAgICAgICAgICBsYmwuc3R5bGUuZm9udFNpemUgPSAnaW5oZXJpdCc7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVzZXIgUmVxdWVzdDogQm9sZCArIFJlZAogICAgICAgICAgICAgICAgICAgICAgICBsYmwuc3R5bGUuZm9udFdlaWdodCA9ICdib2xkJzsKICAgICAgICAgICAgICAgICAgICAgICAgbGJsLnN0eWxlLmNvbG9yID0gJ3JlZCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuYXBwZW5kQ2hpbGQobGJsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsYXN0UHJpY2VGbG9vcjEwMCA9IGN1cnJlbnRGbG9vcjsKCiAgICAgICAgICAgICAgICAvLyBBZGQgcHJpY2UgdGV4dAogICAgICAgICAgICAgICAgY29uc3QgcHJpY2VUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgICAgICAgICAgLy8gT25seSBzaG93IHByaWNlIHRleHQgb24gdGhlIGZpcnN0IGNvbHVtbiBvZiBpZGVudGljYWwgcHJpY2VzPyAKICAgICAgICAgICAgICAgIC8vIFVzZXIgc2FpZCAiNTAwLCA1MDAsIDUwMCIgLT4gaW1wbGllZCBzZWVpbmcgaXQgMyB0aW1lcy4KICAgICAgICAgICAgICAgIHByaWNlVGV4dC50ZXh0Q29udGVudCA9IE51bWJlci5pc0ludGVnZXIocHJpY2UpID8gcHJpY2UgOiBwcmljZS50b0ZpeGVkKDIpOwogICAgICAgICAgICAgICAgY2VsbC5hcHBlbmRDaGlsZChwcmljZVRleHQpOwogICAgICAgICAgICAgICAgaGVhZGVyUm93LmFwcGVuZENoaWxkKGNlbGwpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZChoZWFkZXJSb3cpOwoKICAgICAgICAgICAgLy8gLS0tIDIuIERhdGEgUm93cyAtLS0KICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGJvcmRlciBpbmRpY2VzCiAgICAgICAgICAgIGNvbnN0IGJvcmRlckluZGljZXMgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgIGV4cGFuZGVkQ29sdW1ucy5mb3JFYWNoKChjb2wsIGkpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHByaWNlID0gY29sLnByaWNlOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEZsb29yID0gTWF0aC5mbG9vcihwcmljZSAvIDUwKTsKICAgICAgICAgICAgICAgIGNvbnN0IHByZXZGbG9vciA9IGkgPiAwID8gTWF0aC5mbG9vcihleHBhbmRlZENvbHVtbnNbaSAtIDFdLnByaWNlIC8gNTApIDogLTE7CgogICAgICAgICAgICAgICAgY29uc3QgaXNCb3VuZGFyeSA9IChpID4gMCAmJiBjdXJyZW50Rmxvb3IgPiBwcmV2Rmxvb3IpOwogICAgICAgICAgICAgICAgY29uc3QgaXNFeGFjdDUwID0gKHByaWNlICUgNTAgPT09IDAgJiYgY29sLmluZGV4ID09PSAwKTsKCiAgICAgICAgICAgICAgICBpZiAoaXNCb3VuZGFyeSB8fCBpc0V4YWN0NTApIGJvcmRlckluZGljZXMuYWRkKGkpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGdyb3Vwcy5mb3JFYWNoKGcgPT4gewogICAgICAgICAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICByb3cuY2xhc3NOYW1lID0gJ2RhdGEtcm93JzsKCiAgICAgICAgICAgICAgICAvLyAyLjEgU3RpY2t5IExlZnQgSGVhZGVyIENlbGwKICAgICAgICAgICAgICAgIGNvbnN0IGxlZnRDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBsZWZ0Q2VsbC5jbGFzc05hbWUgPSAnc3RpY2t5LWxlZnQtY29sIHN0aWNreS1wbGF0Zm9ybS1jZWxsJzsKICAgICAgICAgICAgICAgIGlmIChncmlkUm93TW9kZSA9PT0gJ3BsYXRmb3JtJykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvZ29OYW1lID0gZy5yZXBsYWNlKC9eUi0vLCAnJyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9nb01hcCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgJ3Rvb20nOiAndG9vbS5wbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAnT0JJJzogJ09CSS5wbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAnSG9sem1hbm4nOiAnSG9sem1hbm4ucG5nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ0hvbHpzdGFyJzogJ0hvbHpzdGFyLnBuZycsCiAgICAgICAgICAgICAgICAgICAgICAgICdUb29tJzogJ3Rvb20ucG5nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ0JhdW1hcmt0JzogJ0JhdW1hcmt0LnBuZycsCiAgICAgICAgICAgICAgICAgICAgICAgICdCQU1BVE8nOiAnQkFNQVRPLnBuZycsCiAgICAgICAgICAgICAgICAgICAgICAgICdGZW1pJzogJ0ZlbWkucG5nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ0JhdWhhdXMnOiAnQmF1aGF1cy5wbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAnSG9ybmJhY2gnOiAnSG9ybmJhY2gucG5nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ0hlbGx3ZWcnOiAnSGVsbHdlZy5wbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAnR29Ub29scyc6ICdHb1Rvb2xzLnBuZycsCiAgICAgICAgICAgICAgICAgICAgICAgICdDb250b3Jpb24nOiAnQ29udG9yaW9uLnBuZycsCiAgICAgICAgICAgICAgICAgICAgICAgICdUb29saW5lbyc6ICdUb29saW5lby5wbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAnQ29ucmFkJzogJ0NvbnJhZC5wbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAnVk9OUk9DJzogJ1ZPTlJPQy5wbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAnU2NoZXBwYWNoJzogJ1NjaGVwcGFjaC5wbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAnRWluaGVsbCc6ICdFaW5oZWxsLnBuZycsCiAgICAgICAgICAgICAgICAgICAgICAgICdCb3NjaCc6ICdCb3NjaC5wbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAnTWV0YWJvJzogJ01ldGFiby5wbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAnUnlvYmknOiAnUnlvYmkucG5nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ0F0aWthJzogJ0F0aWthLnBuZycsCiAgICAgICAgICAgICAgICAgICAgICAgICdIaWtva2knOiAnSGlrb2tpLnBuZycsCiAgICAgICAgICAgICAgICAgICAgICAgICdGZXN0b29sJzogJ0Zlc3Rvb2wucG5nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ1N0YW5sZXknOiAnU3RhbmxleS5wbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAnVHJpdG9uIFRvb2xzJzogJ1RyaXRvbiBUb29scy5wbmcnCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2dvRmlsZSA9IGxvZ29NYXBbbG9nb05hbWVdOwogICAgICAgICAgICAgICAgICAgIGlmIChsb2dvRmlsZSkgewogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0Q2VsbC5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0ibG9nby13cmFwcGVyIj48aW1nIHNyYz0iaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tLzZhc2UtMWluMy9QVC1MYW5kc2NhcGUvbWFpbi9sb2dvcy8ke2xvZ29GaWxlfSIgYWx0PSIke2d9IiBjbGFzcz0icGxhdGZvcm0tbG9nbyIgb25lcnJvcj0idGhpcy5zdHlsZS5kaXNwbGF5PSdub25lJzt0aGlzLnBhcmVudEVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nLnN0eWxlLmRpc3BsYXk9J2Jsb2NrJyI+PC9kaXY+PHNwYW4gc3R5bGU9ImRpc3BsYXk6bm9uZSI+JHtnfTwvc3Bhbj5gOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRDZWxsLnRleHRDb250ZW50ID0gZzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIEJyYW5kIE1vZGUgLSBEeW5hbWljIExvZ28gTG9hZGluZwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJyYW5kTmFtZSA9IGcudHJpbSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvZ29VcmwgPSBgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tLzZhc2UtMWluMy9QVC1MYW5kc2NhcGUvbWFpbi9sb2dvcy8ke2JyYW5kTmFtZX0ucG5nYDsKCiAgICAgICAgICAgICAgICAgICAgbGVmdENlbGwuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9ImxvZ28td3JhcHBlciI+PGltZyBzcmM9IiR7bG9nb1VybH0iIGFsdD0iJHtnfSIgY2xhc3M9InBsYXRmb3JtLWxvZ28iIG9uZXJyb3I9InRoaXMuc3R5bGUuZGlzcGxheT0nbm9uZSc7dGhpcy5wYXJlbnRFbGVtZW50Lm5leHRFbGVtZW50U2libGluZy5zdHlsZS5kaXNwbGF5PSdibG9jayciPjwvZGl2PjxzcGFuIGNsYXNzPSJicmFuZC1mYWxsYmFjayIgc3R5bGU9ImRpc3BsYXk6bm9uZTsgdGV4dC1hbGlnbjpjZW50ZXI7IHdpZHRoOjEwMCU7IGZvbnQtc2l6ZTowLjhyZW07Ij4ke2d9PC9zcGFuPmA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQobGVmdENlbGwpOwoKICAgICAgICAgICAgICAgIC8vIDIuMiBEYXRhIENlbGxzCiAgICAgICAgICAgICAgICBleHBhbmRlZENvbHVtbnMuZm9yRWFjaCgoY29sLCBpZHgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICAgICAgY2VsbC5jbGFzc05hbWUgPSAnZ3JpZC1jZWxsJzsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGJvcmRlckluZGljZXMuaGFzKGlkeCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdib3JkZXItbGVmdC1yZWQtY3VzdG9tJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBgJHtjb2wucHJpY2V9LSR7Y29sLmluZGV4fWA7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IG1hdHJpeFtnXVtrZXldOwoKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmFwcGVuZENoaWxkKGNyZWF0ZVByb2R1Y3RDYXJkKGl0ZW0sIDEpKTsgLy8gUmV2ZXJ0ZWQgY3JlYXRlUHJvZHVjdENhcmQgYWNjZXB0cyAxIGl0ZW0gbm93IGlmIHVzZXIgd2lzaGVzLiAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogSSByZXZlcnQgY3JlYXRlUHJvZHVjdENhcmQgdG8gK04gbG9naWMgaW4gcHJldmlvdXMgc3RlcCAxMDc4LgogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZGVhbGx5IEkgc2hvdWxkIHJldmVydCBjcmVhdGVQcm9kdWN0Q2FyZCB0byBzaW1wbGUgc2lnbmF0dXJlIGBjcmVhdGVQcm9kdWN0Q2FyZChpdGVtKWAgaWYgd2UgaGF2ZSAxLTEgbWFwcGluZyBub3cuCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJ1dCB3YWl0LCB1c2VyIHNhaWQgImRpc3BsYXkgYWxsIi4gCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdpdGggMS0xIG1hcHBpbmcsIGBjcmVhdGVQcm9kdWN0Q2FyZGAgbG9naWMgZm9yICtOIHdvbid0IHRyaWdnZXIgKHNpbmNlIGNvdW50IGlzIDEpLgogICAgICAgICAgICAgICAgICAgICAgICAvLyBCdXQgSSBuZWVkIHRvIHBhc3MgYDFgIGFzIGNvdW50IGlmIHRoZSBmdW5jdGlvbiBleHBlY3RzIGNoZWNraW5nIGNvdW50LgogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdGVwIDEwNzggUmV2ZXJ0ZWQgY3JlYXRlUHJvZHVjdENhcmQgdG8gYGNyZWF0ZVByb2R1Y3RDYXJkKGl0ZW0sIGNvdW50KWAuCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNvIEkgc2hvdWxkIGNhbGw6IGBjcmVhdGVQcm9kdWN0Q2FyZChpdGVtLCAxKWAuCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5pbm5lckhUTUwgPSAnPHNwYW4gY2xhc3M9ImVtcHR5LWNlbGwiPi08L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKGNlbGwpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZChyb3cpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgoKCiAgICAgICAgLy8gPT09PT09PT09PSBDYXJkIENvbmZpZ3VyYXRpb24gTWFuYWdlbWVudCA9PT09PT09PT09CiAgICAgICAgLy8gPT09PT09PT09PSBDYXJkIENvbmZpZ3VyYXRpb24gTWFuYWdlbWVudCA9PT09PT09PT09CiAgICAgICAgY29uc3QgY2FyZENvbmZpZ3MgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJpZCI6ICJNVFMiLAogICAgICAgICAgICAgICAgIm5hbWUiOiAiTWl0ZXIgU2F3IiwKICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJNaXRlciBzYXcgd2l0aCBCZXZlbCBhbmQgU2xpZGUgZmVhdHVyZXMiLAogICAgICAgICAgICAgICAgImZpbGVuYW1lX3BhdHRlcm5zIjogWwogICAgICAgICAgICAgICAgICAgICJNVFMiLAogICAgICAgICAgICAgICAgICAgICJtaXRlciIsCiAgICAgICAgICAgICAgICAgICAgIm1pdGVyX3NhdyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiZmlsdGVycyI6IFsKICAgICAgICAgICAgICAgICAgICB7ICJrZXkiOiAiUGxhdGZvcm0iLCAibGFiZWwiOiAiUGxhdGZvcm0iIH0sCiAgICAgICAgICAgICAgICAgICAgeyAia2V5IjogIlByaWNlIFJhbmdlIiwgImxhYmVsIjogIlByaWNlIFJhbmdlIiB9LAogICAgICAgICAgICAgICAgICAgIHsgImtleSI6ICJCcmFuZCIsICJsYWJlbCI6ICJCcmFuZCIsICJoYXNTZWFyY2giOiB0cnVlIH0sCiAgICAgICAgICAgICAgICAgICAgeyAia2V5IjogIk1vZGVsICMiLCAibGFiZWwiOiAiTW9kZWwiLCAiaGFzU2VhcmNoIjogdHJ1ZSB9LAogICAgICAgICAgICAgICAgICAgIHsgImtleSI6ICJUeXBlIiwgImxhYmVsIjogIlR5cGUiIH0sCiAgICAgICAgICAgICAgICAgICAgeyAia2V5IjogIkJldmVsIiwgImxhYmVsIjogIkJldmVsIiB9LAogICAgICAgICAgICAgICAgICAgIHsgImtleSI6ICJTbGlkZSIsICJsYWJlbCI6ICJTbGlkZSIgfSwKICAgICAgICAgICAgICAgICAgICB7ICJrZXkiOiAiQmxhZGUgUmFuZ2UiLCAibGFiZWwiOiAiQmxhZGUgUmFuZ2UiIH0sCiAgICAgICAgICAgICAgICAgICAgeyAia2V5IjogIlBvd2VyIFN1cHBseSIsICJsYWJlbCI6ICJQb3dlciIgfSwKICAgICAgICAgICAgICAgICAgICB7ICJrZXkiOiAiU29mdCBTdGFydCIsICJsYWJlbCI6ICJTb2Z0IFN0YXJ0IiB9LAogICAgICAgICAgICAgICAgICAgIHsgImtleSI6ICJMYXNlciIsICJsYWJlbCI6ICJMYXNlciIgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJzcGVjcyI6IFsKICAgICAgICAgICAgICAgICAgICB7ICJrZXkiOiAiQmV2ZWwiLCAibGFiZWwiOiAiQmV2ZWwiIH0sCiAgICAgICAgICAgICAgICAgICAgeyAia2V5IjogIlNsaWRlIiwgImxhYmVsIjogIlNsaWRlIiB9LAogICAgICAgICAgICAgICAgICAgIHsgImtleSI6ICJQb3dlciBTdXBwbHkiLCAibGFiZWwiOiAiUG93ZXIiLCAiZm9ybWF0IjogImNsZWFuUG93ZXJTdXBwbHkiIH0sCiAgICAgICAgICAgICAgICAgICAgeyAia2V5IjogIkJsYWRlIERpYW1ldGVyIiwgImxhYmVsIjogIkJsYWRlIiwgInN1ZmZpeCI6ICJtbSIgfQogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAiaWQiOiAiVEJTIiwKICAgICAgICAgICAgICAgICJuYW1lIjogIlRhYmxlIFNhdyIsCiAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiU3RhbmRhcmQgdGFibGUgc2F3IiwKICAgICAgICAgICAgICAgICJmaWxlbmFtZV9wYXR0ZXJucyI6IFsKICAgICAgICAgICAgICAgICAgICAiVEJTIiwKICAgICAgICAgICAgICAgICAgICAidGFibGUiLAogICAgICAgICAgICAgICAgICAgICJ0YWJsZV9zYXciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImZpbHRlcnMiOiBbCiAgICAgICAgICAgICAgICAgICAgeyAia2V5IjogIlBsYXRmb3JtIiwgImxhYmVsIjogIlBsYXRmb3JtIiB9LAogICAgICAgICAgICAgICAgICAgIHsgImtleSI6ICJQcmljZSBSYW5nZSIsICJsYWJlbCI6ICJQcmljZSBSYW5nZSIgfSwKICAgICAgICAgICAgICAgICAgICB7ICJrZXkiOiAiQnJhbmQiLCAibGFiZWwiOiAiQnJhbmQiLCAiaGFzU2VhcmNoIjogdHJ1ZSB9LAogICAgICAgICAgICAgICAgICAgIHsgImtleSI6ICJNb2RlbCAjIiwgImxhYmVsIjogIk1vZGVsIiwgImhhc1NlYXJjaCI6IHRydWUgfSwKICAgICAgICAgICAgICAgICAgICB7ICJrZXkiOiAiVHlwZSIsICJsYWJlbCI6ICJUeXBlIiB9LAogICAgICAgICAgICAgICAgICAgIHsgImtleSI6ICJCbGFkZSBSYW5nZSIsICJsYWJlbCI6ICJCbGFkZSBSYW5nZSIgfSwKICAgICAgICAgICAgICAgICAgICB7ICJrZXkiOiAiV2F0dCIsICJsYWJlbCI6ICJXYXR0IiwgImZhbGxiYWNrX2tleSI6ICJQb3dlciBTdXBwbHkiIH0sCiAgICAgICAgICAgICAgICAgICAgeyAia2V5IjogIlJQTSIsICJsYWJlbCI6ICJSUE0iIH0sCiAgICAgICAgICAgICAgICAgICAgeyAia2V5IjogIlNvZnQgU3RhcnQiLCAibGFiZWwiOiAiU29mdCBTdGFydCIgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJtYXRjaF9ydWxlcyI6IHsgImRlZmF1bHQiOiB0cnVlIH0sCiAgICAgICAgICAgICAgICAic3BlY3MiOiBbCiAgICAgICAgICAgICAgICAgICAgeyAia2V5IjogIldhdHQiLCAibGFiZWwiOiAiV2F0dCIsICJzdWZmaXgiOiAiVyIsICJmYWxsYmFja19rZXkiOiAiUG93ZXIgU3VwcGx5IiwgImZvcm1hdCI6ICJjbGVhblBvd2VyU3VwcGx5IiB9LAogICAgICAgICAgICAgICAgICAgIHsgImtleSI6ICJSUE0iLCAibGFiZWwiOiAiUlBNIiwgInN1ZmZpeCI6ICJycG0iIH0sCiAgICAgICAgICAgICAgICAgICAgeyAia2V5IjogIkJsYWRlIERpYW1ldGVyIiwgImxhYmVsIjogIkJsYWRlIiwgInN1ZmZpeCI6ICJtbSIgfSwKICAgICAgICAgICAgICAgICAgICB7ICJrZXkiOiAiU29mdCBTdGFydCIsICJsYWJlbCI6ICJTb2Z0IFN0YXJ0IiB9CiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICBdOwoKICAgICAgICBmdW5jdGlvbiBtYW51YWxMb2FkQ29uZmlnKCkgewogICAgICAgICAgICAvLyBQbGFjZWhvbGRlciB0byBrZWVwIGZ1bmN0aW9uIGlmIG5lZWRlZCwgYnV0IGNvbmZpZyBpcyBub3cgY29uc3RhbnQuCiAgICAgICAgICAgIGlmICghYWN0aXZlQ29uZmlnICYmIGNhcmRDb25maWdzLmxlbmd0aCA+IDApIHNldEFjdGl2ZU1vZGUoY2FyZENvbmZpZ3MuZmluZChjID0+IGMubWF0Y2hfcnVsZXM/LmRlZmF1bHQpIHx8IGNhcmRDb25maWdzWzBdKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRldGVjdE1vZGUoZmlsZW5hbWVPclVybCkgewogICAgICAgICAgICBpZiAoIWNhcmRDb25maWdzIHx8IGNhcmRDb25maWdzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBuYW1lID0gZmlsZW5hbWVPclVybC5zcGxpdCgnLycpLnBvcCgpLnNwbGl0KCdcXCcpLnBvcCgpOwogICAgICAgICAgICBjb25zb2xlLmxvZygiRGV0ZWN0aW5nIG1vZGUgZm9yOiIsIG5hbWUpOwogICAgICAgICAgICBsZXQgbWF0Y2hlZENvbmZpZyA9IG51bGw7CiAgICAgICAgICAgIGZvciAoY29uc3QgY29uZmlnIG9mIGNhcmRDb25maWdzKSB7CiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmZpbGVuYW1lX3BhdHRlcm5zKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5maWxlbmFtZV9wYXR0ZXJucy5zb21lKHBhdCA9PiBuYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocGF0LnRvTG93ZXJDYXNlKCkpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVkQ29uZmlnID0gY29uZmlnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFtYXRjaGVkQ29uZmlnKSB7CiAgICAgICAgICAgICAgICBtYXRjaGVkQ29uZmlnID0gY2FyZENvbmZpZ3MuZmluZChjID0+IGMubWF0Y2hfcnVsZXM/LmRlZmF1bHQpIHx8IGNhcmRDb25maWdzWzBdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldEFjdGl2ZU1vZGUobWF0Y2hlZENvbmZpZyk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXRBY3RpdmVNb2RlKGNvbmZpZykgewogICAgICAgICAgICBpZiAoIWNvbmZpZykgcmV0dXJuOwoKICAgICAgICAgICAgLy8gRW5zdXJlIFR5cGUgYW5kIFNvZnQgU3RhcnQgYXJlIHByZXNlbnQgaWYgZmlsdGVycyBhcmUgZGVmaW5lZCAoVXNlciBSZXF1ZXN0IHVuaWZpY2F0aW9uKQogICAgICAgICAgICBpZiAoY29uZmlnLmZpbHRlcnMpIHsKICAgICAgICAgICAgICAgIGlmICghY29uZmlnLmZpbHRlcnMuc29tZShmID0+IGYua2V5ID09PSAnVHlwZScpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmZpbHRlcnMucHVzaCh7IGtleTogJ1R5cGUnLCBsYWJlbDogJ1R5cGUnIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFjb25maWcuZmlsdGVycy5zb21lKGYgPT4gZi5rZXkgPT09ICdTb2Z0IFN0YXJ0JykpIHsKICAgICAgICAgICAgICAgICAgICBjb25maWcuZmlsdGVycy5wdXNoKHsga2V5OiAnU29mdCBTdGFydCcsIGxhYmVsOiAnU29mdCBTdGFydCcgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFjdGl2ZUNvbmZpZyA9IGNvbmZpZzsKICAgICAgICAgICAgY29uc29sZS5sb2coIlN3aXRjaGVkIHRvIE1vZGU6IiwgYWN0aXZlQ29uZmlnLmlkKTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXJnZWREYXRhICE9PSAndW5kZWZpbmVkJyAmJiBtZXJnZWREYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHNldHVwRmlsdGVycygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlb2YgZmlsdGVyZWREYXRhICE9PSAndW5kZWZpbmVkJyAmJiBmaWx0ZXJlZERhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgYXBwbHlGaWx0ZXJzKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEluaXRpYWxpemUgQ29uZmlnCiAgICAgICAgbWFudWFsTG9hZENvbmZpZygpOwoKICAgICAgICBmdW5jdGlvbiBnZXRNYXRjaGluZ0NvbmZpZyhpdGVtKSB7CiAgICAgICAgICAgIGlmICghY2FyZENvbmZpZ3MgfHwgY2FyZENvbmZpZ3MubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIC8vIDEuIFRyeSB0byBmaW5kIGEgbWF0Y2ggYmFzZWQgb24gcnVsZXMKICAgICAgICAgICAgZm9yIChjb25zdCBjb25maWcgb2YgY2FyZENvbmZpZ3MpIHsKICAgICAgICAgICAgICAgIGlmIChjb25maWcubWF0Y2hfcnVsZXM/LmRlZmF1bHQpIGNvbnRpbnVlOyAvLyBTa2lwIGRlZmF1bHQgZm9yIG5vdwoKICAgICAgICAgICAgICAgIGNvbnN0IHJ1bGVzID0gY29uZmlnLm1hdGNoX3J1bGVzOwogICAgICAgICAgICAgICAgaWYgKCFydWxlcykgY29udGludWU7IC8vIFNraXAgaWYgbm8gcnVsZXMgZGVmaW5lZAogICAgICAgICAgICAgICAgbGV0IGlzTWF0Y2ggPSB0cnVlOwoKICAgICAgICAgICAgICAgIC8vIFJ1bGU6IGhhc19jb2x1bW5zIChTaG93IGlmIEFMTCBjb2x1bW5zIGV4aXN0KQogICAgICAgICAgICAgICAgaWYgKHJ1bGVzLmhhc19jb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBjb2wgb2YgcnVsZXMuaGFzX2NvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpdGVtLmhhc093blByb3BlcnR5KGNvbCkpIHsgLy8gU2ltcGxlIGNoZWNrIGZvciBrZXkgZXhpc3RlbmNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc01hdGNoID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoaXNNYXRjaCkgcmV0dXJuIGNvbmZpZzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gUmV0dXJuIGRlZmF1bHQgY29uZmlnCiAgICAgICAgICAgIHJldHVybiBjYXJkQ29uZmlncy5maW5kKGMgPT4gYy5tYXRjaF9ydWxlcz8uZGVmYXVsdCkgfHwgY2FyZENvbmZpZ3NbMF07CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZW5kZXJTcGVjVmFsdWUoaXRlbSwgc3BlY0RlZikgewogICAgICAgICAgICBsZXQgdmFsID0gaXRlbVtzcGVjRGVmLmtleV07CgogICAgICAgICAgICAvLyBGYWxsYmFjayBLZXkKICAgICAgICAgICAgaWYgKCh2YWwgPT09IHVuZGVmaW5lZCB8fCB2YWwgPT09IG51bGwgfHwgdmFsID09PSAnJyB8fCB2YWwgPT09ICctJykgJiYgc3BlY0RlZi5mYWxsYmFja19rZXkpIHsKICAgICAgICAgICAgICAgIHZhbCA9IGl0ZW1bc3BlY0RlZi5mYWxsYmFja19rZXldOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBWYWx1ZSBDaGVjawogICAgICAgICAgICBpZiAodmFsID09PSB1bmRlZmluZWQgfHwgdmFsID09PSBudWxsIHx8IHZhbCA9PT0gJycpIHZhbCA9ICctJzsKCiAgICAgICAgICAgIC8vIEZvcm1hdHRlcgogICAgICAgICAgICBpZiAoc3BlY0RlZi5mb3JtYXQgPT09ICdjbGVhblBvd2VyU3VwcGx5JykgewogICAgICAgICAgICAgICAgdmFsID0gY2xlYW5Qb3dlclN1cHBseSh2YWwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciBXYXR0L1Bvd2VyIGZpZWxkIHdpdGggY29yZGxlc3Mgdm9sdGFnZSAoZS5nLiwgImNvcmRsZXNzIDE4ViIpCiAgICAgICAgICAgIGxldCBza2lwU3VmZml4ID0gZmFsc2U7CiAgICAgICAgICAgIGlmICh2YWwgIT09ICctJyAmJiAoc3BlY0RlZi5rZXkgPT09ICdXYXR0JyB8fCBzcGVjRGVmLmtleSA9PT0gJ1Bvd2VyIFN1cHBseScpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzdHJWYWwgPSBTdHJpbmcodmFsKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgY29udGFpbnMgY29yZGxlc3Mgd2l0aCB2b2x0YWdlIHBhdHRlcm4KICAgICAgICAgICAgICAgIGlmIChzdHJWYWwuaW5jbHVkZXMoJ2NvcmRsZXNzJykgfHwgL1xkK1xzKnZcYi9pLnRlc3QodmFsKSkgewogICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSAiY29yZGxlc3MiIGFuZCBjbGVhbiB1cCwga2VlcCBvbmx5IHRoZSB2b2x0YWdlIHBhcnQKICAgICAgICAgICAgICAgICAgICB2YWwgPSBTdHJpbmcodmFsKS5yZXBsYWNlKC9jb3JkbGVzc1xzKi9naSwgJycpLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgcmVzdWx0IGFscmVhZHkgaGFzIFYsIGRvbid0IGFkZCBXIHN1ZmZpeAogICAgICAgICAgICAgICAgICAgIGlmICgvXGQrXHMqdlxiL2kudGVzdCh2YWwpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNraXBTdWZmaXggPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU3VmZml4IChvbmx5IGlmIHZhbHVlIGlzIG5vdCAnLScgYW5kIG5vdCBza2lwcGVkKQogICAgICAgICAgICBpZiAodmFsICE9PSAnLScgJiYgc3BlY0RlZi5zdWZmaXggJiYgIXNraXBTdWZmaXgpIHsKICAgICAgICAgICAgICAgIHZhbCA9IHZhbCArIHNwZWNEZWYuc3VmZml4OwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlUHJvZHVjdENhcmQoaXRlbSwgY291bnQpIHsKICAgICAgICAgICAgY29uc3QgY2FyZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBjYXJkLmNsYXNzTmFtZSA9ICdwcm9kdWN0LWNhcmQnOwoKICAgICAgICAgICAgY29uc3QgaW1nID0gaXRlbVsnSW1hZ2UgVVJMJ10gfHwgaXRlbS5JbWFnZSB8fCAnJzsKICAgICAgICAgICAgY29uc3QgdG90YWxMaW5lcyA9IChpdGVtLlRvdGFsIHx8ICctJykuc3BsaXQoJ1xuJykubWFwKGwgPT4gbC50cmltKCkgfHwgJy0nKTsKICAgICAgICAgICAgY29uc3QgYWNjZXNzb3JpZXMgPSBpdGVtLkFjY2Vzc29yaWVzIHx8IGl0ZW0u6YWN5Lu2IHx8ICctJzsKICAgICAgICAgICAgY29uc3QgbW9kZWxOYW1lID0gKGl0ZW1bJ01vZGVsICMnXSB8fCBpdGVtLuapn+WeiykgKyAoY291bnQgPiAxID8gYCArJHtjb3VudCAtIDF9YCA6ICcnKTsKICAgICAgICAgICAgY29uc3QgcHJvZHVjdFVybCA9IGl0ZW1bJ1Byb2R1Y3QgVVJMJ10gfHwgJyMnOwogICAgICAgICAgICBjb25zdCBoYXNVcmwgPSBwcm9kdWN0VXJsICYmIHByb2R1Y3RVcmwgIT09ICcjJyAmJiBwcm9kdWN0VXJsICE9PSAnJzsKCgoKICAgICAgICAgICAgLy8gRHluYW1pYyBTcGVjIFJlbmRlcmluZwogICAgICAgICAgICBjb25zdCBjb25maWcgPSBnZXRNYXRjaGluZ0NvbmZpZyhpdGVtKTsKICAgICAgICAgICAgbGV0IHNwZWNzSHRtbCA9ICcnOwoKICAgICAgICAgICAgaWYgKGNvbmZpZyAmJiBjb25maWcuc3BlY3MpIHsKICAgICAgICAgICAgICAgIHNwZWNzSHRtbCA9IGNvbmZpZy5zcGVjcy5tYXAoc3BlYyA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzcGxheVZhbHVlID0gcmVuZGVyU3BlY1ZhbHVlKGl0ZW0sIHNwZWMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0iY2FyZC1zcGVjIiB0aXRsZT0iJHtzcGVjLmxhYmVsIHx8IHNwZWMua2V5fSI+JHtkaXNwbGF5VmFsdWV9PC9kaXY+YDsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYXJkLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtaW1hZ2UiPgogICAgICAgICAgICAgICAgICAgICR7aW1nID8gYDxpbWcgc3JjPSIke2ltZ30iIG9uZXJyb3I9InRoaXMuc3R5bGUuZGlzcGxheT0nbm9uZSciPmAgOiAnPGkgY2xhc3M9ImZhcyBmYS1pbWFnZSB0ZXh0LWdyYXktMzAwIj48L2k+J30KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1ib2R5Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWJyYW5kIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImJyYW5kLXRleHQiPiR7aXRlbS5CcmFuZCB8fCAnLSd9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPSJicmFuZC1pbWciIHNyYz0iaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tLzZhc2UtMWluMy9QVC1MYW5kc2NhcGUvbWFpbi9sb2dvcy8keyhpdGVtLkJyYW5kIHx8ICcnKS50cmltKCl9LnBuZyIgb25lcnJvcj0idGhpcy5zdHlsZS5kaXNwbGF5PSdub25lJzt0aGlzLnByZXZpb3VzRWxlbWVudFNpYmxpbmcuc3R5bGUuZGlzcGxheT0nYmxvY2snIj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLW1vZGVsIiB0aXRsZT0iJHtpdGVtWydNb2RlbCAjJ119Ij4ke21vZGVsTmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLXNwZWNzIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtzcGVjc0h0bWx9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC10b3RhbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7dG90YWxMaW5lcy5tYXAobCA9PiBgPHNwYW4gY2xhc3M9ImNhcmQtdG90YWwtbGluZSI+JHtsfTwvc3Bhbj5gKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWFjY2Vzc29yaWVzIj4ke2FjY2Vzc29yaWVzfTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtcHJpY2UiPuKCrCR7TnVtYmVyKGl0ZW0uUHJpY2UpLnRvRml4ZWQoMil9PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKCgoKCgogICAgICAgICAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gc2hvd0RldGFpbFBhbmVsKGl0ZW0pKTsKICAgICAgICAgICAgcmV0dXJuIGNhcmQ7CiAgICAgICAgfQoKICAgICAgICAvLyBNaW5pIENoYXJ0IEluaXRpYWxpemF0aW9uCiAgICAgICAgLy8gRGV0YWlsIFBhbmVsIENoYXJ0CiAgICAgICAgZnVuY3Rpb24gcmVuZGVyRGV0YWlsQ2hhcnQoY2FudmFzSWQsIGl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2FudmFzSWQpOwogICAgICAgICAgICBpZiAoIWN0eCkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgcHJpY2VzID0gW107CiAgICAgICAgICAgIGNvbnN0IGxhYmVscyA9IFtdOwoKICAgICAgICAgICAgLy8gQ3VycmVudAogICAgICAgICAgICBpZiAoaXRlbS5QcmljZSkgewogICAgICAgICAgICAgICAgbGFiZWxzLnB1c2goJ05vdycpOwogICAgICAgICAgICAgICAgcHJpY2VzLnB1c2goaXRlbS5QcmljZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEhpc3RvcnkKICAgICAgICAgICAgaWYgKGl0ZW0uSGlzdG9yeSkgewogICAgICAgICAgICAgICAgLy8gSGlzdG9yeSBpcyBwdXNoZWQgKG9sZGVzdCB0byBuZXdlc3QpIGluIG1lcmdlRGF0YT8gCiAgICAgICAgICAgICAgICAvLyBXZSdsbCB0cnVzdCBvcmRlciBvciBzb3J0LgogICAgICAgICAgICAgICAgaXRlbS5IaXN0b3J5LmZvckVhY2goaCA9PiB7CiAgICAgICAgICAgICAgICAgICAgbGFiZWxzLnVuc2hpZnQoZm9ybWF0RGF0ZShoLmRhdGUpKTsKICAgICAgICAgICAgICAgICAgICBwcmljZXMudW5zaGlmdChoLnByaWNlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBuZXcgQ2hhcnQoY3R4LCB7CiAgICAgICAgICAgICAgICB0eXBlOiAnbGluZScsCiAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgbGFiZWxzOiBsYWJlbHMsCiAgICAgICAgICAgICAgICAgICAgZGF0YXNldHM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnUHJpY2UgVHJlbmQnLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBwcmljZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiAnIzRmNDZlNScsCiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoNzksIDcwLCAyMjksIDAuMSknLAogICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMiwKICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRSYWRpdXM6IDQsCiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50SG92ZXJSYWRpdXM6IDYsCiAgICAgICAgICAgICAgICAgICAgICAgIHRlbnNpb246IDAuMiwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNpdmU6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgcGx1Z2luczogewogICAgICAgICAgICAgICAgICAgICAgICBsZWdlbmQ6IHsgZGlzcGxheTogZmFsc2UgfSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9vbHRpcDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IChjKSA9PiBg4oKsJHtjLnJhd31gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNjYWxlczogewogICAgICAgICAgICAgICAgICAgICAgICB5OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkOiB7IGNvbG9yOiAnI2YzZjRmNicgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gJ+KCrCcgKyB2YWx1ZTsgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB4OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkOiB7IGRpc3BsYXk6IGZhbHNlIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmb3JtYXREYXRlKGRhdGVTdHIpIHsKICAgICAgICAgICAgLy8gWVlZWU1NREQgLT4gTU0vREQKICAgICAgICAgICAgaWYgKCFkYXRlU3RyIHx8IGRhdGVTdHIubGVuZ3RoICE9PSA4KSByZXR1cm4gZGF0ZVN0cjsKICAgICAgICAgICAgcmV0dXJuIGRhdGVTdHIuc3Vic3RyaW5nKDQsIDYpICsgJy8nICsgZGF0ZVN0ci5zdWJzdHJpbmcoNiwgOCk7CiAgICAgICAgfQoKICAgICAgICAvLyA9PT09PT09PT09IOaVo+m7nuWcliAo5ZCrIFgg6Lu45YO55qC85bGV6ZaLKSA9PT09PT09PT09CiAgICAgICAgbGV0IHhBeGlzTWFwcGluZyA9IFtdOwogICAgICAgIGxldCB0aWNrUHJpY2VzID0gW107CgogICAgICAgIC8vID09PT09PT09PT0g5paw5aKe5Yqf6IO9ID09PT09PT09PT0KICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZVNjYXR0ZXJPcHRpb25zKCkgewogICAgICAgICAgICBjb25zdCBheGlzU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYXR0ZXJZQXhpcycpOwogICAgICAgICAgICBjb25zdCBjb2xvclNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2F0dGVyQ29sb3JCeScpOwoKICAgICAgICAgICAgLy8g6aCQ6Kit5L+d55WZ55qE5YC8ICjlpoLmnpzpgoTmspLooqvmuIXnqbrnmoToqbHvvIzkvYbpgJnoo6HmiJHlgJHmnIPph43nva4pCiAgICAgICAgICAgIC8vIOWFtuWvpuacgOWlveaYryBBcHBlbmQg6ICM5LiN5pivIGlubmVySFRNTD0nJ++8jOS9hueCuuS6humBv+WFjemHjeikh+ewoeWWrui1t+imi+aIkeWAkeWFiOa4heepuumHjeWKoAogICAgICAgICAgICAvLyDkuI3pgY7opoHkv53nlZnljp/mnKznmoQgSGFyZGNvZGVkIOmBuOmgheWXju+8nyDkvb/nlKjogIXoqqogIuebruWJjeWPquaciTPlgIsuLi7nr6npgbjmnInnmoTpoIXnm67pg73opoEiCiAgICAgICAgICAgIC8vIOaIkeWAkeeUqCBjb2xIZWFkZXJzIOS+hueUoueUnwoKICAgICAgICAgICAgY29uc3QgY3VycmVudEF4aXMgPSBheGlzU2VsZWN0LnZhbHVlOwogICAgICAgICAgICBjb25zdCBjdXJyZW50Q29sb3IgPSBjb2xvclNlbGVjdC52YWx1ZTsKCiAgICAgICAgICAgIC8vIEhlbHBlciB0byBhZGQgb3B0aW9uCiAgICAgICAgICAgIGNvbnN0IGFkZE9wdCA9IChzZWwsIHZhbCwgdGV4dCkgPT4gewogICAgICAgICAgICAgICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgICAgICAgICAgICBvcHQudmFsdWUgPSB2YWw7CiAgICAgICAgICAgICAgICBvcHQudGV4dENvbnRlbnQgPSB0ZXh0OwogICAgICAgICAgICAgICAgc2VsLmFwcGVuZENoaWxkKG9wdCk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBheGlzU2VsZWN0LmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBjb2xvclNlbGVjdC5pbm5lckhUTUwgPSAnJzsKCiAgICAgICAgICAgIC8vIOWfuuacrOmgkOiorQogICAgICAgICAgICAvLyDmoLnmk5ogRklMVEVSX0ZJRUxEUwogICAgICAgICAgICBGSUxURVJfRklFTERTLmZvckVhY2goaCA9PiB7CiAgICAgICAgICAgICAgICAvLyDmjpLpmaTkuIDkupvkuI3pganlkIjnmoTmrITkvY0gKOWPquaOkumZpOWclueJhykKICAgICAgICAgICAgICAgIGlmIChoLmtleSAhPT0gJ+WclueJhycgJiYgaC5rZXkgIT09ICdJbWFnZSBVUkwnKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkT3B0KGF4aXNTZWxlY3QsIGgua2V5LCBoLmxhYmVsIHx8IGgua2V5KTsKICAgICAgICAgICAgICAgICAgICBhZGRPcHQoY29sb3JTZWxlY3QsIGgua2V5LCBoLmxhYmVsIHx8IGgua2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyDlmJfoqabmgaLlvqnpgbjlj5bvvIzlpoLmnpzmlrDmuIXllq7mnInoqbLlgLwKICAgICAgICAgICAgaWYgKEFycmF5LmZyb20oYXhpc1NlbGVjdC5vcHRpb25zKS5zb21lKG8gPT4gby52YWx1ZSA9PT0gY3VycmVudEF4aXMpKSBheGlzU2VsZWN0LnZhbHVlID0gY3VycmVudEF4aXM7CiAgICAgICAgICAgIGVsc2UgYXhpc1NlbGVjdC52YWx1ZSA9ICdCcmFuZCc7IC8vIERlZmF1bHQKCiAgICAgICAgICAgIGlmIChBcnJheS5mcm9tKGNvbG9yU2VsZWN0Lm9wdGlvbnMpLnNvbWUobyA9PiBvLnZhbHVlID09PSBjdXJyZW50Q29sb3IpKSBjb2xvclNlbGVjdC52YWx1ZSA9IGN1cnJlbnRDb2xvcjsKICAgICAgICAgICAgZWxzZSBjb2xvclNlbGVjdC52YWx1ZSA9ICdCcmFuZCc7IC8vIERlZmF1bHQKICAgICAgICB9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGNhcHR1cmVTY2F0dGVyQ2hhcnQoKSB7CiAgICAgICAgICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhdHRlcldyYXBwZXInKTsgLy8g5oiq5Y+W5pW05YCL5Y2A5Z+f5YyF5ZCrIExlZ2VuZC9Ub29sYmFyCiAgICAgICAgICAgIC8vIOaIluiAheWPquaIquWPliAjc2NhdHRlckNoYXJ0V3JhcHBlciA/IOS9v+eUqOiAheWPr+iDveaDs+imgSBMZWdlbmQKICAgICAgICAgICAgLy8g5L2GIHdyYXBwZXIg6aCQ6Kit5pivIGhpZGRlbiAoZGlzcGxheTpub25lKSDnlbblnKggR3JpZCB2aWV3IOaZguOAggogICAgICAgICAgICAvLyDmiKrlnJbpgJrluLjmmK/lnKggU2NhdHRlciBWaWV3IOS4i+aMieeahOOAggoKICAgICAgICAgICAgLy8g5L2/55SoIGh0bWwyY2FudmFzCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBjYW52YXMgPSBhd2FpdCBodG1sMmNhbnZhcyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2NhdHRlci1jb250YWluZXInKSwgewogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNmZmZmZmYnLAogICAgICAgICAgICAgICAgICAgIHNjYWxlOiAyIC8vIOmrmOino+aekOW6pgogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICAgICAgICAgIGxpbmsuZG93bmxvYWQgPSBgU2NhdHRlckNoYXJ0XyR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsIDE5KS5yZXBsYWNlKC9bOlRdL2csICctJyl9LnBuZ2A7CiAgICAgICAgICAgICAgICBsaW5rLmhyZWYgPSBjYW52YXMudG9EYXRhVVJMKCk7CiAgICAgICAgICAgICAgICBsaW5rLmNsaWNrKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1NjcmVlbnNob3QgZmFpbGVkOicsIGUpOwogICAgICAgICAgICAgICAgYWxlcnQoJ+aIquWcluWkseaVlycpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB1cGRhdGVTY2F0dGVyQ2hhcnQoKSB7CiAgICAgICAgICAgIC8vIEd1YXJkOiBDaGVjayBpZiBDaGFydC5qcyBpcyBsb2FkZWQgKENETiBtYXkgZmFpbCkKICAgICAgICAgICAgaWYgKHR5cGVvZiBDaGFydCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignQ2hhcnQuanMgbm90IGxvYWRlZCwgc2tpcHBpbmcgc2NhdHRlciBjaGFydCcpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCB5RmllbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhdHRlcllBeGlzJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGNvbG9yRmllbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhdHRlckNvbG9yQnknKS52YWx1ZTsKICAgICAgICAgICAgY29uc3Qgc2l6ZUZpZWxkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYXR0ZXJTaXplQnknKT8udmFsdWUgfHwgJ25vbmUnOwoKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIE1vZGVsIENvdW50IE1hcCBmb3IgU2l6ZSBvcHRpb24KICAgICAgICAgICAgLy8gSU1QT1JUQU5UOiBVc2UgbWVyZ2VkRGF0YSAobm90IGZpbHRlcmVkRGF0YSkgdG8gYXZvaWQgRGF0YSBNb2RlIGluZmx1ZW5jZQogICAgICAgICAgICAvLyBJZiBZLWF4aXMgaXMgUGxhdGZvcm06IGNvdW50IHBlciBwbGF0Zm9ybSAoc2luZ2xlIHBsYXRmb3JtKQogICAgICAgICAgICAvLyBJZiBZLWF4aXMgaXMgbm90IFBsYXRmb3JtOiBjb3VudCBhY3Jvc3MgYWxsIHBsYXRmb3JtcyAoY3Jvc3MtcGxhdGZvcm0pCiAgICAgICAgICAgIGNvbnN0IG1vZGVsQ291bnRNYXAgPSB7fTsKICAgICAgICAgICAgaWYgKHNpemVGaWVsZCA9PT0gJ01vZGVsQ291bnQnKSB7CiAgICAgICAgICAgICAgICBpZiAoeUZpZWxkID09PSAnUGxhdGZvcm0nKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2luZ2xlIHBsYXRmb3JtOiBjb3VudCBzYW1lIE1vZGVsIyB3aXRoaW4gc2FtZSBQbGF0Zm9ybQogICAgICAgICAgICAgICAgICAgIG1lcmdlZERhdGEuZm9yRWFjaChkID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gYCR7ZFsnTW9kZWwgIyddfXx8JHtkLlBsYXRmb3JtfWA7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsQ291bnRNYXBba2V5XSA9IChtb2RlbENvdW50TWFwW2tleV0gfHwgMCkgKyAxOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBDcm9zcy1wbGF0Zm9ybTogY291bnQgdW5pcXVlIHBsYXRmb3JtcyBmb3IgZWFjaCBNb2RlbCMKICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2RlbFBsYXRmb3JtcyA9IHt9OwogICAgICAgICAgICAgICAgICAgIG1lcmdlZERhdGEuZm9yRWFjaChkID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9kZWwgPSBkWydNb2RlbCAjJ107CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbW9kZWxQbGF0Zm9ybXNbbW9kZWxdKSBtb2RlbFBsYXRmb3Jtc1ttb2RlbF0gPSBuZXcgU2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsUGxhdGZvcm1zW21vZGVsXS5hZGQoZC5QbGF0Zm9ybSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMobW9kZWxQbGF0Zm9ybXMpLmZvckVhY2gobW9kZWwgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBtb2RlbENvdW50TWFwW21vZGVsXSA9IG1vZGVsUGxhdGZvcm1zW21vZGVsXS5zaXplOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGaW5kIG1heCBDb21tZW50cyBmb3Igbm9ybWFsaXphdGlvbiAodXNlIG1lcmdlZERhdGEgdG8gYXZvaWQgRGF0YSBNb2RlIGluZmx1ZW5jZSkKICAgICAgICAgICAgY29uc3QgbWF4Q29tbWVudHMgPSBNYXRoLm1heCguLi5tZXJnZWREYXRhLm1hcChkID0+IGQuQ29tbWVudHMgfHwgMCksIDEpOwoKICAgICAgICAgICAgLy8gU2l6ZSBtdWx0aXBsaWVyIGNhbGN1bGF0aW9uIGZ1bmN0aW9uCiAgICAgICAgICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVNpemVNdWx0aXBsaWVyKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChzaXplRmllbGQgPT09ICdub25lJykgcmV0dXJuIDE7CgogICAgICAgICAgICAgICAgaWYgKHNpemVGaWVsZCA9PT0gJ0NvbW1lbnRzJykgewogICAgICAgICAgICAgICAgICAgIC8vIENvbW1lbnRzOiAwID0gMXgsIG1heENvbW1lbnRzID0gM3gsIGxpbmVhciBzY2FsZQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1lbnRzID0gaXRlbS5Db21tZW50cyB8fCAwOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAxICsgKGNvbW1lbnRzIC8gbWF4Q29tbWVudHMpICogMjsgLy8gMXggfiAzeAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzaXplRmllbGQgPT09ICdTY29yZScpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTY29yZTogMSA9IDAuNXgsIDMgPSAxeCwgNSA9IDJ4LCBubyBkYXRhID0gMXgKICAgICAgICAgICAgICAgICAgICBjb25zdCBzY29yZSA9IGl0ZW0uU2NvcmUgfHwgMDsKICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcmUgPT09IDApIHJldHVybiAxOyAvLyBObyBkYXRhCiAgICAgICAgICAgICAgICAgICAgLy8gTGluZWFyIGludGVycG9sYXRpb246IHNjb3JlIDEtPjAuNSwgc2NvcmUgMy0+MSwgc2NvcmUgNS0+MgogICAgICAgICAgICAgICAgICAgIGlmIChzY29yZSA8PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwLjUgKyAoc2NvcmUgLSAxKSAqICgwLjUgLyAyKTsgLy8gMC41IHRvIDEgZm9yIHNjb3JlIDEtMwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxICsgKHNjb3JlIC0gMykgKiAoMSAvIDIpOyAvLyAxIHRvIDIgZm9yIHNjb3JlIDMtNQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc2l6ZUZpZWxkID09PSAnTW9kZWxDb3VudCcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSB5RmllbGQgPT09ICdQbGF0Zm9ybScKICAgICAgICAgICAgICAgICAgICAgICAgPyBgJHtpdGVtWydNb2RlbCAjJ119fHwke2l0ZW0uUGxhdGZvcm19YAogICAgICAgICAgICAgICAgICAgICAgICA6IGl0ZW1bJ01vZGVsICMnXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IG1vZGVsQ291bnRNYXBba2V5XSB8fCAxOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heENvdW50ID0gTWF0aC5tYXgoLi4uT2JqZWN0LnZhbHVlcyhtb2RlbENvdW50TWFwKSwgMSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEgKyAoY291bnQgLyBtYXhDb3VudCkgKiAyOyAvLyAxeCB+IDN4CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOaUtumbhuaJgOacieacieaViOaVuOaTmiAo5YWB6KixIFkg6Lu45YC854K656m677yM5q246aGe54K6ICdVbmtub3duJykKICAgICAgICAgICAgY29uc3QgdmFsaWREYXRhID0gZmlsdGVyZWREYXRhLmZpbHRlcihkID0+IGRbJ1ByaWNlIFRhZyddID4gMCkubWFwKGQgPT4gKHsKICAgICAgICAgICAgICAgIHByaWNlOiBkWydQcmljZSBUYWcnXSwgIC8vIFVzZSBQcmljZSBUYWcgZm9yIFgtYXhpcwogICAgICAgICAgICAgICAgb3JpZ2luYWxQcmljZTogZC5QcmljZSwgICAvLyBLZWVwIG9yaWdpbmFsIGZvciBkaXNwbGF5CiAgICAgICAgICAgICAgICB5VmFsdWU6IGRbeUZpZWxkXSB8fCAnKFVua25vd24pJywKICAgICAgICAgICAgICAgIGNvbG9yOiBkW2NvbG9yRmllbGRdIHx8ICdVbmNhdGVnb3JpemVkJywKICAgICAgICAgICAgICAgIHNpemVNdWx0aXBsaWVyOiBjYWxjdWxhdGVTaXplTXVsdGlwbGllcihkKSwKICAgICAgICAgICAgICAgIGl0ZW06IGQKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgaWYgKHZhbGlkRGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiTm8gdmFsaWQgZGF0YSBmb3Igc2NhdHRlciBjaGFydCIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgoKICAgICAgICAgICAgLy8gWSDou7jpoZ7liKUKICAgICAgICAgICAgbGV0IHlDYXRlZ29yaWVzID0gWy4uLm5ldyBTZXQodmFsaWREYXRhLm1hcChkID0+IGQueVZhbHVlKSldOwogICAgICAgICAgICAvLyBBcHBseSBjdXN0b20gc29ydCBvcmRlciBpZiBhdmFpbGFibGUsIGVsc2UgQS1aCiAgICAgICAgICAgIHlDYXRlZ29yaWVzID0gdHlwZW9mIGdldEN1c3RvbVNvcnRlZFZhbHVlcyA9PT0gJ2Z1bmN0aW9uJwogICAgICAgICAgICAgICAgPyBnZXRDdXN0b21Tb3J0ZWRWYWx1ZXMoeUNhdGVnb3JpZXMsIHlGaWVsZCkKICAgICAgICAgICAgICAgIDogeUNhdGVnb3JpZXMuc29ydCgpOwoKICAgICAgICAgICAgLy8g5YuV5oWL6Kq/5pW05ZyW6KGo6auY5bqmICjnp7vpmaToiIrnmoQgaGFyZGNvZGVkIOmCj+i8rykKICAgICAgICAgICAgLy8gY29uc3QgbWluSGVpZ2h0ID0gNDAwOyAKICAgICAgICAgICAgLy8gY29uc3QgaGVpZ2h0UGVyQ2F0ZWdvcnkgPSA1MDsKICAgICAgICAgICAgLy8gLi4uIGxvZ2ljIG1vdmVkIHRvIHVzYWdlIG9mIGNoYXJ0U2V0dGluZ3MKCiAgICAgICAgICAgIC8vIOmhj+iJsumhnuWIpQogICAgICAgICAgICBjb25zdCBjb2xvckNhdGVnb3JpZXMgPSBbLi4ubmV3IFNldCh2YWxpZERhdGEubWFwKGQgPT4gZC5jb2xvcikpXS5zb3J0KCk7CiAgICAgICAgICAgIGNvbnN0IGNvbG9yTWFwID0ge307CiAgICAgICAgICAgIGNvbG9yQ2F0ZWdvcmllcy5mb3JFYWNoKChjLCBpKSA9PiBjb2xvck1hcFtjXSA9IENPTE9SX1BBTEVUVEVbaSAlIENPTE9SX1BBTEVUVEUubGVuZ3RoXSk7CgogICAgICAgICAgICAvLyDph43mlrDlr6bkvZw6IOWfuuaWvOWvhuW6pueahOWxlemWi+i7uCAoU3ByZWFkIEF4aXMpCiAgICAgICAgICAgIC8vIOimj+WJhzogCiAgICAgICAgICAgIC8vIDEuIOmWk+i3neS+neaTmiB0aWNrSW50ZXJ2YWwgKDI1LzUwLzEwMC8yMDApLCDotoXpgY45MDDliYfngro1MDAKICAgICAgICAgICAgLy8gMi4g5q+P5YCL6ZaT6Led5a+s5bqmID0gbWF4KDIsIOizh+aWmeethuaVuCkKICAgICAgICAgICAgLy8gMy4g57SF57ea5q+PMTAw5LiA5qKdCgogICAgICAgICAgICBjb25zdCBpbnRlcnZhbCA9IHBhcnNlSW50KGNoYXJ0U2V0dGluZ3MudGlja0ludGVydmFsKSB8fCA1MDsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1VzaW5nIEludGVydmFsOicsIGludGVydmFsKTsgLy8gRGVidWcgbG9nCgogICAgICAgICAgICBjb25zdCBoaWdoSW50ZXJ2YWwgPSA1MDA7CgogICAgICAgICAgICAvLyDmraXpqZ8gMTog5bu656uLIEJpbnMKICAgICAgICAgICAgY29uc3QgYmlucyA9IFtdOwogICAgICAgICAgICBsZXQgY3VycmVudEJvdW5kYXJ5ID0gMDsKICAgICAgICAgICAgLy8g5om+5Ye65pyA5aSn5YO55qC85Lul5rG65a6a57WC6bueCiAgICAgICAgICAgIGNvbnN0IG1heE1zZ1ByaWNlID0gTWF0aC5tYXgoLi4udmFsaWREYXRhLm1hcChkID0+IGQucHJpY2UpLCAwKTsKICAgICAgICAgICAgY29uc3QgZ2xvYmFsTWF4ID0gTWF0aC5jZWlsKG1heE1zZ1ByaWNlIC8gMTAwKSAqIDEwMCArIDIwMDsgLy8g5bu25Ly46YCZ6Laz5Lul6KaG6JOLCgogICAgICAgICAgICB3aGlsZSAoY3VycmVudEJvdW5kYXJ5IDwgZ2xvYmFsTWF4KSB7CiAgICAgICAgICAgICAgICBsZXQgbmV4dEJvdW5kYXJ5OwogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRCb3VuZGFyeSA+PSA5MDApIHsKICAgICAgICAgICAgICAgICAgICBuZXh0Qm91bmRhcnkgPSBjdXJyZW50Qm91bmRhcnkgKyBoaWdoSW50ZXJ2YWw7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG5leHRCb3VuZGFyeSA9IGN1cnJlbnRCb3VuZGFyeSArIGludGVydmFsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIOaJvuWHuuiQveWcqOatpCBCaW4g55qE6LOH5paZCiAgICAgICAgICAgICAgICBjb25zdCBiaW5EYXRhID0gdmFsaWREYXRhLmZpbHRlcihkID0+IGQucHJpY2UgPj0gY3VycmVudEJvdW5kYXJ5ICYmIGQucHJpY2UgPCBuZXh0Qm91bmRhcnkpOwoKICAgICAgICAgICAgICAgIC8vIOioiOeul+atpCBCaW4g55qE6KaW6Ka65a+s5bqmICjllq7kvY06IHNsb3QpCiAgICAgICAgICAgICAgICAvLyDln7rmnKwgNiDllq7kvY0sIOmYsuatouaomeexpOmHjeeWiiAoNTUwIHZzIDYwMCkKICAgICAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5tYXgoNiwgYmluRGF0YS5sZW5ndGgpOwoKICAgICAgICAgICAgICAgIGJpbnMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRQcmljZTogY3VycmVudEJvdW5kYXJ5LAogICAgICAgICAgICAgICAgICAgIGVuZFByaWNlOiBuZXh0Qm91bmRhcnksCiAgICAgICAgICAgICAgICAgICAgZGF0YTogYmluRGF0YSwKICAgICAgICAgICAgICAgICAgICB3aWR0aDogd2lkdGgsCiAgICAgICAgICAgICAgICAgICAgc3RhcnRYOiAwLCAvLyDnqI3lvozoqIjnrpcKICAgICAgICAgICAgICAgICAgICBlbmRYOiAwCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjdXJyZW50Qm91bmRhcnkgPSBuZXh0Qm91bmRhcnk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOatpempnyAyOiDoqIjnrpfoppboprrluqfmqJkgKFZpc3VhbCBYKQogICAgICAgICAgICBsZXQgY3VycmVudFZpc1ggPSAwOwogICAgICAgICAgICBjb25zdCB0aWNrTWFwID0ge307IC8vIOiomOmMhCBWaXN1YWwgWCDlsI3mh4nnmoQgUHJpY2UgKOeUqOaWvOagvOe3mi/mqJnnsaQpCgogICAgICAgICAgICBiaW5zLmZvckVhY2goYmluID0+IHsKICAgICAgICAgICAgICAgIGJpbi5zdGFydFggPSBjdXJyZW50VmlzWDsKICAgICAgICAgICAgICAgIGJpbi5lbmRYID0gY3VycmVudFZpc1ggKyBiaW4ud2lkdGg7CgogICAgICAgICAgICAgICAgLy8g6KiY6YyE6YKK55WMIFRpY2sKICAgICAgICAgICAgICAgIC8vIOaIkeWAkeWPqumcgOimgeiomOmMhCBzdGFydFByaWNlIOWwjeaHiSBzdGFydFgKICAgICAgICAgICAgICAgIC8vIOS9hueCuuS6hueyvueiuu+8jOaIkeWAkeWPr+S7peeUqCBNYXA6IHZpc3VhbFggLT4gcHJpY2UKICAgICAgICAgICAgICAgIHRpY2tNYXBbY3VycmVudFZpc1hdID0gYmluLnN0YXJ0UHJpY2U7CgogICAgICAgICAgICAgICAgY3VycmVudFZpc1ggKz0gYmluLndpZHRoOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8g6KOc5pyA5b6M5LiA5YCL57WC6bueCiAgICAgICAgICAgIHRpY2tNYXBbY3VycmVudFZpc1hdID0gYmluc1tiaW5zLmxlbmd0aCAtIDFdLmVuZFByaWNlOwoKICAgICAgICAgICAgLy8g5q2l6amfIDM6IOWIhumFjeizh+aWmem7nueahCBYIOW6p+aomQogICAgICAgICAgICAvLyDlnKggQmluIOWFp+mDqO+8jOizh+aWmem7nuS+neWDueagvOaOkuW6j+W+jOWdh+WLu+WIhuS9iD8g5oiW5piv6Zqo5qmfPwogICAgICAgICAgICAvLyAi6LOH5paZ562G5pW45aSa55qE6ZaT6Led5pyD6K6K5a+sIiAtPiDmhI/lkbPokZfos4fmlpnpu57lsZXplovkuI3ph43nlooKICAgICAgICAgICAgYmlucy5mb3JFYWNoKGJpbiA9PiB7CiAgICAgICAgICAgICAgICBpZiAoYmluLmRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIOWwjSBCaW4g5YWn6LOH5paZ5oyJ5YO55qC85o6S5bqPKOmblueEtuWkp+WkmuW3suiiq+mBjua/vuWZqOaOkumBju+8jOS/nemaqui1t+imiykKICAgICAgICAgICAgICAgICAgICBiaW4uZGF0YS5zb3J0KChhLCBiKSA9PiBhLnByaWNlIC0gYi5wcmljZSk7CgogICAgICAgICAgICAgICAgICAgIGJpbi5kYXRhLmZvckVhY2goKGQsIGkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g57Ch5Zau57ea5oCn5YiG6YWNOiDlnKggc3RhcnRYIH4gZW5kWCDkuYvplpMKICAgICAgICAgICAgICAgICAgICAgICAgLy8g54K65LqG576O6KeA77yM55WZ5LiA6bue6YKK6LedICgwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOiLpSB3aWR0aCA9IGNvdW50LCDliYfmr4/pu57kvZQgMSDllq7kvY0KICAgICAgICAgICAgICAgICAgICAgICAgZC5kaXNwbGF5WCA9IGJpbi5zdGFydFggKyAwLjUgKyAoaSAqICgoYmluLndpZHRoIC0gMSkgLyBNYXRoLm1heCgxLCBiaW4uZGF0YS5sZW5ndGggLSAxKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzlj6rmnInkuIDpu57vvIzlsYXkuK0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJpbi5kYXRhLmxlbmd0aCA9PT0gMSkgZC5kaXNwbGF5WCA9IGJpbi5zdGFydFggKyAoYmluLndpZHRoIC8gMik7CgogICAgICAgICAgICAgICAgICAgICAgICBkLm9yaWdpbmFsUHJpY2UgPSBkLnByaWNlOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIOatpempnyA0OiDlu7rnq4sgQ2hhcnQuanMgRGF0YXNldCB3aXRoIGR5bmFtaWMgcG9pbnQgc2l6ZXMKICAgICAgICAgICAgY29uc3QgZGF0YXNldHMgPSBjb2xvckNhdGVnb3JpZXMubWFwKGNhdCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjYXREYXRhID0gdmFsaWREYXRhLmZpbHRlcihkID0+IGQuY29sb3IgPT09IGNhdCk7CiAgICAgICAgICAgICAgICBjb25zdCBwb2ludFJhZGlpID0gY2F0RGF0YS5tYXAoZCA9PiBjaGFydFNldHRpbmdzLnBvaW50UmFkaXVzICogZC5zaXplTXVsdGlwbGllcik7CiAgICAgICAgICAgICAgICBjb25zdCBob3ZlclJhZGlpID0gY2F0RGF0YS5tYXAoZCA9PiAoY2hhcnRTZXR0aW5ncy5wb2ludFJhZGl1cyArIDMpICogZC5zaXplTXVsdGlwbGllcik7CgogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBsYWJlbDogY2F0LAogICAgICAgICAgICAgICAgICAgIGRhdGE6IGNhdERhdGEubWFwKGQgPT4gKHsKICAgICAgICAgICAgICAgICAgICAgICAgeDogZC5kaXNwbGF5WCwKICAgICAgICAgICAgICAgICAgICAgICAgeTogeUNhdGVnb3JpZXMuaW5kZXhPZihkLnlWYWx1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IGQuaXRlbSwKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxQcmljZTogZC5vcmlnaW5hbFByaWNlLAogICAgICAgICAgICAgICAgICAgICAgICBzaXplTXVsdGlwbGllcjogZC5zaXplTXVsdGlwbGllcgogICAgICAgICAgICAgICAgICAgIH0pKSwKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGNvbG9yTWFwW2NhdF0gKyAnOTknLAogICAgICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiBjb2xvck1hcFtjYXRdLAogICAgICAgICAgICAgICAgICAgIHBvaW50UmFkaXVzOiBwb2ludFJhZGlpLAogICAgICAgICAgICAgICAgICAgIHBvaW50SG92ZXJSYWRpdXM6IGhvdmVyUmFkaWkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYXR0ZXJDaGFydCcpLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhdHRlckNoYXJ0V3JhcHBlcicpOwogICAgICAgICAgICBjb25zdCBmaW5hbEhlaWdodCA9IE1hdGgubWF4KGNoYXJ0U2V0dGluZ3MubWluSGVpZ2h0LCB5Q2F0ZWdvcmllcy5sZW5ndGggKiBjaGFydFNldHRpbmdzLnJvd0hlaWdodCArIDYwKTsKICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5oZWlnaHQgPSBmaW5hbEhlaWdodCArICdweCc7CiAgICAgICAgICAgIHdyYXBwZXIuc3R5bGUubWluSGVpZ2h0ID0gZmluYWxIZWlnaHQgKyAncHgnOwoKICAgICAgICAgICAgaWYgKHNjYXR0ZXJDaGFydCkgc2NhdHRlckNoYXJ0LmRlc3Ryb3koKTsKCiAgICAgICAgICAgIHNjYXR0ZXJDaGFydCA9IG5ldyBDaGFydChjdHgsIHsKICAgICAgICAgICAgICAgIHR5cGU6ICdzY2F0dGVyJywKICAgICAgICAgICAgICAgIGRhdGE6IHsgZGF0YXNldHMgfSwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHBsdWdpbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVnZW5kOiB7IHBvc2l0aW9uOiAndG9wJyB9LAogICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogKGN0eCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gY3R4LnJhdy5pdGVtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmljZSA9IGl0ZW0uUHJpY2UgPyBOdW1iZXIoaXRlbS5QcmljZSkgOiAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbGFiZWwgPSBgJHtpdGVtWydNb2RlbCAjJ119IC0g4oKsJHtwcmljZS50b0ZpeGVkKDIpfWA7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgU2l6ZSBmaWVsZCBpbmZvIGJhc2VkIG9uIHNlbGVjdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2l6ZUZpZWxkID09PSAnQ29tbWVudHMnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21tZW50cyA9IGl0ZW0uQ29tbWVudHMgfHwgMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsICs9IGAgfCAke2NvbW1lbnRzfSByZXZpZXdzYDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzaXplRmllbGQgPT09ICdTY29yZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjb3JlID0gaXRlbS5TY29yZSB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgKz0gc2NvcmUgPiAwID8gYCB8IOKYhSR7c2NvcmUudG9GaXhlZCgxKX1gIDogJyB8IE5vIHJhdGluZyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2l6ZUZpZWxkID09PSAnTW9kZWxDb3VudCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IHlGaWVsZCA9PT0gJ1BsYXRmb3JtJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gYCR7aXRlbVsnTW9kZWwgIyddfXx8JHtpdGVtLlBsYXRmb3JtfWAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGl0ZW1bJ01vZGVsICMnXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gbW9kZWxDb3VudE1hcFtrZXldIHx8IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1bml0ID0geUZpZWxkID09PSAnUGxhdGZvcm0nID8gJ29jY3VycmVuY2UocyknIDogJ3BsYXRmb3JtKHMpJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsICs9IGAgfCAke2NvdW50fSAke3VuaXR9YDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxhYmVsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2NhbGVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsaW5lYXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdib3R0b20nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4OiBjdXJyZW50VmlzWCwgLy8g57i95a+s5bqmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IChjdHgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5p+l6KGo5Y+W5b6X55yf5a+m5YO55qC8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByaWNlID0gdGlja01hcFtjdHgudGljay52YWx1ZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmljZSAhPT0gdW5kZWZpbmVkICYmIHByaWNlICUgMTAwID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3JnYmEoMjU1LCAwLCAwLCAwLjUpJzsgLy8g57SF57eaIOavjzEwMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAncmdiYSgwLCAwLCAwLCAwLjEpJzsgLy8g5YW25LuWIEJpbiDpgornlYzngrrmt6HngbAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVXaWR0aDogKGN0eCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmljZSA9IHRpY2tNYXBbY3R4LnRpY2sudmFsdWVdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJpY2UgIT09IHVuZGVmaW5lZCAmJiBwcmljZSAlIDEwMCA9PT0gMCkgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJpY2UgPSB0aWNrTWFwW3ZhbHVlXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByaWNlID09PSB1bmRlZmluZWQpIHJldHVybiBudWxsOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5qiZ57Gk6aGv56S66YKP6LyvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmljZSA+IDkwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChwcmljZSAlIDUwMCA9PT0gMCkgPyBwcmljZSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXNlciBJbnRlcnZhbCBMb2dpYwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDpm5bnhLYgQmluIOmCiueVjOWwseaYryBJbnRlcnZhbCDnmoTlgI3mlbjvvIzkvYbmiJHlgJHopoHnorrkv53poa/npLoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByaWNlICUgaW50ZXJ2YWwgPT09IDApIHJldHVybiBwcmljZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvU2tpcDogZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlckJ1aWxkVGlja3M6IGZ1bmN0aW9uIChheGlzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5by35Yi2IFRpY2sg5Y+q5ZyoIEJpbiDpgornlYznlJ/miJAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aWNrcyA9IE9iamVjdC5rZXlzKHRpY2tNYXApLm1hcCh2ID0+ICh7IHZhbHVlOiBwYXJzZUZsb2F0KHYpIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBheGlzLnRpY2tzID0gdGlja3M7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB4VG9wOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbGluZWFyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAndG9wJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heDogY3VycmVudFZpc1gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkOiB7IGRpc3BsYXk6IGZhbHNlIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJpY2UgPSB0aWNrTWFwW3ZhbHVlXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByaWNlID09PSB1bmRlZmluZWQpIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJpY2UgPiA5MDApIHJldHVybiAocHJpY2UgJSA1MDAgPT09IDApID8gcHJpY2UgOiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJpY2UgJSBpbnRlcnZhbCA9PT0gMCkgcmV0dXJuIHByaWNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyQnVpbGRUaWNrczogZnVuY3Rpb24gKGF4aXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aWNrcyA9IE9iamVjdC5rZXlzKHRpY2tNYXApLm1hcCh2ID0+ICh7IHZhbHVlOiBwYXJzZUZsb2F0KHYpIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBheGlzLnRpY2tzID0gdGlja3M7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHk6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB7IGRpc3BsYXk6IHRydWUsIHRleHQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2F0dGVyWUF4aXMnKS52YWx1ZSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2xpbmVhcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiAodikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpZHggPSBNYXRoLnJvdW5kKHYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geUNhdGVnb3JpZXNbaWR4XSAhPT0gdW5kZWZpbmVkID8geUNhdGVnb3JpZXNbaWR4XSA6ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b1NraXA6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXBTaXplOiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBjaGFydFNldHRpbmdzLmxhYmVsRm9udFNpemUgfHwgMTIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYXdPbkNoYXJ0QXJlYTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmF3VGlja3M6IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW46IC0wLjUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXg6IHlDYXRlZ29yaWVzLmxlbmd0aCAtIDAuNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyQnVpbGRUaWNrczogZnVuY3Rpb24gKHNjYWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g56K65L+d5q+P5YCL5pW05pW46YO95pyJ5Yi75bqmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGUudGlja3MgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHlDYXRlZ29yaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlLnRpY2tzLnB1c2goeyB2YWx1ZTogaSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IChlLCBlbGVtZW50cykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaWR4ID0gZWxlbWVudHNbMF0uaW5kZXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhc2V0SWR4ID0gZWxlbWVudHNbMF0uZGF0YXNldEluZGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHNjYXR0ZXJDaGFydC5kYXRhLmRhdGFzZXRzW2RhdGFzZXRJZHhdLmRhdGFbaWR4XS5pdGVtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0RldGFpbFBhbmVsKGl0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CgoKICAgICAgICBmdW5jdGlvbiBzaG93RGV0YWlsUGFuZWwoaXRlbSkgewogICAgICAgICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbEJvZHknKTsKICAgICAgICAgICAgY29uc3QgaW1nID0gaXRlbVsnSW1hZ2UgVVJMJ10gfHwgaXRlbS7lnJbniYcgfHwgJyc7CgogICAgICAgICAgICAvLyBEeW5hbWljIGZpZWxkcyBiYXNlZCBvbiBhY3RpdmVDb25maWcKICAgICAgICAgICAgY29uc3QgYmFzZUZpZWxkcyA9IFsKICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdNb2RlbCAjJywgdmFsdWU6IGl0ZW1bJ01vZGVsICMnXSB9LAogICAgICAgICAgICAgICAgeyBsYWJlbDogJ0JyYW5kJywgdmFsdWU6IGl0ZW0uQnJhbmQgfSwKICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdUeXBlJywgdmFsdWU6IGl0ZW0uVHlwZSB9CiAgICAgICAgICAgIF07CgogICAgICAgICAgICAvLyBBZGQgc3BlYy1zcGVjaWZpYyBmaWVsZHMgZnJvbSBhY3RpdmVDb25maWcKICAgICAgICAgICAgbGV0IHNwZWNGaWVsZHMgPSBbXTsKICAgICAgICAgICAgaWYgKGFjdGl2ZUNvbmZpZyAmJiBhY3RpdmVDb25maWcuc3BlY3MpIHsKICAgICAgICAgICAgICAgIHNwZWNGaWVsZHMgPSBhY3RpdmVDb25maWcuc3BlY3MubWFwKHNwZWMgPT4gewogICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IGl0ZW1bc3BlYy5rZXldOwogICAgICAgICAgICAgICAgICAgIC8vIFRyeSBmYWxsYmFjayBrZXkgaWYgcHJpbWFyeSBpcyBlbXB0eQogICAgICAgICAgICAgICAgICAgIGlmICghdmFsdWUgJiYgc3BlYy5mYWxsYmFja19rZXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBpdGVtW3NwZWMuZmFsbGJhY2tfa2V5XTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gQXBwbHkgZm9ybWF0IGlmIHNwZWNpZmllZAogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiBzcGVjLmZvcm1hdCA9PT0gJ2NsZWFuUG93ZXJTdXBwbHknKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gU3RyaW5nKHZhbHVlKS5yZXBsYWNlKC9bXjAtOVZdL2dpLCAnJykudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgV2F0dCBmaWVsZCB3aXRoIGNvcmRsZXNzIHZvbHRhZ2UgKGUuZy4sICJjb3JkbGVzcyAxOFYiKQogICAgICAgICAgICAgICAgICAgIGxldCBza2lwU3VmZml4ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIChzcGVjLmtleSA9PT0gJ1dhdHQnIHx8IHNwZWMua2V5ID09PSAnUG93ZXIgU3VwcGx5JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyVmFsID0gU3RyaW5nKHZhbHVlKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBjb250YWlucyBjb3JkbGVzcyB3aXRoIHZvbHRhZ2UgcGF0dGVybgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RyVmFsLmluY2x1ZGVzKCdjb3JkbGVzcycpIHx8IC9cZCtccyp2XGIvaS50ZXN0KHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlICJjb3JkbGVzcyIgYW5kIGNsZWFuIHVwLCBrZWVwIG9ubHkgdGhlIHZvbHRhZ2UgcGFydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBTdHJpbmcodmFsdWUpLnJlcGxhY2UoL2NvcmRsZXNzXHMqL2dpLCAnJykudHJpbSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHJlc3VsdCBhbHJlYWR5IGhhcyBWLCBkb24ndCBhZGQgVyBzdWZmaXgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgvXGQrXHMqdlxiL2kudGVzdCh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lwU3VmZml4ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBBZGQgc3VmZml4IGlmIHNwZWNpZmllZCAoYW5kIG5vdCBza2lwcGVkKQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiBzcGVjLnN1ZmZpeCAmJiAhc2tpcFN1ZmZpeCAmJiAhU3RyaW5nKHZhbHVlKS5pbmNsdWRlcyhzcGVjLnN1ZmZpeCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSArIHNwZWMuc3VmZml4OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBsYWJlbDogc3BlYy5sYWJlbCB8fCBzcGVjLmtleSwgdmFsdWU6IHZhbHVlIH07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrOiBzaG93IGNvbW1vbiBmaWVsZHMgZm9yIGJvdGggTVRTIGFuZCBUQlMKICAgICAgICAgICAgICAgIHNwZWNGaWVsZHMgPSBbCiAgICAgICAgICAgICAgICAgICAgeyBsYWJlbDogJ0JsYWRlJywgdmFsdWU6IGl0ZW1bJ0JsYWRlIERpYW1ldGVyJ10gfSwKICAgICAgICAgICAgICAgICAgICB7IGxhYmVsOiAnUG93ZXInLCB2YWx1ZTogaXRlbVsnUG93ZXIgU3VwcGx5J10gfHwgaXRlbS5XYXR0IH0sCiAgICAgICAgICAgICAgICAgICAgeyBsYWJlbDogJ01vdG9yJywgdmFsdWU6IGl0ZW1bJ01vdG9yIFR5cGUnXSB9LAogICAgICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdSUE0nLCB2YWx1ZTogaXRlbS5SUE0gfQogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQWRkaXRpb25hbCBjb21tb24gZmllbGRzCiAgICAgICAgICAgIGNvbnN0IGFkZGl0aW9uYWxGaWVsZHMgPSBbCiAgICAgICAgICAgICAgICB7IGxhYmVsOiAnVG90YWwnLCB2YWx1ZTogaXRlbS5Ub3RhbCB9LAogICAgICAgICAgICAgICAgeyBsYWJlbDogJ090aGVycycsIHZhbHVlOiBpdGVtLk90aGVycyB9LAogICAgICAgICAgICAgICAgeyBsYWJlbDogJ1ByaWNlJywgdmFsdWU6IGl0ZW0uUHJpY2UgPyAn4oKsJyArIE51bWJlcihpdGVtLlByaWNlKS50b0ZpeGVkKDIpIDogJy0nIH0sCiAgICAgICAgICAgICAgICB7IGxhYmVsOiAnUHJpY2UgVGFnJywgdmFsdWU6IGl0ZW1bJ1ByaWNlIFRhZyddID8gJ+KCrCcgKyBOdW1iZXIoaXRlbVsnUHJpY2UgVGFnJ10pLnRvRml4ZWQoMCkgOiAnLScgfSwKICAgICAgICAgICAgICAgIHsgbGFiZWw6ICdQbGF0Zm9ybScsIHZhbHVlOiBpdGVtLlBsYXRmb3JtIH0sCiAgICAgICAgICAgICAgICB7IGxhYmVsOiAnQWNjZXNzb3JpZXMnLCB2YWx1ZTogaXRlbS5BY2Nlc3NvcmllcyB9CiAgICAgICAgICAgIF07CgogICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBbLi4uYmFzZUZpZWxkcywgLi4uc3BlY0ZpZWxkcywgLi4uYWRkaXRpb25hbEZpZWxkc107CgogICAgICAgICAgICAvLyBJbmZvIFRhYiBDb250ZW50IChPcmlnaW5hbCBGaWVsZHMpCiAgICAgICAgICAgIGNvbnN0IGluZm9Db250ZW50ID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGV0YWlsLXRhYi1jb250ZW50IHAtNCIgZGF0YS10YWI9IkluZm8iPgogICAgICAgICAgICAgICAgICAgICR7aW1nID8gYDxpbWcgc3JjPSIke2ltZ30iIGNsYXNzPSJkZXRhaWwtaW1hZ2UgbWItNCI+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgdGV4dC1pbmRpZ28tOTAwIG1iLTQiPiR7aXRlbVsnTW9kZWwgIyddIHx8IGl0ZW0u5qmf5Z6LfTwvaDI+CiAgICAgICAgICAgICAgICAgICAgJHtmaWVsZHMubWFwKGYgPT4gYAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkZXRhaWwtcm93IHB5LTIgYm9yZGVyLWIgYm9yZGVyLWdyYXktMTAwIGZsZXgiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGV0YWlsLWxhYmVsIHctMzIgZm9udC1zZW1pYm9sZCB0ZXh0LWdyYXktNTAwIj4ke2YubGFiZWx9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkZXRhaWwtdmFsdWUgZmxleC0xIHRleHQtZ3JheS05MDAiPiR7Zi52YWx1ZSB8fCAnLSd9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIGApLmpvaW4oJycpfQogICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkZXRhaWwtcm93IHB5LTIgYm9yZGVyLWIgYm9yZGVyLWdyYXktMTAwIGZsZXgiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkZXRhaWwtbGFiZWwgdy0zMiBmb250LXNlbWlib2xkIHRleHQtZ3JheS01MDAiPlRvdGFsPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRldGFpbC12YWx1ZSBmbGV4LTEgdGV4dC1ncmF5LTkwMCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmUtbGluZTsiPiR7aXRlbS5Ub3RhbCB8fCAnLSd9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIC8vIERlc2MgVGFiIENvbnRlbnQgKFBsYWNlaG9sZGVyKQogICAgICAgICAgICBjb25zdCBkZXNjQ29udGVudCA9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRldGFpbC10YWItY29udGVudCBoaWRkZW4gcC00IiBkYXRhLXRhYj0iRGVzYyI+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtZ3JheS01MDAgaXRhbGljIHRleHQtY2VudGVyIG10LTgiPk5vIGRlc2NyaXB0aW9uIGF2YWlsYWJsZS48L3A+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIC8vIENoYXJ0IFRhYiBDb250ZW50CiAgICAgICAgICAgIGNvbnN0IGNoYXJ0SWQgPSAnZGV0YWlsSGlzdENoYXJ0JzsKICAgICAgICAgICAgY29uc3QgY2hhcnRDb250ZW50ID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGV0YWlsLXRhYi1jb250ZW50IGhpZGRlbiBwLTQgaC1mdWxsIGZsZXggZmxleC1jb2wiIGRhdGEtdGFiPSJDaGFydCI+CiAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBoLTY0IG10LTQiPgogICAgICAgICAgICAgICAgICAgICAgICA8Y2FudmFzIGlkPSIke2NoYXJ0SWR9Ij48L2NhbnZhcz4KICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIC8vIFVSTCBCdXR0b24KICAgICAgICAgICAgY29uc3QgdXJsQnRuID0gKGl0ZW1bJ1Byb2R1Y3QgVVJMJ10gfHwgaXRlbS7ntrLlnYApID8gYDxhIGhyZWY9IiR7aXRlbVsnUHJvZHVjdCBVUkwnXSB8fCBpdGVtLue2suWdgH0iIHRhcmdldD0iX2JsYW5rIiBjbGFzcz0iYmxvY2sgdy1mdWxsIHB5LTMgYmctYmx1ZS02MDAgaG92ZXI6YmctYmx1ZS03MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBmb250LWJvbGQgdGV4dC1zbSB1cHBlcmNhc2UgdHJhY2tpbmctd2lkZXIgdHJhbnNpdGlvbi1jb2xvcnMiPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leHRlcm5hbC1saW5rLWFsdCBtci0yIj48L2k+UHJvZHVjdCBQYWdlCiAgICAgICAgICAgIDwvYT5gIDogJyc7CgoKICAgICAgICAgICAgYm9keS5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtY29sIGgtZnVsbCI+CiAgICAgICAgICAgICAgICAgICAgPCEtLSBUYWJzIC0tPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggYm9yZGVyLWIgYm9yZGVyLWdyYXktMjAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZmxleC0xIHB5LTMgdGV4dC1zbSBmb250LXNlbWlib2xkIHRleHQtaW5kaWdvLTYwMCBib3JkZXItYi0yIGJvcmRlci1pbmRpZ28tNjAwIGZvY3VzOm91dGxpbmUtbm9uZSBkZXRhaWwtdGFiLWJ0biIgZGF0YS10YXJnZXQ9IkluZm8iPkluZm88L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZmxleC0xIHB5LTMgdGV4dC1zbSBmb250LXNlbWlib2xkIHRleHQtZ3JheS01MDAgaG92ZXI6dGV4dC1ncmF5LTcwMCBmb2N1czpvdXRsaW5lLW5vbmUgZGV0YWlsLXRhYi1idG4iIGRhdGEtdGFyZ2V0PSJEZXNjIj5EZXNjPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImZsZXgtMSBweS0zIHRleHQtc20gZm9udC1zZW1pYm9sZCB0ZXh0LWdyYXktNTAwIGhvdmVyOnRleHQtZ3JheS03MDAgZm9jdXM6b3V0bGluZS1ub25lIGRldGFpbC10YWItYnRuIiBkYXRhLXRhcmdldD0iQ2hhcnQiPkNoYXJ0PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDwhLS0gQ29udGVudCAtLT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LTEgb3ZlcmZsb3cteS1hdXRvIGJnLXdoaXRlIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtpbmZvQ29udGVudH0KICAgICAgICAgICAgICAgICAgICAgICAgJHtkZXNjQ29udGVudH0KICAgICAgICAgICAgICAgICAgICAgICAgJHtjaGFydENvbnRlbnR9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDwhLS0gRm9vdGVyIEFjdGlvbiAtLT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC1hdXRvIGJvcmRlci10IGJvcmRlci1ncmF5LTIwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7dXJsQnRufQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CgogICAgICAgICAgICAvLyBUYWIgU3dpdGNoaW5nIExvZ2ljCiAgICAgICAgICAgIGNvbnN0IHRhYkJ0bnMgPSBib2R5LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZXRhaWwtdGFiLWJ0bicpOwogICAgICAgICAgICBjb25zdCB0YWJDb250ZW50cyA9IGJvZHkucXVlcnlTZWxlY3RvckFsbCgnLmRldGFpbC10YWItY29udGVudCcpOwogICAgICAgICAgICBsZXQgY2hhcnRSZW5kZXJlZCA9IGZhbHNlOwoKICAgICAgICAgICAgdGFiQnRucy5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQKICAgICAgICAgICAgICAgICAgICB0YWJCdG5zLmZvckVhY2goYiA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuY2xhc3NMaXN0LnJlbW92ZSgndGV4dC1pbmRpZ28tNjAwJywgJ2JvcmRlci1iLTInLCAnYm9yZGVyLWluZGlnby02MDAnKTsKICAgICAgICAgICAgICAgICAgICAgICAgYi5jbGFzc0xpc3QuYWRkKCd0ZXh0LWdyYXktNTAwJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGFiQ29udGVudHMuZm9yRWFjaChjID0+IGMuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwoKICAgICAgICAgICAgICAgICAgICAvLyBBY3RpdmF0ZQogICAgICAgICAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCd0ZXh0LWluZGlnby02MDAnLCAnYm9yZGVyLWItMicsICdib3JkZXItaW5kaWdvLTYwMCcpOwogICAgICAgICAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QucmVtb3ZlKCd0ZXh0LWdyYXktNTAwJyk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGJ0bi5kYXRhc2V0LnRhcmdldDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYm9keS5xdWVyeVNlbGVjdG9yKGAuZGV0YWlsLXRhYi1jb250ZW50W2RhdGEtdGFiPSIke3RhcmdldH0iXWApOwogICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50KSBjb250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0ID09PSAnQ2hhcnQnICYmICFjaGFydFJlbmRlcmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlckRldGFpbENoYXJ0KGNoYXJ0SWQsIGl0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICBjaGFydFJlbmRlcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsUGFuZWwnKS5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdmVybGF5JykuY2xhc3NMaXN0LmFkZCgnc2hvdycpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2xvc2VEZXRhaWxQYW5lbCgpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbFBhbmVsJykuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3ZlcmxheScpLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVN0YXRzKCkgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZHVjdENvdW50JykudGV4dENvbnRlbnQgPSBmaWx0ZXJlZERhdGEubGVuZ3RoOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxhdGZvcm1Db3VudCcpLnRleHRDb250ZW50ID0gWy4uLm5ldyBTZXQoZmlsdGVyZWREYXRhLm1hcChkID0+IGQuUGxhdGZvcm0pKV0ubGVuZ3RoOwogICAgICAgIH0KCgogICAgICAgIC8vIHNob3dMb2FkaW5nIGZ1bmN0aW9uIGlzIGRlZmluZWQgZWFybGllciB3aXRoIHByb2dyZXNzIGJhciBzdXBwb3J0CiAgICAgICAgLy8gUERGIOWMr+WHuuWKn+iDvSAtIOS9v+eUqCBodG1sMmNhbnZhcyDmk7flj5blr6bpmpvnlavpnaIKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwb3J0UGRmQnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXhwb3J0VG9QZGYpOwoKICAgICAgICAvLyBUb2dnbGUgUERGIGNvbnRyb2xzIHZpc2liaWxpdHkKICAgICAgICBmdW5jdGlvbiB0b2dnbGVQZGZJbnB1dHMoKSB7CiAgICAgICAgICAgIGNvbnN0IG1vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGRmTW9kZScpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBzcGxpdENvbnRyb2xzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NwbGl0Q29udHJvbHMnKTsKICAgICAgICAgICAgaWYgKHNwbGl0Q29udHJvbHMpIHsKICAgICAgICAgICAgICAgIGlmIChtb2RlID09PSAnc3BsaXQnKSBzcGxpdENvbnRyb2xzLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgZWxzZSBzcGxpdENvbnRyb2xzLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBhc3luYyBmdW5jdGlvbiBleHBvcnRUb1BkZigpIHsKICAgICAgICAgICAgaWYgKGZpbHRlcmVkRGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCdObyBkYXRhIHRvIGV4cG9ydCcpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwb3J0UGRmQnRuJyk7CiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsQnRuVGV4dCA9IGJ0bi5pbm5lckhUTUw7CiAgICAgICAgICAgIGJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4gbXItMSI+PC9pPlByb2Nlc3NpbmcuLi4nOwogICAgICAgICAgICBidG4uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2V4cG9ydGluZy1wZGYnKTsKCiAgICAgICAgICAgIGNvbnN0IG1vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGRmTW9kZScpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBvcmlnaW5hbFpvb20gPSB6b29tTGV2ZWw7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gUmVzZXQgem9vbSBmb3IgYWNjdXJhdGUgbWVhc3VyZW1lbnRzCiAgICAgICAgICAgICAgICBzZXRab29tKDEpOwogICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDEwMCkpOwoKICAgICAgICAgICAgICAgIC8vIDEuIEdldCBBY3R1YWwgRGltZW5zaW9ucyBmcm9tIExJVkUgR3JpZAogICAgICAgICAgICAgICAgLy8gZ3JpZFNjcm9sbEFyZWEuc2Nyb2xsV2lkdGggaW5jbHVkZXMgdGhlIGZ1bGwgb3ZlcmZsb3cgd2lkdGgKICAgICAgICAgICAgICAgIGNvbnN0IGxpdmVTY3JvbGxBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dyaWRTY3JvbGxBcmVhJyk7CiAgICAgICAgICAgICAgICBjb25zdCB0b3RhbFdpZHRoID0gbGl2ZVNjcm9sbEFyZWEuc2Nyb2xsV2lkdGg7CiAgICAgICAgICAgICAgICBjb25zdCB0b3RhbEhlaWdodCA9IGxpdmVTY3JvbGxBcmVhLnNjcm9sbEhlaWdodDsKCiAgICAgICAgICAgICAgICAvLyAyLiBDcmVhdGUgRXhwb3J0IENvbnRhaW5lciBPRkYtU0NSRUVOIChGdWxsIFNpemUpCiAgICAgICAgICAgICAgICBjb25zdCBleHBvcnRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIGV4cG9ydENvbnRhaW5lci5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CiAgICAgICAgICAgICAgICBleHBvcnRDb250YWluZXIuc3R5bGUudG9wID0gJzAnOwogICAgICAgICAgICAgICAgZXhwb3J0Q29udGFpbmVyLnN0eWxlLmxlZnQgPSAnLTk5OTk5cHgnOyAvLyBNb3ZlIG9mZi1zY3JlZW4KICAgICAgICAgICAgICAgIGV4cG9ydENvbnRhaW5lci5zdHlsZS53aWR0aCA9IHRvdGFsV2lkdGggKyAncHgnOyAvLyBFeGFjdCBmdWxsIHdpZHRoCiAgICAgICAgICAgICAgICBleHBvcnRDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gJ2F1dG8nOwogICAgICAgICAgICAgICAgZXhwb3J0Q29udGFpbmVyLnN0eWxlLm92ZXJmbG93ID0gJ3Zpc2libGUnOwogICAgICAgICAgICAgICAgZXhwb3J0Q29udGFpbmVyLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjZmZmZmZmJzsKICAgICAgICAgICAgICAgIGV4cG9ydENvbnRhaW5lci5zdHlsZS56SW5kZXggPSAnLTk5OTknOwoKICAgICAgICAgICAgICAgIGNvbnN0IHN0eWxlcyA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuYm9keSk7CiAgICAgICAgICAgICAgICBleHBvcnRDb250YWluZXIuc3R5bGUuZm9udEZhbWlseSA9IHN0eWxlcy5mb250RmFtaWx5OwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZXhwb3J0Q29udGFpbmVyKTsKCiAgICAgICAgICAgICAgICAvLyAzLiBDbG9uZSBHcmlkCiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3JpZFdyYXBwZXInKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNsb25lID0gc291cmNlLmNsb25lTm9kZSh0cnVlKTsKCiAgICAgICAgICAgICAgICAvLyBIZWxwZXIgdG8gZm9yY2UgZXhwbGljaXQgZGltZW5zaW9ucyBvbiBjbG9uZSBwYXJ0cwogICAgICAgICAgICAgICAgY29uc3QgZm9yY2VTaXplID0gKGVsKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlLndpZHRoID0gdG90YWxXaWR0aCArICdweCc7CiAgICAgICAgICAgICAgICAgICAgZWwuc3R5bGUubWluV2lkdGggPSB0b3RhbFdpZHRoICsgJ3B4JzsKICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS5tYXhXaWR0aCA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS5oZWlnaHQgPSAnYXV0byc7CiAgICAgICAgICAgICAgICAgICAgZWwuc3R5bGUubWF4SGVpZ2h0ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlLm92ZXJmbG93ID0gJ3Zpc2libGUnOyAvLyBSZXZlYWwgYWxsCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIC8vIEhlbHBlciB0byBmb3JjZSBiYWNrZ3JvdW5kIGNvbG9yIChGaXggQmxhY2sgSGVhZGVyIElzc3VlKQogICAgICAgICAgICAgICAgY29uc3QgZm9yY2VTdHlsZSA9IChlbCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICghZWwpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgLy8gUmVjdXJzaXZlIGZ1bmN0aW9uIHRvIGFwcGx5IHN0eWxlcwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFwcGx5ID0gKG5vZGUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGV0ZXJtaW5lIGNvbG9yOiBSZWQgZm9yIGJvdW5kYXJ5IGxhYmVscywgQmxhY2sgZm9yIG90aGVycwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgY29sb3IgPSAnIzAwMDAwMCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmNsYXNzTGlzdCAmJiAobm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ2JvdW5kYXJ5LWxhYmVsJykgfHwgbm9kZS5zdHlsZS5jb2xvciA9PT0gJ3JlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9ICdyZWQnOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBBcHBlbmQgIWltcG9ydGFudCBzdHlsZXMgc2FmZWx5CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTdHlsZSA9IG5vZGUuZ2V0QXR0cmlidXRlKCdzdHlsZScpIHx8ICcnOwogICAgICAgICAgICAgICAgICAgICAgICBub2RlLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBjdXJyZW50U3R5bGUgKyBgOyBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmZmZmICFpbXBvcnRhbnQ7IGNvbG9yOiAke2NvbG9yfSAhaW1wb3J0YW50O2ApOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVjdXJzZQogICAgICAgICAgICAgICAgICAgICAgICBBcnJheS5mcm9tKG5vZGUuY2hpbGRyZW4pLmZvckVhY2goY2hpbGQgPT4gYXBwbHkoY2hpbGQpKTsKICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICBhcHBseShlbCk7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIC8vIEFwcGx5IHRvIGtleSBsYXlvdXQgY29udGFpbmVycwogICAgICAgICAgICAgICAgY2xvbmUuc3R5bGUud2lkdGggPSB0b3RhbFdpZHRoICsgJ3B4JzsKCiAgICAgICAgICAgICAgICBjb25zdCBncmlkTWFpbiA9IGNsb25lLnF1ZXJ5U2VsZWN0b3IoJy5ncmlkLW1haW4nKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNjcm9sbEFyZWEgPSBjbG9uZS5xdWVyeVNlbGVjdG9yKCcjZ3JpZFNjcm9sbEFyZWEnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBjbG9uZS5xdWVyeVNlbGVjdG9yKCcjZ3JpZENvbnRlbnQnKTsKCiAgICAgICAgICAgICAgICAvLyBUYXJnZXQgdGhlIEFDVFVBTCB2aXNpYmxlIGhlYWRlciAoU3RpY2t5IEhlYWRlciBSb3cpCiAgICAgICAgICAgICAgICBjb25zdCBzdGlja3lIZWFkZXIgPSBjbG9uZS5xdWVyeVNlbGVjdG9yKCcuc3RpY2t5LWhlYWRlci1yb3cnKTsKCiAgICAgICAgICAgICAgICAvLyBLZWVwIHRhcmdldHRpbmcgb2xkIG9uZXMganVzdCBpbiBjYXNlL2ZvciBjb21wbGV0ZW5lc3MKICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlckNvbnRhaW5lciA9IGNsb25lLnF1ZXJ5U2VsZWN0b3IoJyNwcmljZUhlYWRlckNvbnRhaW5lcicpOwogICAgICAgICAgICAgICAgY29uc3QgaGVhZGVyUm93ID0gY2xvbmUucXVlcnlTZWxlY3RvcignI3ByaWNlSGVhZGVyUm93Jyk7CiAgICAgICAgICAgICAgICBjb25zdCBwbGF0SGVhZGVyID0gY2xvbmUucXVlcnlTZWxlY3RvcignLnBsYXRmb3JtLWhlYWRlcicpOwoKICAgICAgICAgICAgICAgIGZvcmNlU2l6ZShncmlkTWFpbik7CiAgICAgICAgICAgICAgICBmb3JjZVNpemUoc2Nyb2xsQXJlYSk7CiAgICAgICAgICAgICAgICBmb3JjZVNpemUoY29udGVudCk7CiAgICAgICAgICAgICAgICBmb3JjZVNpemUoc3RpY2t5SGVhZGVyKTsgLy8gTmV3IHRhcmdldAogICAgICAgICAgICAgICAgZm9yY2VTaXplKGhlYWRlckNvbnRhaW5lcik7CiAgICAgICAgICAgICAgICBmb3JjZVNpemUoaGVhZGVyUm93KTsKCiAgICAgICAgICAgICAgICAvLyBGb3JjZSBXaGl0ZSBCYWNrZ3JvdW5kcyAtIEFHR1JFU1NJVkUKICAgICAgICAgICAgICAgIGlmIChzdGlja3lIZWFkZXIpIGZvcmNlU3R5bGUoc3RpY2t5SGVhZGVyKTsgLy8gTmV3IHRhcmdldAogICAgICAgICAgICAgICAgZm9yY2VTdHlsZShoZWFkZXJDb250YWluZXIpOwogICAgICAgICAgICAgICAgZm9yY2VTdHlsZShoZWFkZXJSb3cpOwogICAgICAgICAgICAgICAgaWYgKHBsYXRIZWFkZXIpIGZvcmNlU3R5bGUocGxhdEhlYWRlcik7CgogICAgICAgICAgICAgICAgLy8gQWxzbyBmb3JjZSB0aGUgcGxhdGZvcm0gY29sdW1uIGhlYWRlciBiYWNrZ3JvdW5kCiAgICAgICAgICAgICAgICBjb25zdCBwbGF0Q29sID0gY2xvbmUucXVlcnlTZWxlY3RvcignLnBsYXRmb3JtLWNvbHVtbicpOwogICAgICAgICAgICAgICAgaWYgKHBsYXRDb2wpIHsKICAgICAgICAgICAgICAgICAgICBwbGF0Q29sLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjZmZmZmZmJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGlja3lMZWZ0ID0gcGxhdENvbC5xdWVyeVNlbGVjdG9yKCcuc3RpY2t5LWxlZnQtY29sJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0aWNreUxlZnQpIGZvcmNlU3R5bGUoc3RpY2t5TGVmdCk7CiAgICAgICAgICAgICAgICAgICAgZm9yY2VTdHlsZShwbGF0Q29sKTsgLy8gcmVjdXJzZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIElkZW50aWZ5IFJvd3MKICAgICAgICAgICAgICAgIGNvbnN0IGNsb25lRGF0YVJvd3MgPSBBcnJheS5mcm9tKGNsb25lLnF1ZXJ5U2VsZWN0b3JBbGwoJy5kYXRhLXJvdycpKTsKCiAgICAgICAgICAgICAgICBleHBvcnRDb250YWluZXIuYXBwZW5kQ2hpbGQoY2xvbmUpOwoKICAgICAgICAgICAgICAgIC8vIFdhaXQgZm9yIGxheW91dCBwYWludAogICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDUwMCkpOwoKICAgICAgICAgICAgICAgIGNvbnN0IHsganNQREYgfSA9IHdpbmRvdy5qc3BkZjsKCiAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gJ3NpbmdsZScpIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0gU2luZ2xlIFBhZ2UgTW9kZSAtLS0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhbnZhcyA9IGF3YWl0IGh0bWwyY2FudmFzKGNsb25lLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAxLjUsCiAgICAgICAgICAgICAgICAgICAgICAgIHVzZUNPUlM6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dpbmc6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmZmZmJywKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRvdGFsV2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogZXhwb3J0Q29udGFpbmVyLnNjcm9sbEhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93V2lkdGg6IHRvdGFsV2lkdGggKyAxMDAsIC8vIEVuc3VyZSBodG1sMmNhbnZhcyBzZWVzIGZ1bGwgd2lkdGgKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93SGVpZ2h0OiBleHBvcnRDb250YWluZXIuc2Nyb2xsSGVpZ2h0ICsgMTAwCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBkZiA9IG5ldyBqc1BERih7CiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWVudGF0aW9uOiBjYW52YXMud2lkdGggPiBjYW52YXMuaGVpZ2h0ID8gJ2wnIDogJ3AnLAogICAgICAgICAgICAgICAgICAgICAgICB1bml0OiAncHgnLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFtjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHRdCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcGRmLmFkZEltYWdlKGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL2pwZWcnLCAwLjkpLCAnSlBFRycsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgcGRmLnNhdmUoJ1BUX0xhbmRzY2FwZV9TaW5nbGUucGRmJyk7CgogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0gU3BsaXQgTW9kZSBMb2dpYyAtLS0KICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dzSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxhdGZvcm1zUGVyUGFnZScpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvd3NQZXJQYWdlID0gKHJvd3NJbnB1dCAmJiBwYXJzZUludChyb3dzSW5wdXQudmFsdWUpID4gMCkgPyBwYXJzZUludChyb3dzSW5wdXQudmFsdWUpIDogMzsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxSb3dzID0gY2xvbmVEYXRhUm93cy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGRmID0gbmV3IGpzUERGKHsgb3JpZW50YXRpb246ICdsJywgdW5pdDogJ21tJywgZm9ybWF0OiAnYTQnIH0pOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYWdlV19tbSA9IDI5NzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYWdlSF9tbSA9IDIxMDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXJnaW5fbW0gPSA1OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRXX21tID0gcGFnZVdfbW0gLSAobWFyZ2luX21tICogMik7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxXaWR0aCA9IHBhcnNlSW50KHN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKCctLWNlbGwtd2lkdGgnKSkgfHwgMTQwOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxlZnRIZWFkZXJXaWR0aCA9IHBhcnNlSW50KHN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKCctLXBsYXRmb3JtLWNvbC13aWR0aCcpKSB8fCAxMDA7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHB4VG9NbSA9IDAuMjY0NjsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhdmFpbFB4ID0gY29udGVudFdfbW0gLyBweFRvTW07CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFBcmVhUHggPSBhdmFpbFB4IC0gbGVmdEhlYWRlcldpZHRoOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbHNQZXJQYWdlID0gTWF0aC5mbG9vcihkYXRhQXJlYVB4IC8gY2VsbFdpZHRoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzbGljZVN0ZXBQeCA9IGNvbHNQZXJQYWdlICogY2VsbFdpZHRoOwoKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRvdGFsUm93czsgaSArPSByb3dzUGVyUGFnZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjbG9uZURhdGFSb3dzLmZvckVhY2gocm93ID0+IHJvdy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2h1bmtSb3dzID0gY2xvbmVEYXRhUm93cy5zbGljZShpLCBpICsgcm93c1BlclBhZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICBjaHVua1Jvd3MuZm9yRWFjaChyb3cgPT4gcm93LnN0eWxlLmRpc3BsYXkgPSAnZmxleCcpOwoKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDUwKSk7CgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaHVua0NhbnZhcyA9IGF3YWl0IGh0bWwyY2FudmFzKGNsb25lLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZUNPUlM6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnaW5nOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNmZmZmZmYnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRvdGFsV2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGV4cG9ydENvbnRhaW5lci5zY3JvbGxIZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3dXaWR0aDogdG90YWxXaWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvd0hlaWdodDogZXhwb3J0Q29udGFpbmVyLnNjcm9sbEhlaWdodAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNodW5rVyA9IGNodW5rQ2FudmFzLndpZHRoOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaHVua0ggPSBjaHVua0NhbnZhcy5oZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlRmFjdG9yID0gMjsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlYWxIZWFkZXJXID0gbGVmdEhlYWRlcldpZHRoICogc2NhbGVGYWN0b3I7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlYWxTdGVwVyA9IHNsaWNlU3RlcFB4ICogc2NhbGVGYWN0b3I7CgogICAgICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVudFggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGFydCA9IDE7CgogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY3VycmVudFggPCBjaHVua1cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID4gMCB8fCBwYXJ0ID4gMSkgcGRmLmFkZFBhZ2UoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2xpY2VXID0gcmVhbFN0ZXBXOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRYID09PSAwKSBzbGljZVcgKz0gcmVhbEhlYWRlclc7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRYICsgc2xpY2VXID4gY2h1bmtXKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xpY2VXID0gY2h1bmtXIC0gY3VycmVudFg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNsaWNlVyA8IDEwKSBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzQ2FudmFzLndpZHRoID0gc2xpY2VXOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc0NhbnZhcy5oZWlnaHQgPSBjaHVua0g7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdHggPSBzQ2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGNodW5rQ2FudmFzLCBjdXJyZW50WCwgMCwgc2xpY2VXLCBjaHVua0gsIDAsIDAsIHNsaWNlVywgY2h1bmtIKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzRGF0YSA9IHNDYW52YXMudG9EYXRhVVJMKCdpbWFnZS9qcGVnJywgMC45NSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGRmVyA9IChzbGljZVcgLyBzY2FsZUZhY3RvcikgKiBweFRvTW07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwZGZIID0gKGNodW5rSCAvIHNjYWxlRmFjdG9yKSAqIHB4VG9NbTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGYuYWRkSW1hZ2Uoc0RhdGEsICdKUEVHJywgbWFyZ2luX21tLCBtYXJnaW5fbW0sIHBkZlcsIHBkZkgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZi5zZXRGb250U2l6ZSg4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZi5zZXRUZXh0Q29sb3IoMTAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvd1N0YXJ0ID0gaSArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dFbmQgPSBNYXRoLm1pbihpICsgcm93c1BlclBhZ2UsIHRvdGFsUm93cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGYudGV4dChgUiR7cm93U3RhcnR9LSR7cm93RW5kfS5TJHtwYXJ0fWAsIHBhZ2VXX21tIC0gMTAsIHBhZ2VIX21tIC0gNSwgeyBhbGlnbjogJ3JpZ2h0JyB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50WCArPSBzbGljZVc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0Kys7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnQgPiA1MCkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHBkZi5zYXZlKCdQVF9MYW5kc2NhcGVfU3BsaXQucGRmJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignUERGIGV4cG9ydCBlcnJvcjonLCBlcnJvcik7CiAgICAgICAgICAgICAgICBhbGVydCgnUERGIGV4cG9ydCBmYWlsZWQ6ICcgKyBlcnJvci5tZXNzYWdlKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnZXhwb3J0aW5nLXBkZicpOwogICAgICAgICAgICAgICAgYnRuLmlubmVySFRNTCA9IG9yaWdpbmFsQnRuVGV4dDsKICAgICAgICAgICAgICAgIGJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGV4cG9ydENvbnRhaW5lciAmJiBleHBvcnRDb250YWluZXIucGFyZW50Tm9kZSkgewogICAgICAgICAgICAgICAgICAgIGV4cG9ydENvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGV4cG9ydENvbnRhaW5lcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXRab29tKG9yaWdpbmFsWm9vbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgICAgICAgUGl2b3QgQW5hbHlzaXMgRnVuY3Rpb25zCiAgICAgICAgICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCiAgICAgICAgbGV0IHBpdm90Q29sdW1uQ291bnRlciA9IDA7CgogICAgICAgIC8vIOWIneWni+WMluaonue0kOWIhuaekOaOp+WItumghQogICAgICAgIGZ1bmN0aW9uIGluaXRQaXZvdENvbnRyb2xzKCkgewogICAgICAgICAgICAvLyBHZXQgYWxsIGF2YWlsYWJsZSBjb2x1bW5zIGZyb20gbWVyZ2VkRGF0YQogICAgICAgICAgICBsZXQgY29sdW1ucyA9IFtdOwogICAgICAgICAgICBpZiAobWVyZ2VkRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBjb2x1bW5zID0gT2JqZWN0LmtleXMobWVyZ2VkRGF0YVswXSkuc29ydCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29sdW1ucyA9IEZJTFRFUl9GSUVMRFMubWFwKGYgPT4gZi5rZXkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCByb3dTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGl2b3RSb3dTZWxlY3QnKTsKICAgICAgICAgICAgY29uc3QgY29sU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bpdm90Q29sU2VsZWN0Jyk7CgogICAgICAgICAgICAvLyBQb3B1bGF0ZSBib3RoIGRyb3Bkb3ducwogICAgICAgICAgICBbcm93U2VsZWN0LCBjb2xTZWxlY3RdLmZvckVhY2goc2VsZWN0ID0+IHsKICAgICAgICAgICAgICAgIGlmICghc2VsZWN0KSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50VmFsID0gc2VsZWN0LnZhbHVlOwogICAgICAgICAgICAgICAgc2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPlNlbGVjdCBmaWVsZC4uLjwvb3B0aW9uPic7CiAgICAgICAgICAgICAgICBjb2x1bW5zLmZvckVhY2goY29sID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsKICAgICAgICAgICAgICAgICAgICBvcHQudmFsdWUgPSBjb2w7CiAgICAgICAgICAgICAgICAgICAgb3B0LnRleHRDb250ZW50ID0gY29sOwogICAgICAgICAgICAgICAgICAgIHNlbGVjdC5hcHBlbmRDaGlsZChvcHQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFZhbCAmJiBjb2x1bW5zLmluY2x1ZGVzKGN1cnJlbnRWYWwpKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0LnZhbHVlID0gY3VycmVudFZhbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBCaW5kIGNoYW5nZSBldmVudHMKICAgICAgICAgICAgaWYgKHJvd1NlbGVjdCkgcm93U2VsZWN0Lm9uY2hhbmdlID0gdXBkYXRlUGl2b3RUYWJsZTsKICAgICAgICAgICAgaWYgKGNvbFNlbGVjdCkgY29sU2VsZWN0Lm9uY2hhbmdlID0gdXBkYXRlUGl2b3RUYWJsZTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVBpdm90VGFibGUoKSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50VmlldyAhPT0gJ3Bpdm90JykgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3Qgcm93U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bpdm90Um93U2VsZWN0Jyk7CiAgICAgICAgICAgIGNvbnN0IGNvbFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwaXZvdENvbFNlbGVjdCcpOwogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGl2b3RUYWJsZUNvbnRhaW5lcicpOwoKICAgICAgICAgICAgaWYgKCFyb3dTZWxlY3QgfHwgIWNvbFNlbGVjdCB8fCAhY29udGFpbmVyKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCByb3dGaWVsZCA9IHJvd1NlbGVjdC52YWx1ZTsKICAgICAgICAgICAgY29uc3QgY29sRmllbGQgPSBjb2xTZWxlY3QudmFsdWU7CgogICAgICAgICAgICBpZiAoIXJvd0ZpZWxkIHx8ICFjb2xGaWVsZCkgewogICAgICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1ncmF5LTUwMCI+U2VsZWN0IFJvdyBhbmQgQ29sdW1uIGZpZWxkcyB0byBnZW5lcmF0ZSBtYXRyaXggdGFibGU8L3A+JzsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVXNlIGZpbHRlcmVkIGRhdGEgaWYgYXZhaWxhYmxlCiAgICAgICAgICAgIGNvbnN0IGRhdGFUb1VzZSA9IGZpbHRlcmVkRGF0YS5sZW5ndGggPiAwID8gZmlsdGVyZWREYXRhIDogbWVyZ2VkRGF0YTsKCiAgICAgICAgICAgIC8vIEhlbHBlciB0byBnZXQgdW5pcXVlIHNvcnRlZCB2YWx1ZXMKICAgICAgICAgICAgY29uc3QgZ2V0U29ydGVkVW5pcXVlID0gKGZpZWxkKSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgdmFsdWVzID0gWy4uLm5ldyBTZXQoZGF0YVRvVXNlLm1hcChkID0+IGRbZmllbGRdKSldLmZpbHRlcih2ID0+IHYgIT09IG51bGwgJiYgdiAhPT0gdW5kZWZpbmVkICYmIHYgIT09ICcnKTsKICAgICAgICAgICAgICAgIC8vIEFwcGx5IGN1c3RvbSBzb3J0IG9yZGVyIGZvciBQbGF0Zm9ybS9CcmFuZCwgZWxzZSBBLVogKHdpdGggbnVtZXJpYyBhd2FyZW5lc3MpCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGdldEN1c3RvbVNvcnRlZFZhbHVlcyA9PT0gJ2Z1bmN0aW9uJyAmJgogICAgICAgICAgICAgICAgICAgIChmaWVsZC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdwbGF0Zm9ybScpIHx8IGZpZWxkLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2JyYW5kJykpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gZ2V0Q3VzdG9tU29ydGVkVmFsdWVzKHZhbHVlcywgZmllbGQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMuc29ydCgoYSwgYikgPT4gU3RyaW5nKGEpLmxvY2FsZUNvbXBhcmUoU3RyaW5nKGIpLCB1bmRlZmluZWQsIHsgbnVtZXJpYzogdHJ1ZSwgc2Vuc2l0aXZpdHk6ICdiYXNlJyB9KSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVzOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3Qgcm93VmFsdWVzID0gZ2V0U29ydGVkVW5pcXVlKHJvd0ZpZWxkKTsKICAgICAgICAgICAgY29uc3QgY29sVmFsdWVzID0gZ2V0U29ydGVkVW5pcXVlKGNvbEZpZWxkKTsKCiAgICAgICAgICAgIC8vIEJ1aWxkIGNyb3NzLXRhYnVsYXRpb24gbWF0cml4CiAgICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IHt9OwogICAgICAgICAgICBjb25zdCByb3dUb3RhbHMgPSB7fTsKICAgICAgICAgICAgY29uc3QgY29sVG90YWxzID0ge307CiAgICAgICAgICAgIGxldCBncmFuZFRvdGFsID0gMDsKCiAgICAgICAgICAgIHJvd1ZhbHVlcy5mb3JFYWNoKHIgPT4gewogICAgICAgICAgICAgICAgbWF0cml4W3JdID0ge307CiAgICAgICAgICAgICAgICByb3dUb3RhbHNbcl0gPSAwOwogICAgICAgICAgICAgICAgY29sVmFsdWVzLmZvckVhY2goYyA9PiB7CiAgICAgICAgICAgICAgICAgICAgbWF0cml4W3JdW2NdID0gMDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29sVmFsdWVzLmZvckVhY2goYyA9PiB7CiAgICAgICAgICAgICAgICBjb2xUb3RhbHNbY10gPSAwOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIENvdW50CiAgICAgICAgICAgIGRhdGFUb1VzZS5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgICAgICAgICAgY29uc3QgciA9IGl0ZW1bcm93RmllbGRdOwogICAgICAgICAgICAgICAgY29uc3QgYyA9IGl0ZW1bY29sRmllbGRdOwogICAgICAgICAgICAgICAgaWYgKHIgIT0gbnVsbCAmJiBjICE9IG51bGwgJiYgbWF0cml4W3JdICYmIG1hdHJpeFtyXVtjXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgbWF0cml4W3JdW2NdKys7CiAgICAgICAgICAgICAgICAgICAgcm93VG90YWxzW3JdKys7CiAgICAgICAgICAgICAgICAgICAgY29sVG90YWxzW2NdKys7CiAgICAgICAgICAgICAgICAgICAgZ3JhbmRUb3RhbCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIEdldCBDb21wYXJlIE1vZGUgYW5kIERhdGEgc2V0dGluZ3MKICAgICAgICAgICAgY29uc3QgY29tcGFyZU1vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF0cml4Q29tcGFyZU1vZGUnKT8udmFsdWUgfHwgJ3Jvdyc7CiAgICAgICAgICAgIGNvbnN0IGNvbXBhcmVEYXRhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hdHJpeENvbXBhcmVEYXRhJyk/LnZhbHVlIHx8ICdjb3VudCc7CgogICAgICAgICAgICAvLyBSZS1jYWxjdWxhdGUgbWF0cml4IGJhc2VkIG9uIENvbXBhcmUgRGF0YSBzZXR0aW5nCiAgICAgICAgICAgIGlmIChjb21wYXJlRGF0YSAhPT0gJ2NvdW50JykgewogICAgICAgICAgICAgICAgLy8gUmVzZXQgbWF0cml4IGZvciBuZXcgYWdncmVnYXRpb24KICAgICAgICAgICAgICAgIHJvd1ZhbHVlcy5mb3JFYWNoKHIgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbFZhbHVlcy5mb3JFYWNoKGMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBtYXRyaXhbcl1bY10gPSAwOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHJvd1RvdGFsc1tyXSA9IDA7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGNvbFZhbHVlcy5mb3JFYWNoKGMgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbFRvdGFsc1tjXSA9IDA7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGdyYW5kVG90YWwgPSAwOwoKICAgICAgICAgICAgICAgIC8vIEhlbHBlcnMgZm9yIGFnZ3JlZ2F0aW9uCiAgICAgICAgICAgICAgICBjb25zdCBjZWxsRGF0YSA9IHt9OyAvLyBjZWxsRGF0YVtyXVtjXSA9IGFycmF5IG9mIGl0ZW1zCiAgICAgICAgICAgICAgICByb3dWYWx1ZXMuZm9yRWFjaChyID0+IHsKICAgICAgICAgICAgICAgICAgICBjZWxsRGF0YVtyXSA9IHt9OwogICAgICAgICAgICAgICAgICAgIGNvbFZhbHVlcy5mb3JFYWNoKGMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjZWxsRGF0YVtyXVtjXSA9IFtdOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgLy8gQ29sbGVjdCBpdGVtcyBwZXIgY2VsbAogICAgICAgICAgICAgICAgZGF0YVRvVXNlLmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IGl0ZW1bcm93RmllbGRdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBpdGVtW2NvbEZpZWxkXTsKICAgICAgICAgICAgICAgICAgICBpZiAociAhPSBudWxsICYmIGMgIT0gbnVsbCAmJiBjZWxsRGF0YVtyXSAmJiBjZWxsRGF0YVtyXVtjXSkgewogICAgICAgICAgICAgICAgICAgICAgICBjZWxsRGF0YVtyXVtjXS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIEFnZ3JlZ2F0ZSBiYXNlZCBvbiBjb21wYXJlRGF0YQogICAgICAgICAgICAgICAgcm93VmFsdWVzLmZvckVhY2gociA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29sVmFsdWVzLmZvckVhY2goYyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gY2VsbERhdGFbcl1bY107CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IDA7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29tcGFyZURhdGEgPT09ICdjb21tZW50cycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN1bSBvZiBDb21tZW50cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBpdGVtcy5yZWR1Y2UoKHN1bSwgaXRlbSkgPT4gc3VtICsgKGl0ZW0uQ29tbWVudHMgfHwgMCksIDApOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXBhcmVEYXRhID09PSAnc2NvcmUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBdmVyYWdlIG9mIFNjb3JlIChpZ25vcmUgaXRlbXMgd2l0aCBzY29yZSAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsaWRTY29yZXMgPSBpdGVtcy5maWx0ZXIoaXRlbSA9PiBpdGVtLlNjb3JlID4gMCkubWFwKGl0ZW0gPT4gaXRlbS5TY29yZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbGlkU2NvcmVzLmxlbmd0aCA+IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHZhbGlkU2NvcmVzLnJlZHVjZSgoc3VtLCBzKSA9PiBzdW0gKyBzLCAwKSAvIHZhbGlkU2NvcmVzLmxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wYXJlRGF0YSA9PT0gJ21vZGVsQ291bnQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3VudCB1bmlxdWUgTW9kZWwjCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2RlbHMgPSBuZXcgU2V0KGl0ZW1zLm1hcChpdGVtID0+IGl0ZW1bJ01vZGVsICMnXSkuZmlsdGVyKG0gPT4gbSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBtb2RlbHMuc2l6ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wYXJlRGF0YSA9PT0gJ2NvbXBldGl0aW9uJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29tcGV0aXRpb24gSW5kZXggPSBUb3RhbCBDb21tZW50cyAvIFRvdGFsIENvdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXByZXNlbnRzICJBdmVyYWdlIENvbW1lbnRzIHBlciBMaXN0aW5nIiAoUmVkIE9jZWFuIEluZGV4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxDb21tZW50cyA9IGl0ZW1zLnJlZHVjZSgoc3VtLCBpdGVtKSA9PiBzdW0gKyAoaXRlbS5Db21tZW50cyB8fCAwKSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGl0ZW1zLmxlbmd0aCA+IDAgPyB0b3RhbENvbW1lbnRzIC8gaXRlbXMubGVuZ3RoIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgbWF0cml4W3JdW2NdID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBDb21wZXRpdGlvbiBJbmRleCwgdG90YWxzIGFyZSBhbHNvIGF2ZXJhZ2VzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhvd2V2ZXIsIHNpbXBsZSBzdW0gb2YgYXZlcmFnZXMgaXMgd3JvbmcgZm9yIHRvdGFscy4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWRlYWxseSB3ZSBzaG91bGQgcmVjYWxjdWxhdGUgdG90YWxzIGZyb20gc2NyYXRjaCwgYnV0IGZvciBzaW1wbGljaXR5IGluIHRoaXMgc3RydWN0dXJlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlJ2xsIHN1bSB0aGVtIGZvciBub3cgKGxpa2Ugc2NvcmUpLCBidXQgTk9URTogQXZlcmFnZSBvZiBBdmVyYWdlcyBpcyBhcHByb3hpbWF0aW9uLgogICAgICAgICAgICAgICAgICAgICAgICAvLyBBIGJldHRlciBhcHByb2FjaCBmb3Igc3BlY2lmaWMgbWV0cmljcyB3b3VsZCBiZSBzaWduaWZpY2FudCByZWZhY3Rvci4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2l2ZW4gdXNlciByZXF1ZXN0ICJDb21tZW50L2NvdW50IiwgbGV0J3MgdHJlYXQgY2VsbCB2YWx1ZSBhcyB0aGUgbWV0cmljLgogICAgICAgICAgICAgICAgICAgICAgICByb3dUb3RhbHNbcl0gKz0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbFRvdGFsc1tjXSArPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgZ3JhbmRUb3RhbCArPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGaXggVG90YWxzIGZvciBBdmVyYWdlLWJhc2VkIG1ldHJpY3MgKFNjb3JlLCBDb21wZXRpdGlvbikKICAgICAgICAgICAgLy8gSWYgd2UganVzdCBzdW0gYXZlcmFnZXMsIHRoZSAiVG90YWwiIGNvbHVtbiBiZWNvbWVzIG1lYW5pbmdsZXNzIChlLmcuIDQuNSArIDQuMiA9IDguNyBzY29yZSkuCiAgICAgICAgICAgIC8vIEl0IHNob3VsZCBiZSB0aGUgYXZlcmFnZSBvZiB0aGUgd2hvbGUgcm93L2NvbC4KICAgICAgICAgICAgLy8gTGV0J3MgcGVyZm9ybSBhIHBvc3QtY29ycmVjdGlvbiBmb3IgU2NvcmUgYW5kIENvbXBldGl0aW9uIHRvdGFscyBpZiBuZWVkZWQuCiAgICAgICAgICAgIGlmIChjb21wYXJlRGF0YSA9PT0gJ3Njb3JlJyB8fCBjb21wYXJlRGF0YSA9PT0gJ2NvbXBldGl0aW9uJykgewogICAgICAgICAgICAgICAgLy8gUmUtY2FsY3VsYXRlIHRvdGFscyBmcm9tIHJhdyBkYXRhCiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGV4cGVuc2l2ZSBidXQgbmVjZXNzYXJ5IGZvciBjb3JyZWN0bmVzcwogICAgICAgICAgICAgICAgY29uc3QgY2FsY01ldHJpYyA9IChpdGVtcykgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGggPT09IDApIHJldHVybiAwOwogICAgICAgICAgICAgICAgICAgIGlmIChjb21wYXJlRGF0YSA9PT0gJ3Njb3JlJykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWxpZCA9IGl0ZW1zLmZpbHRlcihpID0+IGkuU2NvcmUgPiAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkLmxlbmd0aCA/IHZhbGlkLnJlZHVjZSgocywgaSkgPT4gcyArIGkuU2NvcmUsIDApIC8gdmFsaWQubGVuZ3RoIDogMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBhcmVEYXRhID09PSAnY29tcGV0aXRpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtcy5yZWR1Y2UoKHMsIGkpID0+IHMgKyAoaS5Db21tZW50cyB8fCAwKSwgMCkgLyBpdGVtcy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAvLyBIZWxwZXIgdG8gY29sbGVjdCBpdGVtcyBmb3IgYSByb3cvY29sCiAgICAgICAgICAgICAgICBjb25zdCBnZXRSb3dJdGVtcyA9IChyKSA9PiBjb2xWYWx1ZXMuZmxhdE1hcChjID0+IChjZWxsRGF0YSAmJiBjZWxsRGF0YVtyXSAmJiBjZWxsRGF0YVtyXVtjXSkgPyBjZWxsRGF0YVtyXVtjXSA6IFtdKTsKICAgICAgICAgICAgICAgIGNvbnN0IGdldENvbEl0ZW1zID0gKGMpID0+IHJvd1ZhbHVlcy5mbGF0TWFwKHIgPT4gKGNlbGxEYXRhICYmIGNlbGxEYXRhW3JdICYmIGNlbGxEYXRhW3JdW2NdKSA/IGNlbGxEYXRhW3JdW2NdIDogW10pOwogICAgICAgICAgICAgICAgY29uc3QgZ2V0QWxsSXRlbXMgPSAoKSA9PiByb3dWYWx1ZXMuZmxhdE1hcChyID0+IGdldFJvd0l0ZW1zKHIpKTsKCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNlbGxEYXRhICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgICAgIHJvd1ZhbHVlcy5mb3JFYWNoKHIgPT4gcm93VG90YWxzW3JdID0gY2FsY01ldHJpYyhnZXRSb3dJdGVtcyhyKSkpOwogICAgICAgICAgICAgICAgICAgIGNvbFZhbHVlcy5mb3JFYWNoKGMgPT4gY29sVG90YWxzW2NdID0gY2FsY01ldHJpYyhnZXRDb2xJdGVtcyhjKSkpOwogICAgICAgICAgICAgICAgICAgIGdyYW5kVG90YWwgPSBjYWxjTWV0cmljKGdldEFsbEl0ZW1zKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBQcmUtY2FsY3VsYXRlIG1pbi9tYXggZm9yIGhlYXRtYXAgYmFzZWQgb24gQ29tcGFyZSBNb2RlCiAgICAgICAgICAgIGxldCBnbG9iYWxNaW4gPSBJbmZpbml0eSwgZ2xvYmFsTWF4ID0gLUluZmluaXR5OwogICAgICAgICAgICBjb25zdCBjb2xNaW5NYXggPSB7fTsgLy8gY29sTWluTWF4W2NdID0ge21pbiwgbWF4fQoKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGdsb2JhbCBtaW4vbWF4CiAgICAgICAgICAgIHJvd1ZhbHVlcy5mb3JFYWNoKHIgPT4gewogICAgICAgICAgICAgICAgY29sVmFsdWVzLmZvckVhY2goYyA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gbWF0cml4W3JdW2NdIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCA8IGdsb2JhbE1pbikgZ2xvYmFsTWluID0gdmFsOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWwgPiBnbG9iYWxNYXgpIGdsb2JhbE1heCA9IHZhbDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGdsb2JhbE1pbiA9PT0gSW5maW5pdHkpIGdsb2JhbE1pbiA9IDA7CiAgICAgICAgICAgIGlmIChnbG9iYWxNYXggPT09IC1JbmZpbml0eSkgZ2xvYmFsTWF4ID0gMDsKCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBjb2x1bW4gbWluL21heAogICAgICAgICAgICBjb2xWYWx1ZXMuZm9yRWFjaChjID0+IHsKICAgICAgICAgICAgICAgIGxldCBjTWluID0gSW5maW5pdHksIGNNYXggPSAtSW5maW5pdHk7CiAgICAgICAgICAgICAgICByb3dWYWx1ZXMuZm9yRWFjaChyID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWwgPSBtYXRyaXhbcl1bY10gfHwgMDsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsIDwgY01pbikgY01pbiA9IHZhbDsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsID4gY01heCkgY01heCA9IHZhbDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY29sTWluTWF4W2NdID0geyBtaW46IGNNaW4gPT09IEluZmluaXR5ID8gMCA6IGNNaW4sIG1heDogY01heCA9PT0gLUluZmluaXR5ID8gMCA6IGNNYXggfTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBHZW5lcmF0ZSBIVE1MCiAgICAgICAgICAgIGxldCBodG1sID0gJzxkaXYgY2xhc3M9Im92ZXJmbG93LXgtYXV0byI+PHRhYmxlIGNsYXNzPSJtaW4tdy1mdWxsIGJvcmRlci1jb2xsYXBzZSBib3JkZXIgYm9yZGVyLWdyYXktMzAwIHRleHQtc20iPic7CgogICAgICAgICAgICAvLyBIZWFkZXIgcm93CiAgICAgICAgICAgIGh0bWwgKz0gJzx0aGVhZD48dHIgY2xhc3M9ImJnLWdyYXktMTAwIj4nOwogICAgICAgICAgICBodG1sICs9IGA8dGggY2xhc3M9ImJvcmRlciBib3JkZXItZ3JheS0zMDAgcHgtMyBweS0yIHRleHQtbGVmdCBmb250LWJvbGQgc3RpY2t5IGxlZnQtMCBiZy1ncmF5LTEwMCB6LTEwIj48L3RoPmA7CiAgICAgICAgICAgIGNvbFZhbHVlcy5mb3JFYWNoKGMgPT4gewogICAgICAgICAgICAgICAgaHRtbCArPSBgPHRoIGNsYXNzPSJib3JkZXIgYm9yZGVyLWdyYXktMzAwIHB4LTMgcHktMiB0ZXh0LWNlbnRlciBmb250LW1lZGl1bSI+JHtjfTwvdGg+YDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGh0bWwgKz0gJzx0aCBjbGFzcz0iYm9yZGVyIGJvcmRlci1ncmF5LTMwMCBweC0zIHB5LTIgdGV4dC1jZW50ZXIgZm9udC1ib2xkIGJnLWJsdWUtMTAwIj5Ub3RhbDwvdGg+JzsKICAgICAgICAgICAgaHRtbCArPSAnPC90cj48L3RoZWFkPic7CgogICAgICAgICAgICAvLyBGb3JtYXQgdmFsdWUgZm9yIGRpc3BsYXkKICAgICAgICAgICAgY29uc3QgZm9ybWF0VmFsdWUgPSAodmFsKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoY29tcGFyZURhdGEgPT09ICdzY29yZScpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsID4gMCA/IHZhbC50b0ZpeGVkKDIpIDogJzAnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNvbXBhcmVEYXRhID09PSAnY29tcGV0aXRpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyAxIGRlY2ltYWwgcGxhY2UgZm9yIFJlZCBPY2VhbiBJbmRleAogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWwgPiAwID8gdmFsLnRvRml4ZWQoMSkgOiAnMCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh2YWwpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gQm9keSByb3dzCiAgICAgICAgICAgIGh0bWwgKz0gJzx0Ym9keT4nOwogICAgICAgICAgICByb3dWYWx1ZXMuZm9yRWFjaChyID0+IHsKICAgICAgICAgICAgICAgIGh0bWwgKz0gJzx0cj4nOwogICAgICAgICAgICAgICAgaHRtbCArPSBgPHRkIGNsYXNzPSJib3JkZXIgYm9yZGVyLWdyYXktMzAwIHB4LTMgcHktMiBmb250LW1lZGl1bSBiZy1ncmF5LTUwIHN0aWNreSBsZWZ0LTAiPiR7cn08L3RkPmA7CgogICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIFJvdyBNaW4vTWF4IGZvciBIZWF0bWFwIChyb3cgbW9kZSkKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDb3VudHMgPSBjb2xWYWx1ZXMubWFwKGMgPT4gbWF0cml4W3JdW2NdIHx8IDApOwogICAgICAgICAgICAgICAgY29uc3Qgcm93TWF4ID0gTWF0aC5tYXgoLi4uY3VycmVudENvdW50cyk7CiAgICAgICAgICAgICAgICBjb25zdCByb3dNaW4gPSBNYXRoLm1pbiguLi5jdXJyZW50Q291bnRzKTsKCiAgICAgICAgICAgICAgICBjb2xWYWx1ZXMuZm9yRWFjaChjID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG1hdHJpeFtyXVtjXTsKICAgICAgICAgICAgICAgICAgICBsZXQgY2VsbFN0eWxlID0gJyc7CiAgICAgICAgICAgICAgICAgICAgbGV0IGNlbGxDbGFzcyA9ICd0ZXh0LWdyYXktMzAwJzsgLy8gRGVmYXVsdCBlbXB0eS96ZXJvIHN0eWxlCgogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGludGVuc2l0eSBiYXNlZCBvbiBDb21wYXJlIE1vZGUKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJhdGlvID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1pblZhbCwgbWF4VmFsOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBhcmVNb2RlID09PSAncm93JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluVmFsID0gcm93TWluOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4VmFsID0gcm93TWF4OwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXBhcmVNb2RlID09PSAnY29sdW1uJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluVmFsID0gY29sTWluTWF4W2NdLm1pbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFZhbCA9IGNvbE1pbk1heFtjXS5tYXg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIGdsb2JhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluVmFsID0gZ2xvYmFsTWluOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4VmFsID0gZ2xvYmFsTWF4OwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5nZSA9IG1heFZhbCAtIG1pblZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJhbmdlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXRpbyA9IDE7IC8vIEFsbCBzYW1lIG5vbi16ZXJvIHZhbHVlcwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0aW8gPSAodmFsdWUgLSBtaW5WYWwpIC8gcmFuZ2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFscGhhID0gMC4xICsgKDAuOCAqIHJhdGlvKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dENvbG9yID0gYWxwaGEgPiAwLjUgPyAndGV4dC13aGl0ZScgOiAndGV4dC1ncmF5LTkwMCc7CgogICAgICAgICAgICAgICAgICAgICAgICBjZWxsU3R5bGUgPSBgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6IHJnYmEoMTYsIDE4NSwgMTI5LCAke2FscGhhfSk7ImA7CiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxDbGFzcyA9IHRleHRDb2xvcjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gYDx0ZCBjbGFzcz0iYm9yZGVyIGJvcmRlci1ncmF5LTMwMCBweC0zIHB5LTIgdGV4dC1jZW50ZXIgJHtjZWxsQ2xhc3N9IiAke2NlbGxTdHlsZX0+JHtmb3JtYXRWYWx1ZSh2YWx1ZSl9PC90ZD5gOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBodG1sICs9IGA8dGQgY2xhc3M9ImJvcmRlciBib3JkZXItZ3JheS0zMDAgcHgtMyBweS0yIHRleHQtY2VudGVyIGZvbnQtc2VtaWJvbGQgYmctYmx1ZS01MCI+JHtmb3JtYXRWYWx1ZShyb3dUb3RhbHNbcl0pfTwvdGQ+YDsKICAgICAgICAgICAgICAgIGh0bWwgKz0gJzwvdHI+JzsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBGb290ZXIgcm93IChjb2x1bW4gdG90YWxzKQogICAgICAgICAgICBodG1sICs9ICc8dHIgY2xhc3M9ImJnLWJsdWUtMTAwIGZvbnQtYm9sZCI+JzsKICAgICAgICAgICAgaHRtbCArPSAnPHRkIGNsYXNzPSJib3JkZXIgYm9yZGVyLWdyYXktMzAwIHB4LTMgcHktMiBzdGlja3kgbGVmdC0wIGJnLWJsdWUtMTAwIj5Ub3RhbDwvdGQ+JzsKICAgICAgICAgICAgY29sVmFsdWVzLmZvckVhY2goYyA9PiB7CiAgICAgICAgICAgICAgICBodG1sICs9IGA8dGQgY2xhc3M9ImJvcmRlciBib3JkZXItZ3JheS0zMDAgcHgtMyBweS0yIHRleHQtY2VudGVyIj4ke2Zvcm1hdFZhbHVlKGNvbFRvdGFsc1tjXSl9PC90ZD5gOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaHRtbCArPSBgPHRkIGNsYXNzPSJib3JkZXIgYm9yZGVyLWdyYXktMzAwIHB4LTMgcHktMiB0ZXh0LWNlbnRlciBiZy1ibHVlLTIwMCI+JHtmb3JtYXRWYWx1ZShncmFuZFRvdGFsKX08L3RkPmA7CiAgICAgICAgICAgIGh0bWwgKz0gJzwvdHI+JzsKCiAgICAgICAgICAgIGh0bWwgKz0gJzwvdGJvZHk+PC90YWJsZT48L2Rpdj4nOwoKICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9IGh0bWw7CiAgICAgICAgfQoKICAgICAgICAvLyBGZWF0dXJlOiBNYXRyaXggWm9vbSAoVmFyaWFibGUgbW92ZWQgdG8gdG9wKQoKICAgICAgICBmdW5jdGlvbiBzZXRNYXRyaXhab29tKGxldmVsKSB7CiAgICAgICAgICAgIG1hdHJpeFpvb21MZXZlbCA9IE1hdGgubWF4KDAuNSwgTWF0aC5taW4oMy4wLCBsZXZlbCkpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF0cml4Wm9vbUxldmVsJykudGV4dENvbnRlbnQgPSBNYXRoLnJvdW5kKG1hdHJpeFpvb21MZXZlbCAqIDEwMCkgKyAnJSc7CgogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGl2b3RUYWJsZUNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoY29udGFpbmVyKSB7CiAgICAgICAgICAgICAgICAvLyBVc2UgQ1NTIHpvb20gcHJvcGVydHkgd2hpY2ggYWZmZWN0cyBsYXlvdXQgKGZpeGluZyBzY3JvbGxiYXIgaXNzdWVzKQogICAgICAgICAgICAgICAgLy8gaW5zdGVhZCBvZiB0cmFuc2Zvcm06IHNjYWxlKCkgd2hpY2ggb25seSBhZmZlY3RzIHZpc3VhbCByZW5kZXJpbmcKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS56b29tID0gbWF0cml4Wm9vbUxldmVsOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBDb3B5IE1hdHJpeCBUYWJsZSB0byBDbGlwYm9hcmQKICAgICAgICBmdW5jdGlvbiBjb3B5TWF0cml4VGFibGUoKSB7CiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwaXZvdFRhYmxlQ29udGFpbmVyJyk7CiAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gY29udGFpbmVyPy5xdWVyeVNlbGVjdG9yKCd0YWJsZScpOwogICAgICAgICAgICBpZiAoIXRhYmxlKSB7CiAgICAgICAgICAgICAgICBhbGVydCgnTm8gdGFibGUgdG8gY29weScpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBDcmVhdGUgYSB0ZW1wb3JhcnkgdGV4dCBmcm9tIHRhYmxlIGZvciBwbGFpbiB0ZXh0IGNsaXBib2FyZAogICAgICAgICAgICBsZXQgdGV4dCA9ICcnOwogICAgICAgICAgICBjb25zdCByb3dzID0gdGFibGUucXVlcnlTZWxlY3RvckFsbCgndHInKTsKICAgICAgICAgICAgcm93cy5mb3JFYWNoKHJvdyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjZWxscyA9IHJvdy5xdWVyeVNlbGVjdG9yQWxsKCd0aCwgdGQnKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJvd0RhdGEgPSBbXTsKICAgICAgICAgICAgICAgIGNlbGxzLmZvckVhY2goY2VsbCA9PiB7CiAgICAgICAgICAgICAgICAgICAgcm93RGF0YS5wdXNoKGNlbGwudGV4dENvbnRlbnQudHJpbSgpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGV4dCArPSByb3dEYXRhLmpvaW4oJ1x0JykgKyAnXG4nOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIENvcHkgYXMgYm90aCBIVE1MIGFuZCBwbGFpbiB0ZXh0CiAgICAgICAgICAgIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGUoWwogICAgICAgICAgICAgICAgbmV3IENsaXBib2FyZEl0ZW0oewogICAgICAgICAgICAgICAgICAgICd0ZXh0L2h0bWwnOiBuZXcgQmxvYihbdGFibGUub3V0ZXJIVE1MXSwgeyB0eXBlOiAndGV4dC9odG1sJyB9KSwKICAgICAgICAgICAgICAgICAgICAndGV4dC9wbGFpbic6IG5ldyBCbG9iKFt0ZXh0XSwgeyB0eXBlOiAndGV4dC9wbGFpbicgfSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIF0pLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hdHJpeENvcHlCdG4nKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsQ29udGVudCA9IGJ0bi5pbm5lckhUTUw7CiAgICAgICAgICAgICAgICBidG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtY2hlY2siPjwvaT4nOwogICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2JnLWdyZWVuLTEwMCcsICd0ZXh0LWdyZWVuLTYwMCcpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmlubmVySFRNTCA9IG9yaWdpbmFsQ29udGVudDsKICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnYmctZ3JlZW4tMTAwJywgJ3RleHQtZ3JlZW4tNjAwJyk7CiAgICAgICAgICAgICAgICB9LCAxNTAwKTsKICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NvcHkgZmFpbGVkOicsIGVycik7CiAgICAgICAgICAgICAgICAvLyBGYWxsYmFjazogY29weSBhcyBwbGFpbiB0ZXh0CiAgICAgICAgICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh0ZXh0KS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBhbGVydCgnVGFibGUgY29waWVkIGFzIHRleHQhJyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjYWxjdWxhdGVBZ2dyZWdhdGlvbihkYXRhLCBmaWVsZCwgYWdnRnVuYywgZm9ybWF0KSB7CiAgICAgICAgICAgIGlmICghZGF0YSB8fCBkYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG51bGw7CgogICAgICAgICAgICBpZiAoYWdnRnVuYyA9PT0gJ2NvdW50JykgewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEubGVuZ3RoOwogICAgICAgICAgICB9IGVsc2UgaWYgKGFnZ0Z1bmMgPT09ICdjb3VudHVuaXF1ZScpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2V0KGRhdGEubWFwKGQgPT4gZFtmaWVsZF0pKS5zaXplOwogICAgICAgICAgICB9IGVsc2UgaWYgKGFnZ0Z1bmMgPT09ICdjb3VudHgnKSB7CiAgICAgICAgICAgICAgICBpZiAoIWZvcm1hdCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRWYWx1ZSA9IGZvcm1hdC50cmltKCkucmVwbGFjZSgvWyciXS9nLCAnJyk7CiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaENvdW50ID0gZGF0YS5maWx0ZXIoZCA9PiBTdHJpbmcoZFtmaWVsZF0pID09IHRhcmdldFZhbHVlKS5sZW5ndGg7CiAgICAgICAgICAgICAgICByZXR1cm4gKG1hdGNoQ291bnQgLyBkYXRhLmxlbmd0aCkgKiAxMDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE51bWVyaWMgYWdncmVnYXRpb25zCiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IGRhdGEubWFwKGQgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdiA9IHBhcnNlRmxvYXQoZFtmaWVsZF0pOwogICAgICAgICAgICAgICAgLy8gSGFuZGxlIGN1cnJlbmN5IG9yIG90aGVyIG5vbi1udW1lcmljIGNoYXJzIGlmIG5lZWRlZCwgYnV0IGFzc3VtaW5nIGNsZWFuZWQgZGF0YSBvciByYXcgbnVtYmVycwogICAgICAgICAgICAgICAgLy8gRm9yICJQcmljZSIsIGl0IG1pZ2h0IGJlIHN0cmluZyAiJDEwMCIuCiAgICAgICAgICAgICAgICBpZiAoaXNOYU4odikgJiYgdHlwZW9mIGRbZmllbGRdID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgIC8vIFRyeSB0byBzdHJpcCBjdXJyZW5jeSBzeW1ib2xzCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoZFtmaWVsZF0ucmVwbGFjZSgvW14wLTkuLV0rL2csICIiKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdjsKICAgICAgICAgICAgfSkuZmlsdGVyKHYgPT4gIWlzTmFOKHYpKTsKCiAgICAgICAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIHN3aXRjaCAoYWdnRnVuYykgewogICAgICAgICAgICAgICAgY2FzZSAnc3VtJzogcmV0dXJuIHZhbHVlcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKTsKICAgICAgICAgICAgICAgIGNhc2UgJ2F2ZXJhZ2UnOiByZXR1cm4gdmFsdWVzLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApIC8gdmFsdWVzLmxlbmd0aDsKICAgICAgICAgICAgICAgIGNhc2UgJ21heCc6IHJldHVybiBNYXRoLm1heCguLi52YWx1ZXMpOwogICAgICAgICAgICAgICAgY2FzZSAnbWluJzogcmV0dXJuIE1hdGgubWluKC4uLnZhbHVlcyk7CiAgICAgICAgICAgICAgICBjYXNlICdtZWRpYW4nOgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvcnRlZCA9IFsuLi52YWx1ZXNdLnNvcnQoKGEsIGIpID0+IGEgLSBiKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtaWQgPSBNYXRoLmZsb29yKHNvcnRlZC5sZW5ndGggLyAyKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc29ydGVkLmxlbmd0aCAlIDIgPT09IDAgPyAoc29ydGVkW21pZCAtIDFdICsgc29ydGVkW21pZF0pIC8gMiA6IHNvcnRlZFttaWRdOwogICAgICAgICAgICAgICAgY2FzZSAnc3RkZXYnOgogICAgICAgICAgICAgICAgY2FzZSAndmFyJzoKICAgICAgICAgICAgICAgICAgICBjb25zdCBhdmcgPSB2YWx1ZXMucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyB2YWx1ZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNxdWFyZURpZmZzID0gdmFsdWVzLm1hcCh2ID0+IE1hdGgucG93KHYgLSBhdmcsIDIpKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYW5jZSA9IHNxdWFyZURpZmZzLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApIC8gTWF0aC5tYXgoMSwgdmFsdWVzLmxlbmd0aCAtIDEpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhZ2dGdW5jID09PSAnc3RkZXYnID8gTWF0aC5zcXJ0KHZhcmlhbmNlKSA6IHZhcmlhbmNlOwogICAgICAgICAgICAgICAgZGVmYXVsdDogcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZvcm1hdFZhbHVlV2l0aEN1c3RvbUZvcm1hdCh2YWx1ZSwgZm9ybWF0KSB7CiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IGlzTmFOKHZhbHVlKSkgcmV0dXJuICctJzsKCiAgICAgICAgICAgIC8vIFNpbXBsZSBsb2dpYzogaWYgZm9ybWF0IGNvbnRhaW5zICLlhYMiIG9yICIkIiwgYXBwZW5kL3ByZXBlbmQKICAgICAgICAgICAgLy8gT3IgdXNlIHN0YW5kYXJkIG51bWJlciBmb3JtYXR0aW5nCgogICAgICAgICAgICBsZXQgZm9ybWF0dGVkID0gTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSkgPyB2YWx1ZS50b1N0cmluZygpIDogdmFsdWUudG9GaXhlZCgyKTsKCiAgICAgICAgICAgIGlmIChmb3JtYXQpIHsKICAgICAgICAgICAgICAgIC8vIElmIGZvcm1hdCBpcyBjb21wbGV4IGxpa2UgIiMsIyMwIOWFgyIsIHdlIGNhbiB0cnkgdG8gcmVzcGVjdCBpdCBsb29zZWx5CiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0LmluY2x1ZGVzKCflhYMnKSkgcmV0dXJuIGZvcm1hdHRlZCArICcg5YWDJzsKICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuaW5jbHVkZXMoJyQnKSkgcmV0dXJuICckJyArIGZvcm1hdHRlZDsKICAgICAgICAgICAgICAgIGlmIChmb3JtYXQuaW5jbHVkZXMoJyUnKSkgcmV0dXJuIGZvcm1hdHRlZCArICclJzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVkOwogICAgICAgIH0KICAgIDwvc2NyaXB0PgoKICAgIDwhLS0gQ2hhcnQgU2V0dGluZ3MgTW9kYWwgLS0+CiAgICA8IS0tIENoYXJ0IFNldHRpbmdzIE1vZGFsIC0tPgogICAgPGRpdiBpZD0ic2V0dGluZ3NNb2RhbCIgY2xhc3M9Im1vZGFsIiBzdHlsZT0iZGlzcGxheTpub25lOyI+CiAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtY29udGVudCIgc3R5bGU9Im1heC13aWR0aDogNDAwcHg7Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtaGVhZGVyIj4KICAgICAgICAgICAgICAgIDxoMz5WaWV3IFNldHRpbmdzPC9oMz4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJjbG9zZS1tb2RhbCI+JnRpbWVzOzwvc3Bhbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLWJvZHkiPgogICAgICAgICAgICAgICAgPCEtLSBTY2F0dGVyIFNldHRpbmdzIC0tPgogICAgICAgICAgICAgICAgPGRpdiBpZD0ic2NhdHRlclNldHRpbmdzU2VjdGlvbiI+CiAgICAgICAgICAgICAgICAgICAgPGg0IGNsYXNzPSJ0ZXh0LXNtIGZvbnQtYm9sZCB0ZXh0LWdyYXktNzAwIG1iLTIgYm9yZGVyLWIgcGItMSI+U2NhdHRlciBDaGFydDwvaDQ+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZy1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPlJvdyBTcGFjaW5nIChHYXApOiA8c3BhbiBpZD0idmFsUm93SGVpZ2h0Ij4zMDwvc3Bhbj48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFuZ2UiIGlkPSJzZXRSb3dIZWlnaHQiIG1pbj0iMTUiIG1heD0iMTAwIiB2YWx1ZT0iMzAiPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmctaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD5NaW4gQ2hhcnQgSGVpZ2h0OiA8c3BhbiBpZD0idmFsTWluSGVpZ2h0Ij4yMDA8L3NwYW4+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhbmdlIiBpZD0ic2V0TWluSGVpZ2h0IiBtaW49IjUwIiBtYXg9IjgwMCIgdmFsdWU9IjIwMCI+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZy1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPlBvaW50IFNpemUgKHB4KTogPHNwYW4gaWQ9InZhbFBvaW50UmFkaXVzIj42PC9zcGFuPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJyYW5nZSIgaWQ9InNldFBvaW50UmFkaXVzIiBtaW49IjIiIG1heD0iMjAiIHZhbHVlPSI2Ij4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nLWl0ZW0iPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+WS1MYWJlbCBTaXplIChweCk6IDxzcGFuIGlkPSJ2YWxMYWJlbFNpemUiPjEyPC9zcGFuPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJyYW5nZSIgaWQ9InNldExhYmVsU2l6ZSIgbWluPSI4IiBtYXg9IjI0IiB2YWx1ZT0iMTIiPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPCEtLSBHcmlkL0xhbmRzY2FwZSBTZXR0aW5ncyAtLT4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImdyaWRTZXR0aW5nc1NlY3Rpb24iIGNsYXNzPSJoaWRkZW4iPgogICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzcz0idGV4dC1zbSBmb250LWJvbGQgdGV4dC1ncmF5LTcwMCBtYi0yIGJvcmRlci1iIHBiLTEiPkNhcmQgQXBwZWFyYW5jZTwvaDQ+CgogICAgICAgICAgICAgICAgICAgIDwhLS0gVmlzdWFsIE9yZGVyOiBCcmFuZC9Mb2dvIC0+IE1vZGVsIC0+IFNwZWNzIC0+IEZlYXR1cmUgLT4gQWNjZXNzIC0+IFByaWNlIC0tPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmctaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD5CcmFuZCBUZXh0OiA8c3BhbiBpZD0idmFsRnNCcmFuZCI+MC43PC9zcGFuPnJlbTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJyYW5nZSIgaWQ9InNldEZzQnJhbmQiIG1pbj0iMC40IiBtYXg9IjEuMCIgc3RlcD0iMC4wNSIgdmFsdWU9IjAuNyI+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZy1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPkxvZ28gSGVpZ2h0OiA8c3BhbiBpZD0idmFsSExvZ28iPjM4PC9zcGFuPnB4PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhbmdlIiBpZD0ic2V0SExvZ28iIG1pbj0iMjAiIG1heD0iNTYiIHN0ZXA9IjEiIHZhbHVlPSIzOCI+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZy1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPk1vZGVsIEZvbnQ6IDxzcGFuIGlkPSJ2YWxGc01vZGVsIj4wLjc8L3NwYW4+cmVtPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhbmdlIiBpZD0ic2V0RnNNb2RlbCIgbWluPSIwLjQiIG1heD0iMS4wIiBzdGVwPSIwLjA1IiB2YWx1ZT0iMC43Ij4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nLWl0ZW0iPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+U3BlYyBGb250OiA8c3BhbiBpZD0idmFsRnNTcGVjIj4wLjc8L3NwYW4+cmVtPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhbmdlIiBpZD0ic2V0RnNTcGVjIiBtaW49IjAuNCIgbWF4PSIxLjAiIHN0ZXA9IjAuMDUiIHZhbHVlPSIwLjciPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmctaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD5GZWF0dXJlIEZvbnQ6IDxzcGFuIGlkPSJ2YWxGc0ZlYXR1cmUiPjAuNzwvc3Bhbj5yZW08L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFuZ2UiIGlkPSJzZXRGc0ZlYXR1cmUiIG1pbj0iMC40IiBtYXg9IjEuMCIgc3RlcD0iMC4wNSIgdmFsdWU9IjAuNyI+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZy1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPkFjY2Vzcy4gRm9udDogPHNwYW4gaWQ9InZhbEZzQWNjZXNzIj4wLjc8L3NwYW4+cmVtPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhbmdlIiBpZD0ic2V0RnNBY2Nlc3MiIG1pbj0iMC40IiBtYXg9IjEuMCIgc3RlcD0iMC4wNSIgdmFsdWU9IjAuNyI+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZy1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPlByaWNlIEZvbnQ6IDxzcGFuIGlkPSJ2YWxGc1ByaWNlIj4wLjc8L3NwYW4+cmVtPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhbmdlIiBpZD0ic2V0RnNQcmljZSIgbWluPSIwLjQiIG1heD0iMS4wIiBzdGVwPSIwLjA1IiB2YWx1ZT0iMC43Ij4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtZm9vdGVyIj4KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImFwcGx5U2V0dGluZ3NCdG4iCiAgICAgICAgICAgICAgICAgICAgc3R5bGU9ImJhY2tncm91bmQ6IzRmNDZlNTtjb2xvcjp3aGl0ZTtwYWRkaW5nOjhweCAxNnB4O2JvcmRlci1yYWRpdXM6NHB4O2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyOyI+RG9uZTwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxzY3JpcHQ+CiAgICAgICAgLy8gU2V0dGluZ3MgTG9naWMgdjMuMCAtIEV4ZWN1dGUgaW1tZWRpYXRlbHkgc2luY2UgbW9kYWwgSFRNTCBpcyBhbHJlYWR5IHBhcnNlZAogICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW1NldHRpbmdzIElJRkVdIFN0YXJ0aW5nIGV4ZWN1dGlvbi4uLicpOwogICAgICAgICAgICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V0dGluZ3NNb2RhbCcpOwogICAgICAgICAgICAgICAgY29uc3Qgb3BlblNldHRpbmdzQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZW5TZXR0aW5nc0J0bicpOyAvLyBTY2F0dGVyCiAgICAgICAgICAgICAgICBjb25zdCBncmlkU2V0dGluZ3NCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3JpZFNldHRpbmdzQnRuJyk7IC8vIEdyaWQKICAgICAgICAgICAgICAgIGNvbnN0IHNwYW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2xvc2UtbW9kYWwnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGFwcGx5QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcGx5U2V0dGluZ3NCdG4nKTsKCiAgICAgICAgICAgICAgICBjb25zdCBzY2F0dGVyU2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2F0dGVyU2V0dGluZ3NTZWN0aW9uJyk7CiAgICAgICAgICAgICAgICBjb25zdCBncmlkU2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncmlkU2V0dGluZ3NTZWN0aW9uJyk7CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gb3Blbk1vZGFsKCkgewogICAgICAgICAgICAgICAgICAgIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICAgICAgICAgIC8vIFRvZ2dsZSBzZWN0aW9ucyBiYXNlZCBvbiB2aWV3IChjdXJyZW50VmlldyBpcyBnbG9iYWwgZnJvbSBtYWluIHNjcmlwdCkKICAgICAgICAgICAgICAgICAgICBjb25zdCB2aWV3ID0gKHR5cGVvZiBjdXJyZW50VmlldyAhPT0gJ3VuZGVmaW5lZCcpID8gY3VycmVudFZpZXcgOiAnZ3JpZCc7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZpZXcgPT09ICdzY2F0dGVyJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NhdHRlclNlY3Rpb24pIHNjYXR0ZXJTZWN0aW9uLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ3JpZFNlY3Rpb24pIGdyaWRTZWN0aW9uLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgdG8gR3JpZCBzZXR0aW5ncyBmb3IgR3JpZCBhbmQgUGl2b3QvTWF0cml4IHZpZXdzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY2F0dGVyU2VjdGlvbikgc2NhdHRlclNlY3Rpb24uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncmlkU2VjdGlvbikgZ3JpZFNlY3Rpb24uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChvcGVuU2V0dGluZ3NCdG4pIG9wZW5TZXR0aW5nc0J0bi5vbmNsaWNrID0gb3Blbk1vZGFsOwogICAgICAgICAgICAgICAgaWYgKGdyaWRTZXR0aW5nc0J0bikgZ3JpZFNldHRpbmdzQnRuLm9uY2xpY2sgPSBvcGVuTW9kYWw7CgogICAgICAgICAgICAgICAgaWYgKHNwYW4pIHsKICAgICAgICAgICAgICAgICAgICBzcGFuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHdpbmRvdy5vbmNsaWNrID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PSBtb2RhbCkgewogICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgLy8gRm9yY2UgcmVzZXQgaW5wdXRzIHRvIGRlZmF1bHQgKGZpeCBicm93c2VyIGNhY2hpbmcgaXNzdWUpCiAgICAgICAgICAgICAgICBbJ0ZzTW9kZWwnLCAnRnNCcmFuZCcsICdITG9nbycsICdGc1NwZWMnLCAnRnNGZWF0dXJlJywgJ0ZzQWNjZXNzJywgJ0ZzUHJpY2UnXS5mb3JFYWNoKGlkID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXQnICsgaWQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZhbCcgKyBpZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnZhbHVlID0gZWwuZ2V0QXR0cmlidXRlKCd2YWx1ZScpOyAvLyBGb3JjZSB1c2UgSFRNTCBhdHRyaWJ1dGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxhYmVsKSBsYWJlbC50ZXh0Q29udGVudCA9IGVsLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIC0tLSBHZW5lcmljIElucHV0IEJpbmRpbmcgSGVscGVyIC0tLQogICAgICAgICAgICAgICAgbGV0IGRlYm91bmNlVGltZXI7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiB0cmlnZ2VyVXBkYXRlKCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdXBkYXRlU2NhdHRlckNoYXJ0ICE9PSAnZnVuY3Rpb24nKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGRlYm91bmNlVGltZXIpOwogICAgICAgICAgICAgICAgICAgIGRlYm91bmNlVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlU2NhdHRlckNoYXJ0KCk7CiAgICAgICAgICAgICAgICAgICAgfSwgMTUwKTsgLy8gMTUwbXMgZGVib3VuY2UgZm9yIHJlc3BvbnNpdmVuZXNzCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYmluZElucHV0KGlkS2V5LCBjYWxsYmFjaykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NldCcgKyBpZEtleSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmFsJyArIGlkS2V5KTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW2JpbmRJbnB1dF0gQmluZGluZzonLCBpZEtleSwgJ2lucHV0OicsICEhaW5wdXQsICdsYWJlbDonLCAhIWxhYmVsKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQgJiYgbGFiZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tiaW5kSW5wdXRdIEV2ZW50IGZpcmVkIGZvcjonLCBpZEtleSwgJ3ZhbHVlOicsIGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gZS50YXJnZXQudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKGUudGFyZ2V0LnZhbHVlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUcmlnZ2VyIFJlYWwtdGltZSB1cGRhdGUgZm9yIFNjYXR0ZXIgc2V0dGluZ3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9ubHkgdHJpZ2dlciBpZiBjdXJyZW50IHZpZXcgaXMgc2NhdHRlciB0byBhdm9pZCBlcnJvcnMgb3IgaGVhdnkgbG9hZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50VmlldyAhPT0gJ3VuZGVmaW5lZCcgJiYgY3VycmVudFZpZXcgPT09ICdzY2F0dGVyJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJVcGRhdGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFNjYXR0ZXIgQmluZGluZ3MKICAgICAgICAgICAgICAgIGJpbmRJbnB1dCgnUm93SGVpZ2h0JywgKHZhbCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY2hhcnRTZXR0aW5ncyAhPT0gJ3VuZGVmaW5lZCcpIGNoYXJ0U2V0dGluZ3Mucm93SGVpZ2h0ID0gcGFyc2VJbnQodmFsKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYmluZElucHV0KCdNaW5IZWlnaHQnLCAodmFsKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGFydFNldHRpbmdzICE9PSAndW5kZWZpbmVkJykgY2hhcnRTZXR0aW5ncy5taW5IZWlnaHQgPSBwYXJzZUludCh2YWwpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBiaW5kSW5wdXQoJ1BvaW50UmFkaXVzJywgKHZhbCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY2hhcnRTZXR0aW5ncyAhPT0gJ3VuZGVmaW5lZCcpIGNoYXJ0U2V0dGluZ3MucG9pbnRSYWRpdXMgPSBwYXJzZUludCh2YWwpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBiaW5kSW5wdXQoJ0xhYmVsU2l6ZScsICh2YWwpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNoYXJ0U2V0dGluZ3MgIT09ICd1bmRlZmluZWQnKSBjaGFydFNldHRpbmdzLmxhYmVsRm9udFNpemUgPSBwYXJzZUludCh2YWwpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgLy8gR3JpZCBDU1MgVmFyaWFibGUgQmluZGluZ3MKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbU2V0dGluZ3MgSUlGRV0gQWJvdXQgdG8gYmluZCBHcmlkIGlucHV0cy4uLicpOwogICAgICAgICAgICAgICAgYmluZElucHV0KCdGc01vZGVsJywgKHZhbCkgPT4gewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1mcy1tb2RlbCcsIHZhbCArICdyZW0nKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYmluZElucHV0KCdGc0JyYW5kJywgKHZhbCkgPT4gewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1mcy1icmFuZCcsIHZhbCArICdyZW0nKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYmluZElucHV0KCdITG9nbycsICh2YWwpID0+IHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0taC1sb2dvJywgdmFsICsgJ3B4Jyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJpbmRJbnB1dCgnRnNTcGVjJywgKHZhbCkgPT4gewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1mcy1zcGVjJywgdmFsICsgJ3JlbScpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBiaW5kSW5wdXQoJ0ZzRmVhdHVyZScsICh2YWwpID0+IHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tZnMtZmVhdHVyZScsIHZhbCArICdyZW0nKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYmluZElucHV0KCdGc0FjY2VzcycsICh2YWwpID0+IHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tZnMtYWNjZXNzJywgdmFsICsgJ3JlbScpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBiaW5kSW5wdXQoJ0ZzUHJpY2UnLCAodmFsKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCctLWZzLXByaWNlJywgdmFsICsgJ3JlbScpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgLy8gVGljayBJbnRlcnZhbAogICAgICAgICAgICAgICAgY29uc3QgdGlja1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluVGlja0ludGVydmFsJyk7CiAgICAgICAgICAgICAgICBpZiAodGlja1NlbGVjdCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY2hhcnRTZXR0aW5ncyAhPT0gJ3VuZGVmaW5lZCcpIHRpY2tTZWxlY3QudmFsdWUgPSBjaGFydFNldHRpbmdzLnRpY2tJbnRlcnZhbDsKICAgICAgICAgICAgICAgICAgICB0aWNrU2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY2hhcnRTZXR0aW5ncyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJ0U2V0dGluZ3MudGlja0ludGVydmFsID0gcGFyc2VJbnQoZS50YXJnZXQudmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB1cGRhdGVTY2F0dGVyQ2hhcnQgPT09ICdmdW5jdGlvbicpIHVwZGF0ZVNjYXR0ZXJDaGFydCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGFwcGx5QnRuKSB7CiAgICAgICAgICAgICAgICAgICAgYXBwbHlCdG4ub25jbGljayA9ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGhhbmRsZWQgYnkgcmVhbHRpbWUsIGp1c3QgY2xvc2UuCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJ1dCBjYWxsIG9uY2UgbW9yZSB0byBiZSBzdXJlPyBObyBuZWVkLgogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTZXR0aW5ncyBJSUZFIEVSUk9SXScsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfSkoKTsKCiAgICAgICAgLy8gLS0tIEFJIENvbnRleHQgQ29weSBGdW5jdGlvbmFsaXR5IC0tLQogICAgICAgIGZ1bmN0aW9uIGNvcHlBaUNvbnRleHQoKSB7CiAgICAgICAgICAgIGlmICghZmlsdGVyZWREYXRhIHx8IGZpbHRlcmVkRGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCdObyBkYXRhIHRvIGNvcHkhIFBsZWFzZSBsb2FkIGRhdGEgZmlyc3QuJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb3B5QWlDb250ZXh0QnRuJyk7CiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsVGV4dCA9IGJ0bi5pbm5lckhUTUw7CiAgICAgICAgICAgIGJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4iPjwvaT4gR2VuZXJhdGluZy4uLic7CgogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgLy8gU21hbGwgZGVsYXkgdG8gYWxsb3cgVUkgdXBkYXRlCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIC8vIDEuIFByZXBhcmUgSGVhZGVyCiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbnRleHQgPSBgW0NvbnRleHQ6IFBvd2VyIFRvb2wgTWFya2V0IERhdGFdXG5gOwogICAgICAgICAgICAgICAgICAgIGNvbnRleHQgKz0gYFRvdGFsIFByb2R1Y3RzOiAke2ZpbHRlcmVkRGF0YS5sZW5ndGh9XG5gOwogICAgICAgICAgICAgICAgICAgIGNvbnRleHQgKz0gYEN1cnJlbnQgVmlldzogJHtjdXJyZW50Vmlldy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGN1cnJlbnRWaWV3LnNsaWNlKDEpfVxuYDsKCiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGFjdGl2ZSBmaWx0ZXJzIGluZm8KICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVGaWx0ZXJzID0gW107CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMoZmlsdGVyU2VsZWN0aW9ucykuZm9yRWFjaCgoW2tleSwgdmFsdWVzXSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVzICYmIHZhbHVlcy5zaXplID4gMCkgYWN0aXZlRmlsdGVycy5wdXNoKGAke2tleX06ICR7QXJyYXkuZnJvbSh2YWx1ZXMpLmpvaW4oJywgJyl9YCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByaWNlUmFuZ2UubWluID4gMCB8fCBwcmljZVJhbmdlLm1heCA8IDEwMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlRmlsdGVycy5wdXNoKGBQcmljZTogJHtwcmljZVJhbmdlLm1pbn0tJHtwcmljZVJhbmdlLm1heH1gKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZUZpbHRlcnMubGVuZ3RoID4gMCkgY29udGV4dCArPSBgQWN0aXZlIEZpbHRlcnM6ICR7YWN0aXZlRmlsdGVycy5qb2luKCc7ICcpfVxuYDsKICAgICAgICAgICAgICAgICAgICBjb250ZXh0ICs9IGBcbltEYXRhIFN0cnVjdHVyZTogQ1NWXVxuYDsKCiAgICAgICAgICAgICAgICAgICAgLy8gMi4gU2VsZWN0IEtleSBDb2x1bW5zCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sdW1ucyA9IFsnTW9kZWwgIycsICdCcmFuZCcsICdQbGF0Zm9ybScsICdQcmljZScsICdQcmljZSBUYWcnLCAnUG93ZXIgU3VwcGx5JywgJ0JsYWRlIERpYW1ldGVyJywgJ1dhdHQnLCAnUlBNJywgJ1R5cGUnLCAnQmV2ZWwnLCAnU2xpZGUnLCAnTGFzZXInLCAnU29mdCBTdGFydCddOwogICAgICAgICAgICAgICAgICAgIGNvbnRleHQgKz0gY29sdW1ucy5qb2luKCcsJykgKyAnXG4nOwoKICAgICAgICAgICAgICAgICAgICAvLyAzLiBEYXRhIFJvd3MgKExpbWl0IHRvIHByZXZlbnQgaHVnZSBwYXN0ZSkKICAgICAgICAgICAgICAgICAgICBjb25zdCBNQVhfUk9XUyA9IDIwMDA7IC8vIFRleHQgaXMgY2hlYXAKICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dzVG9Qcm9jZXNzID0gZmlsdGVyZWREYXRhLnNsaWNlKDAsIE1BWF9ST1dTKTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3N2Um93cyA9IHJvd3NUb1Byb2Nlc3MubWFwKHJvdyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2x1bW5zLm1hcChjb2wgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHZhbCA9IHJvd1tjb2xdIHx8ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbCA9PT0gJ1ByaWNlJykgdmFsID0gdHlwZW9mIHZhbCA9PT0gJ251bWJlcicgPyB2YWwudG9GaXhlZCgyKSA6IHZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENsZWFuIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBTdHJpbmcodmFsKS5yZXBsYWNlKC9bXHJcbl0rL2csICcgJykudHJpbSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXNjYXBlIHF1b3RlcyBhbmQgd3JhcCBpZiBjb250YWlucyBjb21tYQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbC5pbmNsdWRlcygnLCcpIHx8IHZhbC5pbmNsdWRlcygnIicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gYCIke3ZhbC5yZXBsYWNlKC8iL2csICciIicpfSJgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgfSkuam9pbignLCcpOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBjb250ZXh0ICs9IGNzdlJvd3Muam9pbignXG4nKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkRGF0YS5sZW5ndGggPiBNQVhfUk9XUykgewogICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0ICs9IGBcbi4uLiAodHJ1bmNhdGVkICR7ZmlsdGVyZWREYXRhLmxlbmd0aCAtIE1BWF9ST1dTfSBtb3JlIHJvd3MpYDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIDQuIEluc3RydWN0aW9ucyBtYWlubHkgZm9yIHVzZXIgcGFzdGluZwogICAgICAgICAgICAgICAgICAgIGNvbnRleHQgKz0gYFxuW0luc3RydWN0aW9uXVxuVXNlIHRoaXMgZGF0YSB0byBhbnN3ZXIgcXVlc3Rpb25zIGFib3V0IHByb2R1Y3Qgc3BlY3MsIHByaWNpbmcsIGFuZCBjb21wYXJpc29ucy5gOwoKICAgICAgICAgICAgICAgICAgICAvLyA1LiBDb3B5CiAgICAgICAgICAgICAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoY29udGV4dCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1jaGVjayI+PC9pPiBDb3BpZWQhJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5yZXBsYWNlKCdiZy1pbmRpZ28tNjAwJywgJ2JnLWdyZWVuLTYwMCcpOwogICAgICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlcGxhY2UoJ2hvdmVyOmJnLWluZGlnby03MDAnLCAnaG92ZXI6YmctZ3JlZW4tNzAwJyk7CgogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ0bi5pbm5lckhUTUwgPSBvcmlnaW5hbFRleHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlcGxhY2UoJ2JnLWdyZWVuLTYwMCcsICdiZy1pbmRpZ28tNjAwJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlcGxhY2UoJ2hvdmVyOmJnLWdyZWVuLTcwMCcsICdob3ZlcjpiZy1pbmRpZ28tNzAwJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDIwMDApOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NvcHkgQUkgQ29udGV4dCBGYWlsZWQ6JywgZXJyKTsKICAgICAgICAgICAgICAgICAgICBidG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUiPjwvaT4gRXJyb3InOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gYnRuLmlubmVySFRNTCA9IG9yaWdpbmFsVGV4dCwgMjAwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICB9CgogICAgICAgIC8vIEFkZCBMaXN0ZW5lciBzYWZlbHkKICAgICAgICBjb25zdCBjb3B5QWlCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29weUFpQ29udGV4dEJ0bicpOwogICAgICAgIGlmIChjb3B5QWlCdG4pIGNvcHlBaUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNvcHlBaUNvbnRleHQpOwoKICAgIDwvc2NyaXB0PgoKICAgIDwhLS0gVGlwcyAmIENvbnRleHQgSGVscGVyIChHbG9iYWwgU2NvcGUpIC0tPgogICAgPHNjcmlwdD4KICAgICAgICAvLyAtLS0gUmFuZG9tIFRpcHMgTG9naWMgLS0tCiAgICAgICAgZnVuY3Rpb24gc2hvd1JhbmRvbVRpcCgpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBMT0FESU5HX1RJUFMgPT09ICd1bmRlZmluZWQnIHx8IExPQURJTkdfVElQUy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCLwn5KhIFRpcDogVHJ5IHVzaW5nIHRoZSAnU2NhdHRlcicgdmlldyB0byBzZWUgcHJpY2UgdnMgcGVyZm9ybWFuY2UhIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgdGlwID0gTE9BRElOR19USVBTW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIExPQURJTkdfVElQUy5sZW5ndGgpXTsKICAgICAgICAgICAgLy8gU2ltcGxlIHNsZWVrIG5vdGlmaWNhdGlvbiBpbnN0ZWFkIG9mIGFsZXJ0PyBBbGVydCBpcyBmaW5lIGZvciBub3cgYXMgcmVxdWVzdGVkICdwb3B1cCcuCiAgICAgICAgICAgIGFsZXJ0KCLwn5KhICIgKyB0aXApOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIENvbnRleHQgSGVscGVyIChFeHBvc2VkIGZvciBNb2R1bGUpIC0tLQogICAgICAgIHdpbmRvdy5nZXRDb250ZXh0U3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodHlwZW9mIGZpbHRlcmVkRGF0YSA9PT0gJ3VuZGVmaW5lZCcgfHwgIWZpbHRlcmVkRGF0YSB8fCBmaWx0ZXJlZERhdGEubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGxldCBjb250ZXh0ID0gYFRvdGFsIFByb2R1Y3RzOiAke2ZpbHRlcmVkRGF0YS5sZW5ndGh9XG5gOwogICAgICAgICAgICBjb250ZXh0ICs9IGBDdXJyZW50IFZpZXc6ICR7Y3VycmVudFZpZXd9XG5gOwoKICAgICAgICAgICAgLy8gQ29yZSBjb2x1bW5zIGZvciBhbmFseXNpcwogICAgICAgICAgICBjb25zdCBjb2x1bW5zID0gWydNb2RlbCAjJywgJ0JyYW5kJywgJ1BsYXRmb3JtJywgJ1ByaWNlJywgJ1ByaWNlIFRhZycsICdQb3dlciBTdXBwbHknLCAnQmxhZGUgRGlhbWV0ZXInLCAnV2F0dCcsICdSUE0nLCAnVHlwZSddOwogICAgICAgICAgICBjb250ZXh0ICs9IGNvbHVtbnMuam9pbignLCcpICsgJ1xuJzsKCiAgICAgICAgICAgIGNvbnN0IE1BWF9ST1dTID0gMTAwMDsKICAgICAgICAgICAgY29uc3Qgcm93cyA9IGZpbHRlcmVkRGF0YS5zbGljZSgwLCBNQVhfUk9XUykubWFwKHJvdyA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29sdW1ucy5tYXAoY29sID0+IHsKICAgICAgICAgICAgICAgICAgICBsZXQgdmFsID0gcm93W2NvbF0gfHwgJyc7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbCA9PT0gJ1ByaWNlJykgdmFsID0gdHlwZW9mIHZhbCA9PT0gJ251bWJlcicgPyB2YWwudG9GaXhlZCgyKSA6IHZhbDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKHZhbCkucmVwbGFjZSgvLC9nLCAnICcpLnRyaW0oKTsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJywnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnRleHQgKz0gcm93cy5qb2luKCdcbicpOwoKICAgICAgICAgICAgaWYgKGZpbHRlcmVkRGF0YS5sZW5ndGggPiBNQVhfUk9XUykgY29udGV4dCArPSBgXG4uLi4oJHtmaWx0ZXJlZERhdGEubGVuZ3RoIC0gTUFYX1JPV1N9IG1vcmUpLi4uYDsKICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQ7CiAgICAgICAgfQogICAgPC9zY3JpcHQ+CgoKCgogICAgPC9zY3JpcHQ+CgoKCiAgICA8IS0tIFZvaWNlIElucHV0IExvZ2ljIC0tPgogICAgPHNjcmlwdD4KICAgICAgICBmdW5jdGlvbiB0b2dnbGVWb2ljZUlucHV0KCkgewogICAgICAgICAgICBpZiAoISgnd2Via2l0U3BlZWNoUmVjb2duaXRpb24nIGluIHdpbmRvdykpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCJCcm93c2VyIGRvZXMgbm90IHN1cHBvcnQgVm9pY2UgSW5wdXQuIFRyeSBDaHJvbWUvRWRnZS4iKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pY0J0bicpOwogICAgICAgICAgICBjb25zdCBpY29uID0gYnRuLnF1ZXJ5U2VsZWN0b3IoJ2knKTsKCiAgICAgICAgICAgIGlmICh3aW5kb3cucmVjb2duaXRpb24gJiYgd2luZG93LnJlY29nbml0aW9uLnN0YXJ0ZWQpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5yZWNvZ25pdGlvbi5zdG9wKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IHJlY29nbml0aW9uID0gbmV3IHdlYmtpdFNwZWVjaFJlY29nbml0aW9uKCk7CiAgICAgICAgICAgIHdpbmRvdy5yZWNvZ25pdGlvbiA9IHJlY29nbml0aW9uOyAvLyBHbG9iYWwKICAgICAgICAgICAgcmVjb2duaXRpb24ubGFuZyA9ICd6aC1UVyc7IC8vIERlZmF1bHQgZ2VuZXJpYyBDaGluZXNlCiAgICAgICAgICAgIHJlY29nbml0aW9uLmNvbnRpbnVvdXMgPSBmYWxzZTsKICAgICAgICAgICAgcmVjb2duaXRpb24uaW50ZXJpbVJlc3VsdHMgPSBmYWxzZTsKCiAgICAgICAgICAgIHJlY29nbml0aW9uLm9uc3RhcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZWNvZ25pdGlvbi5zdGFydGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnZmEtYmVhdCcpOwogICAgICAgICAgICAgICAgaWNvbi5zdHlsZS5jb2xvciA9ICdyZWQnOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmVjb2duaXRpb24ub25lbmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZWNvZ25pdGlvbi5zdGFydGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhLWJlYXQnKTsKICAgICAgICAgICAgICAgIGljb24uc3R5bGUuY29sb3IgPSAnJzsgLy8gUmVzZXQKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJlY29nbml0aW9uLm9ucmVzdWx0ID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2NyaXB0ID0gZXZlbnQucmVzdWx0c1swXVswXS50cmFuc2NyaXB0OwogICAgICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdElucHV0Jyk7CiAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSArPSAoaW5wdXQudmFsdWUgPyAnICcgOiAnJykgKyB0cmFuc2NyaXB0OwogICAgICAgICAgICAgICAgaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJlY29nbml0aW9uLnN0YXJ0KCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gQ29udGV4dCBNYW5hZ2VtZW50IC0tLQogICAgICAgIHdpbmRvdy5hY3RpdmVDb250ZXh0cyA9IHsKICAgICAgICAgICAgZGF0YTogZmFsc2UsCiAgICAgICAgICAgIG1hbnVhbDogZmFsc2UsCiAgICAgICAgICAgIGhpc3Rvcnk6IGZhbHNlCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRnVsbFNjcmVlbigpIHsKICAgICAgICAgICAgY29uc3QgcGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdFBhbmVsJyk7CiAgICAgICAgICAgIC8vIFF1ZXJ5IGZvciBlaXRoZXIgZXhwYW5kIG9yIGNvbXByZXNzIGljb24KICAgICAgICAgICAgY29uc3QgaWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGF0LWhlYWRlciAuZmEtZXhwYW5kLCAuY2hhdC1oZWFkZXIgLmZhLWNvbXByZXNzJyk7CiAgICAgICAgICAgIGlmICghcGFuZWwpIHJldHVybjsKCiAgICAgICAgICAgIHBhbmVsLmNsYXNzTGlzdC50b2dnbGUoJ2NoYXQtZnVsbHNjcmVlbicpOwoKICAgICAgICAgICAgaWYgKGljb24pIHsKICAgICAgICAgICAgICAgIGlmIChwYW5lbC5jbGFzc0xpc3QuY29udGFpbnMoJ2NoYXQtZnVsbHNjcmVlbicpKSB7CiAgICAgICAgICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QucmVtb3ZlKCdmYS1leHBhbmQnKTsKICAgICAgICAgICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhLWNvbXByZXNzJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmEtY29tcHJlc3MnKTsKICAgICAgICAgICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhLWV4cGFuZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjbGVhckNoYXQoKSB7CiAgICAgICAgICAgIGlmICghY29uZmlybSgiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNsZWFyIHRoZSBjb252ZXJzYXRpb24/IikpIHJldHVybjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXRNZXNzYWdlcycpLmlubmVySFRNTCA9CiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iY2hhdC1tc2cgc3lzdGVtIj5TeXN0ZW06IDxiPkNoYXQgQ2xlYXJlZC48L2I+PGJyPkhpc3RvcnkgbWVtb3J5IHJlc2V0LjwvZGl2Pic7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0b2dnbGVDb250ZXh0KHR5cGUpIHsKICAgICAgICAgICAgY29uc3QgaXNBY3RpdmUgPSAhd2luZG93LmFjdGl2ZUNvbnRleHRzW3R5cGVdOwogICAgICAgICAgICB3aW5kb3cuYWN0aXZlQ29udGV4dHNbdHlwZV0gPSBpc0FjdGl2ZTsKCiAgICAgICAgICAgIGxldCBidG5JZCA9ICcnOwogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2RhdGEnKSBidG5JZCA9ICdidG5Db250ZXh0RGF0YSc7CiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdtYW51YWwnKSBidG5JZCA9ICdidG5Db250ZXh0TWFudWFsJzsKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2hpc3RvcnknKSBidG5JZCA9ICdidG5Db250ZXh0SGlzdG9yeSc7CgogICAgICAgICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChidG5JZCk7CiAgICAgICAgICAgIGNvbnN0IGljb24gPSBidG4ucXVlcnlTZWxlY3RvcignaScpOwoKICAgICAgICAgICAgaWYgKGlzQWN0aXZlKSB7CiAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LmFkZCgnYmctYmx1ZS0xMDAnLCAnYm9yZGVyLWJsdWUtNTAwJyk7CiAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnaG92ZXI6YmctZ3JheS0xMDAnKTsKICAgICAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZSgndGV4dC1ncmF5LTQwMCcpOwogICAgICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCd0ZXh0LWJsdWUtNjAwJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnYmctYmx1ZS0xMDAnLCAnYm9yZGVyLWJsdWUtNTAwJyk7CiAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LmFkZCgnaG92ZXI6YmctZ3JheS0xMDAnKTsKICAgICAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgndGV4dC1ncmF5LTQwMCcpOwogICAgICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QucmVtb3ZlKCd0ZXh0LWJsdWUtNjAwJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFByZXBhcmUgQ29udGV4dCBTdHJpbmcgKExhenkgTG9hZCkKICAgICAgICBmdW5jdGlvbiBnZXRDb21iaW5lZENvbnRleHQoKSB7CiAgICAgICAgICAgIGxldCBwYXJ0cyA9IFtdOwoKICAgICAgICAgICAgLy8gMC4gRmlsdGVyIENvbnRleHQgKE5ldykKICAgICAgICAgICAgaWYgKHdpbmRvdy5hY3RpdmVDb250ZXh0cy5kYXRhKSB7CiAgICAgICAgICAgICAgICBjb25zdCBmaWx0ZXJzID0ge307CiAgICAgICAgICAgICAgICAvLyBBZGQgVmlldyBTdGF0ZXMKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYWN0aXZlQ29uZmlnICE9PSAndW5kZWZpbmVkJyAmJiBhY3RpdmVDb25maWcpIGZpbHRlcnMuYWN0aXZlTW9kZSA9IGFjdGl2ZUNvbmZpZy5pZDsgLy8gTVRTIC8gVEJTCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFNb2RlICE9PSAndW5kZWZpbmVkJykgZmlsdGVycy5kYXRhTW9kZSA9IGRhdGFNb2RlOyAvLyBhbGwgLyB1bmlxdWUgLyBsb3dlc3QgLyByYW5nZQoKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcHJpY2VSYW5nZSAhPT0gJ3VuZGVmaW5lZCcpIGZpbHRlcnMucHJpY2VSYW5nZSA9IHByaWNlUmFuZ2U7CgogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmaWx0ZXJTZWxlY3Rpb25zICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGZpbHRlclNlbGVjdGlvbnMpLmZvckVhY2goKFtrLCB2XSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodiBpbnN0YW5jZW9mIFNldCAmJiB2LnNpemUgPiAwICYmICFrLmVuZHNXaXRoKCdfZWZmZWN0aXZlS2V5JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIExpbWl0IG91dHB1dCBsZW5ndGggZm9yIGxhcmdlIHNldHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9IFsuLi52XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcnNba10gPSBhcnIubGVuZ3RoID4gNTAgPyBhcnIuc2xpY2UoMCwgNTApLmpvaW4oJywnKSArICcuLi4gKCcgKyBhcnIubGVuZ3RoICsgJyB0b3RhbCknIDogYXJyLmpvaW4oJywnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGFydHMucHVzaChgW0NVUlJFTlQgRklMVEVSU11cbiR7SlNPTi5zdHJpbmdpZnkoZmlsdGVycywgbnVsbCwgMil9YCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh3aW5kb3cuYWN0aXZlQ29udGV4dHMuZGF0YSAmJiB0eXBlb2YgZmlsdGVyZWREYXRhICE9PSAndW5kZWZpbmVkJyAmJiBmaWx0ZXJlZERhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gIlBsYXRmb3JtLEJyYW5kLE1vZGVsLFByaWNlXG4iOwogICAgICAgICAgICAgICAgLy8gU2xpY2UgNDAwIHJvd3MsIG1hcCBzcGVjaWZpYyBjb2x1bW5zCiAgICAgICAgICAgICAgICBjb25zdCBjc3YgPSBmaWx0ZXJlZERhdGEuc2xpY2UoMCwgNDAwKS5tYXAoZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGQucGxhdGZvcm0gfHwgZFsnUGxhdGZvcm0nXSB8fCAnJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gZC5icmFuZCB8fCBkWydCcmFuZCddIHx8ICcnOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBkLm1vZGVsIHx8IGRbJ01vZGVsICMnXSB8fCAnJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwciA9IGQucHJpY2UgfHwgZFsnUHJpY2UnXSB8fCAnJzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCR7cH0sJHtifSwke219LCR7cHJ9YDsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJ1xuJyk7CiAgICAgICAgICAgICAgICBwYXJ0cy5wdXNoKGBbREFUQSBDT05URVhUIChDdXJyZW50IFZpZXcsIFRvcCA0MDApXVxuJHtoZWFkZXJ9JHtjc3Z9YCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIE1hbnVhbCBDb250ZXh0IChTb3VyY2UgQ29kZSkKICAgICAgICAgICAgaWYgKHdpbmRvdy5hY3RpdmVDb250ZXh0cy5tYW51YWwpIHsKICAgICAgICAgICAgICAgIC8vIEdldCByZWxldmFudCBIVE1MIHN0cnVjdHVyZQogICAgICAgICAgICAgICAgY29uc3QgaHRtbENvbnRlbnQgPSBkb2N1bWVudC5ib2R5LmlubmVySFRNTC5yZXBsYWNlKC88c2NyaXB0XGJbXj5dKj5bXHNcU10qPzxcL3NjcmlwdD4vZ20sICIiKQogICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC88c3ZnXGJbXj5dKj5bXHNcU10qPzxcL3N2Zz4vZ20sICJbU1ZHIEljb25dIikKICAgICAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKDAsIDE1MDAwKTsKICAgICAgICAgICAgICAgIHBhcnRzLnB1c2goYFtPUEVSQVRJT04gTUFOVUFMIENPTlRFWFQgKFNvdXJjZSBDb2RlIEZyYWdtZW50KV1cbiR7aHRtbENvbnRlbnR9YCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDMuIEhpc3RvcnkgQ29udGV4dAogICAgICAgICAgICBpZiAod2luZG93LmFjdGl2ZUNvbnRleHRzLmhpc3RvcnkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1zZ3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjY2hhdE1lc3NhZ2VzIC5jaGF0LW1zZycpOwogICAgICAgICAgICAgICAgbGV0IGhpc3RvcnlUZXh0ID0gIiI7CiAgICAgICAgICAgICAgICBtc2dzLmZvckVhY2gobXNnID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByb2xlID0gbXNnLmNsYXNzTGlzdC5jb250YWlucygndXNlcicpID8gJ1VTRVInIDogKG1zZy5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGVsJykgPyAnQUknIDogJ1NZU1RFTScpOwogICAgICAgICAgICAgICAgICAgIGlmIChyb2xlICE9PSAnU1lTVEVNJykgewogICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5VGV4dCArPSBgJHtyb2xlfTogJHttc2cuaW5uZXJUZXh0LnRyaW0oKX1cbmA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAoaGlzdG9yeVRleHQubGVuZ3RoID4gODAwMCkgaGlzdG9yeVRleHQgPSAiLi4uKHRydW5jYXRlZCkuLi5cbiIgKyBoaXN0b3J5VGV4dC5zbGljZSgtODAwMCk7CgogICAgICAgICAgICAgICAgaWYgKGhpc3RvcnlUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgcGFydHMucHVzaChgW0NPTlZFUlNBVElPTiBISVNUT1JZXVxuJHtoaXN0b3J5VGV4dH1cbltJTlNUUlVDVElPTl06IFVzYWdlIG9mIGhpc3RvcnkgaXMgdG8gbWFpbnRhaW4gY29udmVyc2F0aW9uIGNvbnRleHQuYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwYXJ0cy5qb2luKCJcblxuIik7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0b2dnbGVLZXlWaXNpYmlsaXR5KCkgewogICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcGlLZXlJbnB1dCcpOwogICAgICAgICAgICBjb25zdCBpY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwaUtleUV5ZUljb24nKTsKICAgICAgICAgICAgaWYgKGlucHV0LnR5cGUgPT09ICdwYXNzd29yZCcpIHsKICAgICAgICAgICAgICAgIGlucHV0LnR5cGUgPSAndGV4dCc7CiAgICAgICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhLWV5ZScpOwogICAgICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdmYS1leWUtc2xhc2gnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlucHV0LnR5cGUgPSAncGFzc3dvcmQnOwogICAgICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QucmVtb3ZlKCdmYS1leWUtc2xhc2gnKTsKICAgICAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnZmEtZXllJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgPC9zY3JpcHQ+CiAgICA8IS0tIENoYXQgVUkgSFRNTCAtLT4KICAgIDxidXR0b24gaWQ9ImNoYXRGYWIiIG9uY2xpY2s9InRvZ2dsZUNoYXQoKSI+CiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1yb2JvdCBmYS1sZyI+PC9pPgogICAgPC9idXR0b24+CgogICAgPGRpdiBpZD0iY2hhdFBhbmVsIj4KICAgICAgICA8ZGl2IGNsYXNzPSJjaGF0LWhlYWRlciI+CiAgICAgICAgICAgIDxzcGFuPjxpIGNsYXNzPSJmYXMgZmEtYnJhaW4gbXItMiI+PC9pPkdlbWluaSBBSSBBbmFseXN0PC9zcGFuPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyI+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWRvd25sb2FkIGN1cnNvci1wb2ludGVyIHRleHQtZ3JheS00MDAgaG92ZXI6dGV4dC13aGl0ZSB0cmFuc2l0aW9uLWNvbG9ycyIKICAgICAgICAgICAgICAgICAgICBvbmNsaWNrPSJzYXZlQ2hhdEhpc3RvcnkoKSIgdGl0bGU9IkRvd25sb2FkIEVkaXRlZCBDb252ZXJzYXRpb24gKFRYVCkiPjwvaT4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhwYW5kIGN1cnNvci1wb2ludGVyIHRleHQtZ3JheS00MDAgaG92ZXI6dGV4dC13aGl0ZSB0cmFuc2l0aW9uLWNvbG9ycyIKICAgICAgICAgICAgICAgICAgICBvbmNsaWNrPSJ0b2dnbGVGdWxsU2NyZWVuKCkiIHRpdGxlPSJGdWxsIFNjcmVlbiI+PC9pPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10aW1lcyBjdXJzb3ItcG9pbnRlciB0ZXh0LWdyYXktNDAwIGhvdmVyOnRleHQtcmVkLTQwMCB0cmFuc2l0aW9uLWNvbG9ycyIKICAgICAgICAgICAgICAgICAgICBvbmNsaWNrPSJ0b2dnbGVDaGF0KCkiIHRpdGxlPSJDbG9zZSI+PC9pPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPCEtLSBLZXkgQmFyIHdpdGggQWN0aW9ucyAtLT4KICAgICAgICA8ZGl2IGNsYXNzPSJhcGkta2V5LWJhciBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBweC0zIHB5LTIgYm9yZGVyLWIgYm9yZGVyLWdyYXktMTAwIGJnLWdyYXktNTAiPgogICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWtleSB0ZXh0LWFtYmVyLTYwMCI+PC9pPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyZWxhdGl2ZSBmbGV4LTEiPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InBhc3N3b3JkIiBpZD0iYXBpS2V5SW5wdXQiIHBsYWNlaG9sZGVyPSJHZW1pbmkgQVBJIEtleS4uLiIgb25jaGFuZ2U9InNhdmVBcGlLZXkoKSIKICAgICAgICAgICAgICAgICAgICBjbGFzcz0idy1mdWxsIHBsLTIgcHItOCBweS0xIHRleHQteHMgYm9yZGVyIHJvdW5kZWQgZm9jdXM6b3V0bGluZS1ub25lIGZvY3VzOmJvcmRlci1pbmRpZ28tNTAwIj4KICAgICAgICAgICAgICAgIDxpIGlkPSJhcGlLZXlFeWVJY29uIgogICAgICAgICAgICAgICAgICAgIGNsYXNzPSJmYXMgZmEtZXllIGFic29sdXRlIHJpZ2h0LTIgdG9wLTEuNSB0ZXh0LWdyYXktNDAwIGN1cnNvci1wb2ludGVyIGhvdmVyOnRleHQtZ3JheS02MDAiCiAgICAgICAgICAgICAgICAgICAgb25jbGljaz0idG9nZ2xlS2V5VmlzaWJpbGl0eSgpIj48L2k+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEgYm9yZGVyLWwgcGwtMiBib3JkZXItZ3JheS0zMDAiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJzYXZlQ2hhdEhpc3RvcnkoKSIKICAgICAgICAgICAgICAgICAgICBjbGFzcz0idGV4dC14cyBweC0yIHB5LTEgYmctd2hpdGUgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkIGhvdmVyOmJnLWdyYXktMTAwIHRleHQtZ3JheS03MDAiPgogICAgICAgICAgICAgICAgICAgIFNhdmUKICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJjbGVhckNoYXQoKSIKICAgICAgICAgICAgICAgICAgICBjbGFzcz0idGV4dC14cyBweC0yIHB5LTEgYmctd2hpdGUgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkIGhvdmVyOmJnLXJlZC01MCB0ZXh0LXJlZC02MDAiPgogICAgICAgICAgICAgICAgICAgIENsZWFyCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDwhLS0gQ29udGV4dCBUb2dnbGVzIC0tPgogICAgICAgIDxkaXYgY2xhc3M9ImNvbnRleHQtdG9nZ2xlcyBncmlkIGdyaWQtY29scy0zIGdhcC0xIHAtMiBiZy1ncmF5LTUwIGJvcmRlci1iIGJvcmRlci1ncmF5LTIwMCI+CiAgICAgICAgICAgIDxidXR0b24gaWQ9ImJ0bkNvbnRleHREYXRhIgogICAgICAgICAgICAgICAgY2xhc3M9InRleHQteHMgcHktMSBweC0xIGJvcmRlciByb3VuZGVkIGJnLXdoaXRlIHRleHQtZ3JheS01MDAgaG92ZXI6YmctZ3JheS0xMDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTEgdHJhbnNpdGlvbi1jb2xvcnMiCiAgICAgICAgICAgICAgICBvbmNsaWNrPSJ0b2dnbGVDb250ZXh0KCdkYXRhJykiIHRpdGxlPSJBdHRhY2ggRGF0YTogUGxhdGZvcm0sIEJyYW5kLCBNb2RlbCwgUHJpY2UgKFRvcCA0MDApIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZGF0YWJhc2UiPjwvaT4g5pW45pOa6LOH5paZCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGlkPSJidG5Db250ZXh0TWFudWFsIgogICAgICAgICAgICAgICAgY2xhc3M9InRleHQteHMgcHktMSBweC0xIGJvcmRlciByb3VuZGVkIGJnLXdoaXRlIHRleHQtZ3JheS01MDAgaG92ZXI6YmctZ3JheS0xMDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTEgdHJhbnNpdGlvbi1jb2xvcnMiCiAgICAgICAgICAgICAgICBvbmNsaWNrPSJ0b2dnbGVDb250ZXh0KCdtYW51YWwnKSIgdGl0bGU9IkF0dGFjaCBVSSBTb3VyY2UgQ29kZSI+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNvZGUiPjwvaT4g5pON5L2c6Kmi5ZWPCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGlkPSJidG5Db250ZXh0SGlzdG9yeSIKICAgICAgICAgICAgICAgIGNsYXNzPSJ0ZXh0LXhzIHB5LTEgcHgtMSBib3JkZXIgcm91bmRlZCBiZy13aGl0ZSB0ZXh0LWdyYXktNTAwIGhvdmVyOmJnLWdyYXktMTAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0xIHRyYW5zaXRpb24tY29sb3JzIgogICAgICAgICAgICAgICAgb25jbGljaz0idG9nZ2xlQ29udGV4dCgnaGlzdG9yeScpIiB0aXRsZT0iQXR0YWNoIENvbnZlcnNhdGlvbiBIaXN0b3J5Ij4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtaGlzdG9yeSI+PC9pPiDoqJjpjITlsI3oqbEKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXQtbWVzc2FnZXMiIGlkPSJjaGF0TWVzc2FnZXMiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGF0LW1zZyBzeXN0ZW0iPuatoei/ju+8geiri+i8uOWFpSBBUEkgS2V5IOmWi+Wni+OAgjwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJjaGF0LWlucHV0LWFyZWEiPgogICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImNoYXRJbnB1dCIgcGxhY2Vob2xkZXI9Iuiri+i8uOWFpeWVj+mhjC4uLiIKICAgICAgICAgICAgICAgIG9ua2V5cHJlc3M9ImlmKGV2ZW50LmtleT09PSdFbnRlcicpIHNlbmRDaGF0TWVzc2FnZSgpIj4KICAgICAgICAgICAgPCEtLSBWb2ljZSBJbnB1dCBCdXR0b24gaWYgbmVlZGVkLCBvciBrZWVwaW5nIHNpbXBsaWZpZWQgLS0+CiAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0ic2VuZENoYXRNZXNzYWdlKCkiCiAgICAgICAgICAgICAgICBjbGFzcz0idy0xMCBoLTEwIGJnLWluZGlnby02MDAgdGV4dC13aGl0ZSByb3VuZGVkLWZ1bGwgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgaG92ZXI6YmctaW5kaWdvLTcwMCBzaGFkb3ctc20gdHJhbnNpdGlvbi1jb2xvcnMiPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1wYXBlci1wbGFuZSI+PC9pPgogICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDwhLS0gQUkgTG9naWMgU2NyaXB0IC0tPgogICAgPHNjcmlwdD4KICAgICAgICAvLyAtLS0gU2V0dXAgQUkgVmFycyAtLS0KICAgICAgICBjb25zdCBhcGlLZXlJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcGlLZXlJbnB1dCcpOwogICAgICAgIGNvbnN0IGNoYXRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0SW5wdXQnKTsKICAgICAgICBjb25zdCBjaGF0TWVzc2FnZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdE1lc3NhZ2VzJyk7CgogICAgICAgIC8vIEluaXQKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gewogICAgICAgICAgICBsb2FkQXBpS2V5KCk7CiAgICAgICAgICAgIC8vIENoZWNrIGNvbnRleHQgc3RhdGVzIChvcHRpb25hbCByZXN0b3JhdGlvbikKICAgICAgICB9KTsKCiAgICAgICAgZnVuY3Rpb24gc2F2ZUFwaUtleSgpIHsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2dlbWluaV9hcGlfa2V5JywgYXBpS2V5SW5wdXQudmFsdWUpOyB9CiAgICAgICAgZnVuY3Rpb24gbG9hZEFwaUtleSgpIHsKICAgICAgICAgICAgY29uc3QgayA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnZW1pbmlfYXBpX2tleScpOwogICAgICAgICAgICBpZiAoayAmJiBhcGlLZXlJbnB1dCkgYXBpS2V5SW5wdXQudmFsdWUgPSBrOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlQ2hhdCgpIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXRQYW5lbCcpLmNsYXNzTGlzdC50b2dnbGUoJ3Zpc2libGUnKTsgfQoKICAgICAgICAvLyAtLS0gQ29yZSBHZW1pbmkgQVBJIChSRVNUKSAtLS0KICAgICAgICBhc3luYyBmdW5jdGlvbiBjYWxsR2VtaW5pQVBJKHByb21wdCwgc3lzdGVtSW5zdHJ1Y3Rpb24gPSAiIikgewogICAgICAgICAgICBjb25zdCB1c2VyS2V5ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dlbWluaV9hcGlfa2V5Jyk7CiAgICAgICAgICAgIGlmICghdXNlcktleSkgewogICAgICAgICAgICAgICAgYXBwZW5kTWVzc2FnZSgnc3lzdGVtJywgJ+KaoO+4jyDoq4vlhYjoqK3lrpogQVBJIEtleeOAgicpOwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEZhbGxiYWNrIGNoYWluIGhhbmRsZWQgbWFudWFsbHkgb3Igc2ltcGxlIG9uZSBtb2RlbCBmaXJzdAogICAgICAgICAgICAvLyBSZWZlcmVuY2UgdXNlZDogZ2VtaW5pLTIuNS1mbGFzaC1wcmV2aWV3LTA5LTIwMjUKICAgICAgICAgICAgLy8gVXBkYXRlZCB0byAyMDI2IHN0YW5kYXJkCiAgICAgICAgICAgIGNvbnN0IG1vZGVsID0gImdlbWluaS0yLjUtZmxhc2gtcHJldmlldy0wOS0yMDI1IjsKICAgICAgICAgICAgY29uc3QgdXJsID0gYGh0dHBzOi8vZ2VuZXJhdGl2ZWxhbmd1YWdlLmdvb2dsZWFwaXMuY29tL3YxYmV0YS9tb2RlbHMvJHttb2RlbH06Z2VuZXJhdGVDb250ZW50P2tleT0ke3VzZXJLZXl9YDsKCiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7CiAgICAgICAgICAgICAgICBjb250ZW50czogW3sgcGFydHM6IFt7IHRleHQ6IHByb21wdCB9XSB9XSwKICAgICAgICAgICAgICAgIHN5c3RlbUluc3RydWN0aW9uOiBzeXN0ZW1JbnN0cnVjdGlvbiA/IHsgcGFydHM6IFt7IHRleHQ6IHN5c3RlbUluc3RydWN0aW9uIH1dIH0gOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBnZW5lcmF0aW9uQ29uZmlnOiB7IHRlbXBlcmF0dXJlOiAwLjcsIG1heE91dHB1dFRva2VuczogMjAwMCB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBtYXhSZXRyaWVzID0gMzsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXhSZXRyaWVzOyBpKyspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LAogICAgICAgICAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVyciA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVyci5lcnJvcj8ubWVzc2FnZSB8fCAnQVBJIEVycm9yOiAnICsgcmVzcG9uc2Uuc3RhdHVzKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmNhbmRpZGF0ZXM/LlswXT8uY29udGVudD8ucGFydHM/LlswXT8udGV4dDsKCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgQXR0ZW1wdCAke2kgKyAxfSBmYWlsZWQ6YCwgZXJyb3IpOwogICAgICAgICAgICAgICAgICAgIGlmIChpID09PSBtYXhSZXRyaWVzIC0gMSkgdGhyb3cgZXJyb3I7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDEwMDAgKiBNYXRoLnBvdygyLCBpKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBhc3luYyBmdW5jdGlvbiBzZW5kQ2hhdE1lc3NhZ2UoKSB7CiAgICAgICAgICAgIGNvbnN0IHRleHQgPSBjaGF0SW5wdXQudmFsdWUudHJpbSgpOwogICAgICAgICAgICBpZiAoIXRleHQpIHJldHVybjsKCiAgICAgICAgICAgIGFwcGVuZE1lc3NhZ2UoJ3VzZXInLCB0ZXh0KTsKICAgICAgICAgICAgY2hhdElucHV0LnZhbHVlID0gJyc7CgogICAgICAgICAgICBjb25zdCBsb2FkaW5nSWQgPSAnbG9hZGluZy0nICsgRGF0ZS5ub3coKTsKICAgICAgICAgICAgYXBwZW5kTWVzc2FnZSgnbW9kZWwnLCAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4iPjwvaT4g5oCd6ICD5LitLi4uJywgbG9hZGluZ0lkKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBDb21iaW5lIENvbnRleHRzCiAgICAgICAgICAgICAgICBsZXQgZmluYWxQcm9tcHQgPSB0ZXh0OwogICAgICAgICAgICAgICAgY29uc3QgY29udGV4dFN0ciA9IGdldENvbWJpbmVkQ29udGV4dCgpOwoKICAgICAgICAgICAgICAgIGlmIChjb250ZXh0U3RyKSB7CiAgICAgICAgICAgICAgICAgICAgZmluYWxQcm9tcHQgPSBjb250ZXh0U3RyICsgIlxuXG5bVVNFUiBRVUVTVElPTl06ICIgKyB0ZXh0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2FsbEdlbWluaUFQSShmaW5hbFByb21wdCwgIuS9oOaYr+S4gOWAi+WwiOalreeahOmbu+WLleW3peWFt+WIhuaekOW4q+iIh+e2sumggeaTjeS9nOWKqeaJi+OAguiri+eUqOe5gemrlOS4reaWh+WbnuetlOOAguiLpeS9v+eUqOiAheipouWVj+aTjeS9nO+8jOiri+WPg+iAg+aTjeS9nOaJi+WGiuS4iuS4i+aWh+OAgiIpOwoKICAgICAgICAgICAgICAgIC8vIFVzZSBtYXJrZWQuanMgZm9yIHByb3BlciBNYXJrZG93biByZW5kZXJpbmcgKFRhYmxlcywgTGlzdHMsIEJvbGQsIGV0Yy4pCiAgICAgICAgICAgICAgICBsZXQgZm9ybWF0dGVkID0gbWFya2VkLnBhcnNlKHJlc3BvbnNlIHx8ICIiKTsKCiAgICAgICAgICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxvYWRpbmdJZCk7CiAgICAgICAgICAgICAgICBpZiAoZWwpIGVsLmlubmVySFRNTCA9IGZvcm1hdHRlZDsKCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxvYWRpbmdJZCk7CiAgICAgICAgICAgICAgICBpZiAoZWwpIGVsLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz0idGV4dC1yZWQtNTAwIj7pjK/oqqQ6ICR7ZXJyb3IubWVzc2FnZX08L3NwYW4+YDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYXBwZW5kTWVzc2FnZShyb2xlLCBjb250ZW50LCBpZCA9IG51bGwpIHsKICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIGRpdi5jbGFzc05hbWUgPSBgY2hhdC1tc2cgJHtyb2xlfWA7CiAgICAgICAgICAgIGlmIChpZCkgZGl2LmlkID0gaWQ7CiAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSBjb250ZW50OwogICAgICAgICAgICBjaGF0TWVzc2FnZXMuYXBwZW5kQ2hpbGQoZGl2KTsKICAgICAgICAgICAgY2hhdE1lc3NhZ2VzLnNjcm9sbFRvcCA9IGNoYXRNZXNzYWdlcy5zY3JvbGxIZWlnaHQ7CiAgICAgICAgfQoKICAgICAgICBhc3luYyBmdW5jdGlvbiBzYXZlQ2hhdEhpc3RvcnkoKSB7CiAgICAgICAgICAgIGlmIChjaGF0TWVzc2FnZXMuaW5uZXJUZXh0LnRyaW0oKS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCJObyBoaXN0b3J5IHRvIHNhdmUuIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENvbGxlY3QgbWVzc2FnZXMKICAgICAgICAgICAgbGV0IGNvbnRlbnQgPSAiQUkgQ2hhdCBIaXN0b3J5XG49PT09PT09PT09PT09PT09PVxuXG4iOwogICAgICAgICAgICBjb25zdCBtc2dzID0gY2hhdE1lc3NhZ2VzLnF1ZXJ5U2VsZWN0b3JBbGwoJy5jaGF0LW1zZycpOwogICAgICAgICAgICBtc2dzLmZvckVhY2gobXNnID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJvbGUgPSBtc2cuY2xhc3NMaXN0LmNvbnRhaW5zKCd1c2VyJykgPyAnVVNFUicgOiAobXNnLmNsYXNzTGlzdC5jb250YWlucygnbW9kZWwnKSA/ICdBSScgOiAnU1lTVEVNJyk7CiAgICAgICAgICAgICAgICBjb250ZW50ICs9IGBbJHtyb2xlfV1cbiR7bXNnLmlubmVyVGV4dH1cblxuYDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBHZW5lcmF0ZSBGaWxlbmFtZQogICAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICBjb25zdCBkYXRlU3RyID0gbm93LnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwgMTApLnJlcGxhY2UoLy0vZywgJycpOwogICAgICAgICAgICBjb25zdCB0aW1lU3RyID0gbm93LnRvVGltZVN0cmluZygpLnNsaWNlKDAsIDUpLnJlcGxhY2UoLzovZywgJycpOwogICAgICAgICAgICBjb25zdCBmaWxlbmFtZSA9IGBBSV9DaGF0XyR7ZGF0ZVN0cn1fJHt0aW1lU3RyfS50eHRgOwoKICAgICAgICAgICAgLy8gQ2xpZW50IERvd25sb2FkCiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbY29udGVudF0sIHsgdHlwZTogJ3RleHQvcGxhaW4nIH0pOwogICAgICAgICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICAgICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICBhLmhyZWYgPSB1cmw7CiAgICAgICAgICAgIGEuZG93bmxvYWQgPSBmaWxlbmFtZTsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgICAgICAgICAgYS5jbGljaygpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOwogICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7CiAgICAgICAgfQoKCiAgICAgICAgLy8gRG93bmxvYWQgRmlsdGVyZWQgRGF0YSBhcyBDU1YKICAgICAgICBmdW5jdGlvbiBkb3dubG9hZENzdkNvbnRleHQoKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZmlsdGVyZWREYXRhID09PSAndW5kZWZpbmVkJyB8fCBmaWx0ZXJlZERhdGEubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBhbGVydCgiTm8gZGF0YSB0byBkb3dubG9hZC4iKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gR2V0IGFsbCBoZWFkZXJzCiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBPYmplY3Qua2V5cyhmaWx0ZXJlZERhdGFbMF0pOwogICAgICAgICAgICBjb25zdCBjc3ZSb3dzID0gW2hlYWRlcnMuam9pbignLCcpXTsKCiAgICAgICAgICAgIGZpbHRlcmVkRGF0YS5mb3JFYWNoKHJvdyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBoZWFkZXJzLm1hcChoZWFkZXIgPT4gewogICAgICAgICAgICAgICAgICAgIC8vIEVzY2FwZSBxdW90ZXMgYW5kIHdyYXAgaW4gcXVvdGVzCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gcm93W2hlYWRlcl0gIT09IG51bGwgJiYgcm93W2hlYWRlcl0gIT09IHVuZGVmaW5lZCA/IFN0cmluZyhyb3dbaGVhZGVyXSkgOiAnJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlc2NhcGVkID0gdmFsLnJlcGxhY2UoLyIvZywgJyIiJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAiJHtlc2NhcGVkfSJgOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjc3ZSb3dzLnB1c2godmFsdWVzLmpvaW4oJywnKSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY29uc3QgY3N2Q29udGVudCA9ICJcdUZFRkYiICsgY3N2Um93cy5qb2luKCdcbicpOyAvLyBBZGQgQk9NIGZvciBFeGNlbCBjb21wYXRpYmlsaXR5CiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbY3N2Q29udGVudF0sIHsgdHlwZTogJ3RleHQvY3N2O2NoYXJzZXQ9dXRmLTg7JyB9KTsKICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICAgICAgYS5ocmVmID0gdXJsOwogICAgICAgICAgICBhLmRvd25sb2FkID0gYFBUX0RhdGFfRXhwb3J0XyR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsIDEwKX0uY3N2YDsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgICAgICAgICAgYS5jbGljaygpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOwogICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjbGVhckNoYXQoKSB7CiAgICAgICAgICAgIGlmICghY29uZmlybSgiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNsZWFyIHRoZSBjb252ZXJzYXRpb24/IikpIHJldHVybjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXRNZXNzYWdlcycpLmlubmVySFRNTCA9CiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iY2hhdC1tc2cgc3lzdGVtIj5TeXN0ZW06IDxiPkNoYXQgQ2xlYXJlZC48L2I+PGJyPkhpc3RvcnkgbWVtb3J5IHJlc2V0LjwvZGl2Pic7CiAgICAgICAgfQoKCiAgICAgICAgd2luZG93LmhhbmRsZUNoYXRLZXkgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicpIHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsgLy8gUHJldmVudCBkZWZhdWx0IGlmIGl0J3MgaW5zaWRlIGEgZm9ybSBvciB3ZWlyZCBiZWhhdmlvcgogICAgICAgICAgICAgICAgc2VuZENoYXRNZXNzYWdlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgPC9zY3JpcHQ+CgogICAgPCEtLSBDdXN0b20gU29ydCBNb2RhbCAtLT4KICAgIDxkaXYgaWQ9InNvcnRNb2RhbCIgY2xhc3M9ImZpeGVkIGluc2V0LTAgei1bOTk5OF0gaGlkZGVuIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBiZy1ibGFjay81MCBiYWNrZHJvcC1ibHVyLXNtIj4KICAgICAgICA8ZGl2IGNsYXNzPSJiZy13aGl0ZSByb3VuZGVkLXhsIHNoYWRvdy0yeGwgdy1bNzAwcHhdIG1heC1oLVs4NXZoXSBmbGV4IGZsZXgtY29sIG92ZXJmbG93LWhpZGRlbiI+CiAgICAgICAgICAgIDwhLS0gSGVhZGVyIC0tPgogICAgICAgICAgICA8ZGl2CiAgICAgICAgICAgICAgICBjbGFzcz0icC00IGJvcmRlci1iIGJnLWdyYWRpZW50LXRvLXIgZnJvbS1ncmF5LTUwIHRvLWdyYXktMTAwIGZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBzaHJpbmstMCI+CiAgICAgICAgICAgICAgICA8aDMgY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LWxnIHRleHQtZ3JheS04MDAiPjxpCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPSJmYXMgZmEtc29ydC1hbW91bnQtZG93biBtci0yIHRleHQtaW5kaWdvLTUwMCI+PC9pPuiHquioguaOkuW6jzwvaDM+CiAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9ImNsb3NlU29ydE1vZGFsKCkiIGNsYXNzPSJ0ZXh0LWdyYXktNDAwIGhvdmVyOnRleHQtZ3JheS02MDAgdHJhbnNpdGlvbi1jb2xvcnMiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMgdGV4dC1sZyI+PC9pPgogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8IS0tIEJvZHkgLS0+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggZmxleC0xIG92ZXJmbG93LWhpZGRlbiI+CiAgICAgICAgICAgICAgICA8IS0tIFBsYXRmb3JtIExpc3QgLS0+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LTEgcC00IGJvcmRlci1yIG92ZXJmbG93LXktYXV0byI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIG1iLTMiPgogICAgICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTcwMCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXN0b3JlIHRleHQtYmx1ZS01MDAiPjwvaT4gUGxhdGZvcm0g6aCG5bqPCiAgICAgICAgICAgICAgICAgICAgICAgIDwvaDQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0icmV2ZXJzZVNvcnRMaXN0KCdwbGF0Zm9ybScpIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9InB4LTIgcHktMSB0ZXh0LXhzIGJvcmRlciBib3JkZXItZ3JheS0zMDAgcm91bmRlZCBob3ZlcjpiZy1ncmF5LTEwMCB0cmFuc2l0aW9uLWNvbG9ycyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPSLpoZvlgJLpoIbluo8iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leGNoYW5nZS1hbHQgZmEtcm90YXRlLTkwIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDx1bCBpZD0ic29ydExpc3RQbGF0Zm9ybSIgY2xhc3M9InNvcnRhYmxlLWxpc3Qgc3BhY2UteS0xIj48L3VsPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8IS0tIEJyYW5kIExpc3QgLS0+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LTEgcC00IG92ZXJmbG93LXktYXV0byI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIG1iLTMiPgogICAgICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTcwMCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRhZyB0ZXh0LWdyZWVuLTUwMCI+PC9pPiBCcmFuZCDpoIbluo8KICAgICAgICAgICAgICAgICAgICAgICAgPC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJyZXZlcnNlU29ydExpc3QoJ2JyYW5kJykiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0icHgtMiBweS0xIHRleHQteHMgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkIGhvdmVyOmJnLWdyYXktMTAwIHRyYW5zaXRpb24tY29sb3JzIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU9Iumhm+WAkumghuW6jyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2hhbmdlLWFsdCBmYS1yb3RhdGUtOTAiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPHVsIGlkPSJzb3J0TGlzdEJyYW5kIiBjbGFzcz0ic29ydGFibGUtbGlzdCBzcGFjZS15LTEiPjwvdWw+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwhLS0gRm9vdGVyIC0tPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTQgYm9yZGVyLXQgYmctZ3JheS01MCBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgc2hyaW5rLTAiPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTQwMCI+PGkgY2xhc3M9ImZhcyBmYS1ncmlwLWxpbmVzIG1yLTEiPjwvaT7mi5bnp7vpoIXnm67oqr/mlbTpoIbluo88L3NwYW4+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9InJlc2V0U29ydE9yZGVyKCkiCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPSJweC0zIHB5LTEuNSB0ZXh0LXNtIGJvcmRlciBib3JkZXItZ3JheS0zMDAgcm91bmRlZCBob3ZlcjpiZy1ncmF5LTEwMCB0cmFuc2l0aW9uLWNvbG9ycyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdW5kbyBtci0xIj48L2k+6YeN572u54K6IEEtWgogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0ic2F2ZVNvcnRPcmRlcigpIgogICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0icHgtNCBweS0xLjUgdGV4dC1zbSBiZy1pbmRpZ28tNjAwIHRleHQtd2hpdGUgcm91bmRlZCBob3ZlcjpiZy1pbmRpZ28tNzAwIHRyYW5zaXRpb24tY29sb3JzIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGVjayBtci0xIj48L2k+5YSy5a2YCiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8c3R5bGU+CiAgICAgICAgLyogU29ydGFibGUgTGlzdCBTdHlsZXMgKi8KICAgICAgICAuc29ydGFibGUtbGlzdCBsaSB7CiAgICAgICAgICAgIHBhZGRpbmc6IDEwcHggMTRweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNlNWU3ZWI7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDsKICAgICAgICAgICAgY3Vyc29yOiBncmFiOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBnYXA6IDEwcHg7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjE1cyBlYXNlOwogICAgICAgICAgICB1c2VyLXNlbGVjdDogbm9uZTsKICAgICAgICB9CgogICAgICAgIC5zb3J0YWJsZS1saXN0IGxpOmhvdmVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2Y5ZmFmYjsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiAjZDFkNWRiOwogICAgICAgIH0KCiAgICAgICAgLnNvcnRhYmxlLWxpc3QgbGk6YWN0aXZlIHsKICAgICAgICAgICAgY3Vyc29yOiBncmFiYmluZzsKICAgICAgICB9CgogICAgICAgIC5zb3J0YWJsZS1saXN0IGxpIC5kcmFnLWhhbmRsZSB7CiAgICAgICAgICAgIGNvbG9yOiAjOWNhM2FmOwogICAgICAgICAgICBmb250LXNpemU6IDAuNzVyZW07CiAgICAgICAgfQoKICAgICAgICAuc29ydGFibGUtbGlzdCBsaS5kcmFnZ2luZyB7CiAgICAgICAgICAgIG9wYWNpdHk6IDAuNDsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2RiZWFmZTsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiAjOTNjNWZkOwogICAgICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMDIpOwogICAgICAgIH0KCiAgICAgICAgLnNvcnRhYmxlLWxpc3QgbGkuZHJhZy1vdmVyIHsKICAgICAgICAgICAgYm9yZGVyLXRvcDogMnB4IHNvbGlkICM2MzY2ZjE7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IC0xcHg7CiAgICAgICAgfQogICAgPC9zdHlsZT4KCiAgICA8c2NyaXB0PgogICAgICAgIC8vID09PT09PT09PT0gQ3VzdG9tIFNvcnQgTG9naWMgPT09PT09PT09PQogICAgICAgIGxldCBjdXN0b21Tb3J0T3JkZXIgPSB7CiAgICAgICAgICAgIHBsYXRmb3JtOiBbXSwKICAgICAgICAgICAgYnJhbmQ6IFtdCiAgICAgICAgfTsKCiAgICAgICAgLy8gTG9hZCBmcm9tIGxvY2FsU3RvcmFnZSBvbiBpbml0CiAgICAgICAgZnVuY3Rpb24gbG9hZFNvcnRPcmRlcigpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHNhdmVkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ1BUX0NVU1RPTV9TT1JUJyk7CiAgICAgICAgICAgICAgICBpZiAoc2F2ZWQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHNhdmVkKTsKICAgICAgICAgICAgICAgICAgICBjdXN0b21Tb3J0T3JkZXIucGxhdGZvcm0gPSBwYXJzZWQucGxhdGZvcm0gfHwgW107CiAgICAgICAgICAgICAgICAgICAgY3VzdG9tU29ydE9yZGVyLmJyYW5kID0gcGFyc2VkLmJyYW5kIHx8IFtdOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbU29ydF0gTG9hZGVkIGN1c3RvbSBzb3J0IG9yZGVyIGZyb20gbG9jYWxTdG9yYWdlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignW1NvcnRdIEZhaWxlZCB0byBsb2FkIHNvcnQgb3JkZXI6JywgZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFNhdmUgdG8gbG9jYWxTdG9yYWdlCiAgICAgICAgZnVuY3Rpb24gc2F2ZVNvcnRPcmRlcigpIHsKICAgICAgICAgICAgLy8gUmVhZCBjdXJyZW50IGxpc3Qgb3JkZXIgZnJvbSBET00KICAgICAgICAgICAgY29uc3QgcGxhdGZvcm1MaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvcnRMaXN0UGxhdGZvcm0nKTsKICAgICAgICAgICAgY29uc3QgYnJhbmRMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvcnRMaXN0QnJhbmQnKTsKCiAgICAgICAgICAgIGN1c3RvbVNvcnRPcmRlci5wbGF0Zm9ybSA9IFsuLi5wbGF0Zm9ybUxpc3QucXVlcnlTZWxlY3RvckFsbCgnbGknKV0ubWFwKGxpID0+IGxpLmRhdGFzZXQudmFsdWUpOwogICAgICAgICAgICBjdXN0b21Tb3J0T3JkZXIuYnJhbmQgPSBbLi4uYnJhbmRMaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJyldLm1hcChsaSA9PiBsaS5kYXRhc2V0LnZhbHVlKTsKCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdQVF9DVVNUT01fU09SVCcsIEpTT04uc3RyaW5naWZ5KGN1c3RvbVNvcnRPcmRlcikpOwogICAgICAgICAgICBjb25zb2xlLmxvZygnW1NvcnRdIFNhdmVkIGN1c3RvbSBzb3J0IG9yZGVyOicsIGN1c3RvbVNvcnRPcmRlcik7CgogICAgICAgICAgICBjbG9zZVNvcnRNb2RhbCgpOwoKICAgICAgICAgICAgLy8gVHJpZ2dlciByZS1yZW5kZXIgb2YgY3VycmVudCB2aWV3CiAgICAgICAgICAgIGlmICh0eXBlb2YgYXBwbHlGaWx0ZXJzID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICBhcHBseUZpbHRlcnMoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUmVzZXQgdG8gQS1aCiAgICAgICAgZnVuY3Rpb24gcmVzZXRTb3J0T3JkZXIoKSB7CiAgICAgICAgICAgIGN1c3RvbVNvcnRPcmRlci5wbGF0Zm9ybSA9IFtdOwogICAgICAgICAgICBjdXN0b21Tb3J0T3JkZXIuYnJhbmQgPSBbXTsKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ1BUX0NVU1RPTV9TT1JUJyk7CgogICAgICAgICAgICAvLyBSZS1wb3B1bGF0ZSBsaXN0cyB3aXRoIEEtWiBvcmRlcgogICAgICAgICAgICBwb3B1bGF0ZVNvcnRMaXN0cygpOwogICAgICAgICAgICBjb25zb2xlLmxvZygnW1NvcnRdIFJlc2V0IHRvIEEtWiBvcmRlcicpOwogICAgICAgIH0KCiAgICAgICAgLy8gUmV2ZXJzZSB0aGUgb3JkZXIgb2YgYSBsaXN0CiAgICAgICAgZnVuY3Rpb24gcmV2ZXJzZVNvcnRMaXN0KHR5cGUpIHsKICAgICAgICAgICAgY29uc3QgbGlzdElkID0gdHlwZSA9PT0gJ3BsYXRmb3JtJyA/ICdzb3J0TGlzdFBsYXRmb3JtJyA6ICdzb3J0TGlzdEJyYW5kJzsKICAgICAgICAgICAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxpc3RJZCk7CiAgICAgICAgICAgIGlmICghbGlzdCkgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBbLi4ubGlzdC5xdWVyeVNlbGVjdG9yQWxsKCdsaScpXTsKICAgICAgICAgICAgaXRlbXMucmV2ZXJzZSgpOwoKICAgICAgICAgICAgLy8gUmUtYXBwZW5kIGluIHJldmVyc2VkIG9yZGVyCiAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goaXRlbSA9PiBsaXN0LmFwcGVuZENoaWxkKGl0ZW0pKTsKCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbU29ydF0gUmV2ZXJzZWQgJHt0eXBlfSBsaXN0YCk7CiAgICAgICAgfQoKICAgICAgICAvLyBPcGVuIE1vZGFsCiAgICAgICAgZnVuY3Rpb24gb3BlblNvcnRNb2RhbCgpIHsKICAgICAgICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29ydE1vZGFsJyk7CiAgICAgICAgICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdmbGV4Jyk7CgogICAgICAgICAgICBwb3B1bGF0ZVNvcnRMaXN0cygpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2xvc2UgTW9kYWwKICAgICAgICBmdW5jdGlvbiBjbG9zZVNvcnRNb2RhbCgpIHsKICAgICAgICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29ydE1vZGFsJyk7CiAgICAgICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdmbGV4Jyk7CiAgICAgICAgfQoKICAgICAgICAvLyBQb3B1bGF0ZSB0aGUgc29ydGFibGUgbGlzdHMKICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZVNvcnRMaXN0cygpIHsKICAgICAgICAgICAgY29uc3QgcGxhdGZvcm1MaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvcnRMaXN0UGxhdGZvcm0nKTsKICAgICAgICAgICAgY29uc3QgYnJhbmRMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvcnRMaXN0QnJhbmQnKTsKCiAgICAgICAgICAgIC8vIEdldCBhbGwgdW5pcXVlIHZhbHVlcyBmcm9tIG1lcmdlZERhdGEKICAgICAgICAgICAgY29uc3QgYWxsUGxhdGZvcm1zID0gbmV3IFNldCgpOwogICAgICAgICAgICBjb25zdCBhbGxCcmFuZHMgPSBuZXcgU2V0KCk7CgogICAgICAgICAgICBpZiAodHlwZW9mIG1lcmdlZERhdGEgIT09ICd1bmRlZmluZWQnICYmIG1lcmdlZERhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgbWVyZ2VkRGF0YS5mb3JFYWNoKHJvdyA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJvd1snUGxhdGZvcm0nXSkgYWxsUGxhdGZvcm1zLmFkZChyb3dbJ1BsYXRmb3JtJ10pOwogICAgICAgICAgICAgICAgICAgIGlmIChyb3dbJ0JyYW5kJ10pIGFsbEJyYW5kcy5hZGQocm93WydCcmFuZCddKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTb3J0OiB1c2UgY3VzdG9tIG9yZGVyIGlmIGF2YWlsYWJsZSwgZWxzZSBBLVoKICAgICAgICAgICAgY29uc3Qgc29ydGVkUGxhdGZvcm1zID0gZ2V0U29ydGVkQXJyYXkoWy4uLmFsbFBsYXRmb3Jtc10sICdwbGF0Zm9ybScpOwogICAgICAgICAgICBjb25zdCBzb3J0ZWRCcmFuZHMgPSBnZXRTb3J0ZWRBcnJheShbLi4uYWxsQnJhbmRzXSwgJ2JyYW5kJyk7CgogICAgICAgICAgICAvLyBSZW5kZXIgbGlzdHMKICAgICAgICAgICAgcGxhdGZvcm1MaXN0LmlubmVySFRNTCA9IHNvcnRlZFBsYXRmb3Jtcy5tYXAocCA9PiBgCiAgICAgICAgICAgICAgICA8bGkgZHJhZ2dhYmxlPSJ0cnVlIiBkYXRhLXZhbHVlPSIke3B9Ij4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZHJhZy1oYW5kbGUiPjxpIGNsYXNzPSJmYXMgZmEtZ3JpcC12ZXJ0aWNhbCI+PC9pPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZmxleC0xIHRleHQtc20iPiR7cH08L3NwYW4+CiAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICBgKS5qb2luKCcnKTsKCiAgICAgICAgICAgIGJyYW5kTGlzdC5pbm5lckhUTUwgPSBzb3J0ZWRCcmFuZHMubWFwKGIgPT4gYAogICAgICAgICAgICAgICAgPGxpIGRyYWdnYWJsZT0idHJ1ZSIgZGF0YS12YWx1ZT0iJHtifSI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRyYWctaGFuZGxlIj48aSBjbGFzcz0iZmFzIGZhLWdyaXAtdmVydGljYWwiPjwvaT48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZsZXgtMSB0ZXh0LXNtIj4ke2J9PC9zcGFuPgogICAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgYCkuam9pbignJyk7CgogICAgICAgICAgICAvLyBFbmFibGUgZHJhZy1hbmQtZHJvcAogICAgICAgICAgICBpbml0RHJhZ2dhYmxlKHBsYXRmb3JtTGlzdCk7CiAgICAgICAgICAgIGluaXREcmFnZ2FibGUoYnJhbmRMaXN0KTsKICAgICAgICB9CgogICAgICAgIC8vIEhlbHBlcjogR2V0IHNvcnRlZCBhcnJheSBiYXNlZCBvbiBjdXN0b20gb3JkZXIKICAgICAgICBmdW5jdGlvbiBnZXRTb3J0ZWRBcnJheShhcnIsIHR5cGUpIHsKICAgICAgICAgICAgY29uc3Qgb3JkZXIgPSBjdXN0b21Tb3J0T3JkZXJbdHlwZV0gfHwgW107CiAgICAgICAgICAgIGlmIChvcmRlci5sZW5ndGggPT09IDApIHJldHVybiBhcnIuc29ydCgoYSwgYikgPT4gYS5sb2NhbGVDb21wYXJlKGIpKTsKCiAgICAgICAgICAgIHJldHVybiBhcnIuc29ydCgoYSwgYikgPT4gewogICAgICAgICAgICAgICAgY29uc3QgaWR4QSA9IG9yZGVyLmluZGV4T2YoYSk7CiAgICAgICAgICAgICAgICBjb25zdCBpZHhCID0gb3JkZXIuaW5kZXhPZihiKTsKICAgICAgICAgICAgICAgIGlmIChpZHhBID09PSAtMSAmJiBpZHhCID09PSAtMSkgcmV0dXJuIGEubG9jYWxlQ29tcGFyZShiKTsKICAgICAgICAgICAgICAgIGlmIChpZHhBID09PSAtMSkgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICBpZiAoaWR4QiA9PT0gLTEpIHJldHVybiAtMTsKICAgICAgICAgICAgICAgIHJldHVybiBpZHhBIC0gaWR4QjsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBJbml0aWFsaXplIGRyYWctYW5kLWRyb3AgZm9yIGEgbGlzdAogICAgICAgIGZ1bmN0aW9uIGluaXREcmFnZ2FibGUobGlzdCkgewogICAgICAgICAgICBsZXQgZHJhZ2dlZEl0ZW0gPSBudWxsOwoKICAgICAgICAgICAgbGlzdC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgZHJhZ2dlZEl0ZW0gPSBlLnRhcmdldC5jbG9zZXN0KCdsaScpOwogICAgICAgICAgICAgICAgaWYgKGRyYWdnZWRJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgZHJhZ2dlZEl0ZW0uY2xhc3NMaXN0LmFkZCgnZHJhZ2dpbmcnKTsKICAgICAgICAgICAgICAgICAgICBlLmRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkID0gJ21vdmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGxpc3QuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VuZCcsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZHJhZ2dlZEl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBkcmFnZ2VkSXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpOwogICAgICAgICAgICAgICAgICAgIGRyYWdnZWRJdGVtID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxpc3QucXVlcnlTZWxlY3RvckFsbCgnbGknKS5mb3JFYWNoKGxpID0+IGxpLmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWctb3ZlcicpKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBsaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGUuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSAnbW92ZSc7CgogICAgICAgICAgICAgICAgY29uc3QgYWZ0ZXJFbGVtZW50ID0gZ2V0RHJhZ0FmdGVyRWxlbWVudChsaXN0LCBlLmNsaWVudFkpOwogICAgICAgICAgICAgICAgbGlzdC5xdWVyeVNlbGVjdG9yQWxsKCdsaScpLmZvckVhY2gobGkgPT4gbGkuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZy1vdmVyJykpOwoKICAgICAgICAgICAgICAgIGlmIChhZnRlckVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICBhZnRlckVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZHJhZy1vdmVyJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgbGlzdC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGFmdGVyRWxlbWVudCA9IGdldERyYWdBZnRlckVsZW1lbnQobGlzdCwgZS5jbGllbnRZKTsKCiAgICAgICAgICAgICAgICBpZiAoZHJhZ2dlZEl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYWZ0ZXJFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QuaW5zZXJ0QmVmb3JlKGRyYWdnZWRJdGVtLCBhZnRlckVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QuYXBwZW5kQ2hpbGQoZHJhZ2dlZEl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBsaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJykuZm9yRWFjaChsaSA9PiBsaS5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnLW92ZXInKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gSGVscGVyOiBGaW5kIGVsZW1lbnQgdG8gaW5zZXJ0IGJlZm9yZQogICAgICAgIGZ1bmN0aW9uIGdldERyYWdBZnRlckVsZW1lbnQobGlzdCwgeSkgewogICAgICAgICAgICBjb25zdCBkcmFnZ2FibGVFbGVtZW50cyA9IFsuLi5saXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpOm5vdCguZHJhZ2dpbmcpJyldOwoKICAgICAgICAgICAgcmV0dXJuIGRyYWdnYWJsZUVsZW1lbnRzLnJlZHVjZSgoY2xvc2VzdCwgY2hpbGQpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGJveCA9IGNoaWxkLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0geSAtIGJveC50b3AgLSBib3guaGVpZ2h0IC8gMjsKCiAgICAgICAgICAgICAgICBpZiAob2Zmc2V0IDwgMCAmJiBvZmZzZXQgPiBjbG9zZXN0Lm9mZnNldCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7IG9mZnNldDogb2Zmc2V0LCBlbGVtZW50OiBjaGlsZCB9OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xvc2VzdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgeyBvZmZzZXQ6IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSB9KS5lbGVtZW50OwogICAgICAgIH0KCiAgICAgICAgLy8gPT09PT09PT09PSBJbnRlZ3JhdGlvbjogQ3VzdG9tIHNvcnQgZm9yIHJlbmRlciBmdW5jdGlvbnMgPT09PT09PT09PQogICAgICAgIC8vIFRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIGNhbGxlZCBieSByZW5kZXJHcmlkLCB1cGRhdGVTY2F0dGVyQ2hhcnQsIHVwZGF0ZVBpdm90VGFibGUKICAgICAgICB3aW5kb3cuZ2V0Q3VzdG9tU29ydGVkVmFsdWVzID0gZnVuY3Rpb24gKHZhbHVlcywgZmllbGRLZXkpIHsKICAgICAgICAgICAgY29uc3QgdHlwZSA9IGZpZWxkS2V5LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3BsYXRmb3JtJykgPyAncGxhdGZvcm0nIDoKICAgICAgICAgICAgICAgIGZpZWxkS2V5LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2JyYW5kJykgPyAnYnJhbmQnIDogbnVsbDsKCiAgICAgICAgICAgIGlmICghdHlwZSkgcmV0dXJuIHZhbHVlcy5zb3J0KChhLCBiKSA9PiBTdHJpbmcoYSkubG9jYWxlQ29tcGFyZShTdHJpbmcoYikpKTsKCiAgICAgICAgICAgIGNvbnN0IG9yZGVyID0gY3VzdG9tU29ydE9yZGVyW3R5cGVdIHx8IFtdOwogICAgICAgICAgICBpZiAob3JkZXIubGVuZ3RoID09PSAwKSByZXR1cm4gdmFsdWVzLnNvcnQoKGEsIGIpID0+IFN0cmluZyhhKS5sb2NhbGVDb21wYXJlKFN0cmluZyhiKSkpOwoKICAgICAgICAgICAgcmV0dXJuIHZhbHVlcy5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBpZHhBID0gb3JkZXIuaW5kZXhPZihhKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlkeEIgPSBvcmRlci5pbmRleE9mKGIpOwogICAgICAgICAgICAgICAgaWYgKGlkeEEgPT09IC0xICYmIGlkeEIgPT09IC0xKSByZXR1cm4gU3RyaW5nKGEpLmxvY2FsZUNvbXBhcmUoU3RyaW5nKGIpKTsKICAgICAgICAgICAgICAgIGlmIChpZHhBID09PSAtMSkgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICBpZiAoaWR4QiA9PT0gLTEpIHJldHVybiAtMTsKICAgICAgICAgICAgICAgIHJldHVybiBpZHhBIC0gaWR4QjsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgLy8gTG9hZCBzb3J0IG9yZGVyIG9uIHBhZ2UgbG9hZAogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBsb2FkU29ydE9yZGVyKTsKCiAgICAgICAgLy8gQ2xvc2UgbW9kYWwgb24gYmFja2Ryb3AgY2xpY2sKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29ydE1vZGFsJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmlkID09PSAnc29ydE1vZGFsJykgY2xvc2VTb3J0TW9kYWwoKTsKICAgICAgICB9KTsKICAgIDwvc2NyaXB0Pgo8L2JvZHk+Cgo8L2h0bWw+"))));
    </script>
    <noscript>Please enable JavaScript to view this page.</noscript>
</body>
</html>